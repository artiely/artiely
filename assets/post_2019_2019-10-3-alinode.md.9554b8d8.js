import{o as e,c as n,f as t,a,x as l}from"./app.5f3fb606.js";const o='{"title":"Nodejs通用业务模块","description":"","frontmatter":{"title":"Nodejs通用业务模块","tag":["nodejs","alinode"],"author":"Artiely","date":"2019-10-3","cover":"https://gitee.com/artiely/Figure-bed/raw/master/images/20200315144031.png","base64":"9ae3a9"},"headers":[{"level":2,"title":"目标","slug":"目标"},{"level":2,"title":"why","slug":"why"},{"level":2,"title":"nodejs之生态","slug":"nodejs之生态"},{"level":3,"title":"2019年前端，选择Nodejs 还是 PHP？","slug":"2019年前端选择nodejs-还是-php"},{"level":3,"title":"Node.js 在双十一中有哪些应用，表现如何？","slug":"nodejs-在双十一中有哪些应用表现如何"},{"level":2,"title":"接入alinode性能平台","slug":"接入alinode性能平台"},{"level":3,"title":"产品概述","slug":"产品概述"},{"level":3,"title":"应用场景","slug":"应用场景"},{"level":3,"title":"功能特性","slug":"功能特性"},{"level":3,"title":"快速入门","slug":"快速入门"},{"level":3,"title":"I. 创建应用","slug":"i-创建应用"},{"level":3,"title":"II. 服务器部署 Node.js 性能平台","slug":"ii-服务器部署-nodejs-性能平台"},{"level":3,"title":"性能指标","slug":"性能指标"}],"relativePath":"post/2019/2019-10-3-alinode.md","lastUpdated":1629110830090}',i={},c=t('<h1 id="nodejs通用业务模块"><a class="header-anchor" href="#nodejs通用业务模块" aria-hidden="true">#</a> Nodejs通用业务模块</h1><h2 id="目标"><a class="header-anchor" href="#目标" aria-hidden="true">#</a> 目标</h2><ul><li>了解nodejs的生态与未来</li><li>理解alinode监控体系的应用场景与使用</li><li>理解nodejs在云原生应用领域的生态与发展</li></ul><h2 id="why"><a class="header-anchor" href="#why" aria-hidden="true">#</a> why</h2><ul><li>知己知彼，百战不殆</li><li>开阔技术视野，技术的提升不能仅仅停留在crud领域</li></ul><h2 id="nodejs之生态"><a class="header-anchor" href="#nodejs之生态" aria-hidden="true">#</a> nodejs之生态</h2><h3 id="2019年前端选择nodejs-还是-php"><a class="header-anchor" href="#2019年前端选择nodejs-还是-php" aria-hidden="true">#</a> 2019年前端，选择Nodejs 还是 PHP？</h3><p>观点：</p><ul><li>作为前端玩一玩可以学nodejs，真正的后端还是选择php</li><li>未来语言不重要，nodejs必有一席之地</li></ul><p><a href="https://www.zhihu.com/question/333368965/answer/771411673" target="_blank" rel="noopener noreferrer">https://www.zhihu.com/question/333368965/answer/771411673</a></p><p>总结：</p><ul><li>反对前端写js也有道理，有些前端确实连本职工作都没做好，就去写nodejs后端，确实不太好，造成不必要的麻烦</li><li>但是也鼓励前端去深入的学习后端领域的知识，技术是没有界限的</li><li>在后端基础扎实的情况下，未来nodejs大有可为</li></ul><h3 id="nodejs-在双十一中有哪些应用表现如何"><a class="header-anchor" href="#nodejs-在双十一中有哪些应用表现如何" aria-hidden="true">#</a> Node.js 在双十一中有哪些应用，表现如何？</h3><p><a href="https://www.zhihu.com/question/37379084/answer/74601296" target="_blank" rel="noopener noreferrer">https://www.zhihu.com/question/37379084/answer/74601296</a></p><p>观点：</p><ul><li><p>观点1</p><ul><li>nodejs大放异彩，整个双十一期间未出现任何由nodejs引发的故障</li><li>覆盖业务 <ul><li>天猫首页，大部分天猫频道页，活动页面</li><li>商品详情，店铺和搜索页等</li><li>页面搭建平台</li></ul></li><li>nodejs角色 <ul><li>完整的web业务流程</li><li>页面渲染服务</li></ul></li><li>稳定性 <ul><li>自动化测试</li><li>监控和报警,alinode</li></ul></li><li>多节点部署</li></ul></li><li><p>观点2</p><ul><li><p>node在阿里内部遍地开花</p></li><li><p>业务场景</p><ul><li>淘宝，支付宝，1688 等直面用户</li><li>内部系统</li><li>本地工具</li></ul></li><li><p>架构形态</p><ul><li>前后端分离</li><li>全栈应用(内部)</li></ul></li><li><p>nodejs对比java</p><ul><li>技术和人才储备上来看，依然差距比较大</li></ul></li></ul></li><li><p>生态差距也比较大</p></li><li><p><strong>总结：</strong> <strong>nodejs到底该如何使用？何时使用？</strong></p><p>主流企业级微服务架构体系简化图：</p><p><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200314161555.png" alt="image-20191130234831856"></p><ul><li>nodejs的异步非阻塞模型比较擅长处理i/o操作，也就是上层服务(api，渲染)，所以nodejs的绝大部分应用场景都是在上层( 大厂 )</li><li>当然nodejs也可以同时做上下层服务，前提是应用并发较小 ( 产品试错阶段，或者内部管理系统 )</li><li>优点 <ul><li>擅长游走于上层服务领域 (接口聚合，渲染等)</li><li>小快灵，快速堆砌产品原型</li><li>对前端工程师友好</li></ul></li><li>缺点 <ul><li>在下层服务领域的生态远远跟不上Java，goLang等正统服务端语言(特别是微服务架构体系)</li></ul></li></ul></li></ul><h2 id="接入alinode性能平台"><a class="header-anchor" href="#接入alinode性能平台" aria-hidden="true">#</a> 接入alinode性能平台</h2><h3 id="产品概述"><a class="header-anchor" href="#产品概述" aria-hidden="true">#</a> 产品概述</h3><p>Node.js 性能平台( Node.js Performance Platform )是面向所有 Node.js 应用提供 <strong>性能监控、安全提醒、故障排查、性能优化</strong> 等服务的整体性解决方案，尤其适用于中大型 Node.js 应用。</p><p>Node.js 性能平台凭借对 Node.js 内核深入的理解,提供完善的工具链和服务,协助客户主动、快速发现和定位线上问题。</p><h3 id="应用场景"><a class="header-anchor" href="#应用场景" aria-hidden="true">#</a> 应用场景</h3><p>Node.js 性能平台可以应用于所有 Node.js 应用，尤其适用于中大型 Node.js 应用。</p><p>Node.js 提供的精确到虚拟机级别的深度监控，能够如实的反应应用运行状态，通过配置报警规则，用户可以在发现系统出现故障（内存泄露或者 CPU 热点等）趋势时，通过诊断接口迅速定位故障点。</p><p>Node.js 性能平台特别适合业务发展迅速、应用发布频繁、流量上升明显的 Node.js 应用。</p><h3 id="功能特性"><a class="header-anchor" href="#功能特性" aria-hidden="true">#</a> 功能特性</h3><h4 id="系统层面"><a class="header-anchor" href="#系统层面" aria-hidden="true">#</a> 系统层面</h4><p>针对服务器（物理机、虚拟机、Docker 等）级别，提供如下监控指标：</p><ul><li>内存使用</li><li>CPU 使用率</li><li>系统负载</li><li>系统 QPS</li><li>硬性性能指标</li><li>磁盘使用率</li><li>GC 统计</li><li>……</li></ul><h4 id="进程层面"><a class="header-anchor" href="#进程层面" aria-hidden="true">#</a> 进程层面</h4><p>针对每个 Node.js 进程，提供如下监控指标：</p><ul><li>堆内（total 和 used）和堆外内存统计</li><li>堆内各个内存空间占用内存统计</li><li>垃圾回收（GC）占整个进程运行时间比例</li><li>QPS</li><li>按 1s、15s、30s、60s 的 CPU 统计</li><li>libuv 句柄，定时器统计</li><li>……</li></ul><h4 id="安全提醒"><a class="header-anchor" href="#安全提醒" aria-hidden="true">#</a> 安全提醒</h4><ul><li>npm 模块安全漏洞提醒</li></ul><h4 id="故障排查"><a class="header-anchor" href="#故障排查" aria-hidden="true">#</a> 故障排查</h4><ul><li>热点函数分析，通过线上 CPU Profiling 分析定位到热点函数</li><li>内存泄露分析，通过线上堆快照分析定位到内存泄露可疑点</li><li>GC 过程追踪</li><li>堆时间线</li><li>…..</li></ul><h4 id="性能优化"><a class="header-anchor" href="#性能优化" aria-hidden="true">#</a> 性能优化</h4><ul><li>Node.js 性能平台可以提供性能优化建议</li></ul><h3 id="快速入门"><a class="header-anchor" href="#快速入门" aria-hidden="true">#</a> 快速入门</h3><ul><li>阿里云账号，在这里 <a href="https://www.aliyun.com/product/nodejs" target="_blank" rel="noopener noreferrer">https://www.aliyun.com/product/nodejs</a> 开通服务</li><li>一台可以连接到互联网的服务器，或者开发机器</li></ul><h3 id="i-创建应用"><a class="header-anchor" href="#i-创建应用" aria-hidden="true">#</a> I. 创建应用</h3><ul><li>登录阿里云官网 <a href="https://www.aliyun.com/" target="_blank" rel="noopener noreferrer">https://www.aliyun.com/</a></li><li>前往 <a href="https://node.console.aliyun.com/" target="_blank" rel="noopener noreferrer">Node.js性能平台控制台</a> <code>创建新应用</code> 输入应用名 <code>demo</code> ,记录下 <code>App ID</code> 和 <code>App Secret</code> ，后面可以从应用界面的 <code>设置</code> 中查看该设置。</li></ul><h3 id="ii-服务器部署-nodejs-性能平台"><a class="header-anchor" href="#ii-服务器部署-nodejs-性能平台" aria-hidden="true">#</a> II. 服务器部署 Node.js 性能平台</h3><h4 id="a-安装-nodejs-性能平台所需组件"><a class="header-anchor" href="#a-安装-nodejs-性能平台所需组件" aria-hidden="true">#</a> a. 安装 Node.js 性能平台所需组件</h4>',43),s=a("div",{class:"language-shell line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"# 安装版本管理工具 tnvm，安装过程出错参考：https://github.com/aliyun-node/tnvm"),l("\n"),a("span",{class:"token function"},"wget"),l(" -O- https://raw.githubusercontent.com/aliyun-node/tnvm/master/install.sh "),a("span",{class:"token operator"},"|"),l(),a("span",{class:"token function"},"bash"),l("\n"),a("span",{class:"token builtin class-name"},"source"),l(" ~/.bashrc\n"),a("span",{class:"token comment"},"# tnvm ls-remote alinode 查看需要的版本"),l("\ntnvm "),a("span",{class:"token function"},"install"),l(" alinode-v3.11.4 "),a("span",{class:"token comment"},"# 安装需要的版本"),l("\ntnvm use alinode-v3.11.4 "),a("span",{class:"token comment"},"# 使用需要的版本"),l("\n"),a("span",{class:"token function"},"npm"),l(),a("span",{class:"token function"},"install"),l(" @alicloud/agenthub -g "),a("span",{class:"token comment"},"# 安装 agenthub"),l("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989786-575"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"# 安装版本管理工具 tnvm，安装过程出错参考：https://github.com/aliyun-node/tnvm\nwget -O- https://raw.githubusercontent.com/aliyun-node/tnvm/master/install.sh | bash\nsource ~/.bashrc\n# tnvm ls-remote alinode 查看需要的版本\ntnvm install alinode-v3.11.4 # 安装需要的版本\ntnvm use alinode-v3.11.4 # 使用需要的版本\nnpm install @alicloud/agenthub -g # 安装 agenthub\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989786-575","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br")])],-1),d=a("p",null,[l("验证安装是否成功,需要确保"),a("code",null,"which node"),l(" 和"),a("code",null,"which agenthub"),l("的路径中包括"),a("code",null,".tnvm"),l("即可。")],-1),r=a("div",{class:"language-shell line-numbers-mode"},[a("pre",null,[a("code",null,[l("root@iZbp1gqe9a9t5d246bp7vqZ:~"),a("span",{class:"token comment"},"# which node/root/.tnvm/versions/alinode/v3.11.4/bin/noderoot@iZbp1gqe9a9t5d246bp7vqZ:~# which agenthub /root/.tnvm/versions/alinode/v3.11.4/bin/agenthub"),l("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989788-74430"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"root@iZbp1gqe9a9t5d246bp7vqZ:~# which node/root/.tnvm/versions/alinode/v3.11.4/bin/noderoot@iZbp1gqe9a9t5d246bp7vqZ:~# which agenthub /root/.tnvm/versions/alinode/v3.11.4/bin/agenthub\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989788-74430","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br")])],-1),p=a("p",null,[l("将"),a("code",null,"创建新应用"),l("中获得的"),a("code",null,"App ID"),l(" 和 "),a("code",null,"App Secret"),l(" 按如下所示保存为 "),a("code",null,"yourconfig.json"),l("。")],-1),u=a("div",{class:"language-shell line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token punctuation"},"{"),l("  "),a("span",{class:"token string"},'"appid"'),a("span",{class:"token builtin class-name"},":"),l(),a("span",{class:"token string"},'"12345"'),l(",                          "),a("span",{class:"token comment"},'# 前面申请到的 appid，保存时删掉这条注释。  \t     "secret": "kflajglkajlgjalsgjlajdgfakjkgj" # 前面申请到的 secret，保存时删掉这条注释。'),l("\n"),a("span",{class:"token punctuation"},"}"),l("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989788-10055"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'{  "appid": "12345",                          # 前面申请到的 appid，保存时删掉这条注释。  \t     "secret": "kflajglkajlgjalsgjlajdgfakjkgj" # 前面申请到的 secret，保存时删掉这条注释。\n}\n',"data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989788-10055","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br")])],-1),m=a("p",null,[a("strong",null,"注意：")],-1),h=a("p",null,[a("strong",null,"1. 本例未配置 错误日志、报警 等功能。")],-1),y=a("p",null,[a("strong",null,"2. 性能平台每分钟上传一次日志，请等待几分钟后查看数据。")],-1),b=a("p",null,[a("strong",null,"3. 更详细的 Node.js 性能平台 runtime 部署参见 自助式部署 runtime")],-1),g=a("h4",{id:"b使用egg接入nodejs性能平台"},[a("a",{class:"header-anchor",href:"#b使用egg接入nodejs性能平台","aria-hidden":"true"},"#"),l(" b.使用egg接入nodejs性能平台")],-1),f=a("ol",null,[a("li",null,"安装runtime")],-1),j=a("div",{class:"language-"},[a("pre",null,[a("code",null,"npm i nodeinstall -g\nnodeinstall --install-alinode ^3\n"),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989789-14388"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"npm i nodeinstall -g\nnodeinstall --install-alinode ^3\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989789-14388","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br")])],-1),v=a("ol",{start:"2"},[a("li",null,"安装egg-alinode插件")],-1),k=a("div",{class:"language-"},[a("pre",null,[a("code",null,"npm i egg-alinode --save\n"),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989789-97591"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"npm i egg-alinode --save\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989789-97591","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br")])],-1),C=a("ol",{start:"3"},[a("li",null,"在 Egg 项目的 config/plugin.js 中启用此插件")],-1),w=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// config/plugin.js"),l("\nexports"),a("span",{class:"token punctuation"},"."),l("alinode "),a("span",{class:"token operator"},"="),l(),a("span",{class:"token punctuation"},"{"),l("\n  enable"),a("span",{class:"token operator"},":"),l(),a("span",{class:"token boolean"},"true"),a("span",{class:"token punctuation"},","),l("\n  "),a("span",{class:"token keyword"},"package"),a("span",{class:"token operator"},":"),l(),a("span",{class:"token string"},"'egg-alinode'"),l("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),l("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989789-93457"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// config/plugin.js\nexports.alinode = {\n  enable: true,\n  package: 'egg-alinode'\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989789-93457","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br")])],-1),N=a("ol",{start:"4"},[a("li",null,"在 Egg 项目的 config/config.default.js 中添加配置")],-1),x=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// config/config.default.js"),l("\nexports"),a("span",{class:"token punctuation"},"."),l("alinode "),a("span",{class:"token operator"},"="),l(),a("span",{class:"token punctuation"},"{"),l("\n  server"),a("span",{class:"token operator"},":"),l(),a("span",{class:"token string"},"'wss://agentserver.node.aliyun.com:8080'"),a("span",{class:"token punctuation"},","),l("\n  appid"),a("span",{class:"token operator"},":"),l(),a("span",{class:"token string"},"'Node.js 性能平台给您的项目生成的 appid'"),a("span",{class:"token punctuation"},","),l("\n  secret"),a("span",{class:"token operator"},":"),l(),a("span",{class:"token string"},"'Node.js 性能平台给您的项目生成的 secret'"),a("span",{class:"token punctuation"},","),l("\n  logdir"),a("span",{class:"token operator"},":"),l(),a("span",{class:"token string"},"'Node.js 性能平台日志输出地址绝对路径，与 NODE_LOG_DIR 保持一致。如：/tmp/'"),a("span",{class:"token punctuation"},","),l("\n  error_log"),a("span",{class:"token operator"},":"),l(),a("span",{class:"token punctuation"},"["),l("\n    "),a("span",{class:"token string"},"'您的应用在业务层面产生的异常日志的路径，数组，可选，可配置多个'"),a("span",{class:"token punctuation"},","),l("\n    "),a("span",{class:"token string"},"'例如：/root/.logs/error.#YYYY#-#MM#-#DD#.log'"),a("span",{class:"token punctuation"},","),l("\n    "),a("span",{class:"token string"},"'不更改 Egg 默认日志输出路径可不配置本项目'"),a("span",{class:"token punctuation"},","),l("\n  "),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},","),l("\n  agentidMode"),a("span",{class:"token operator"},":"),a("span",{class:"token string"},"'IP'"),l(),a("span",{class:"token string"},"'可选，如果设置，则在实例ID中添加部分IP信息，用于多个实例 hostname 相同的场景（以容器为主）'"),l("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),l("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989789-86342"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// config/config.default.js\nexports.alinode = {\n  server: 'wss://agentserver.node.aliyun.com:8080',\n  appid: 'Node.js 性能平台给您的项目生成的 appid',\n  secret: 'Node.js 性能平台给您的项目生成的 secret',\n  logdir: 'Node.js 性能平台日志输出地址绝对路径，与 NODE_LOG_DIR 保持一致。如：/tmp/',\n  error_log: [\n    '您的应用在业务层面产生的异常日志的路径，数组，可选，可配置多个',\n    '例如：/root/.logs/error.#YYYY#-#MM#-#DD#.log',\n    '不更改 Egg 默认日志输出路径可不配置本项目',\n  ],\n  agentidMode:'IP' '可选，如果设置，则在实例ID中添加部分IP信息，用于多个实例 hostname 相同的场景（以容器为主）'\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989789-86342","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br")])],-1),_=a("ol",{start:"5"},[a("li",null,"启动应用")],-1),I=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[l("egg"),a("span",{class:"token operator"},"-"),l("scripts start "),a("span",{class:"token operator"},"--"),l("daemon\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989789-94009"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"egg-scripts start --daemon\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989789-94009","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br")])],-1),P=t('<h3 id="性能指标"><a class="header-anchor" href="#性能指标" aria-hidden="true">#</a> 性能指标</h3><h4 id="memory"><a class="header-anchor" href="#memory" aria-hidden="true">#</a> Memory</h4><p>内存</p><h4 id="cpu"><a class="header-anchor" href="#cpu" aria-hidden="true">#</a> CPU</h4><h4 id="load"><a class="header-anchor" href="#load" aria-hidden="true">#</a> Load</h4><p>Load &lt; 0.7时：系统很闲，马路上没什么车，要考虑多部署一些服务</p><p>0.7 &lt; Load &lt; 1时：系统状态不错，马路可以轻松应对</p><p>Load == 1时：系统马上要处理不多来了，赶紧找一下原因</p><p>Load &gt; 1时：马路已经非常繁忙了，进入马路的每辆汽车都要无法很快的运行</p><h4 id="gc_avg-gc_max"><a class="header-anchor" href="#gc_avg-gc_max" aria-hidden="true">#</a> gc_avg gc_max</h4><p>gc所花费的时间百分比</p><h4 id="apdex"><a class="header-anchor" href="#apdex" aria-hidden="true">#</a> Apdex</h4><p>性能指标</p><p>0 代表失望</p><p>1 代表满意</p>',15);i.render=function(t,a,l,o,i,T){return e(),n("div",null,[c,s,d,r,p,u,m,h,y,b,g,f,j,v,k,C,w,N,x,_,I,P])};export default i;export{o as __pageData};
