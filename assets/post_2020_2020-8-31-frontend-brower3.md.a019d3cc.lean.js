import{o as e,c as n,f as a,a as t,x as c}from"./app.5f3fb606.js";const s='{"title":"前端面试题汇总-浏览器篇-3","description":"","frontmatter":{"title":"前端面试题汇总-浏览器篇-3","tag":["javaScript"],"cover":"https://gitee.com/artiely/Figure-bed/raw/master/image/20200831112934.png","base64":"2b4dd7","author":"artiely","date":"2020-8-31"},"headers":[{"level":2,"title":"搞懂前端缓存","slug":"搞懂前端缓存"},{"level":2,"title":"前端缓存/后端缓存","slug":"前端缓存后端缓存"},{"level":2,"title":"按缓存位置分类","slug":"按缓存位置分类"},{"level":3,"title":"memory cache","slug":"memory-cache"},{"level":3,"title":"disk cache","slug":"disk-cache"},{"level":3,"title":"Service Worker","slug":"service-worker"},{"level":3,"title":"请求网络","slug":"请求网络"},{"level":2,"title":"按失效策略分类","slug":"按失效策略分类"},{"level":3,"title":"强制缓存 (也叫强缓存)","slug":"强制缓存-也叫强缓存"},{"level":3,"title":"对比缓存 (也叫协商缓存)","slug":"对比缓存-也叫协商缓存"},{"level":2,"title":"缓存小结","slug":"缓存小结"},{"level":2,"title":"一些案例","slug":"一些案例"},{"level":3,"title":"1. memory cache & disk cache","slug":"1-memory-cache-disk-cache"},{"level":3,"title":"2. no-cache & no-store","slug":"2-no-cache-no-store"},{"level":3,"title":"3. Service Worker & memory (disk) cache","slug":"3-service-worker-memory-disk-cache"},{"level":2,"title":"浏览器的行为","slug":"浏览器的行为"},{"level":2,"title":"缓存的应用模式","slug":"缓存的应用模式"},{"level":3,"title":"模式 1：不常变化的资源","slug":"模式-1不常变化的资源"},{"level":3,"title":"模式 2：经常变化的资源","slug":"模式-2经常变化的资源"},{"level":3,"title":"模式 3：非常危险的模式 1 和 2 的结合 （反例）","slug":"模式-3非常危险的模式-1-和-2-的结合-反例"},{"level":2,"title":"后记","slug":"后记"}],"relativePath":"post/2020/2020-8-31-frontend-brower3.md","lastUpdated":1629110864405}',o={},i=a('',49),l=t("div",{class:"language-"},[t("pre",null,[t("code",null,"Expires: Thu, 10 Nov 2017 08:45:11 GMT\n"),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629557013728-32161"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"Expires: Thu, 10 Nov 2017 08:45:11 GMT\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629557013728-32161","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br")])],-1),r=t("p",null,"在响应消息头中，设置这个字段之后，就可以告诉浏览器，在未过期之前不需要再次请求。",-1),d=t("p",null,"但是，这个字段设置时有两个缺点：",-1),p=t("ol",null,[t("li",null,"由于是绝对时间，用户可能会将客户端本地的时间进行修改，而导致浏览器判断缓存失效，重新请求该资源。此外，即使不考虑自信修改，时差或者误差等因素也可能造成客户端与服务端的时间不一致，致使缓存失效。"),t("li",null,"写法太复杂了。表示时间的字符串多个空格，少个字母，都会导致非法属性从而设置失效。")],-1),u=t("h4",{id:"cache-control"},[t("a",{class:"header-anchor",href:"#cache-control","aria-hidden":"true"},"#"),c(" Cache-control")],-1),m=t("p",null,"已知Expires的缺点之后，在HTTP/1.1中，增加了一个字段Cache-control，该字段表示资源缓存的最大有效时间，在该时间内，客户端不需要向服务器发送请求",-1),h=t("p",null,"这两者的区别就是前者是绝对时间，而后者是相对时间。如下：",-1),k=t("div",{class:"language-"},[t("pre",null,[t("code",null,"Cache-control: max-age=2592000\n"),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629557013728-60704"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"Cache-control: max-age=2592000\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629557013728-60704","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br")])],-1),y=a('',15),g=t("ol",null,[t("li",null,[t("p",null,[c("服务器通过 "),t("code",null,"Last-Modified"),c(" 字段告知客户端，资源最后一次被修改的时间，例如")]),t("div",{class:"language-"},[t("pre",null,[t("code",null,"Last-Modified: Mon, 10 Nov 2018 09:10:11 GMT\n"),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629557013728-36952"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"Last-Modified: Mon, 10 Nov 2018 09:10:11 GMT\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629557013728-36952","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br")])])]),t("li",null,[t("p",null,"浏览器将这个值和内容一起记录在缓存数据库中。")]),t("li",null,[t("p",null,[c("下一次请求相同资源时时，浏览器从自己的缓存中找出“不确定是否过期的”缓存。因此在请求头中将上次的 "),t("code",null,"Last-Modified"),c(" 的值写入到请求头的 "),t("code",null,"If-Modified-Since"),c(" 字段")])]),t("li",null,[t("p",null,[c("服务器会将 "),t("code",null,"If-Modified-Since"),c(" 的值与 "),t("code",null,"Last-Modified"),c(" 字段进行对比。如果相等，则表示未修改，响应 304；反之，则表示修改了，响应 200 状态码，并返回数据。")])])],-1),b=a('',18),f=t("div",{class:"language-html line-numbers-mode"},[t("pre",null,[t("code",null,[t("span",{class:"token comment"},"\x3c!-- 把3种资源都改成请求两次 --\x3e"),c("\n"),t("span",{class:"token tag"},[t("span",{class:"token tag"},[t("span",{class:"token punctuation"},"<"),c("link")]),c(),t("span",{class:"token attr-name"},"rel"),t("span",{class:"token attr-value"},[t("span",{class:"token punctuation attr-equals"},"="),t("span",{class:"token punctuation"},'"'),c("stylesheet"),t("span",{class:"token punctuation"},'"')]),c(),t("span",{class:"token attr-name"},"href"),t("span",{class:"token attr-value"},[t("span",{class:"token punctuation attr-equals"},"="),t("span",{class:"token punctuation"},'"'),c("/static/index.css"),t("span",{class:"token punctuation"},'"')]),t("span",{class:"token punctuation"},">")]),c("\n"),t("span",{class:"token tag"},[t("span",{class:"token tag"},[t("span",{class:"token punctuation"},"<"),c("link")]),c(),t("span",{class:"token attr-name"},"rel"),t("span",{class:"token attr-value"},[t("span",{class:"token punctuation attr-equals"},"="),t("span",{class:"token punctuation"},'"'),c("stylesheet"),t("span",{class:"token punctuation"},'"')]),c(),t("span",{class:"token attr-name"},"href"),t("span",{class:"token attr-value"},[t("span",{class:"token punctuation attr-equals"},"="),t("span",{class:"token punctuation"},'"'),c("/static/index.css"),t("span",{class:"token punctuation"},'"')]),t("span",{class:"token punctuation"},">")]),c("\n"),t("span",{class:"token tag"},[t("span",{class:"token tag"},[t("span",{class:"token punctuation"},"<"),c("script")]),c(),t("span",{class:"token attr-name"},"src"),t("span",{class:"token attr-value"},[t("span",{class:"token punctuation attr-equals"},"="),t("span",{class:"token punctuation"},'"'),c("/static/index.js"),t("span",{class:"token punctuation"},'"')]),t("span",{class:"token punctuation"},">")]),t("span",{class:"token script"}),t("span",{class:"token tag"},[t("span",{class:"token tag"},[t("span",{class:"token punctuation"},"</"),c("script")]),t("span",{class:"token punctuation"},">")]),c("\n"),t("span",{class:"token tag"},[t("span",{class:"token tag"},[t("span",{class:"token punctuation"},"<"),c("script")]),c(),t("span",{class:"token attr-name"},"src"),t("span",{class:"token attr-value"},[t("span",{class:"token punctuation attr-equals"},"="),t("span",{class:"token punctuation"},'"'),c("/static/index.js"),t("span",{class:"token punctuation"},'"')]),t("span",{class:"token punctuation"},">")]),t("span",{class:"token script"}),t("span",{class:"token tag"},[t("span",{class:"token tag"},[t("span",{class:"token punctuation"},"</"),c("script")]),t("span",{class:"token punctuation"},">")]),c("\n"),t("span",{class:"token tag"},[t("span",{class:"token tag"},[t("span",{class:"token punctuation"},"<"),c("img")]),c(),t("span",{class:"token attr-name"},"src"),t("span",{class:"token attr-value"},[t("span",{class:"token punctuation attr-equals"},"="),t("span",{class:"token punctuation"},'"'),c("/static/mashroom.jpg"),t("span",{class:"token punctuation"},'"')]),t("span",{class:"token punctuation"},">")]),c("\n"),t("span",{class:"token tag"},[t("span",{class:"token tag"},[t("span",{class:"token punctuation"},"<"),c("img")]),c(),t("span",{class:"token attr-name"},"src"),t("span",{class:"token attr-value"},[t("span",{class:"token punctuation attr-equals"},"="),t("span",{class:"token punctuation"},'"'),c("/static/mashroom.jpg"),t("span",{class:"token punctuation"},'"')]),t("span",{class:"token punctuation"},">")]),c("\n\n"),t("span",{class:"token comment"},"\x3c!-- 异步请求图片 --\x3e"),c("\n"),t("span",{class:"token tag"},[t("span",{class:"token tag"},[t("span",{class:"token punctuation"},"<"),c("script")]),t("span",{class:"token punctuation"},">")]),t("span",{class:"token script"},[t("span",{class:"token language-javascript"},[c("\n    "),t("span",{class:"token function"},"setTimeout"),t("span",{class:"token punctuation"},"("),t("span",{class:"token keyword"},"function"),c(),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),c(),t("span",{class:"token punctuation"},"{"),c("\n        "),t("span",{class:"token keyword"},"let"),c(" img "),t("span",{class:"token operator"},"="),c(" document"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"createElement"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'img'"),t("span",{class:"token punctuation"},")"),c("\n        img"),t("span",{class:"token punctuation"},"."),c("src "),t("span",{class:"token operator"},"="),c(),t("span",{class:"token string"},"'/static/mashroom.jpg'"),c("\n        document"),t("span",{class:"token punctuation"},"."),c("body"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"appendChild"),t("span",{class:"token punctuation"},"("),c("img"),t("span",{class:"token punctuation"},")"),c("\n    "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},","),c(),t("span",{class:"token number"},"1000"),t("span",{class:"token punctuation"},")"),c("\n")])]),t("span",{class:"token tag"},[t("span",{class:"token tag"},[t("span",{class:"token punctuation"},"</"),c("script")]),t("span",{class:"token punctuation"},">")]),c("\n\n")]),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629557013728-83836"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'\x3c!-- 把3种资源都改成请求两次 --\x3e\n<link rel="stylesheet" href="/static/index.css">\n<link rel="stylesheet" href="/static/index.css">\n<script src="/static/index.js"><\/script>\n<script src="/static/index.js"><\/script>\n<img src="/static/mashroom.jpg">\n<img src="/static/mashroom.jpg">\n\n\x3c!-- 异步请求图片 --\x3e\n<script>\n    setTimeout(function () {\n        let img = document.createElement(\'img\')\n        img.src = \'/static/mashroom.jpg\'\n        document.body.appendChild(img)\n    }, 1000)\n<\/script>\n\n',"data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629557013728-83836","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br"),t("span",{class:"line-number"},"4"),t("br"),t("span",{class:"line-number"},"5"),t("br"),t("span",{class:"line-number"},"6"),t("br"),t("span",{class:"line-number"},"7"),t("br"),t("span",{class:"line-number"},"8"),t("br"),t("span",{class:"line-number"},"9"),t("br"),t("span",{class:"line-number"},"10"),t("br"),t("span",{class:"line-number"},"11"),t("br"),t("span",{class:"line-number"},"12"),t("br"),t("span",{class:"line-number"},"13"),t("br"),t("span",{class:"line-number"},"14"),t("br"),t("span",{class:"line-number"},"15"),t("br"),t("span",{class:"line-number"},"16"),t("br"),t("span",{class:"line-number"},"17"),t("br")])],-1),C=a('',3),v=t("div",{class:"language-js line-numbers-mode"},[t("pre",null,[t("code",null,[t("span",{class:"token comment"},"// serviceWorker.js"),c("\nself"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"addEventListener"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'install'"),t("span",{class:"token punctuation"},","),c(),t("span",{class:"token parameter"},"e"),c(),t("span",{class:"token operator"},"=>"),c(),t("span",{class:"token punctuation"},"{"),c("\n  "),t("span",{class:"token comment"},"// 当确定要访问某些资源时，提前请求并添加到缓存中。"),c("\n  "),t("span",{class:"token comment"},"// 这个模式叫做“预缓存”"),c("\n  e"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"waitUntil"),t("span",{class:"token punctuation"},"("),c("\n    caches"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"open"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'service-worker-test-precache'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"then"),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},"cache"),c(),t("span",{class:"token operator"},"=>"),c(),t("span",{class:"token punctuation"},"{"),c("\n      "),t("span",{class:"token keyword"},"return"),c(" cache"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"addAll"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},"["),t("span",{class:"token string"},"'/static/index.js'"),t("span",{class:"token punctuation"},","),c(),t("span",{class:"token string"},"'/static/index.css'"),t("span",{class:"token punctuation"},","),c(),t("span",{class:"token string"},"'/static/mashroom.jpg'"),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},")"),c("\n    "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),c("\n  "),t("span",{class:"token punctuation"},")"),c("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),c("\n\nself"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"addEventListener"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'fetch'"),t("span",{class:"token punctuation"},","),c(),t("span",{class:"token parameter"},"e"),c(),t("span",{class:"token operator"},"=>"),c(),t("span",{class:"token punctuation"},"{"),c("\n  "),t("span",{class:"token comment"},"// 缓存中能找到就返回，找不到就网络请求，之后再写入缓存并返回。"),c("\n  "),t("span",{class:"token comment"},"// 这个称为 CacheFirst 的缓存策略。"),c("\n  "),t("span",{class:"token keyword"},"return"),c(" e"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"respondWith"),t("span",{class:"token punctuation"},"("),c("\n    caches"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"open"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'service-worker-test-precache'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"then"),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},"cache"),c(),t("span",{class:"token operator"},"=>"),c(),t("span",{class:"token punctuation"},"{"),c("\n      "),t("span",{class:"token keyword"},"return"),c(" cache"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"match"),t("span",{class:"token punctuation"},"("),c("e"),t("span",{class:"token punctuation"},"."),c("request"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"then"),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},"matchedResponse"),c(),t("span",{class:"token operator"},"=>"),c(),t("span",{class:"token punctuation"},"{"),c("\n        "),t("span",{class:"token keyword"},"return"),c(" matchedResponse "),t("span",{class:"token operator"},"||"),c(),t("span",{class:"token function"},"fetch"),t("span",{class:"token punctuation"},"("),c("e"),t("span",{class:"token punctuation"},"."),c("request"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"then"),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},"fetchedResponse"),c(),t("span",{class:"token operator"},"=>"),c(),t("span",{class:"token punctuation"},"{"),c("\n          cache"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"put"),t("span",{class:"token punctuation"},"("),c("e"),t("span",{class:"token punctuation"},"."),c("request"),t("span",{class:"token punctuation"},","),c(" fetchedResponse"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"clone"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),c("\n          "),t("span",{class:"token keyword"},"return"),c(" fetchedResponse\n        "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),c("\n      "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),c("\n    "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),c("\n  "),t("span",{class:"token punctuation"},")"),c("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),c("\n")]),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629557013728-78671"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// serviceWorker.js\nself.addEventListener('install', e => {\n  // 当确定要访问某些资源时，提前请求并添加到缓存中。\n  // 这个模式叫做“预缓存”\n  e.waitUntil(\n    caches.open('service-worker-test-precache').then(cache => {\n      return cache.addAll(['/static/index.js', '/static/index.css', '/static/mashroom.jpg'])\n    })\n  )\n})\n\nself.addEventListener('fetch', e => {\n  // 缓存中能找到就返回，找不到就网络请求，之后再写入缓存并返回。\n  // 这个称为 CacheFirst 的缓存策略。\n  return e.respondWith(\n    caches.open('service-worker-test-precache').then(cache => {\n      return cache.match(e.request).then(matchedResponse => {\n        return matchedResponse || fetch(e.request).then(fetchedResponse => {\n          cache.put(e.request, fetchedResponse.clone())\n          return fetchedResponse\n        })\n      })\n    })\n  )\n})\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629557013728-78671","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br"),t("span",{class:"line-number"},"4"),t("br"),t("span",{class:"line-number"},"5"),t("br"),t("span",{class:"line-number"},"6"),t("br"),t("span",{class:"line-number"},"7"),t("br"),t("span",{class:"line-number"},"8"),t("br"),t("span",{class:"line-number"},"9"),t("br"),t("span",{class:"line-number"},"10"),t("br"),t("span",{class:"line-number"},"11"),t("br"),t("span",{class:"line-number"},"12"),t("br"),t("span",{class:"line-number"},"13"),t("br"),t("span",{class:"line-number"},"14"),t("br"),t("span",{class:"line-number"},"15"),t("br"),t("span",{class:"line-number"},"16"),t("br"),t("span",{class:"line-number"},"17"),t("br"),t("span",{class:"line-number"},"18"),t("br"),t("span",{class:"line-number"},"19"),t("br"),t("span",{class:"line-number"},"20"),t("br"),t("span",{class:"line-number"},"21"),t("br"),t("span",{class:"line-number"},"22"),t("br"),t("span",{class:"line-number"},"23"),t("br"),t("span",{class:"line-number"},"24"),t("br"),t("span",{class:"line-number"},"25"),t("br")])],-1),T=t("p",null,[c("注册 SW 的代码这里就不赘述了。此外我们还给服务器设置 "),t("code",null,"Cache-Control: max-age=86400"),c(" 来开启 disk cache。我们的目的是看看两者的优先级。")],-1),x=t("ol",null,[t("li",null,[t("p",null,"当我们首次访问时，会看到常规请求之外，浏览器(确切地说是 Service Worker)额外发出了 3 个请求。这来自预缓存的代码。"),t("p",null,[t("img",{src:"https://gitee.com/artiely/Figure-bed/raw/master/image/20200831104855.png",alt:""})])]),t("li",null,[t("p",null,[c("第二次访问(无论关闭 TAB 重新打开，还是直接按 F5 刷新)都能看到所有的请求标记为 "),t("code",null,"from SerciceWorker"),c("。")]),t("p",null,[t("img",{src:"https://gitee.com/artiely/Figure-bed/raw/master/image/20200831104908.png",alt:""})]),t("p",null,[t("code",null,"from ServiceWorker"),c(" 只表示请求通过了 Service Worker，至于到底是命中了缓存，还是继续 "),t("code",null,"fetch()"),c(" 方法光看这一条记录其实无从知晓。因此我们还得配合后续的 Network 记录来看。因为之后没有额外的请求了，因此判定是命中了缓存。")]),t("p",null,[t("img",{src:"https://gitee.com/artiely/Figure-bed/raw/master/image/20200831104920.png",alt:""})]),t("p",null,"从服务器的日志也能很明显地看到，3 个资源都没有被重新请求，即命中了 Service Worker 内部的缓存。")]),t("li",null,[t("p",null,[c("如果修改 "),t("code",null,"serviceWorker.js"),c(" 的 "),t("code",null,"fetch"),c(" 事件监听代码，改为如下：")]),t("div",{class:"language-js line-numbers-mode"},[t("pre",null,[t("code",null,[t("span",{class:"token comment"},"// 这个也叫做 NetworkOnly 的缓存策略。"),c("\nself"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"addEventListener"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'fetch'"),t("span",{class:"token punctuation"},","),c(),t("span",{class:"token parameter"},"e"),c(),t("span",{class:"token operator"},"=>"),c(),t("span",{class:"token punctuation"},"{"),c("\n  "),t("span",{class:"token keyword"},"return"),c(" e"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"respondWith"),t("span",{class:"token punctuation"},"("),t("span",{class:"token function"},"fetch"),t("span",{class:"token punctuation"},"("),c("e"),t("span",{class:"token punctuation"},"."),c("request"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),c("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),c("\n")]),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629557013729-96922"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// 这个也叫做 NetworkOnly 的缓存策略。\nself.addEventListener('fetch', e => {\n  return e.respondWith(fetch(e.request))\n})\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629557013729-96922","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br"),t("span",{class:"line-number"},"4"),t("br")])])])],-1),_=a('',8),S=t("div",{class:"language-"},[t("pre",null,[t("code",null,"Cache-Control: max-age=31536000\n"),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629557013729-70017"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"Cache-Control: max-age=31536000\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629557013729-70017","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br")])],-1),w=a('',5),j=t("div",{class:"language-"},[t("pre",null,[t("code",null,"Cache-Control: no-cache\n"),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629557013729-69099"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"Cache-Control: no-cache\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629557013729-69099","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br")])],-1),P=a('',4),A=t("div",{class:"language-"},[t("pre",null,[t("code",null,"Cache-Control: max-age=600, must-revalidate\n"),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629557013729-58732"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"Cache-Control: max-age=600, must-revalidate\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629557013729-58732","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br")])],-1),E=a('',13);o.render=function(a,t,c,s,o,N){return e(),n("div",null,[i,l,r,d,p,u,m,h,k,y,g,b,f,C,v,T,x,_,S,w,j,P,A,E])};export default o;export{s as __pageData};
