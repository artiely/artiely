import{o as n,c as t,a as s,x as a}from"./app.5f3fb606.js";const e='{"title":"vue中如何优雅的清除定时器","description":"","frontmatter":{"title":"vue中如何优雅的清除定时器","tag":["vue"],"cover":"https://gitee.com/artiely/Figure-bed/raw/master/image/20200429100126.png","date":"2020-4-29","base64":"4ec07b"},"relativePath":"post/2020/2020-4-29-vue-hook-lifecycle.md","lastUpdated":1629110850727}',c={},o=s("h1",{id:"vue-中如何优雅的清除定时器"},[s("a",{class:"header-anchor",href:"#vue-中如何优雅的清除定时器","aria-hidden":"true"},"#"),a(" vue 中如何优雅的清除定时器")],-1),l=s("p",null,"首先来看一下我们平时最常见的清除方式",-1),i=s("div",{class:"language-js line-numbers-mode"},[s("pre",null,[s("code",null,[s("span",{class:"token keyword"},"export"),a(),s("span",{class:"token keyword"},"default"),a(),s("span",{class:"token punctuation"},"{"),a("\n  "),s("span",{class:"token function"},"data"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),a(),s("span",{class:"token punctuation"},"{"),a("\n    "),s("span",{class:"token keyword"},"return"),a(),s("span",{class:"token punctuation"},"{"),a("\n      timer"),s("span",{class:"token operator"},":"),a(),s("span",{class:"token keyword"},"null"),s("span",{class:"token punctuation"},","),a("\n    "),s("span",{class:"token punctuation"},"}"),a("\n  "),s("span",{class:"token punctuation"},"}"),s("span",{class:"token punctuation"},","),a("\n  "),s("span",{class:"token function"},"mounted"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),a(),s("span",{class:"token punctuation"},"{"),a("\n    "),s("span",{class:"token keyword"},"this"),s("span",{class:"token punctuation"},"."),a("timer "),s("span",{class:"token operator"},"="),a(),s("span",{class:"token function"},"setInterval"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),a(),s("span",{class:"token operator"},"=>"),a(),s("span",{class:"token punctuation"},"{"),s("span",{class:"token punctuation"},"}"),s("span",{class:"token punctuation"},","),a(),s("span",{class:"token number"},"1000"),s("span",{class:"token punctuation"},")"),a("\n  "),s("span",{class:"token punctuation"},"}"),s("span",{class:"token punctuation"},","),a("\n  "),s("span",{class:"token function"},"beforeDestroy"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),a(),s("span",{class:"token punctuation"},"{"),a("\n    "),s("span",{class:"token function"},"clearInterval"),s("span",{class:"token punctuation"},"("),s("span",{class:"token keyword"},"this"),s("span",{class:"token punctuation"},"."),a("timer"),s("span",{class:"token punctuation"},")"),a("\n    "),s("span",{class:"token keyword"},"this"),s("span",{class:"token punctuation"},"."),a("timer "),s("span",{class:"token operator"},"="),a(),s("span",{class:"token keyword"},"null"),a("\n  "),s("span",{class:"token punctuation"},"}"),s("span",{class:"token punctuation"},","),a("\n"),s("span",{class:"token punctuation"},"}"),a("\n")]),s("div",{class:"m-mdic-copy-wrapper"},[s("div",{class:"u-mdic-copy-notify",id:"j-notify-1629557006714-89433"},"复制成功"),s("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"export default {\n  data() {\n    return {\n      timer: null,\n    }\n  },\n  mounted() {\n    this.timer = setInterval(() => {}, 1000)\n  },\n  beforeDestroy() {\n    clearInterval(this.timer)\n    this.timer = null\n  },\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629557006714-89433","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),s("div",{class:"line-numbers-wrapper"},[s("span",{class:"line-number"},"1"),s("br"),s("span",{class:"line-number"},"2"),s("br"),s("span",{class:"line-number"},"3"),s("br"),s("span",{class:"line-number"},"4"),s("br"),s("span",{class:"line-number"},"5"),s("br"),s("span",{class:"line-number"},"6"),s("br"),s("span",{class:"line-number"},"7"),s("br"),s("span",{class:"line-number"},"8"),s("br"),s("span",{class:"line-number"},"9"),s("br"),s("span",{class:"line-number"},"10"),s("br"),s("span",{class:"line-number"},"11"),s("br"),s("span",{class:"line-number"},"12"),s("br"),s("span",{class:"line-number"},"13"),s("br"),s("span",{class:"line-number"},"14"),s("br")])],-1),p=s("p",null,"该方案有两点不好的地方，引用尤大的话来说就是：",-1),u=s("ul",null,[s("li",null,"它需要在这个组件实例中保存这个 timer，如果可以的话最好只有生命周期钩子可以访问到它。这并不算严重的问题，但是它可以被视为杂物。"),s("li",null,"我们的建立代码独立于我们的清理代码，这使得我们比较难于程序化的清理我们建立的所有东西。")],-1),r=s("p",null,"更好的方案",-1),d=s("p",null,[a("该方法是通过"),s("code",null,"$once"),a("这个事件侦听器器在定义完定时器之后的位置来清除定时器。以下是完整代码：")],-1),m=s("div",{class:"language-js line-numbers-mode"},[s("pre",null,[s("code",null,[s("span",{class:"token keyword"},"const"),a(" timer "),s("span",{class:"token operator"},"="),a(),s("span",{class:"token function"},"setInterval"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),a(),s("span",{class:"token operator"},"=>"),a(),s("span",{class:"token punctuation"},"{"),a("\n  "),s("span",{class:"token comment"},"// 某些定时器操作"),a("\n"),s("span",{class:"token punctuation"},"}"),s("span",{class:"token punctuation"},","),a(),s("span",{class:"token number"},"500"),s("span",{class:"token punctuation"},")"),a("\n"),s("span",{class:"token comment"},"// 通过$once来监听定时器，在beforeDestroy钩子可以被清除。"),a("\n"),s("span",{class:"token keyword"},"this"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"$once"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'hook:beforeDestroy'"),s("span",{class:"token punctuation"},","),a(),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),a(),s("span",{class:"token operator"},"=>"),a(),s("span",{class:"token punctuation"},"{"),a("\n  "),s("span",{class:"token function"},"clearInterval"),s("span",{class:"token punctuation"},"("),a("timer"),s("span",{class:"token punctuation"},")"),a("\n"),s("span",{class:"token punctuation"},"}"),s("span",{class:"token punctuation"},")"),a("\n")]),s("div",{class:"m-mdic-copy-wrapper"},[s("div",{class:"u-mdic-copy-notify",id:"j-notify-1629557006714-30601"},"复制成功"),s("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const timer = setInterval(() => {\n  // 某些定时器操作\n}, 500)\n// 通过$once来监听定时器，在beforeDestroy钩子可以被清除。\nthis.$once('hook:beforeDestroy', () => {\n  clearInterval(timer)\n})\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629557006714-30601","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),s("div",{class:"line-numbers-wrapper"},[s("span",{class:"line-number"},"1"),s("br"),s("span",{class:"line-number"},"2"),s("br"),s("span",{class:"line-number"},"3"),s("br"),s("span",{class:"line-number"},"4"),s("br"),s("span",{class:"line-number"},"5"),s("br"),s("span",{class:"line-number"},"6"),s("br"),s("span",{class:"line-number"},"7"),s("br")])],-1),k=s("p",null,[s("code",null,"hook:<生命周期>"),a("的使用方式参见"),s("a",{href:"https://github.com/vuejs/vue/blob/d9b27a92bd5277ee23a4e68a8bd31ecc72f4c99b/src/core/instance/lifecycle.js#L347",target:"_blank",rel:"noopener noreferrer"},"源码")],-1);c.render=function(s,a,e,c,b,y){return n(),t("div",null,[o,l,i,p,u,r,d,m,k])};export default c;export{e as __pageData};
