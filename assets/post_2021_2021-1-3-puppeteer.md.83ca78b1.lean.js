import{o as n,c as t,q as s,a,x as e,t as o}from"./app.746f22cf.js";const c='{"title":"从使用场景了解puppeteer","description":"","frontmatter":{"title":"从使用场景了解puppeteer","tag":["puppeteer"],"cover":"https://gitee.com/artiely/Figure-bed/raw/master/20210124220333.png","base64":"00cab4","author":"artiely","date":"2021-1-3"},"headers":[{"level":2,"title":"安装","slug":"安装"},{"level":2,"title":"从一些场景中了解 Puppeteer 的应用","slug":"从一些场景中了解-puppeteer-的应用"},{"level":2,"title":"可用于在线演示的网站","slug":"可用于在线演示的网站"},{"level":2,"title":"总结","slug":"总结"},{"level":2,"title":"入门资料","slug":"入门资料"},{"level":2,"title":"其他","slug":"其他"}],"relativePath":"post/2021/2021-1-3-puppeteer.md","lastUpdated":1629110885627}',p={},l=a("h1",{id:"puppeteer-是什么"},[a("a",{class:"header-anchor",href:"#puppeteer-是什么","aria-hidden":"true"},"#"),e(" Puppeteer 是什么")],-1),i=a("p",null,[e("英 [ˌpʌpɪˈtɪər]"),a("br"),e(" 美 [ˌpʌpɪˈtɪr]")],-1),u=a("p",null,[e("n. 操纵木偶的人；操纵傀儡"),a("br"),e(" vt. 操纵")],-1),r=a("ul",null,[a("li",null,"浏览器自动化库"),a("li",null,"Puppeteer = Node.js + Chrome"),a("li",null,"评估 Javascript")],-1),k=o('',4),d=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,"npm i puppeteer\n"),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558004097-69798"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"npm i puppeteer\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558004097-69798","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br")])],-1),m=a("p",null,"然后",-1),b=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(" puppetter "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"puppeteer"'),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"("),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token comment"},"// ...."),e("\n  "),a("span",{class:"token keyword"},"const"),e(" browser "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" puppeteer"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"launch"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" page "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" browser"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"newPage"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558004097-57584"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'const puppetter = require("puppeteer");\n(async () => {\n  // ....\n  const browser = await puppeteer.launch();\n  const page = await browser.newPage();\n})();\n',"data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558004097-57584","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br")])],-1),y=a("h2",{id:"从一些场景中了解-puppeteer-的应用"},[a("a",{class:"header-anchor",href:"#从一些场景中了解-puppeteer-的应用","aria-hidden":"true"},"#"),e(" 从一些场景中了解 Puppeteer 的应用")],-1),h=a("ol",null,[a("li",null,"某购物网站某商品的价格变化趋势或某新闻网站的新闻")],-1),g=a("div",{class:"language-js line-numbers-mode"},[a("div",{class:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{class:"highlighted"}," "),a("div",{class:"highlighted"}," "),a("br"),a("br"),a("br"),a("br")]),a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(" puppetter "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"puppeteer"'),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"("),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token comment"},"// ...."),e("\n  "),a("span",{class:"token keyword"},"const"),e(" browser "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" puppeteer"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"launch"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" page "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" browser"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"newPage"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token comment"},"// 获取价格"),e("\n  "),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"goto"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"https://..."'),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" price "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"$sevel"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'".price"'),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"div"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(" div"),a("span",{class:"token punctuation"},"."),e("textContent"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),e("price"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"await"),e(" browser"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"close"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558004097-74109"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'const puppetter = require("puppeteer");\n(async () => {\n  // ....\n  const browser = await puppeteer.launch();\n  const page = await browser.newPage();\n  // 获取价格\n  await page.goto("https://...");\n  const price = await page.$sevel(".price", (div) => div.textContent);\n  console.log(price);\n  await browser.close();\n})();\n',"data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558004097-74109","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br")])],-1),w=a("ol",{start:"2"},[a("li",null,"处理异步和对网站进行测试 可以结合任何测试库")],-1),f=a("div",{class:"language-js line-numbers-mode"},[a("div",{class:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("div",{class:"highlighted"}," "),a("div",{class:"highlighted"}," "),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",null,[a("code",null,[a("span",{class:"token function"},"it"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'should pay'"),a("span",{class:"token punctuation"},","),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token operator"},"=>"),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" page "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" browser"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"newPage"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"goto"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"https://..."'),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token comment"},"// 异步处理 waithForX ..."),e("\n  "),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"waitForSelect"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'.button'"),a("span",{class:"token punctuation"},")"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" response "),a("span",{class:"token operator"},"="),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"waitForResponse"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"res"),a("span",{class:"token operator"},"=>"),e("res"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"url"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"endsWith"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'/pay'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),e("\n  "),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"click"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'.button'"),a("span",{class:"token punctuation"},")"),e("\n  "),a("span",{class:"token keyword"},"await"),e(" response\n  "),a("span",{class:"token function"},"assert"),a("span",{class:"token punctuation"},"("),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"$evel"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'.success'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558004097-58942"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"it('should pay',()=>{\n  const page = await browser.newPage();\n  await page.goto(\"https://...\");\n  // 异步处理 waithForX ...\n  await page.waitForSelect('.button')\n  const response = page.waitForResponse(res=>res.url().endsWith('/pay'))\n  await page.click('.button')\n  await response\n  assert(await page.$evel('.success'))\n})\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558004097-58942","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br")])],-1),v=a("ol",{start:"3"},[a("li",null,"测试在移动设备的表现")],-1),C=a("div",{class:"language-js line-numbers-mode"},[a("div",{class:"highlight-lines"},[a("br"),a("br"),a("div",{class:"highlighted"}," "),a("br"),a("br"),a("br")]),a("pre",null,[a("code",null,[a("span",{class:"token function"},"it"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'should work on mobile'"),a("span",{class:"token punctuation"},","),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token operator"},"=>"),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" page "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" browser"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"newPage"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"emulate"),a("span",{class:"token punctuation"},"("),e("puppeteer"),a("span",{class:"token punctuation"},"."),e("devices"),a("span",{class:"token punctuation"},"["),a("span",{class:"token string"},"'iPhone 8'"),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},")"),e("\n  "),a("span",{class:"token comment"},"// ..."),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558004097-60010"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"it('should work on mobile',()=>{\n  const page = await browser.newPage();\n  await page.emulate(puppeteer.devices['iPhone 8'])\n  // ...\n})\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558004097-60010","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br")])],-1),x=a("ol",{start:"4"},[a("li",null,"网站的离线表现")],-1),j=a("div",{class:"language-js line-numbers-mode"},[a("div",{class:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("div",{class:"highlighted"}," "),a("br"),a("br"),a("br"),a("br")]),a("pre",null,[a("code",null,[a("span",{class:"token function"},"it"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'should notify user when goes offline'"),a("span",{class:"token punctuation"},","),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token operator"},"=>"),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" page "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" browser"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"newPage"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"emulate"),a("span",{class:"token punctuation"},"("),e("puppeteer"),a("span",{class:"token punctuation"},"."),e("devices"),a("span",{class:"token punctuation"},"["),a("span",{class:"token string"},"'iPhone 8'"),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},")"),e("\n  "),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"goto"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"https://..."'),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"setOfflineMode"),a("span",{class:"token punctuation"},"("),a("span",{class:"token boolean"},"true"),a("span",{class:"token punctuation"},")"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" alert "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"waitForSelece"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'.offline-alert'"),a("span",{class:"token punctuation"},")"),e("\n  "),a("span",{class:"token function"},"expect"),a("span",{class:"token punctuation"},"("),e("alert"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"toBeTruthy"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558004097-37852"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"it('should notify user when goes offline',()=>{\n  const page = await browser.newPage();\n  await page.emulate(puppeteer.devices['iPhone 8'])\n  await page.goto(\"https://...\");\n  await page.setOfflineMode(true)\n  const alert = await page.waitForSelece('.offline-alert')\n  expect(alert).toBeTruthy()\n})\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558004097-37852","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br")])],-1),P=a("ol",{start:"5"},[a("li",null,"检测注册的 servce worker")],-1),E=a("div",{class:"language-js line-numbers-mode"},[a("div",{class:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("div",{class:"highlighted"}," "),a("div",{class:"highlighted"}," "),a("div",{class:"highlighted"}," "),a("div",{class:"highlighted"}," "),a("div",{class:"highlighted"}," "),a("div",{class:"highlighted"}," "),a("div",{class:"highlighted"}," "),a("br"),a("br"),a("br")]),a("pre",null,[a("code",null,[a("span",{class:"token function"},"it"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'should register service worker'"),a("span",{class:"token punctuation"},","),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token operator"},"=>"),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" page "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" browser"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"newPage"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"emulate"),a("span",{class:"token punctuation"},"("),e("puppeteer"),a("span",{class:"token punctuation"},"."),e("devices"),a("span",{class:"token punctuation"},"["),a("span",{class:"token string"},"'iPhone 8'"),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},")"),e("\n  "),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"goto"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"https://..."'),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" swTarget "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"waitForTarget"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"target"),a("span",{class:"token operator"},"=>"),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"return"),e(" target"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"type"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token operator"},"==="),a("span",{class:"token string"},"'ervice_worker'"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" sw "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" swTarget"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"worker"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" isCatch  "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" sw"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"evalute"),a("span",{class:"token punctuation"},"("),a("span",{class:"token keyword"},"async"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token operator"},"=>"),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"return"),e(),a("span",{class:"token operator"},"!"),a("span",{class:"token operator"},"!"),a("span",{class:"token punctuation"},"("),a("span",{class:"token keyword"},"await"),e(" caches"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"match"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'https://artiely.gitee.io/x.png'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),e("\n  "),a("span",{class:"token function"},"expect"),a("span",{class:"token punctuation"},"("),e("isCatch"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"toBe"),a("span",{class:"token punctuation"},"("),a("span",{class:"token boolean"},"true"),a("span",{class:"token punctuation"},")"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558004097-79957"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"it('should register service worker',()=>{\n  const page = await browser.newPage();\n  await page.emulate(puppeteer.devices['iPhone 8'])\n  await page.goto(\"https://...\");\n  const swTarget = await page.waitForTarget(target=>{\n    return target.type()==='ervice_worker'\n  })\n  const sw = await swTarget.worker()\n  const isCatch  = await sw.evalute(async()=>{\n    return !!(await caches.match('https://artiely.gitee.io/x.png'))\n  })\n  expect(isCatch).toBe(true)\n})\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558004097-79957","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br")])],-1),$=a("p",null,"进阶",-1),T=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"goto"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'https://...'"),a("span",{class:"token punctuation"},")"),e("\n"),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"evaluate"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'navigator.serviceWorker.ready'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"const"),e(" requests "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"new"),e(),a("span",{class:"token class-name"},"Map"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\npage"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"on"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'request'"),a("span",{class:"token punctuation"},","),a("span",{class:"token parameter"},"req"),a("span",{class:"token operator"},"=>"),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"return"),e(" requests"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"set"),a("span",{class:"token punctuation"},"("),e("req"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"url"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},","),e("req"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),e("\n\n"),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"reload"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),e("waitUntil"),a("span",{class:"token operator"},":"),a("span",{class:"token string"},"'networkkid0'"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"for"),a("span",{class:"token punctuation"},"("),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token punctuation"},"["),e("url"),a("span",{class:"token punctuation"},","),e("req"),a("span",{class:"token punctuation"},"]"),e(),a("span",{class:"token keyword"},"of"),e(" requests"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" swResp "),a("span",{class:"token operator"},"="),e(" req"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"response"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"fromServiceWorker"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"const"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),e("url"),a("span",{class:"token punctuation"},","),e("swResp"),a("span",{class:"token operator"},"?"),a("span",{class:"token string"},"'√'"),e("："),a("span",{class:"token string"},"'×'"),a("span",{class:"token punctuation"},")"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558004098-2044"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"await page.goto('https://...')\nawait page.evaluate('navigator.serviceWorker.ready');\n\nconst requests = new Map();\npage.on('request',req=>{\n  return requests.set(req.url(),req);\n})\n\nawait page.reload({waitUntil:'networkkid0'});\n\nfor(const [url,req] of requests){\n  const swResp = req.response().fromServiceWorker();\n  const.log(url,swResp?'√'：'×')\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558004098-2044","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br")])],-1),q=a("ol",{start:"6"},[a("li",null,"模拟位置")],-1),I=a("div",{class:"language-js line-numbers-mode"},[a("div",{class:"highlight-lines"},[a("br"),a("br"),a("br"),a("div",{class:"highlighted"}," "),a("div",{class:"highlighted"}," "),a("div",{class:"highlighted"}," "),a("div",{class:"highlighted"}," "),a("br"),a("br"),a("br"),a("br")]),a("pre",null,[a("code",null,[a("span",{class:"token function"},"it"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'should $ in US'"),a("span",{class:"token punctuation"},","),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token operator"},"=>"),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" page "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" browser"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"newPage"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"emulate"),a("span",{class:"token punctuation"},"("),e("puppeteer"),a("span",{class:"token punctuation"},"."),e("devices"),a("span",{class:"token punctuation"},"["),a("span",{class:"token string"},"'iPhone 8'"),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},")"),e("\n  "),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"setGeolocation"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),e("\n    latitude"),a("span",{class:"token operator"},":"),a("span",{class:"token number"},"140.00"),a("span",{class:"token punctuation"},","),e("\n    longitude"),a("span",{class:"token operator"},":"),a("span",{class:"token number"},"30.00"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),e("\n  "),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"goto"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"https://..."'),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token comment"},"// ..."),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558004098-96233"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"it('should $ in US',()=>{\n  const page = await browser.newPage();\n  await page.emulate(puppeteer.devices['iPhone 8'])\n  await page.setGeolocation({\n    latitude:140.00,\n    longitude:30.00\n  })\n  await page.goto(\"https://...\");\n  // ...\n})\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558004098-96233","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br")])],-1),_=a("ol",{start:"7"},[a("li",null,"拦截并修改。。。")],-1),N=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"await"),e(" page "),a("span",{class:"token function"},"serRequestInterception"),a("span",{class:"token punctuation"},"("),a("span",{class:"token boolean"},"true"),a("span",{class:"token punctuation"},")"),e("\npage"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"on"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'request'"),a("span",{class:"token punctuation"},","),a("span",{class:"token parameter"},"request"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token comment"},"// 修改图片"),e("\n  "),a("span",{class:"token keyword"},"if"),a("span",{class:"token punctuation"},"("),e("request"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"resourceType"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token operator"},"==="),e(),a("span",{class:"token string"},"'image'"),a("span",{class:"token punctuation"},")"),e("\n    request"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"respond"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),e("body"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token function"},"randomCatImage"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),e("\n  "),a("span",{class:"token keyword"},"else"),e("\n    request"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"continue"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e("\n  "),a("span",{class:"token comment"},"// 取消请求"),e("\n  "),a("span",{class:"token keyword"},"if"),a("span",{class:"token punctuation"},"("),e("request"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"url"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"==="),e(),a("span",{class:"token string"},"'https://x/pay'"),a("span",{class:"token punctuation"},")"),e("\n    request"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"abort"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e("\n  "),a("span",{class:"token keyword"},"else"),e("\n    request"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"contiune"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558004098-38340"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"await page serRequestInterception(true)\npage.on('request',request => {\n  // 修改图片\n  if(request.resourceType()=== 'image')\n    request.respond({body: randomCatImage()})\n  else\n    request.continue()\n  // 取消请求\n  if(request.url() === 'https://x/pay')\n    request.abort()\n  else\n    request.contiune()\n})\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558004098-38340","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br")])],-1),S=a("ol",{start:"8"},[a("li",null,"模拟输入和事件")],-1),D=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"goto"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"https://pptr.dev/"'),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"const"),e(" input "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"waitForSelect"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"[type=search]"'),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"await"),e(" input"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"type"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"javascript"'),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),e("keyboard"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"press"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"Enter"'),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558004098-937"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'await page.goto("https://pptr.dev/");\nconst input = await page.waitForSelect("[type=search]");\nawait input.type("javascript");\nawait page.keyboard.press("Enter");\n',"data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558004098-937","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br")])],-1),R=a("ol",{start:"9"},[a("li",null,"页面性能指标")],-1),B=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(" metrics "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"metrics"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\nconsole"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),e("metrics"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558004098-37145"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const metrics = await page.metrics();\nconsole.log(metrics);\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558004098-37145","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br")])],-1),F=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),e("tracing"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"start"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),e("path"),a("span",{class:"token operator"},":"),a("span",{class:"token string"},"'./trace.json'"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"goto"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'https://pptr.dev'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"waitForSelect"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'select'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token comment"},"// ..."),e("\n"),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token punctuation"},"."),e("tracing"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"stop"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558004098-12092"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"await page.tracing.start({path:'./trace.json'});\nawait page.goto('https://pptr.dev');\nawait page.waitForSelect('select');\n// ...\nawait page..tracing.stop()\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558004098-12092","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br")])],-1),A=a("ol",{start:"10"},[a("li",null,"服务端渲染")],-1),U=a("div",{class:"language-html line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"<"),e("div")]),e(),a("span",{class:"token attr-name"},"id"),a("span",{class:"token attr-value"},[a("span",{class:"token punctuation attr-equals"},"="),a("span",{class:"token punctuation"},'"'),e("container"),a("span",{class:"token punctuation"},'"')]),a("span",{class:"token punctuation"},">")]),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"</"),e("div")]),a("span",{class:"token punctuation"},">")]),e("\n"),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"<"),e("script")]),a("span",{class:"token punctuation"},">")]),a("span",{class:"token script"},[a("span",{class:"token language-javascript"},[e("\n  "),a("span",{class:"token keyword"},"function"),e(),a("span",{class:"token function"},"render"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("posts"),a("span",{class:"token punctuation"},","),e(" container")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" html "),a("span",{class:"token operator"},"="),e(" posts"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"reduce"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("html"),a("span",{class:"token punctuation"},","),e(" post")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n      "),a("span",{class:"token keyword"},"return"),e(),a("span",{class:"token template-string"},[a("span",{class:"token template-punctuation string"},"`"),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("html"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"},"\n        <li>\n        <h2>"),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("post"),a("span",{class:"token punctuation"},"."),e("title"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"},"</h2>\n        <p>"),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("post"),a("span",{class:"token punctuation"},"."),e("content"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"},"</p>\n        </li>\n        "),a("span",{class:"token template-punctuation string"},"`")]),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token string"},'""'),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    container"),a("span",{class:"token punctuation"},"."),e("innerHTML "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token template-string"},[a("span",{class:"token template-punctuation string"},"`"),a("span",{class:"token string"},"<ul>"),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("html"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"},"<ul>"),a("span",{class:"token template-punctuation string"},"`")]),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n  "),a("span",{class:"token function"},"fetch"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"/post"'),a("span",{class:"token punctuation"},")"),e("\n    "),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"then"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"res"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(" res"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"json"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),e("\n    "),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"then"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"res"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token function"},"rednder"),a("span",{class:"token punctuation"},"("),e("res"),a("span",{class:"token punctuation"},","),e(" document"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"getElementById"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"container"'),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")])]),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"</"),e("script")]),a("span",{class:"token punctuation"},">")]),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558004098-51558"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'<div id="container"></div>\n<script>\n  function render(posts, container) {\n    const html = posts.reduce((html, post) => {\n      return `${html}\n        <li>\n        <h2>${post.title}</h2>\n        <p>${post.content}</p>\n        </li>\n        `;\n    }, "");\n    container.innerHTML = `<ul>${html}<ul>`;\n  }\n  fetch("/post")\n    .then((res) => res.json())\n    .then((res) => rednder(res, document.getElementById("container")));\n<\/script>\n',"data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558004098-51558","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br"),a("span",{class:"line-number"},"17"),a("br")])],-1),H=a("p",null,"ssr.js",-1),M=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"import"),e(" puppeteer "),a("span",{class:"token keyword"},"from"),e(),a("span",{class:"token string"},'"puppeteer"'),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"export"),e(),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token keyword"},"function"),e(),a("span",{class:"token function"},"ssr"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"url"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" browser "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" puppeteer"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"lanuch"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),e(" headless"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token boolean"},"true"),e(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" page "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" browser"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"newPage"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"goto"),a("span",{class:"token punctuation"},"("),e("url"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token punctuation"},"{"),e(" waitUntil"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},'"networkidle0"'),e(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" html "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"content"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"await"),e(" browser"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"close"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"return"),e(" html"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558004099-53304"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'import puppeteer from "puppeteer";\nexport async function ssr(url) {\n  const browser = await puppeteer.lanuch({ headless: true });\n  const page = await browser.newPage();\n  await page.goto(url, { waitUntil: "networkidle0" });\n  const html = await page.content();\n  await browser.close();\n  return html;\n}\n',"data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558004099-53304","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br")])],-1),J=a("p",null,"server.js",-1),G=a("div",{class:"language-js line-numbers-mode"},[a("div",{class:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("div",{class:"highlighted"}," "),a("div",{class:"highlighted"}," "),a("div",{class:"highlighted"}," "),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"import"),e(" express "),a("span",{class:"token keyword"},"from"),e(),a("span",{class:"token string"},'"express"'),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"import"),e(),a("span",{class:"token punctuation"},"{"),e(" ssr "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token keyword"},"from"),e(),a("span",{class:"token string"},'"./ssr.js"'),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"const"),e(" app "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"express"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"get"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"/"'),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("req"),a("span",{class:"token punctuation"},","),e(" res"),a("span",{class:"token punctuation"},","),e(" next")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" origin "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token template-string"},[a("span",{class:"token template-punctuation string"},"`"),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("req"),a("span",{class:"token punctuation"},"."),e("protocol"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"},"://"),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("req"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"get"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"host"'),a("span",{class:"token punctuation"},")"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token template-punctuation string"},"`")]),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" html "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(),a("span",{class:"token function"},"ssr"),a("span",{class:"token punctuation"},"("),a("span",{class:"token template-string"},[a("span",{class:"token template-punctuation string"},"`"),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("origin"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"},"/index.html"),a("span",{class:"token template-punctuation string"},"`")]),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"return"),e(" res"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"status"),a("span",{class:"token punctuation"},"("),a("span",{class:"token number"},"200"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"send"),a("span",{class:"token punctuation"},"("),e("html"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"listen"),a("span",{class:"token punctuation"},"("),a("span",{class:"token number"},"8080"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"server start"'),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558004099-74187"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'import express from "express";\nimport { ssr } from "./ssr.js";\nconst app = express();\napp.get("/", async (req, res, next) => {\n  const origin = `${req.protocol}://${req.get("host")}`;\n  const html = await ssr(`${origin}/index.html`);\n  return res.status(200).send(html);\n});\napp.listen(8080, () => {\n  console.log("server start");\n});\n',"data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558004099-74187","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br")])],-1),W=a("ul",null,[a("li",null,[e("优化更快的直达"),a("br"),e(" ssr.js")])],-1),X=a("div",{class:"language-js line-numbers-mode"},[a("div",{class:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{class:"highlighted"}," "),a("br"),a("div",{class:"highlighted"}," "),a("br"),a("br"),a("br"),a("br")]),a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"import"),e(" puppeteer "),a("span",{class:"token keyword"},"from"),e(),a("span",{class:"token string"},'"puppeteer"'),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"export"),e(),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token keyword"},"function"),e(),a("span",{class:"token function"},"ssr"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"url"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" browser "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" puppeteer"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"lanuch"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),e(" headless"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token boolean"},"true"),e(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" page "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" browser"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"newPage"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token comment"},'// await page.goto(url, { waitUntil: "networkidle0" });'),e("\n  "),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"goto"),a("span",{class:"token punctuation"},"("),e("url"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token punctuation"},"{"),e(" waitUntil"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},'"documentloaded"'),e(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token comment"},"// const html = await page.content();"),e("\n  "),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"waitForSelector"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"#post"'),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"await"),e(" browser"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"close"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"return"),e(" html"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558004099-2491"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'import puppeteer from "puppeteer";\nexport async function ssr(url) {\n  const browser = await puppeteer.lanuch({ headless: true });\n  const page = await browser.newPage();\n  // await page.goto(url, { waitUntil: "networkidle0" });\n  await page.goto(url, { waitUntil: "documentloaded" });\n  // const html = await page.content();\n  await page.waitForSelector("#post");\n  await browser.close();\n  return html;\n}\n',"data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558004099-2491","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br")])],-1),O=a("ul",null,[a("li",null,[e("优化 2 添加缓存"),a("br"),e(" ssr.js")])],-1),V=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token constant"},"RENDER_CACHE"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"new"),e(),a("span",{class:"token class-name"},"Map"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token keyword"},"function"),e(),a("span",{class:"token function"},"ssr"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"url"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"if"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token constant"},"RENDER_CACHE"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"has"),a("span",{class:"token punctuation"},"("),e("url"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token keyword"},"return"),e(),a("span",{class:"token constant"},"RENDER_CACHE"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"get"),a("span",{class:"token punctuation"},"("),e("url"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token comment"},"// ..."),e("\n  "),a("span",{class:"token constant"},"RENDER_CACHE"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"set"),a("span",{class:"token punctuation"},"("),e("url"),a("span",{class:"token punctuation"},","),e(" html"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"return"),e(" html"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558004099-14514"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const RENDER_CACHE = new Map();\nasync function ssr(url) {\n  if (RENDER_CACHE.has(url)) return RENDER_CACHE.get(url);\n  // ...\n  RENDER_CACHE.set(url, html);\n  return html;\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558004099-14514","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br")])],-1),L=a("p",null,[e("添加缓存"),a("br"),e(" index.html")],-1),z=a("div",{class:"language-html line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"<"),e("div")]),e(),a("span",{class:"token attr-name"},"id"),a("span",{class:"token attr-value"},[a("span",{class:"token punctuation attr-equals"},"="),a("span",{class:"token punctuation"},'"'),e("container"),a("span",{class:"token punctuation"},'"')]),a("span",{class:"token punctuation"},">")]),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"</"),e("div")]),a("span",{class:"token punctuation"},">")]),e("\n"),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"<"),e("script")]),a("span",{class:"token punctuation"},">")]),a("span",{class:"token script"},[a("span",{class:"token language-javascript"},[e("\n  "),a("span",{class:"token keyword"},"function"),e(),a("span",{class:"token function"},"render"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("posts"),a("span",{class:"token punctuation"},","),e(" container")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" html "),a("span",{class:"token operator"},"="),e(" posts"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"reduce"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("html"),a("span",{class:"token punctuation"},","),e(" post")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n      "),a("span",{class:"token keyword"},"return"),e(),a("span",{class:"token template-string"},[a("span",{class:"token template-punctuation string"},"`"),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("html"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"},"\n        <li>\n        <h2>"),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("post"),a("span",{class:"token punctuation"},"."),e("title"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"},"</h2>\n        <p>"),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("post"),a("span",{class:"token punctuation"},"."),e("content"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"},"</p>\n        </li>\n        "),a("span",{class:"token template-punctuation string"},"`")]),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token string"},'""'),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    container"),a("span",{class:"token punctuation"},"."),e("innerHTML "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token template-string"},[a("span",{class:"token template-punctuation string"},"`"),a("span",{class:"token string"},'<ul id="post">'),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("html"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"},"<ul>"),a("span",{class:"token template-punctuation string"},"`")]),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" container "),a("span",{class:"token operator"},"="),e(" document"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"querySelector"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"#container"'),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token constant"},"PRE_RENDER"),e(),a("span",{class:"token operator"},"="),e(" document"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"querySelector"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"#post"'),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"if"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token operator"},"!"),a("span",{class:"token constant"},"PRE_RENDER"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token function"},"fetch"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"/post"'),a("span",{class:"token punctuation"},")"),e("\n      "),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"then"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"res"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(" res"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"json"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),e("\n      "),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"then"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"res"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token function"},"rednder"),a("span",{class:"token punctuation"},"("),e("res"),a("span",{class:"token punctuation"},","),e(" container"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n")])]),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"</"),e("script")]),a("span",{class:"token punctuation"},">")]),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558004099-77540"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'<div id="container"></div>\n<script>\n  function render(posts, container) {\n    const html = posts.reduce((html, post) => {\n      return `${html}\n        <li>\n        <h2>${post.title}</h2>\n        <p>${post.content}</p>\n        </li>\n        `;\n    }, "");\n    container.innerHTML = `<ul id="post">${html}<ul>`;\n  }\n  const container = document.querySelector("#container");\n  const PRE_RENDER = document.querySelector("#post");\n  if (!PRE_RENDER) {\n    fetch("/post")\n      .then((res) => res.json())\n      .then((res) => rednder(res, container));\n  }\n<\/script>\n',"data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558004099-77540","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br"),a("span",{class:"line-number"},"17"),a("br"),a("span",{class:"line-number"},"18"),a("br"),a("span",{class:"line-number"},"19"),a("br"),a("span",{class:"line-number"},"20"),a("br"),a("span",{class:"line-number"},"21"),a("br")])],-1),K=a("p",null,[e("继续优化-取消不必要的网络请求"),a("br"),e(" ssr.js")],-1),Q=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token keyword"},"function"),e(),a("span",{class:"token function"},"ssr"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"url"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token comment"},"// ..."),e("\n  "),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"setRequestInterception"),a("span",{class:"token punctuation"},"("),a("span",{class:"token boolean"},"true"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"on"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"request"'),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"req"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" whitlist "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"["),a("span",{class:"token string"},'"document"'),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token string"},'"script"'),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token string"},'"xhr"'),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token string"},'"fetch"'),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token keyword"},"if"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token operator"},"!"),e("whitelist"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"includes"),a("span",{class:"token punctuation"},"("),e("req"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"resourceType"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n      "),a("span",{class:"token keyword"},"return"),e(" req"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"abort"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token punctuation"},"}"),e("\n    req"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"continue"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558004100-3291"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'async function ssr(url) {\n  // ...\n  await page.setRequestInterception(true);\n  page.on("request", (req) => {\n    const whitlist = ["document", "script", "xhr", "fetch"];\n    if (!whitelist.includes(req.resourceType())) {\n      return req.abort();\n    }\n    req.continue();\n  });\n}\n',"data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558004100-3291","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br")])],-1),Y=a("ul",null,[a("li",null,"思考-扩展骨架屏")],-1),Z=a("ol",{start:"11"},[a("li",null,"测试代码覆盖率")],-1),nn=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(" puppeteer "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'puppeteer'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token punctuation"},"("),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" browser "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" puppeteer"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"launch"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" page "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" browser"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"newPage"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n  "),a("span",{class:"token comment"},"// 开始收集JS和CSS文件的覆盖率信息"),e("\n  "),a("span",{class:"token keyword"},"await"),e(" Promise"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"all"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"["),e("page"),a("span",{class:"token punctuation"},"."),e("coverage"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"startJSCoverage"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},","),e(" page"),a("span",{class:"token punctuation"},"."),e("coverage"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"startCSSCoverage"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n  "),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"goto"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'https://www.baidu.com'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"await"),e(" page"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"waitForSelector"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'title'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n  "),a("span",{class:"token comment"},"// 停止收集覆盖率信息"),e("\n  "),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token punctuation"},"["),e("jsCoverage"),a("span",{class:"token punctuation"},","),e(" cssCoverage"),a("span",{class:"token punctuation"},"]"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" Promise"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"all"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"["),e("\n    page"),a("span",{class:"token punctuation"},"."),e("coverage"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"stopJSCoverage"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},","),e("\n    page"),a("span",{class:"token punctuation"},"."),e("coverage"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"stopCSSCoverage"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e("\n  "),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n  "),a("span",{class:"token comment"},"// 根据覆盖率计算使用了多少字节"),e("\n  "),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token function-variable function"},"calculateUsedBytes"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("type"),a("span",{class:"token punctuation"},","),e(" coverage")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e("\n    coverage"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"map"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[a("span",{class:"token punctuation"},"{"),e(" url"),a("span",{class:"token punctuation"},","),e(" ranges"),a("span",{class:"token punctuation"},","),e(" text "),a("span",{class:"token punctuation"},"}")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n      "),a("span",{class:"token keyword"},"let"),e(" usedBytes "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token number"},"0"),a("span",{class:"token punctuation"},";"),e("\n\n      ranges"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"forEach"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"range"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"("),e("usedBytes "),a("span",{class:"token operator"},"+="),e(" range"),a("span",{class:"token punctuation"},"."),e("end "),a("span",{class:"token operator"},"-"),e(" range"),a("span",{class:"token punctuation"},"."),e("start "),a("span",{class:"token operator"},"-"),e(),a("span",{class:"token number"},"1"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n      "),a("span",{class:"token keyword"},"return"),e(),a("span",{class:"token punctuation"},"{"),e("\n        url"),a("span",{class:"token punctuation"},","),e("\n        type"),a("span",{class:"token punctuation"},","),e("\n        usedBytes"),a("span",{class:"token punctuation"},","),e("\n        totalBytes"),a("span",{class:"token operator"},":"),e(" text"),a("span",{class:"token punctuation"},"."),e("length\n      "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n  console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"info"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"["),e("\n    "),a("span",{class:"token operator"},"..."),a("span",{class:"token function"},"calculateUsedBytes"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'js'"),a("span",{class:"token punctuation"},","),e(" jsCoverage"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},","),e("\n    "),a("span",{class:"token operator"},"..."),a("span",{class:"token function"},"calculateUsedBytes"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'css'"),a("span",{class:"token punctuation"},","),e(" cssCoverage"),a("span",{class:"token punctuation"},")"),e("\n  "),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n  "),a("span",{class:"token keyword"},"await"),e(" browser"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"close"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558004100-13309"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const puppeteer = require('puppeteer');\n\n(async () => {\n  const browser = await puppeteer.launch();\n  const page = await browser.newPage();\n\n  // 开始收集JS和CSS文件的覆盖率信息\n  await Promise.all([page.coverage.startJSCoverage(), page.coverage.startCSSCoverage()]);\n\n  await page.goto('https://www.baidu.com');\n  await page.waitForSelector('title');\n\n  // 停止收集覆盖率信息\n  const [jsCoverage, cssCoverage] = await Promise.all([\n    page.coverage.stopJSCoverage(),\n    page.coverage.stopCSSCoverage()\n  ]);\n\n  // 根据覆盖率计算使用了多少字节\n  const calculateUsedBytes = (type, coverage) =>\n    coverage.map(({ url, ranges, text }) => {\n      let usedBytes = 0;\n\n      ranges.forEach(range => (usedBytes += range.end - range.start - 1));\n\n      return {\n        url,\n        type,\n        usedBytes,\n        totalBytes: text.length\n      };\n    });\n\n  console.info([\n    ...calculateUsedBytes('js', jsCoverage),\n    ...calculateUsedBytes('css', cssCoverage)\n  ]);\n\n  await browser.close();\n})();\n\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558004100-13309","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br"),a("span",{class:"line-number"},"17"),a("br"),a("span",{class:"line-number"},"18"),a("br"),a("span",{class:"line-number"},"19"),a("br"),a("span",{class:"line-number"},"20"),a("br"),a("span",{class:"line-number"},"21"),a("br"),a("span",{class:"line-number"},"22"),a("br"),a("span",{class:"line-number"},"23"),a("br"),a("span",{class:"line-number"},"24"),a("br"),a("span",{class:"line-number"},"25"),a("br"),a("span",{class:"line-number"},"26"),a("br"),a("span",{class:"line-number"},"27"),a("br"),a("span",{class:"line-number"},"28"),a("br"),a("span",{class:"line-number"},"29"),a("br"),a("span",{class:"line-number"},"30"),a("br"),a("span",{class:"line-number"},"31"),a("br"),a("span",{class:"line-number"},"32"),a("br"),a("span",{class:"line-number"},"33"),a("br"),a("span",{class:"line-number"},"34"),a("br"),a("span",{class:"line-number"},"35"),a("br"),a("span",{class:"line-number"},"36"),a("br"),a("span",{class:"line-number"},"37"),a("br"),a("span",{class:"line-number"},"38"),a("br"),a("span",{class:"line-number"},"39"),a("br"),a("span",{class:"line-number"},"40"),a("br"),a("span",{class:"line-number"},"41"),a("br")])],-1),tn=o('',5),sn=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token constant"},"CRX"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},'"/path/to/extension/"'),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"const"),e(" browser "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" puppeteer"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"launch"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),e("\n  headless"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token boolean"},"false"),a("span",{class:"token punctuation"},","),e("\n  args"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"["),a("span",{class:"token template-string"},[a("span",{class:"token template-punctuation string"},"`"),a("span",{class:"token string"},"--disable-extensions-except="),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),a("span",{class:"token constant"},"CRX"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token template-punctuation string"},"`")]),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token template-string"},[a("span",{class:"token template-punctuation string"},"`"),a("span",{class:"token string"},"--load-extension="),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),a("span",{class:"token constant"},"CRX"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token template-punctuation string"},"`")]),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558004100-63866"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'const CRX = "/path/to/extension/";\n\nconst browser = await puppeteer.launch({\n  headless: false,\n  args: [`--disable-extensions-except=${CRX}`, `--load-extension=${CRX}`],\n});\n',"data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558004100-63866","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br")])],-1),an=o('',16);p.render=function(a,e,o,c,p,en){return n(),t("div",null,[l,i,u,r,s("\n- Puppeteer 是 Node.js 工具引擎\n- Puppeteer 提供了一系列 API，通过 Chrome DevTools Protocol 协议控制 Chromium/Chrome 浏览器的行为\n- Puppeteer 默认情况下是以 headless 启动 Chrome 的，也可以通过参数控制启动有界面的 Chrome\n- Puppeteer 默认绑定最新的 Chromium 版本，也可以自己设置不同版本的绑定\n- Puppeteer 让我们不需要了解太多的底层 CDP 协议实现与浏览器的通信\n\n## [什么是 Chrome DevTool Protocol](https://chromedevtools.github.io/devtools-protocol/)\n\n- CDP 基于 WebSocket，利用 WebSocket 实现与浏览器内核的快速数据通道\n- CDP 分为多个域（DOM，Debugger，Network，Profiler，Console...），每个域中都定义了相关的命令和事件（Commands and Events）\n- 我们可以基于 CDP 封装一些工具对 Chrome 浏览器进行调试及分析，比如我们常用的 “Chrome 开发者工具” 就是基于 CDP 实现的\n- 如果你以 remote-debugging-port 参数启动 Chrome，那么就可以看到所有 Tab 页面的开发者调试前端页面，还会在同一端口上还提供了 http 服务，主要提供以下几个接口：\n```sh\nGET /json/version                     # 获取浏览器的一些元信息\nGET /json or /json/list               # 当前浏览器上打开的一些页面信息\nGET /json/protocol                    # 获取当前 CDP 的协议信息\nGET /json/new?{url}                   # 开启一共新的 Tab 页面\nGET /json/activate/{targetId}         # 激活某个页面成为当前显示的页面\nGET /json/close/{targetId}            # 关闭某个页面\nGET /devtools/inspector.html          # 打开当前页面的开发者调试工具\nWebSocket /devtools/page/{targetId}   # 获取某个页面的 websocket 地址\n```\n很多有用的工具都是基于 CDP 实现的，比如 Chrome 开发者工具，chrome-remote-interface，Puppeteer 等\n\n# Puppeteer 能做什么\n官方称：“Most things that you can do manually in the browser can be done using Puppeteer”，那么具体可以做些什么呢？\n\n- 网页截图或者生成 PDF\n- 爬取 SPA 或 SSR 网站\n- UI 自动化测试，模拟表单提交，键盘输入，点击等行为\n- 捕获网站的时间线，帮助诊断性能问题\n- 创建一个最新的自动化测试环境，使用最新的 js 和最新的 Chrome 浏览器运行测试用例\n- 测试 Chrome 扩展程序\n...\n\n# Puppeteer API 分层结构\nPuppeteer 中的 API 分层结构基本和浏览器保持一致，下面对常使用到的几个类介绍一下：\n![](https://gitee.com/artiely/Figure-bed/raw/master/20210104101644.png)\n\n- `Browser`： 对应一个浏览器实例，一个 Browser 可以包含多个 BrowserContext\n- `BrowserContext`： 对应浏览器一个上下文会话，就像我们打开一个普通的 Chrome 之后又打开一个隐身模式的浏览器一样，BrowserContext 具有独立的 Session(cookie 和 cache 独立不共享)，一个 BrowserContext 可以包含多个 Page\n- `Page`：表示一个 Tab 页面，通过 browserContext.newPage()/browser.newPage() 创建，browser.newPage() 创建页面时会使用默认的 BrowserContext，一个 Page 可以包含多个 Frame\n- `Frame`: 一个框架，每个页面有一个主框架（page.MainFrame()）,也可以多个子框架，主要由 iframe 标签创建产生的\n- `ExecutionContext`： 是 javascript 的执行环境，每一个 Frame 都一个默认的 javascript 执行环境\n- `ElementHandle`: 对应 DOM 的一个元素节点，通过该该实例可以实现对元素的点击，填写表单等行为，我们可以通过选择器，xPath 等来获取对应的元素\n- `JsHandle`：对应 DOM 中的 javascript 对象，ElementHandle 继承于 JsHandle，由于我们无法直接操作 DOM 中对象，所以封装成 JsHandle 来实现相关功能\n- `CDPSession`：可以直接与原生的 CDP 进行通信，通过 session.send 函数直接发消息，通过 session.on 接收消息，可以实现 Puppeteer API 中没有涉及的功能\n- `Coverage`：获取 JavaScript 和 CSS 代码覆盖率\n- `Tracing`：抓取性能数据进行分析\n- `Response`： 页面收到的响应\n- `Request`：  "),k,d,m,b,y,h,g,w,f,v,C,x,j,P,E,$,T,q,I,_,N,S,D,R,B,F,A,U,H,M,J,G,W,X,O,V,L,z,K,Q,Y,Z,nn,tn,sn,an])};export default p;export{c as __pageData};
