import{o as n,c as s,a as e,x as a}from"./app.5f3fb606.js";const t='{"title":"vue管理系统从0到1-本地预览","description":"","frontmatter":{"title":"vue管理系统从0到1-本地预览","tag":["vue"],"cover":"https://gitee.com/artiely/Figure-bed/raw/master/images/20200606170849.png","base64":"63a3dd","date":"2020-6-5"},"relativePath":"post/2020/2020-6-5-06-local-preview.md","lastUpdated":1629110851790}',c={},o=e("h1",{id:"vue管理系统从0到1-本地预览"},[e("a",{class:"header-anchor",href:"#vue管理系统从0到1-本地预览","aria-hidden":"true"},"#"),a(" vue管理系统从0到1-本地预览")],-1),l=e("p",null,"前一节我们设置了环境和模式，现在我们来实现本地预览，主要是为了本地先测试，有问题提前暴露",-1),p=e("p",null,[a("首先我们在根目录创建一个"),e("code",null,"server.js")],-1),i=e("div",{class:"language-js line-numbers-mode"},[e("pre",null,[e("code",null,[e("span",{class:"token keyword"},"var"),a(" express "),e("span",{class:"token operator"},"="),a(),e("span",{class:"token function"},"require"),e("span",{class:"token punctuation"},"("),e("span",{class:"token string"},"'express'"),e("span",{class:"token punctuation"},")"),a("\n"),e("span",{class:"token keyword"},"var"),a(" path "),e("span",{class:"token operator"},"="),a(),e("span",{class:"token function"},"require"),e("span",{class:"token punctuation"},"("),e("span",{class:"token string"},"'path'"),e("span",{class:"token punctuation"},")"),a("\n"),e("span",{class:"token keyword"},"var"),a(" app "),e("span",{class:"token operator"},"="),a(),e("span",{class:"token function"},"express"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),a("\n"),e("span",{class:"token comment"},"// var opn = require('opn')"),a("\n"),e("span",{class:"token keyword"},"var"),a(" localhost "),e("span",{class:"token operator"},"="),a(),e("span",{class:"token function"},"require"),e("span",{class:"token punctuation"},"("),e("span",{class:"token string"},"'address'"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"ip"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),a("\n"),e("span",{class:"token keyword"},"let"),a(" staticDir\n"),e("span",{class:"token keyword"},"let"),a(" baseUrl\n"),e("span",{class:"token keyword"},"const"),a(" argv "),e("span",{class:"token operator"},"="),a(" process"),e("span",{class:"token punctuation"},"."),a("argv"),e("span",{class:"token punctuation"},"["),e("span",{class:"token number"},"2"),e("span",{class:"token punctuation"},"]"),a("\n"),e("span",{class:"token keyword"},"if"),a(),e("span",{class:"token punctuation"},"("),a("argv "),e("span",{class:"token operator"},"==="),a(),e("span",{class:"token string"},"'test'"),e("span",{class:"token punctuation"},")"),a(),e("span",{class:"token punctuation"},"{"),a("\n  staticDir "),e("span",{class:"token operator"},"="),a(),e("span",{class:"token string"},"'/dist/test'"),a("\n  baseUrl "),e("span",{class:"token operator"},"="),a(),e("span",{class:"token string"},"'http://118.31.222.92:8088'"),a("\n"),e("span",{class:"token punctuation"},"}"),a(),e("span",{class:"token keyword"},"else"),a(),e("span",{class:"token keyword"},"if"),a(),e("span",{class:"token punctuation"},"("),a("argv "),e("span",{class:"token operator"},"==="),a(),e("span",{class:"token string"},"'stage'"),e("span",{class:"token punctuation"},")"),a(),e("span",{class:"token punctuation"},"{"),a("\n  staticDir "),e("span",{class:"token operator"},"="),a(),e("span",{class:"token string"},"'/dist/gray'"),a("\n  baseUrl "),e("span",{class:"token operator"},"="),a(),e("span",{class:"token string"},"'http://101.37.27.140:12800'"),a("\n"),e("span",{class:"token punctuation"},"}"),a(),e("span",{class:"token keyword"},"else"),a(),e("span",{class:"token keyword"},"if"),a(),e("span",{class:"token punctuation"},"("),a("argv "),e("span",{class:"token operator"},"==="),a(),e("span",{class:"token string"},"'release'"),e("span",{class:"token punctuation"},")"),a(),e("span",{class:"token punctuation"},"{"),a("\n  staticDir "),e("span",{class:"token operator"},"="),a(),e("span",{class:"token string"},"'/dist/release'"),a("\n  baseUrl "),e("span",{class:"token operator"},"="),a(),e("span",{class:"token string"},"'https://sp.timing360.com'"),a("\n"),e("span",{class:"token punctuation"},"}"),a("\napp"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"use"),e("span",{class:"token punctuation"},"("),a("express"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"static"),e("span",{class:"token punctuation"},"("),a("path"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"join"),e("span",{class:"token punctuation"},"("),a("__dirname"),e("span",{class:"token punctuation"},","),a(" staticDir"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},")"),a("\n"),e("span",{class:"token keyword"},"var"),a(" proxy "),e("span",{class:"token operator"},"="),a(),e("span",{class:"token function"},"require"),e("span",{class:"token punctuation"},"("),e("span",{class:"token string"},"'http-proxy-middleware'"),e("span",{class:"token punctuation"},")"),a("\n\n"),e("span",{class:"token keyword"},"var"),a(" options "),e("span",{class:"token operator"},"="),a(),e("span",{class:"token punctuation"},"{"),a("\n  target"),e("span",{class:"token operator"},":"),a(" baseUrl"),e("span",{class:"token punctuation"},","),a(),e("span",{class:"token comment"},"// 测试"),a("\n  changeOrigin"),e("span",{class:"token operator"},":"),a(),e("span",{class:"token boolean"},"true"),e("span",{class:"token punctuation"},","),a(),e("span",{class:"token comment"},"// 需要虚拟主机站点"),a("\n  pathRewrite"),e("span",{class:"token operator"},":"),a(),e("span",{class:"token punctuation"},"{"),e("span",{class:"token punctuation"},"}"),a("\n"),e("span",{class:"token punctuation"},"}"),a("\n"),e("span",{class:"token keyword"},"var"),a(" exampleProxy "),e("span",{class:"token operator"},"="),a(),e("span",{class:"token function"},"proxy"),e("span",{class:"token punctuation"},"("),a("options"),e("span",{class:"token punctuation"},")"),a(),e("span",{class:"token comment"},"// 开启代理功能，并加载配置"),a("\napp"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"use"),e("span",{class:"token punctuation"},"("),e("span",{class:"token string"},"'/'"),e("span",{class:"token punctuation"},","),a(" exampleProxy"),e("span",{class:"token punctuation"},")"),a("\napp"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"listen"),e("span",{class:"token punctuation"},"("),e("span",{class:"token number"},"8888"),e("span",{class:"token punctuation"},","),a(),e("span",{class:"token parameter"},"err"),a(),e("span",{class:"token operator"},"=>"),a(),e("span",{class:"token punctuation"},"{"),a("\n  "),e("span",{class:"token keyword"},"var"),a(" uri "),e("span",{class:"token operator"},"="),a(),e("span",{class:"token template-string"},[e("span",{class:"token template-punctuation string"},"`"),e("span",{class:"token string"},"http://"),e("span",{class:"token interpolation"},[e("span",{class:"token interpolation-punctuation punctuation"},"${"),a("localhost"),e("span",{class:"token interpolation-punctuation punctuation"},"}")]),e("span",{class:"token string"},":8888"),e("span",{class:"token template-punctuation string"},"`")]),a("\n  "),e("span",{class:"token keyword"},"if"),a(),e("span",{class:"token punctuation"},"("),e("span",{class:"token operator"},"!"),a("err"),e("span",{class:"token punctuation"},")"),a(),e("span",{class:"token punctuation"},"{"),a("\n    console"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"log"),e("span",{class:"token punctuation"},"("),a("uri"),e("span",{class:"token punctuation"},")"),a("\n  "),e("span",{class:"token punctuation"},"}"),a(),e("span",{class:"token keyword"},"else"),a(),e("span",{class:"token punctuation"},"{"),a("\n    console"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"log"),e("span",{class:"token punctuation"},"("),a("err"),e("span",{class:"token punctuation"},")"),a("\n  "),e("span",{class:"token punctuation"},"}"),a("\n"),e("span",{class:"token punctuation"},"}"),e("span",{class:"token punctuation"},")"),a("\n\n")]),e("div",{class:"m-mdic-copy-wrapper"},[e("div",{class:"u-mdic-copy-notify",id:"j-notify-1629557010150-77002"},"复制成功"),e("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"var express = require('express')\nvar path = require('path')\nvar app = express()\n// var opn = require('opn')\nvar localhost = require('address').ip()\nlet staticDir\nlet baseUrl\nconst argv = process.argv[2]\nif (argv === 'test') {\n  staticDir = '/dist/test'\n  baseUrl = 'http://118.31.222.92:8088'\n} else if (argv === 'stage') {\n  staticDir = '/dist/gray'\n  baseUrl = 'http://101.37.27.140:12800'\n} else if (argv === 'release') {\n  staticDir = '/dist/release'\n  baseUrl = 'https://sp.timing360.com'\n}\napp.use(express.static(path.join(__dirname, staticDir)))\nvar proxy = require('http-proxy-middleware')\n\nvar options = {\n  target: baseUrl, // 测试\n  changeOrigin: true, // 需要虚拟主机站点\n  pathRewrite: {}\n}\nvar exampleProxy = proxy(options) // 开启代理功能，并加载配置\napp.use('/', exampleProxy)\napp.listen(8888, err => {\n  var uri = `http://${localhost}:8888`\n  if (!err) {\n    console.log(uri)\n  } else {\n    console.log(err)\n  }\n})\n\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629557010150-77002","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),e("div",{class:"line-numbers-wrapper"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br"),e("span",{class:"line-number"},"3"),e("br"),e("span",{class:"line-number"},"4"),e("br"),e("span",{class:"line-number"},"5"),e("br"),e("span",{class:"line-number"},"6"),e("br"),e("span",{class:"line-number"},"7"),e("br"),e("span",{class:"line-number"},"8"),e("br"),e("span",{class:"line-number"},"9"),e("br"),e("span",{class:"line-number"},"10"),e("br"),e("span",{class:"line-number"},"11"),e("br"),e("span",{class:"line-number"},"12"),e("br"),e("span",{class:"line-number"},"13"),e("br"),e("span",{class:"line-number"},"14"),e("br"),e("span",{class:"line-number"},"15"),e("br"),e("span",{class:"line-number"},"16"),e("br"),e("span",{class:"line-number"},"17"),e("br"),e("span",{class:"line-number"},"18"),e("br"),e("span",{class:"line-number"},"19"),e("br"),e("span",{class:"line-number"},"20"),e("br"),e("span",{class:"line-number"},"21"),e("br"),e("span",{class:"line-number"},"22"),e("br"),e("span",{class:"line-number"},"23"),e("br"),e("span",{class:"line-number"},"24"),e("br"),e("span",{class:"line-number"},"25"),e("br"),e("span",{class:"line-number"},"26"),e("br"),e("span",{class:"line-number"},"27"),e("br"),e("span",{class:"line-number"},"28"),e("br"),e("span",{class:"line-number"},"29"),e("br"),e("span",{class:"line-number"},"30"),e("br"),e("span",{class:"line-number"},"31"),e("br"),e("span",{class:"line-number"},"32"),e("br"),e("span",{class:"line-number"},"33"),e("br"),e("span",{class:"line-number"},"34"),e("br"),e("span",{class:"line-number"},"35"),e("br"),e("span",{class:"line-number"},"36"),e("br"),e("span",{class:"line-number"},"37"),e("br")])],-1),r=e("p",null,[a("然后配置"),e("code",null,"package.json")],-1),u=e("div",{class:"language-diff line-numbers-mode"},[e("pre",null,[e("code",null,[a('"scripts": {\n'),e("span",{class:"token unchanged"},[e("span",{class:"token prefix unchanged"}," "),e("span",{class:"token line"},'   "serve": "vue-cli-service serve",\n'),e("span",{class:"token prefix unchanged"}," "),e("span",{class:"token line"},'   "build": "vue-cli-service build",\n'),e("span",{class:"token prefix unchanged"}," "),e("span",{class:"token line"},'   "deploy": "pm2 deploy deploy.yml production",\n'),e("span",{class:"token prefix unchanged"}," "),e("span",{class:"token line"},'   "build:test": "vue-cli-service build --mode test",\n'),e("span",{class:"token prefix unchanged"}," "),e("span",{class:"token line"},'   "build:stage": "vue-cli-service build --mode stage",\n'),e("span",{class:"token prefix unchanged"}," "),e("span",{class:"token line"},'   "build:release": "vue-cli-service build --mode release",\n'),e("span",{class:"token prefix unchanged"}," "),e("span",{class:"token line"},'   "build:all": "npm run build:test && npm run build:stage && npm run build:release",\n')]),e("span",{class:"token inserted-sign inserted"},[e("span",{class:"token prefix inserted"},"+"),e("span",{class:"token line"},'   "local:test": "node ./server.js test",\n'),e("span",{class:"token prefix inserted"},"+"),e("span",{class:"token line"},'   "local:stage": "node ./server.js stage",\n'),e("span",{class:"token prefix inserted"},"+"),e("span",{class:"token line"},'   "local:release": "node ./server.js release",\n')]),e("span",{class:"token unchanged"},[e("span",{class:"token prefix unchanged"}," "),e("span",{class:"token line"},'   "preview": "node build/index.js --preview",\n'),e("span",{class:"token prefix unchanged"}," "),e("span",{class:"token line"},'   "lint": "eslint --fix --ext .js,.vue src",\n'),e("span",{class:"token prefix unchanged"}," "),e("span",{class:"token line"},'   "test:unit": "jest --clearCache && vue-cli-service test:unit",\n'),e("span",{class:"token prefix unchanged"}," "),e("span",{class:"token line"},'   "test:ci": "npm run lint && npm run test:unit",\n'),e("span",{class:"token prefix unchanged"}," "),e("span",{class:"token line"},'   "svgo": "svgo -f src/icons/svg --config=src/icons/svgo.yml"\n'),e("span",{class:"token prefix unchanged"}," "),e("span",{class:"token line"}," },\n")])]),e("div",{class:"m-mdic-copy-wrapper"},[e("div",{class:"u-mdic-copy-notify",id:"j-notify-1629557010150-42431"},"复制成功"),e("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'"scripts": {\n    "serve": "vue-cli-service serve",\n    "build": "vue-cli-service build",\n    "deploy": "pm2 deploy deploy.yml production",\n    "build:test": "vue-cli-service build --mode test",\n    "build:stage": "vue-cli-service build --mode stage",\n    "build:release": "vue-cli-service build --mode release",\n    "build:all": "npm run build:test && npm run build:stage && npm run build:release",\n+   "local:test": "node ./server.js test",\n+   "local:stage": "node ./server.js stage",\n+   "local:release": "node ./server.js release",\n    "preview": "node build/index.js --preview",\n    "lint": "eslint --fix --ext .js,.vue src",\n    "test:unit": "jest --clearCache && vue-cli-service test:unit",\n    "test:ci": "npm run lint && npm run test:unit",\n    "svgo": "svgo -f src/icons/svg --config=src/icons/svgo.yml"\n  },\n',"data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629557010150-42431","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),e("div",{class:"line-numbers-wrapper"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br"),e("span",{class:"line-number"},"3"),e("br"),e("span",{class:"line-number"},"4"),e("br"),e("span",{class:"line-number"},"5"),e("br"),e("span",{class:"line-number"},"6"),e("br"),e("span",{class:"line-number"},"7"),e("br"),e("span",{class:"line-number"},"8"),e("br"),e("span",{class:"line-number"},"9"),e("br"),e("span",{class:"line-number"},"10"),e("br"),e("span",{class:"line-number"},"11"),e("br"),e("span",{class:"line-number"},"12"),e("br"),e("span",{class:"line-number"},"13"),e("br"),e("span",{class:"line-number"},"14"),e("br"),e("span",{class:"line-number"},"15"),e("br"),e("span",{class:"line-number"},"16"),e("br"),e("span",{class:"line-number"},"17"),e("br")])],-1),d=e("p",null,"这样只要执行对应的命令就是在本地通过代理模拟线上的环境。把上线的不确定性在本地提前暴露。",-1);c.render=function(e,a,t,c,k,m){return n(),s("div",null,[o,l,p,i,r,u,d])};export default c;export{t as __pageData};
