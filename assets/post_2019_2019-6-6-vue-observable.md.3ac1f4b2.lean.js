import{o as n,c as t,a,x as e,f as s}from"./app.b304d650.js";const o='{"title":"vue observable api 初应用","description":"","frontmatter":{"title":"vue observable api 初应用","tag":["vue","observable"],"author":"Artiely","date":"2019-6-6","cover":"https://gitee.com/artiely/Figure-bed/raw/master/images/20200315153307.png","base64":404040},"headers":[{"level":2,"title":"Vue.observable 的应用","slug":"vueobservable-的应用"},{"level":2,"title":"参数","slug":"参数"},{"level":2,"title":"用法","slug":"用法"}],"relativePath":"post/2019/2019-6-6-vue-observable.md","lastUpdated":1629110829129}',c={},l=a("h1",{id:"vue-列表的按需刷新"},[a("a",{class:"header-anchor",href:"#vue-列表的按需刷新","aria-hidden":"true"},"#"),e(" vue 列表的按需刷新")],-1),p=a("p",null,[e("在vue 2.6.0 新增了一个api "),a("code",null,"observable"),e(" 可实现全局的数据相应，一定程度上可以取代vuex"),a("br"),e(" 所以我在项目中第一次使用了他，"),a("br"),e(" 我们的业务场景是这样的，一个订单列表，可以无限下拉，假如：我下拉了 3 页，点击一个订单可以进入详情，在详情里可以改变订单的状态，但是从详情返回的时候列表应该刷新到第一页才能看到状态的改变【前提是后端排序是按更新时间】，但也不能每次从详情返回都刷新列表，因为我可能只是查看了详情，并没有改变订单的状态，这个时候返回订单列表应该在我进入详情时的位置（也就是第三页）并且没有刷新。")],-1),i=a("p",null,"简述为： 列表进详情有操作返回刷新，无操作返回不刷新。",-1),r=a("p",null,"我们通过路由钩子监听当前从哪个页面来;伪代码如下：",-1),u=a("div",{class:"language-js line-numbers-mode"},[a("div",{class:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("div",{class:"highlighted"}," "),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",null,[a("code",null,[a("span",{class:"token function"},"beforeRouteEnter"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("to"),a("span",{class:"token punctuation"},","),e(" from"),a("span",{class:"token punctuation"},","),e(" next")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token function"},"next"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"vm"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n      "),a("span",{class:"token keyword"},"if"),e(),a("span",{class:"token punctuation"},"("),e("\n        from"),a("span",{class:"token punctuation"},"."),e("path "),a("span",{class:"token operator"},"==="),e(),a("span",{class:"token string"},"'/index'"),e(),a("span",{class:"token operator"},"||"),e("\n        from"),a("span",{class:"token punctuation"},"."),e("path "),a("span",{class:"token operator"},"==="),e(),a("span",{class:"token string"},"'/detail'"),e(),a("span",{class:"token operator"},"||"),e("\n        from"),a("span",{class:"token punctuation"},"."),e("name "),a("span",{class:"token operator"},"==="),e(),a("span",{class:"token keyword"},"null"),e("\n      "),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n        vm"),a("span",{class:"token punctuation"},"."),e("query"),a("span",{class:"token punctuation"},"."),e("pageNo "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token number"},"1"),e("\n        vm"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"getData"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e("\n      "),a("span",{class:"token punctuation"},"}"),e("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558743450-35742"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"beforeRouteEnter(to, from, next) {\n    next(vm => {\n      if (\n        from.path === '/index' ||\n        from.path === '/detail' ||\n        from.name === null\n      ) {\n        vm.query.pageNo = 1\n        vm.getData()\n      }\n    })\n  },\n\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558743450-35742","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br")])],-1),d=s('',6),m=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(" state "),a("span",{class:"token operator"},"="),e(" Vue"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"observable"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),e(" count"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token number"},"0"),e(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),e("\n\n"),a("span",{class:"token keyword"},"const"),e(" Demo "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token function"},"render"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"h"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"return"),e(),a("span",{class:"token function"},"h"),a("span",{class:"token punctuation"},"("),e("\n      "),a("span",{class:"token string"},"'button'"),a("span",{class:"token punctuation"},","),e("\n      "),a("span",{class:"token punctuation"},"{"),e("\n        on"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n          "),a("span",{class:"token function-variable function"},"click"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n            state"),a("span",{class:"token punctuation"},"."),e("count"),a("span",{class:"token operator"},"++"),e("\n          "),a("span",{class:"token punctuation"},"}"),e("\n        "),a("span",{class:"token punctuation"},"}"),e("\n      "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n      "),a("span",{class:"token template-string"},[a("span",{class:"token template-punctuation string"},"`"),a("span",{class:"token string"},"count is: "),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("state"),a("span",{class:"token punctuation"},"."),e("count"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token template-punctuation string"},"`")]),e("\n    "),a("span",{class:"token punctuation"},")"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558743450-19896"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const state = Vue.observable({ count: 0 })\n\nconst Demo = {\n  render(h) {\n    return h(\n      'button',\n      {\n        on: {\n          click: () => {\n            state.count++\n          }\n        }\n      },\n      `count is: ${state.count}`\n    )\n  }\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558743450-19896","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br"),a("span",{class:"line-number"},"17"),a("br")])],-1),b=a("p",null,[e("个人认为这个一个在未来有能力取代 vuex 的 api"),a("br"),e(" 他不存在命名空间，可以作为独立的模块，并且是响应式的")],-1),k=a("p",null,[e("新建一个"),a("code",null,"refresh.js"),e("管理所有的页面返回是否刷新的状态")],-1),y=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"/**\n * 放所有的返回操作需要刷新的\n * 参数为路由path的驼峰+refresh\n */"),e("\n"),a("span",{class:"token keyword"},"import"),e(" Vue "),a("span",{class:"token keyword"},"from"),e(),a("span",{class:"token string"},"'vue'"),e("\n"),a("span",{class:"token keyword"},"const"),e(" refresh "),a("span",{class:"token operator"},"="),e(" Vue"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"observable"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),e(" cardAddRefresh"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token boolean"},"false"),e(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),e("\n"),a("span",{class:"token keyword"},"export"),e(),a("span",{class:"token keyword"},"default"),e(" refresh\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558743450-10492"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"/**\n * 放所有的返回操作需要刷新的\n * 参数为路由path的驼峰+refresh\n */\nimport Vue from 'vue'\nconst refresh = Vue.observable({ cardAddRefresh: false })\nexport default refresh\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558743450-10492","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br")])],-1),f=a("p",null,"在详情页",-1),h=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"import"),e(" refresh "),a("span",{class:"token keyword"},"from"),e(),a("span",{class:"token string"},"'@/refresh'"),e("\n"),a("span",{class:"token comment"},"// 有操作的回调里修改刷新状态"),e("\nrefresh"),a("span",{class:"token punctuation"},"."),e("cardAddRefresh "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token boolean"},"true"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558743450-68233"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"import refresh from '@/refresh'\n// 有操作的回调里修改刷新状态\nrefresh.cardAddRefresh = true\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558743450-68233","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br")])],-1),v=a("p",null,"在列表里",-1),g=a("div",{class:"language-js line-numbers-mode"},[a("div",{class:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{class:"highlighted"}," "),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"import"),e(" refresh "),a("span",{class:"token keyword"},"from"),e(),a("span",{class:"token string"},"'@/refresh'"),e("\n"),a("span",{class:"token function"},"beforeRouteEnter"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("to"),a("span",{class:"token punctuation"},","),e(" from"),a("span",{class:"token punctuation"},","),e(" next")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token function"},"next"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"vm"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"if"),e(),a("span",{class:"token punctuation"},"("),e("\n      from"),a("span",{class:"token punctuation"},"."),e("path "),a("span",{class:"token operator"},"==="),e(),a("span",{class:"token string"},"'/index'"),e(),a("span",{class:"token operator"},"||"),e("\n      "),a("span",{class:"token punctuation"},"("),e("from"),a("span",{class:"token punctuation"},"."),e("path "),a("span",{class:"token operator"},"==="),e(),a("span",{class:"token string"},"'/card-add'"),e(),a("span",{class:"token operator"},"&&"),e(" refresh"),a("span",{class:"token punctuation"},"."),e("cardAddRefresh"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"||"),e("\n      from"),a("span",{class:"token punctuation"},"."),e("name "),a("span",{class:"token operator"},"==="),e(),a("span",{class:"token keyword"},"null"),e("\n    "),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n      vm"),a("span",{class:"token punctuation"},"."),e("query"),a("span",{class:"token punctuation"},"."),e("pageNo "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token number"},"1"),e("\n      vm"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"getData"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e("\n    "),a("span",{class:"token punctuation"},"}"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558743450-23025"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"import refresh from '@/refresh'\nbeforeRouteEnter(to, from, next) {\n  next(vm => {\n    if (\n      from.path === '/index' ||\n      (from.path === '/card-add' && refresh.cardAddRefresh) ||\n      from.name === null\n    ) {\n      vm.query.pageNo = 1\n      vm.getData()\n    }\n  })\n},\n\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558743450-23025","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br")])],-1),C=a("p",null,"这样在进入列表时候就知道是否该刷新了",-1);c.render=function(a,e,s,o,c,x){return n(),t("div",null,[l,p,i,r,u,d,m,b,k,y,f,h,v,g,C])};export default c;export{o as __pageData};
