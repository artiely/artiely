import{o as n,c as t,f as s,a,x as e}from"./app.b304d650.js";const o='{"title":"web应用开发框架","description":"","frontmatter":{"title":"web应用开发框架","tag":["koa","egg"],"author":"Artiely","date":"2018-6-26","cover":"https://gitee.com/artiely/Figure-bed/raw/master/images/20200315171325.png","base64":"332a2a"},"headers":[{"level":2,"title":"koa入门与使用","slug":"koa入门与使用"},{"level":3,"title":"简介","slug":"简介"},{"level":3,"title":"安装","slug":"安装"},{"level":3,"title":"基本用法","slug":"基本用法"},{"level":3,"title":"路由","slug":"路由"},{"level":3,"title":"中间件","slug":"中间件"},{"level":3,"title":"错误处理","slug":"错误处理"},{"level":3,"title":"web app","slug":"web-app"},{"level":2,"title":"Egg入门","slug":"egg入门"},{"level":3,"title":"Egg是什么？","slug":"egg是什么"},{"level":3,"title":"Egg与Koa的关系","slug":"egg与koa的关系"},{"level":3,"title":"快速入门","slug":"快速入门"},{"level":3,"title":"渐进式开发","slug":"渐进式开发"},{"level":3,"title":"基础功能","slug":"基础功能"},{"level":2,"title":"Egg进阶与实战","slug":"egg进阶与实战"},{"level":3,"title":"Debug","slug":"debug"},{"level":3,"title":"日志","slug":"日志"},{"level":3,"title":"多进程模型和进程间通信","slug":"多进程模型和进程间通信"},{"level":3,"title":"异常捕获( 错误处理 )","slug":"异常捕获-错误处理"},{"level":3,"title":"多实例插件","slug":"多实例插件"},{"level":3,"title":"多进程增强版","slug":"多进程增强版"},{"level":3,"title":"实战-简易博客","slug":"实战-简易博客"},{"level":3,"title":"未来展望","slug":"未来展望"}],"relativePath":"post/2018/2018-6-26-web-koa-egg.md","lastUpdated":1629110797259}',c={},l=s('',9),p=a("div",{class:"language-shell line-numbers-mode"},[a("pre",null,[a("code",null,[e("$ nvm "),a("span",{class:"token function"},"install"),e(),a("span",{class:"token number"},"7"),e("\n$ "),a("span",{class:"token function"},"npm"),e(" i koa\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754400-82238"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"$ nvm install 7\n$ npm i koa\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754400-82238","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br")])],-1),i=s('',3),r=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(" Koa "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'koa'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"const"),e(" app "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"new"),e(),a("span",{class:"token class-name"},"Koa"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"listen"),a("span",{class:"token punctuation"},"("),a("span",{class:"token number"},"3000"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754400-88027"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const Koa = require('koa');\nconst app = new Koa();\n\napp.listen(3000);\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754400-88027","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br")])],-1),u=a("h4",{id:"2-context对象"},[a("a",{class:"header-anchor",href:"#2-context对象","aria-hidden":"true"},"#"),e(" 2. context对象")],-1),d=a("p",null,"Koa 提供一个 Context 对象，表示一次对话的上下文（包括 HTTP 请求和 HTTP 回复）。通过加工这个对象，就可以控制返回给用户的内容。",-1),m=a("p",null,[a("code",null,"Context.response.body"),e("属性就是发送给用户的内容。")],-1),k=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(" Koa "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'koa'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"const"),e(" app "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"new"),e(),a("span",{class:"token class-name"},"Koa"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token function-variable function"},"main"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"ctx"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'Hello World'"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"use"),a("span",{class:"token punctuation"},"("),e("main"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"listen"),a("span",{class:"token punctuation"},"("),a("span",{class:"token number"},"3000"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754400-16655"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const Koa = require('koa');\nconst app = new Koa();\n\nconst main = ctx => {\n  ctx.response.body = 'Hello World';\n};\n\napp.use(main);\napp.listen(3000);\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754400-16655","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br")])],-1),b=s('',4),y=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// demos/03.js"),e("\n"),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token function-variable function"},"main"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"ctx"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"if"),e(),a("span",{class:"token punctuation"},"("),e("ctx"),a("span",{class:"token punctuation"},"."),e("request"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"accepts"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'xml'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("type "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'xml'"),a("span",{class:"token punctuation"},";"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'<data>Hello World</data>'"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token keyword"},"else"),e(),a("span",{class:"token keyword"},"if"),e(),a("span",{class:"token punctuation"},"("),e("ctx"),a("span",{class:"token punctuation"},"."),e("request"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"accepts"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'json'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("type "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'json'"),a("span",{class:"token punctuation"},";"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e(" data"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'Hello World'"),e(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token keyword"},"else"),e(),a("span",{class:"token keyword"},"if"),e(),a("span",{class:"token punctuation"},"("),e("ctx"),a("span",{class:"token punctuation"},"."),e("request"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"accepts"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'html'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("type "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'html'"),a("span",{class:"token punctuation"},";"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'<p>Hello World</p>'"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token keyword"},"else"),e(),a("span",{class:"token punctuation"},"{"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("type "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'text'"),a("span",{class:"token punctuation"},";"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'Hello World'"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754400-57183"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// demos/03.js\nconst main = ctx => {\n  if (ctx.request.accepts('xml')) {\n    ctx.response.type = 'xml';\n    ctx.response.body = '<data>Hello World</data>';\n  } else if (ctx.request.accepts('json')) {\n    ctx.response.type = 'json';\n    ctx.response.body = { data: 'Hello World' };\n  } else if (ctx.request.accepts('html')) {\n    ctx.response.type = 'html';\n    ctx.response.body = '<p>Hello World</p>';\n  } else {\n    ctx.response.type = 'text';\n    ctx.response.body = 'Hello World';\n  }\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754400-57183","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br")])],-1),h=a("h4",{id:"4-网页模板"},[a("a",{class:"header-anchor",href:"#4-网页模板","aria-hidden":"true"},"#"),e(" 4. 网页模板")],-1),f=a("p",null,"实际开发中，返回给用户的网页往往都写成模板文件。我们可以让 Koa 先读取模板文件，然后将这个模板返回给用户。",-1),g=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(" Koa "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'koa'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"const"),e(" app "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"new"),e(),a("span",{class:"token class-name"},"Koa"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"const"),e(" fs "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'fs'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"const"),e(" path "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'path'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token function-variable function"},"main"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"ctx"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("type "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'html'"),a("span",{class:"token punctuation"},";"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(" fs"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"createReadStream"),a("span",{class:"token punctuation"},"("),e("path"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"resolve"),a("span",{class:"token punctuation"},"("),e("path"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"join"),a("span",{class:"token punctuation"},"("),e("__dirname"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token string"},"'./demo.html'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"use"),a("span",{class:"token punctuation"},"("),e("main"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"listen"),a("span",{class:"token punctuation"},"("),a("span",{class:"token number"},"3000"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754400-33615"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const Koa = require('koa');\nconst app = new Koa();\nconst fs = require('fs');\nconst path = require('path');\n\nconst main = (ctx) => {\n    ctx.response.type = 'html';\n    ctx.response.body = fs.createReadStream(path.resolve(path.join(__dirname, './demo.html')));\n}\n\napp.use(main);\napp.listen(3000);\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754400-33615","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br")])],-1),C=a("h3",{id:"路由"},[a("a",{class:"header-anchor",href:"#路由","aria-hidden":"true"},"#"),e(" 路由")],-1),x=a("h4",{id:"1原生路由"},[a("a",{class:"header-anchor",href:"#1原生路由","aria-hidden":"true"},"#"),e(" 1.原生路由")],-1),v=a("p",null,[e("网站一般都有多个页面。通过"),a("code",null,"ctx.request.path"),e("可以获取用户请求的路径，由此实现简单的路由。")],-1),w=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token function-variable function"},"main"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"ctx"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"if"),e(),a("span",{class:"token punctuation"},"("),e("ctx"),a("span",{class:"token punctuation"},"."),e("request"),a("span",{class:"token punctuation"},"."),e("path "),a("span",{class:"token operator"},"!=="),e(),a("span",{class:"token string"},"'/'"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("type "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'html'"),a("span",{class:"token punctuation"},";"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'<a href=\"/\">Index Page</a>'"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token keyword"},"else"),e(),a("span",{class:"token punctuation"},"{"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'Hello World'"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754401-35966"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const main = ctx => {\n  if (ctx.request.path !== '/') {\n    ctx.response.type = 'html';\n    ctx.response.body = '<a href=\"/\">Index Page</a>';\n  } else {\n    ctx.response.body = 'Hello World';\n  }\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754401-35966","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br")])],-1),j=a("h4",{id:"2-koa-route模块"},[a("a",{class:"header-anchor",href:"#2-koa-route模块","aria-hidden":"true"},"#"),e(" 2. koa-route模块")],-1),_=a("p",null,[e("原生路由用起来不太方便，我们可以使用封装好的"),a("a",{href:"https://www.npmjs.com/package/koa-route",target:"_blank",rel:"noopener noreferrer"},[a("code",null,"koa-route")]),e("模块。")],-1),T=a("div",{class:"language-javascript line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(" route "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'koa-route'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token function-variable function"},"about"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"ctx"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("type "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'html'"),a("span",{class:"token punctuation"},";"),e("\n  ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'<a href=\"/\">Index Page</a>'"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token function-variable function"},"main"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"ctx"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'Hello World'"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"use"),a("span",{class:"token punctuation"},"("),e("route"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"get"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'/'"),a("span",{class:"token punctuation"},","),e(" main"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"use"),a("span",{class:"token punctuation"},"("),e("route"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"get"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'/about'"),a("span",{class:"token punctuation"},","),e(" about"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754401-79359"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const route = require('koa-route');\n\nconst about = ctx => {\n  ctx.response.type = 'html';\n  ctx.response.body = '<a href=\"/\">Index Page</a>';\n};\n\nconst main = ctx => {\n  ctx.response.body = 'Hello World';\n};\n\napp.use(route.get('/', main));\napp.use(route.get('/about', about));\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754401-79359","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br")])],-1),$=a("h4",{id:"3-静态资源"},[a("a",{class:"header-anchor",href:"#3-静态资源","aria-hidden":"true"},"#"),e(" 3. 静态资源")],-1),I=a("p",null,[e("如果网站提供静态资源（图片、字体、样式表、脚本......），为它们一个个写路由就很麻烦，也没必要。"),a("a",{href:"https://www.npmjs.com/package/koa-static",target:"_blank",rel:"noopener noreferrer"},[a("code",null,"koa-static")]),e("模块封装了这部分的请求。")],-1),E=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(" path "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'path'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"const"),e(" serve "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'koa-static'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"const"),e(" main "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"serve"),a("span",{class:"token punctuation"},"("),e("path"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"join"),a("span",{class:"token punctuation"},"("),e("__dirname"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"use"),a("span",{class:"token punctuation"},"("),e("main"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754401-42174"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const path = require('path');\nconst serve = require('koa-static');\n\nconst main = serve(path.join(__dirname));\napp.use(main);\n\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754401-42174","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br")])],-1),N=a("h4",{id:"4重定向"},[a("a",{class:"header-anchor",href:"#4重定向","aria-hidden":"true"},"#"),e(" 4.重定向")],-1),A=a("p",null,[e("有些场合，服务器需要重定向（redirect）访问请求。比如，用户登陆以后，将他重定向到登陆前的页面。"),a("code",null,"ctx.response.redirect()"),e("方法可以发出一个302跳转，将用户导向另一个路由。")],-1),P=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token function-variable function"},"redirect"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"ctx"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"redirect"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'/'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'<a href=\"/\">Index Page</a>'"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"use"),a("span",{class:"token punctuation"},"("),e("route"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"get"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'/redirect'"),a("span",{class:"token punctuation"},","),e(" redirect"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754401-61691"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const redirect = ctx => {\n  ctx.response.redirect('/');\n  ctx.response.body = '<a href=\"/\">Index Page</a>';\n};\n\napp.use(route.get('/redirect', redirect));\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754401-61691","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br")])],-1),q=a("h3",{id:"中间件"},[a("a",{class:"header-anchor",href:"#中间件","aria-hidden":"true"},"#"),e(" 中间件")],-1),S=a("h4",{id:"1logger"},[a("a",{class:"header-anchor",href:"#1logger","aria-hidden":"true"},"#"),e(" 1.logger")],-1),D=a("p",null,"Koa 的最大特色，也是最重要的一个设计，就是中间件（middleware）。为了理解中间件，我们先看一下 Logger （打印日志）功能的实现。",-1),F=a("p",null,[e("最简单的写法就是在"),a("code",null,"main"),e("函数里面增加一行。")],-1),B=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token function-variable function"},"main"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"ctx"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token template-string"},[a("span",{class:"token template-punctuation string"},"`"),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("Date"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"now"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"}," "),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("ctx"),a("span",{class:"token punctuation"},"."),e("request"),a("span",{class:"token punctuation"},"."),e("method"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"}," "),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("ctx"),a("span",{class:"token punctuation"},"."),e("request"),a("span",{class:"token punctuation"},"."),e("url"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token template-punctuation string"},"`")]),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'Hello World'"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754401-14865"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const main = ctx => {\n  console.log(`${Date.now()} ${ctx.request.method} ${ctx.request.url}`);\n  ctx.response.body = 'Hello World';\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754401-14865","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br")])],-1),R=a("h4",{id:"2-中间件的概念"},[a("a",{class:"header-anchor",href:"#2-中间件的概念","aria-hidden":"true"},"#"),e(" 2. 中间件的概念")],-1),L=a("p",null,"上一个例子里面的 Logger 功能，可以拆分成一个独立函数。",-1),z=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token function-variable function"},"logger"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("ctx"),a("span",{class:"token punctuation"},","),e(" next")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token template-string"},[a("span",{class:"token template-punctuation string"},"`"),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("Date"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"now"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"}," "),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("ctx"),a("span",{class:"token punctuation"},"."),e("request"),a("span",{class:"token punctuation"},"."),e("method"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"}," "),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("ctx"),a("span",{class:"token punctuation"},"."),e("request"),a("span",{class:"token punctuation"},"."),e("url"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token template-punctuation string"},"`")]),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token function"},"next"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"use"),a("span",{class:"token punctuation"},"("),e("logger"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754401-47859"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const logger = (ctx, next) => {\n  console.log(`${Date.now()} ${ctx.request.method} ${ctx.request.url}`);\n  next();\n}\napp.use(logger);\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754401-47859","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br")])],-1),V=a("h4",{id:"3中间件执行顺序"},[a("a",{class:"header-anchor",href:"#3中间件执行顺序","aria-hidden":"true"},"#"),e(" 3.中间件执行顺序")],-1),H=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token function-variable function"},"one"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("ctx"),a("span",{class:"token punctuation"},","),e(" next")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'>> one'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token function"},"next"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'<< one'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n\n"),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token function-variable function"},"two"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("ctx"),a("span",{class:"token punctuation"},","),e(" next")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'>> two'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token function"},"next"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e(" \n  console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'<< two'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n\n"),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token function-variable function"},"three"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("ctx"),a("span",{class:"token punctuation"},","),e(" next")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'>> three'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token function"},"next"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'<< three'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"use"),a("span",{class:"token punctuation"},"("),e("one"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"use"),a("span",{class:"token punctuation"},"("),e("two"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"use"),a("span",{class:"token punctuation"},"("),e("three"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754401-97055"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const one = (ctx, next) => {\n  console.log('>> one');\n  next();\n  console.log('<< one');\n}\n\nconst two = (ctx, next) => {\n  console.log('>> two');\n  next(); \n  console.log('<< two');\n}\n\nconst three = (ctx, next) => {\n  console.log('>> three');\n  next();\n  console.log('<< three');\n}\n\napp.use(one);\napp.use(two);\napp.use(three);\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754401-97055","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br"),a("span",{class:"line-number"},"17"),a("br"),a("span",{class:"line-number"},"18"),a("br"),a("span",{class:"line-number"},"19"),a("br"),a("span",{class:"line-number"},"20"),a("br"),a("span",{class:"line-number"},"21"),a("br")])],-1),M=a("p",null,"结果如下：",-1),W=a("div",{class:"language-shell line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token operator"},">>"),e(" one\n"),a("span",{class:"token operator"},">>"),e(" two\n"),a("span",{class:"token operator"},">>"),e(" three\n"),a("span",{class:"token operator"},"<<"),e(" three\n"),a("span",{class:"token operator"},"<<"),e(" two\n"),a("span",{class:"token operator"},"<<"),e(" one\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754402-55077"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":">> one\n>> two\n>> three\n<< three\n<< two\n<< one\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754402-55077","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br")])],-1),O=a("p",null,[a("strong",null,"洋葱模型")],-1),U=a("p",null,"其实就是想向我们表达，调用next的时候，中间件的代码执行顺序是什么。",-1),K=a("p",null,[a("img",{src:"https://gitee.com/artiely/Figure-bed/raw/master/images/20200314152250.png",alt:"image-20190623131006853"})],-1),G=a("h4",{id:"4异步中间件"},[a("a",{class:"header-anchor",href:"#4异步中间件","aria-hidden":"true"},"#"),e(" 4.异步中间件")],-1),J=a("p",null,[e("迄今为止，所有例子的中间件都是同步的，不包含异步操作。如果有异步操作（比如读取数据库），中间件就必须写成 "),a("a",{href:"http://es6.ruanyifeng.com/#docs/async",target:"_blank",rel:"noopener noreferrer"},"async 函数"),e("。请看")],-1),Q=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(" fs "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'fs.promised'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"const"),e(" Koa "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'koa'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"const"),e(" app "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"new"),e(),a("span",{class:"token class-name"},"Koa"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token function-variable function"},"main"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token keyword"},"function"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("ctx"),a("span",{class:"token punctuation"},","),e(" next")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n  ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("type "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'html'"),a("span",{class:"token punctuation"},";"),e("\n  ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" fs"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"readFile"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'./demos/template.html'"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token string"},"'utf8'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"use"),a("span",{class:"token punctuation"},"("),e("main"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"listen"),a("span",{class:"token punctuation"},"("),a("span",{class:"token number"},"3000"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754402-68904"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const fs = require('fs.promised');\nconst Koa = require('koa');\nconst app = new Koa();\n\nconst main = async function (ctx, next) {\n  ctx.response.type = 'html';\n  ctx.response.body = await fs.readFile('./demos/template.html', 'utf8');\n};\n\napp.use(main);\napp.listen(3000);\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754402-68904","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br")])],-1),Y=a("h4",{id:"5-中间件的合成"},[a("a",{class:"header-anchor",href:"#5-中间件的合成","aria-hidden":"true"},"#"),e(" 5. 中间件的合成")],-1),X=a("p",null,[a("a",{href:"https://www.npmjs.com/package/koa-compose",target:"_blank",rel:"noopener noreferrer"},[a("code",null,"koa-compose")]),e("模块可以将多个中间件合成为一个。")],-1),Z=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(" compose "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'koa-compose'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token function-variable function"},"logger"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("ctx"),a("span",{class:"token punctuation"},","),e(" next")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token template-string"},[a("span",{class:"token template-punctuation string"},"`"),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("Date"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"now"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"}," "),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("ctx"),a("span",{class:"token punctuation"},"."),e("request"),a("span",{class:"token punctuation"},"."),e("method"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"}," "),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("ctx"),a("span",{class:"token punctuation"},"."),e("request"),a("span",{class:"token punctuation"},"."),e("url"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token template-punctuation string"},"`")]),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token function"},"next"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n\n"),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token function-variable function"},"main"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"ctx"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'Hello World'"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"const"),e(" middlewares "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"compose"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"["),e("logger"),a("span",{class:"token punctuation"},","),e(" main"),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"use"),a("span",{class:"token punctuation"},"("),e("middlewares"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754402-74230"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const compose = require('koa-compose');\n\nconst logger = (ctx, next) => {\n  console.log(`${Date.now()} ${ctx.request.method} ${ctx.request.url}`);\n  next();\n}\n\nconst main = ctx => {\n  ctx.response.body = 'Hello World';\n};\n\nconst middlewares = compose([logger, main]);\napp.use(middlewares);\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754402-74230","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br")])],-1),nn=a("h5",{id:"compose简单介绍"},[a("a",{class:"header-anchor",href:"#compose简单介绍","aria-hidden":"true"},"#"),e(" compose简单介绍")],-1),tn=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"var"),e(),a("span",{class:"token function-variable function"},"greeting"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("firstName"),a("span",{class:"token punctuation"},","),e(" lastName")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token string"},"'hello, '"),e(),a("span",{class:"token operator"},"+"),e(" firstName "),a("span",{class:"token operator"},"+"),e(),a("span",{class:"token string"},"' '"),e(),a("span",{class:"token operator"},"+"),e(" lastName\n"),a("span",{class:"token keyword"},"var"),e(),a("span",{class:"token function-variable function"},"toUpper"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"str"),e(),a("span",{class:"token operator"},"=>"),e(" str"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"toUpperCase"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e("\n"),a("span",{class:"token keyword"},"var"),e(" fn "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"compose"),a("span",{class:"token punctuation"},"("),e("toUpper"),a("span",{class:"token punctuation"},","),e(" greeting"),a("span",{class:"token punctuation"},")"),e("\nconsole"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token function"},"fn"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'jack'"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token string"},"'smith'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),e("   "),a("span",{class:"token comment"},"// Hello Jack Smith"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754406-59942"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"var greeting = (firstName, lastName) => 'hello, ' + firstName + ' ' + lastName\nvar toUpper = str => str.toUpperCase()\nvar fn = compose(toUpper, greeting)\nconsole.log(fn('jack', 'smith'))   // Hello Jack Smith\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754406-59942","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br")])],-1),sn=s('',8),an=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token function-variable function"},"main"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"ctx"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  ctx"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"throw"),a("span",{class:"token punctuation"},"("),a("span",{class:"token number"},"500"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754406-74507"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const main = ctx => {\n  ctx.throw(500);\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754406-74507","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br")])],-1),en=a("h4",{id:"2404错误"},[a("a",{class:"header-anchor",href:"#2404错误","aria-hidden":"true"},"#"),e(" 2.404错误")],-1),on=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token function-variable function"},"main"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"ctx"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("status "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token number"},"404"),a("span",{class:"token punctuation"},";"),e("\n  ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'Page Not Found'"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754406-8595"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const main = ctx => {\n  ctx.response.status = 404;\n  ctx.response.body = 'Page Not Found';\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754406-8595","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br")])],-1),cn=a("h4",{id:"3处理错误的中间件"},[a("a",{class:"header-anchor",href:"#3处理错误的中间件","aria-hidden":"true"},"#"),e(" 3.处理错误的中间件")],-1),ln=a("p",null,[e("为了方便处理错误，最好使用"),a("code",null,"try...catch"),e("将其捕获。但是，为每个中间件都写"),a("code",null,"try...catch"),e("太麻烦，我们可以让最外层的中间件，负责所有中间件的错误处理。")],-1),pn=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token function-variable function"},"handler"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("ctx"),a("span",{class:"token punctuation"},","),e(" next")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"try"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"await"),e(),a("span",{class:"token function"},"next"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token keyword"},"catch"),e(),a("span",{class:"token punctuation"},"("),e("err"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("status "),a("span",{class:"token operator"},"="),e(" err"),a("span",{class:"token punctuation"},"."),e("statusCode "),a("span",{class:"token operator"},"||"),e(" err"),a("span",{class:"token punctuation"},"."),e("status "),a("span",{class:"token operator"},"||"),e(),a("span",{class:"token number"},"500"),a("span",{class:"token punctuation"},";"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n      message"),a("span",{class:"token operator"},":"),e(" err"),a("span",{class:"token punctuation"},"."),e("message\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token function-variable function"},"main"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"ctx"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  ctx"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"throw"),a("span",{class:"token punctuation"},"("),a("span",{class:"token number"},"500"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"use"),a("span",{class:"token punctuation"},"("),e("handler"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"use"),a("span",{class:"token punctuation"},"("),e("main"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754406-64747"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const handler = async (ctx, next) => {\n  try {\n    await next();\n  } catch (err) {\n    ctx.response.status = err.statusCode || err.status || 500;\n    ctx.response.body = {\n      message: err.message\n    };\n  }\n};\n\nconst main = ctx => {\n  ctx.throw(500);\n};\n\napp.use(handler);\napp.use(main);\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754406-64747","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br"),a("span",{class:"line-number"},"17"),a("br")])],-1),rn=a("h4",{id:"4-error事件监听"},[a("a",{class:"header-anchor",href:"#4-error事件监听","aria-hidden":"true"},"#"),e(" 4. error事件监听")],-1),un=a("p",null,[e("运行过程中一旦出错，Koa 会触发一个"),a("code",null,"error"),e("事件。监听这个事件，也可以处理错误。")],-1),dn=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token function-variable function"},"main"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"ctx"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  ctx"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"throw"),a("span",{class:"token punctuation"},"("),a("span",{class:"token number"},"500"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"on"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'error'"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("err"),a("span",{class:"token punctuation"},","),e(" ctx")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e("\n  console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"error"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'server error'"),a("span",{class:"token punctuation"},","),e(" err"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754406-85608"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const main = ctx => {\n  ctx.throw(500);\n};\n\napp.on('error', (err, ctx) =>\n  console.error('server error', err);\n);\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754406-85608","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br")])],-1),mn=a("h4",{id:"5-释放error事件"},[a("a",{class:"header-anchor",href:"#5-释放error事件","aria-hidden":"true"},"#"),e(" 5. 释放error事件")],-1),kn=a("p",null,[e("需要注意的是，如果错误被"),a("code",null,"try...catch"),e("捕获，就不会触发"),a("code",null,"error"),e("事件。这时，必须调用"),a("code",null,"ctx.app.emit()"),e("，手动释放"),a("code",null,"error"),e("事件，才能让监听函数生效。")],-1),bn=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token function-variable function"},"handler"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("ctx"),a("span",{class:"token punctuation"},","),e(" next")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"try"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"await"),e(),a("span",{class:"token function"},"next"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token keyword"},"catch"),e(),a("span",{class:"token punctuation"},"("),e("err"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("status "),a("span",{class:"token operator"},"="),e(" err"),a("span",{class:"token punctuation"},"."),e("statusCode "),a("span",{class:"token operator"},"||"),e(" err"),a("span",{class:"token punctuation"},"."),e("status "),a("span",{class:"token operator"},"||"),e(),a("span",{class:"token number"},"500"),a("span",{class:"token punctuation"},";"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("type "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'html'"),a("span",{class:"token punctuation"},";"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'<p>Something wrong, please contact administrator.</p>'"),a("span",{class:"token punctuation"},";"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("app"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"emit"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'error'"),a("span",{class:"token punctuation"},","),e(" err"),a("span",{class:"token punctuation"},","),e(" ctx"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token function-variable function"},"main"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"ctx"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  ctx"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"throw"),a("span",{class:"token punctuation"},"("),a("span",{class:"token number"},"500"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"on"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'error'"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token keyword"},"function"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"err"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n  console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'logging error '"),a("span",{class:"token punctuation"},","),e(" err"),a("span",{class:"token punctuation"},"."),e("message"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),e("err"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754406-99293"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const handler = async (ctx, next) => {\n  try {\n    await next();\n  } catch (err) {\n    ctx.response.status = err.statusCode || err.status || 500;\n    ctx.response.type = 'html';\n    ctx.response.body = '<p>Something wrong, please contact administrator.</p>';\n    ctx.app.emit('error', err, ctx);\n  }\n};\n\nconst main = ctx => {\n  ctx.throw(500);\n};\n\napp.on('error', function(err) {\n  console.log('logging error ', err.message);\n  console.log(err);\n});\n\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754406-99293","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br"),a("span",{class:"line-number"},"17"),a("br"),a("span",{class:"line-number"},"18"),a("br"),a("span",{class:"line-number"},"19"),a("br"),a("span",{class:"line-number"},"20"),a("br")])],-1),yn=s('',4),hn=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"var"),e(" koa "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'koa'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"var"),e(" app "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"new"),e(),a("span",{class:"token class-name"},"koa"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token comment"},"// var route = require('koa-route');"),e("\n\n"),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token function-variable function"},"main"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"ctx"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"var"),e(" dataArr "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"["),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},";"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("req"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"addListener"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'data'"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"data"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n        dataArr"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"push"),a("span",{class:"token punctuation"},"("),e("data"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("req"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"addListener"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'end'"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n        "),a("span",{class:"token comment"},"// console.log(jsonBodyparser(str));"),e("\n        "),a("span",{class:"token keyword"},"let"),e(" data "),a("span",{class:"token operator"},"="),e(" Buffer"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"concat"),a("span",{class:"token punctuation"},"("),e("dataArr"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"toString"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n        console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),e("data"),a("span",{class:"token punctuation"},")"),e("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'hello world'"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"use"),a("span",{class:"token punctuation"},"("),e("route"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"post"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'/'"),a("span",{class:"token punctuation"},","),e(" main"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("  "),a("span",{class:"token comment"},"//  1. 路径 2. ctx函数"),e("\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"listen"),a("span",{class:"token punctuation"},"("),a("span",{class:"token number"},"3000"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("  "),a("span",{class:"token comment"},"// 起服务 ， 监听3000端口"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754406-33688"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"var koa = require('koa');\nvar app = new koa();\n// var route = require('koa-route');\n\nconst main = (ctx) => {\n    var dataArr = [];\n    ctx.req.addListener('data', (data) => {\n        dataArr.push(data);\n    });\n    ctx.req.addListener('end', () => {\n        // console.log(jsonBodyparser(str));\n        let data = Buffer.concat(dataArr).toString();\n        console.log(data)\n    });\n    ctx.response.body = 'hello world';\n}\n\napp.use(route.post('/', main));  //  1. 路径 2. ctx函数\napp.listen(3000);  // 起服务 ， 监听3000端口\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754406-33688","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br"),a("span",{class:"line-number"},"17"),a("br"),a("span",{class:"line-number"},"18"),a("br"),a("span",{class:"line-number"},"19"),a("br")])],-1),fn=a("h4",{id:"2-文件上传"},[a("a",{class:"header-anchor",href:"#2-文件上传","aria-hidden":"true"},"#"),e(" 2. 文件上传")],-1),gn=a("p",null,[a("a",{href:"https://www.npmjs.com/package/koa-body",target:"_blank",rel:"noopener noreferrer"},[a("code",null,"koa-body")]),e("模块还可以用来处理文件上传。")],-1),Cn=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(" os "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'os'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"const"),e(" path "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'path'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"const"),e(" koaBody "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'koa-body'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"var"),e(" route "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'koa-route'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"var"),e(" koa "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'koa'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"var"),e(" app "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"new"),e(),a("span",{class:"token class-name"},"koa"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"var"),e(" fs "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'fs'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token function-variable function"},"main"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token keyword"},"function"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"ctx"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" tmpdir "),a("span",{class:"token operator"},"="),e(" os"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"tmpdir"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e(" \n  "),a("span",{class:"token keyword"},"const"),e(" filePaths "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"["),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},";"),e("  \n  "),a("span",{class:"token keyword"},"const"),e(" files "),a("span",{class:"token operator"},"="),e(" ctx"),a("span",{class:"token punctuation"},"."),e("request"),a("span",{class:"token punctuation"},"."),e("files "),a("span",{class:"token operator"},"||"),e(),a("span",{class:"token punctuation"},"{"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n\n  "),a("span",{class:"token keyword"},"for"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token keyword"},"let"),e(" key "),a("span",{class:"token keyword"},"in"),e(" files"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" file "),a("span",{class:"token operator"},"="),e(" files"),a("span",{class:"token punctuation"},"["),e("key"),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" filePath "),a("span",{class:"token operator"},"="),e(" path"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"join"),a("span",{class:"token punctuation"},"("),e("tmpdir"),a("span",{class:"token punctuation"},","),e(" file"),a("span",{class:"token punctuation"},"."),e("name"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" reader "),a("span",{class:"token operator"},"="),e(" fs"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"createReadStream"),a("span",{class:"token punctuation"},"("),e("file"),a("span",{class:"token punctuation"},"."),e("path"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" writer "),a("span",{class:"token operator"},"="),e(" fs"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"createWriteStream"),a("span",{class:"token punctuation"},"("),e("filePath"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    reader"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"pipe"),a("span",{class:"token punctuation"},"("),e("writer"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    filePaths"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"push"),a("span",{class:"token punctuation"},"("),e("filePath"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token comment"},"//   console.log('xxxxxxxx', filePaths)"),e("\n  ctx"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(" filePaths"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"use"),a("span",{class:"token punctuation"},"("),a("span",{class:"token function"},"koaBody"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),e(" multipart"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token boolean"},"true"),e(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("  "),a("span",{class:"token comment"},"// 代表我们上传的是文件"),e("\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"use"),a("span",{class:"token punctuation"},"("),e("route"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"post"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'/upload'"),a("span",{class:"token punctuation"},","),e(" main"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"listen"),a("span",{class:"token punctuation"},"("),a("span",{class:"token number"},"3000"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("  "),a("span",{class:"token comment"},"// 起服务 ， 监听3000端口"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754407-93046"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const os = require('os');\nconst path = require('path');\nconst koaBody = require('koa-body');\nvar route = require('koa-route');\nvar koa = require('koa');\nvar app = new koa();\nvar fs = require('fs');\n\nconst main = async function(ctx) {\n  const tmpdir = os.tmpdir(); \n  const filePaths = [];  \n  const files = ctx.request.files || {};\n\n  for (let key in files) {\n    const file = files[key];\n    const filePath = path.join(tmpdir, file.name);\n    const reader = fs.createReadStream(file.path);\n    const writer = fs.createWriteStream(filePath);\n    reader.pipe(writer);\n    filePaths.push(filePath);\n  }\n//   console.log('xxxxxxxx', filePaths)\n  ctx.body = filePaths;\n};\n\napp.use(koaBody({ multipart: true }));  // 代表我们上传的是文件\napp.use(route.post('/upload', main));\napp.listen(3000);  // 起服务 ， 监听3000端口\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754407-93046","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br"),a("span",{class:"line-number"},"17"),a("br"),a("span",{class:"line-number"},"18"),a("br"),a("span",{class:"line-number"},"19"),a("br"),a("span",{class:"line-number"},"20"),a("br"),a("span",{class:"line-number"},"21"),a("br"),a("span",{class:"line-number"},"22"),a("br"),a("span",{class:"line-number"},"23"),a("br"),a("span",{class:"line-number"},"24"),a("br"),a("span",{class:"line-number"},"25"),a("br"),a("span",{class:"line-number"},"26"),a("br"),a("span",{class:"line-number"},"27"),a("br"),a("span",{class:"line-number"},"28"),a("br")])],-1),xn=s('',17),vn=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/extend/context.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"get"),e(),a("span",{class:"token function"},"isIOS"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" iosReg "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token regex"},[a("span",{class:"token regex-delimiter"},"/"),a("span",{class:"token regex-source language-regex"},"iphone|ipad|ipod"),a("span",{class:"token regex-delimiter"},"/"),a("span",{class:"token regex-flags"},"i")]),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token keyword"},"return"),e(" iosReg"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"test"),a("span",{class:"token punctuation"},"("),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"get"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'user-agent'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754407-67041"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/extend/context.js\nmodule.exports = {\n  get isIOS() {\n    const iosReg = /iphone|ipad|ipod/i;\n    return iosReg.test(this.get('user-agent'));\n  },\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754407-67041","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br")])],-1),wn=a("p",null,"在 Controller 中，我们就可以使用到刚才定义的这个便捷属性了：",-1),jn=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/controller/home.js"),e("\nexports"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"handler"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"ctx"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  ctx"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(" ctx"),a("span",{class:"token punctuation"},"."),e("isIOS\n    "),a("span",{class:"token operator"},"?"),e(),a("span",{class:"token string"},"'Your operating system is iOS.'"),e("\n    "),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'Your operating system is not iOS.'"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754407-94101"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/controller/home.js\nexports.handler = ctx => {\n  ctx.body = ctx.isIOS\n    ? 'Your operating system is iOS.'\n    : 'Your operating system is not iOS.';\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754407-94101","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br")])],-1),_n=s('',6),Tn=a("div",{class:"language-shell line-numbers-mode"},[a("pre",null,[a("code",null,[e("$ "),a("span",{class:"token function"},"mkdir"),e(" egg-example "),a("span",{class:"token operator"},"&&"),e(),a("span",{class:"token builtin class-name"},"cd"),e(" egg-example\n$ "),a("span",{class:"token function"},"npm"),e(" init egg --type"),a("span",{class:"token operator"},"="),e("simple\n$ "),a("span",{class:"token function"},"npm"),e(" i\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754407-83984"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"$ mkdir egg-example && cd egg-example\n$ npm init egg --type=simple\n$ npm i\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754407-83984","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br")])],-1),$n=a("h4",{id:"编写controller"},[a("a",{class:"header-anchor",href:"#编写controller","aria-hidden":"true"},"#"),e(" 编写Controller")],-1),In=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/controller/home.js"),e("\n"),a("span",{class:"token keyword"},"const"),e(" Controller "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'egg'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),e("Controller"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"class"),e(),a("span",{class:"token class-name"},"HomeController"),e(),a("span",{class:"token keyword"},"extends"),e(),a("span",{class:"token class-name"},"Controller"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"index"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token punctuation"},"{"),e(" ctx "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},";"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'hi, egg'"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n\nmodule"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(" HomeController"),a("span",{class:"token punctuation"},";"),e("\n\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754407-71040"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/controller/home.js\nconst Controller = require('egg').Controller;\n\nclass HomeController extends Controller {\n  async index() {\n    const { ctx } = this;\n    ctx.body = 'hi, egg';\n  }\n}\n\nmodule.exports = HomeController;\n\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754407-71040","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br")])],-1),En=a("p",null,"配置路由映射：",-1),Nn=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/router.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"app"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token punctuation"},"{"),e(" router"),a("span",{class:"token punctuation"},","),e(" controller "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token operator"},"="),e(" app"),a("span",{class:"token punctuation"},";"),e("\n  router"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"get"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'/'"),a("span",{class:"token punctuation"},","),e(" controller"),a("span",{class:"token punctuation"},"."),e("home"),a("span",{class:"token punctuation"},"."),e("index"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754407-47869"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/router.js\nmodule.exports = app => {\n  const { router, controller } = app;\n  router.get('/', controller.home.index);\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754407-47869","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br")])],-1),An=a("h4",{id:"静态资源"},[a("a",{class:"header-anchor",href:"#静态资源","aria-hidden":"true"},"#"),e(" 静态资源")],-1),Pn=a("p",null,[e("Egg 内置了 "),a("a",{href:"https://github.com/eggjs/egg-static",target:"_blank",rel:"noopener noreferrer"},"static"),e(" 插件，线上环境建议部署到 CDN，无需该插件。")],-1),qn=a("p",null,[e("static 插件默认映射 "),a("code",null,"/public/* -> app/public/*"),e(" 目录")],-1),Sn=a("p",null,[e("此处，我们把静态资源都放到 "),a("code",null,"app/public"),e(" 目录即可：")],-1),Dn=a("div",{class:"language-"},[a("pre",null,[a("code",null,"app/public\n├── css\n│   └── news.css\n└── js\n    ├── lib.js\n    └── news.js\n"),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754408-57827"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"app/public\n├── css\n│   └── news.css\n└── js\n    ├── lib.js\n    └── news.js\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754408-57827","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br")])],-1),Fn=a("h4",{id:"模板渲染"},[a("a",{class:"header-anchor",href:"#模板渲染","aria-hidden":"true"},"#"),e(" 模板渲染")],-1),Bn=a("div",{class:"language-shell line-numbers-mode"},[a("pre",null,[a("code",null,[e("$ "),a("span",{class:"token function"},"npm"),e(" i egg-view-nunjucks --save\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754408-49605"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"$ npm i egg-view-nunjucks --save\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754408-49605","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br")])],-1),Rn=a("p",null,"开启插件：",-1),Ln=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// config/plugin.js"),e("\nexports"),a("span",{class:"token punctuation"},"."),e("nunjucks "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  enable"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token boolean"},"true"),a("span",{class:"token punctuation"},","),e("\n  "),a("span",{class:"token keyword"},"package"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'egg-view-nunjucks'"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754408-72052"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// config/plugin.js\nexports.nunjucks = {\n  enable: true,\n  package: 'egg-view-nunjucks'\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754408-72052","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br")])],-1),zn=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// config/config.default.js"),e("\n"),a("span",{class:"token comment"},"// 添加 view 配置"),e("\nexports"),a("span",{class:"token punctuation"},"."),e("view "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  defaultViewEngine"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'nunjucks'"),a("span",{class:"token punctuation"},","),e("\n  mapping"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token string"},"'.nj'"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'nunjucks'"),a("span",{class:"token punctuation"},","),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754408-47864"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// config/config.default.js\n// 添加 view 配置\nexports.view = {\n  defaultViewEngine: 'nunjucks',\n  mapping: {\n    '.nj': 'nunjucks',\n  },\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754408-47864","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br")])],-1),Vn=a("div",{class:"language-html line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"<"),e("html")]),a("span",{class:"token punctuation"},">")]),e("\n  "),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"<"),e("head")]),a("span",{class:"token punctuation"},">")]),e("\n    "),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"<"),e("title")]),a("span",{class:"token punctuation"},">")]),e("Hacker News"),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"</"),e("title")]),a("span",{class:"token punctuation"},">")]),e("\n  "),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"</"),e("head")]),a("span",{class:"token punctuation"},">")]),e("\n  "),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"<"),e("body")]),a("span",{class:"token punctuation"},">")]),e("\n    "),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"<"),e("ul")]),e(),a("span",{class:"token attr-name"},"class"),a("span",{class:"token attr-value"},[a("span",{class:"token punctuation attr-equals"},"="),a("span",{class:"token punctuation"},'"'),e("news-view view"),a("span",{class:"token punctuation"},'"')]),a("span",{class:"token punctuation"},">")]),e("\n      hello world\n    "),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"</"),e("ul")]),a("span",{class:"token punctuation"},">")]),e("\n    "),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"<"),e("h1")]),a("span",{class:"token punctuation"},">")]),e("hello world"),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"</"),e("h1")]),a("span",{class:"token punctuation"},">")]),e("\n  "),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"</"),e("body")]),a("span",{class:"token punctuation"},">")]),e("\n"),a("span",{class:"token tag"},[a("span",{class:"token tag"},[a("span",{class:"token punctuation"},"</"),e("html")]),a("span",{class:"token punctuation"},">")]),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754408-94611"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'<html>\n  <head>\n    <title>Hacker News</title>\n  </head>\n  <body>\n    <ul class="news-view view">\n      hello world\n    </ul>\n    <h1>hello world</h1>\n  </body>\n</html>\n',"data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754408-94611","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br")])],-1),Hn=a("h4",{id:"编写helper扩展"},[a("a",{class:"header-anchor",href:"#编写helper扩展","aria-hidden":"true"},"#"),e(" 编写helper扩展")],-1),Mn=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/extend/helper.js"),e("\nexports"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"getData"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"return"),e(),a("span",{class:"token string"},"'我是处理后的时间'"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754408-57570"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/extend/helper.js\nexports.getData = () => {\n    return '我是处理后的时间'\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754408-57570","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br")])],-1),Wn=a("p",null,"模板引擎和ctx都可以获取helper对象",-1),On=a("h4",{id:"编写middleware"},[a("a",{class:"header-anchor",href:"#编写middleware","aria-hidden":"true"},"#"),e(" 编写Middleware")],-1),Un=a("p",null,"类似koa中的中间件",-1),Kn=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/middleware/log.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("options"),a("span",{class:"token punctuation"},","),e(" app")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e(),a("span",{class:"token comment"},"// egg约定  1. 可以定制化配置， 2.传入 app的实例"),e("\n    "),a("span",{class:"token keyword"},"return"),e(),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token keyword"},"function"),e(),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("ctx"),a("span",{class:"token punctuation"},","),e(" next")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e(),a("span",{class:"token comment"},"// 和koa写法完全一样"),e("\n        console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'我是日志！！！！！'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n        "),a("span",{class:"token keyword"},"await"),e(),a("span",{class:"token function"},"next"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754408-2623"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/middleware/log.js\nmodule.exports = (options, app) => { // egg约定  1. 可以定制化配置， 2.传入 app的实例\n    return async function log(ctx, next) { // 和koa写法完全一样\n        console.log('我是日志！！！！！');\n        await next();\n    }\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754408-2623","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br")])],-1),Gn=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// config/config.default.js"),e("\nconfig"),a("span",{class:"token punctuation"},"."),e("middleware "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"["),e("\n    "),a("span",{class:"token string"},"'log'"),e("\n"),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754408-64455"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// config/config.default.js\nconfig.middleware = [\n    'log'\n];\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754408-64455","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br")])],-1),Jn=a("ol",null,[a("li",null,"写一个中间件"),a("li",null,"配置引入")],-1),Qn=a("h3",{id:"渐进式开发"},[a("a",{class:"header-anchor",href:"#渐进式开发","aria-hidden":"true"},"#"),e(" 渐进式开发")],-1),Yn=a("p",null,"渐进式开发是egg里面的一种非常重要的设计思想。",-1),Xn=a("ol",null,[a("li",null,"需要封装一些方法， 最早起的需求雏形")],-1),Zn=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/extend/context.js   给ctx对象扩展属性或者方法"),e("\nmodule"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"get"),e(),a("span",{class:"token function"},"isIOS"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n        "),a("span",{class:"token keyword"},"return"),e(),a("span",{class:"token string"},"'我不是ios'"),e("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754408-82105"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/extend/context.js   给ctx对象扩展属性或者方法\nmodule.exports = {\n    get isIOS() {\n        return '我不是ios'\n    },\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754408-82105","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br")])],-1),nt=a("ol",{start:"2"},[a("li",null,"插件的雏形")],-1),tt=a("div",{class:"language-"},[a("pre",null,[a("code",null,"example-app\n├── app\n│   └── router.js\n├── config\n│   └── plugin.js\n├── lib\n│   └── plugin\n│       └── egg-ua\n│           ├── app\n│           │   └── extend\n│           │       └── context.js\n│           └── package.json\n├── test\n│   └── index.test.js\n└── package.json\n"),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754408-98145"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"example-app\n├── app\n│   └── router.js\n├── config\n│   └── plugin.js\n├── lib\n│   └── plugin\n│       └── egg-ua\n│           ├── app\n│           │   └── extend\n│           │       └── context.js\n│           └── package.json\n├── test\n│   └── index.test.js\n└── package.json\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754408-98145","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br")])],-1),st=a("p",null,[a("code",null,"lib/plugin/egg-ua/package.json"),e(" 声明插件。")],-1),at=a("div",{class:"language-json line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token property"},'"eggPlugin"'),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token property"},'"name"'),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},'"ua"'),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754408-5282"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'{\n  "eggPlugin": {\n    "name": "ua"\n  }\n}\n',"data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754408-5282","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br")])],-1),et=a("p",null,[a("code",null,"config/plugin.js"),e(" 中通过 "),a("code",null,"path"),e(" 来挂载插件。")],-1),ot=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// config/plugin.js"),e("\n"),a("span",{class:"token keyword"},"const"),e(" path "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'path'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\nexports"),a("span",{class:"token punctuation"},"."),e("ua "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  enable"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token boolean"},"true"),a("span",{class:"token punctuation"},","),e("\n  path"),a("span",{class:"token operator"},":"),e(" path"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"join"),a("span",{class:"token punctuation"},"("),e("__dirname"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token string"},"'../lib/plugin/egg-ua'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754408-35621"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// config/plugin.js\nconst path = require('path');\nexports.ua = {\n  enable: true,\n  path: path.join(__dirname, '../lib/plugin/egg-ua'),\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754408-35621","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br")])],-1),ct=a("ol",{start:"3"},[a("li",null,"抽成独立的插件, 通过npm包的形式引入")],-1),lt=a("div",{class:"language-"},[a("pre",null,[a("code",null,"egg-ua\n├── app\n│   └── extend\n│       └── context.js\n├── test\n│   ├── fixtures\n│   │   └── test-app\n│   │       ├── app\n│   │       │   └── router.js\n│   │       └── package.json\n│   └── ua.test.js\n└── package.json\n"),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754409-5585"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"egg-ua\n├── app\n│   └── extend\n│       └── context.js\n├── test\n│   ├── fixtures\n│   │   └── test-app\n│   │       ├── app\n│   │       │   └── router.js\n│   │       └── package.json\n│   └── ua.test.js\n└── package.json\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754409-5585","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br")])],-1),pt=s('',7),it=a("div",{class:"language-shell line-numbers-mode"},[a("pre",null,[a("code",null,[e("egg-project\n├── package.json\n├── app.js "),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n├── agent.js "),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("  // 比较独特\n├── app\n"),a("span",{class:"token operator"},"|"),e("   ├── router.js\n│   ├── controller\n│   "),a("span",{class:"token operator"},"|"),e("   └── home.js\n│   ├── "),a("span",{class:"token function"},"service"),e(),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n│   "),a("span",{class:"token operator"},"|"),e("   └── user.js\n│   ├── middleware "),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n│   "),a("span",{class:"token operator"},"|"),e("   └── response_time.js\n│   ├── schedule "),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n│   "),a("span",{class:"token operator"},"|"),e("   └── my_task.js\n│   ├── public "),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n│   "),a("span",{class:"token operator"},"|"),e("   └── reset.css\n│   ├── view "),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n│   "),a("span",{class:"token operator"},"|"),e("   └── home.tpl\n│   └── extend "),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n│       ├── helper.js "),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n│       ├── request.js "),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n│       ├── response.js "),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n│       ├── context.js "),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n│       ├── application.js "),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n│       └── agent.js "),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n├── config\n"),a("span",{class:"token operator"},"|"),e("   ├── plugin.js\n"),a("span",{class:"token operator"},"|"),e("   ├── config.default.js\n│   ├── config.prod.js\n"),a("span",{class:"token operator"},"|"),e("   ├── config.test.js "),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n"),a("span",{class:"token operator"},"|"),e("   ├── config.local.js "),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n"),a("span",{class:"token operator"},"|"),e("   └── config.unittest.js "),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n└── "),a("span",{class:"token builtin class-name"},"test"),e("\n    ├── middleware\n    "),a("span",{class:"token operator"},"|"),e("   └── response_time.test.js\n    └── controller\n        └── home.test.js\n\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754409-66316"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"egg-project\n├── package.json\n├── app.js (可选)\n├── agent.js (可选)  // 比较独特\n├── app\n|   ├── router.js\n│   ├── controller\n│   |   └── home.js\n│   ├── service (可选)\n│   |   └── user.js\n│   ├── middleware (可选)\n│   |   └── response_time.js\n│   ├── schedule (可选)\n│   |   └── my_task.js\n│   ├── public (可选)\n│   |   └── reset.css\n│   ├── view (可选)\n│   |   └── home.tpl\n│   └── extend (可选)\n│       ├── helper.js (可选)\n│       ├── request.js (可选)\n│       ├── response.js (可选)\n│       ├── context.js (可选)\n│       ├── application.js (可选)\n│       └── agent.js (可选)\n├── config\n|   ├── plugin.js\n|   ├── config.default.js\n│   ├── config.prod.js\n|   ├── config.test.js (可选)\n|   ├── config.local.js (可选)\n|   └── config.unittest.js (可选)\n└── test\n    ├── middleware\n    |   └── response_time.test.js\n    └── controller\n        └── home.test.js\n\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754409-66316","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br"),a("span",{class:"line-number"},"17"),a("br"),a("span",{class:"line-number"},"18"),a("br"),a("span",{class:"line-number"},"19"),a("br"),a("span",{class:"line-number"},"20"),a("br"),a("span",{class:"line-number"},"21"),a("br"),a("span",{class:"line-number"},"22"),a("br"),a("span",{class:"line-number"},"23"),a("br"),a("span",{class:"line-number"},"24"),a("br"),a("span",{class:"line-number"},"25"),a("br"),a("span",{class:"line-number"},"26"),a("br"),a("span",{class:"line-number"},"27"),a("br"),a("span",{class:"line-number"},"28"),a("br"),a("span",{class:"line-number"},"29"),a("br"),a("span",{class:"line-number"},"30"),a("br"),a("span",{class:"line-number"},"31"),a("br"),a("span",{class:"line-number"},"32"),a("br"),a("span",{class:"line-number"},"33"),a("br"),a("span",{class:"line-number"},"34"),a("br"),a("span",{class:"line-number"},"35"),a("br"),a("span",{class:"line-number"},"36"),a("br"),a("span",{class:"line-number"},"37"),a("br"),a("span",{class:"line-number"},"38"),a("br")])],-1),rt=s('',11),ut=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app.js"),e("\n\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"app"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  app"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"once"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'server'"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token parameter"},"server"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token comment"},"// websocket"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  app"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"on"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'error'"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("err"),a("span",{class:"token punctuation"},","),e(" ctx")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token comment"},"// report error"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  app"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"on"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'request'"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token parameter"},"ctx"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token comment"},"// log receive request"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  app"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"on"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'response'"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token parameter"},"ctx"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token comment"},"// ctx.starttime is set by framework"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" used "),a("span",{class:"token operator"},"="),e(" Date"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"now"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"-"),e(" ctx"),a("span",{class:"token punctuation"},"."),e("starttime"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token comment"},"// log total cost"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754409-47505"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app.js\n\nmodule.exports = app => {\n  app.once('server', server => {\n    // websocket\n  });\n  app.on('error', (err, ctx) => {\n    // report error\n  });\n  app.on('request', ctx => {\n    // log receive request\n  });\n  app.on('response', ctx => {\n    // ctx.starttime is set by framework\n    const used = Date.now() - ctx.starttime;\n    // log total cost\n  });\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754409-47505","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br"),a("span",{class:"line-number"},"17"),a("br"),a("span",{class:"line-number"},"18"),a("br")])],-1),dt=a("p",null,[a("strong",null,"获取方式")],-1),mt=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"app"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  app"),a("span",{class:"token punctuation"},"."),e("xxxx "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'xxxx'"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754409-95363"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app.js\nmodule.exports = app => {\n  app.xxxx = 'xxxx';\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754409-95363","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br")])],-1),kt=a("p",null,"controller文件",-1),bt=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"class"),e(),a("span",{class:"token class-name"},"UserController"),e(),a("span",{class:"token keyword"},"extends"),e(),a("span",{class:"token class-name"},"Controller"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"fetch"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("ctx"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("app"),a("span",{class:"token punctuation"},"."),e("xxxx"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754409-42616"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"class UserController extends Controller {\n  async fetch() {\n    this.ctx.body = this.app.xxxx;\n  }\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754409-42616","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br")])],-1),yt=s('',6),ht=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"app"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  app"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"beforeStart"),a("span",{class:"token punctuation"},"("),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" ctx "),a("span",{class:"token operator"},"="),e(" app"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"createAnonymousContext"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token comment"},"// preload before app start"),e("\n    "),a("span",{class:"token keyword"},"await"),e(" ctx"),a("span",{class:"token punctuation"},"."),e("service"),a("span",{class:"token punctuation"},"."),e("posts"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"load"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754409-15796"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app.js\nmodule.exports = app => {\n  app.beforeStart(async () => {\n    const ctx = app.createAnonymousContext();\n    // preload before app start\n    await ctx.service.posts.load();\n  });\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754409-15796","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br")])],-1),ft=a("p",null,[e("在"),a("a",{href:"https://eggjs.org/zh-cn/basics/schedule.html",target:"_blank",rel:"noopener noreferrer"},"定时任务"),e("中的每一个 task 都接受一个 Context 实例作为参数，以便我们更方便的执行一些定时的业务逻辑：")],-1),gt=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/schedule/refresh.js"),e("\nexports"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"task"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token parameter"},"ctx"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"await"),e(" ctx"),a("span",{class:"token punctuation"},"."),e("service"),a("span",{class:"token punctuation"},"."),e("posts"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"refresh"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754409-14630"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/schedule/refresh.js\nexports.task = async ctx => {\n  await ctx.service.posts.refresh();\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754409-14630","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br")])],-1),Ct=s('',3),xt=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/controller/user.js"),e("\n"),a("span",{class:"token keyword"},"class"),e(),a("span",{class:"token class-name"},"UserController"),e(),a("span",{class:"token keyword"},"extends"),e(),a("span",{class:"token class-name"},"Controller"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"fetch"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token punctuation"},"{"),e(" app"),a("span",{class:"token punctuation"},","),e(" ctx "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" id "),a("span",{class:"token operator"},"="),e(" ctx"),a("span",{class:"token punctuation"},"."),e("request"),a("span",{class:"token punctuation"},"."),e("query"),a("span",{class:"token punctuation"},"."),e("id"),a("span",{class:"token punctuation"},";"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("response"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(" app"),a("span",{class:"token punctuation"},"."),e("cache"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"get"),a("span",{class:"token punctuation"},"("),e("id"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754409-72715"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/controller/user.js\nclass UserController extends Controller {\n  async fetch() {\n    const { app, ctx } = this;\n    const id = ctx.request.query.id;\n    ctx.response.body = app.cache.get(id);\n  }\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754409-72715","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br")])],-1),vt=s('',4),wt=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/controller/user.js"),e("\n\n"),a("span",{class:"token comment"},"// 从 egg 上获取（推荐）"),e("\n"),a("span",{class:"token keyword"},"const"),e(" Controller "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'egg'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),e("Controller"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"class"),e(),a("span",{class:"token class-name"},"UserController"),e(),a("span",{class:"token keyword"},"extends"),e(),a("span",{class:"token class-name"},"Controller"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token comment"},"// implement"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\nmodule"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(" UserController"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token comment"},"// 从 app 实例上获取"),e("\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"app"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"return"),e(),a("span",{class:"token keyword"},"class"),e(),a("span",{class:"token class-name"},"UserController"),e(),a("span",{class:"token keyword"},"extends"),e(),a("span",{class:"token class-name"},[e("app"),a("span",{class:"token punctuation"},"."),e("Controller")]),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token comment"},"// implement"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754409-48392"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/controller/user.js\n\n// 从 egg 上获取（推荐）\nconst Controller = require('egg').Controller;\nclass UserController extends Controller {\n  // implement\n}\nmodule.exports = UserController;\n\n// 从 app 实例上获取\nmodule.exports = app => {\n  return class UserController extends app.Controller {\n    // implement\n  };\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754409-48392","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br")])],-1),jt=a("h5",{id:"service"},[a("a",{class:"header-anchor",href:"#service","aria-hidden":"true"},"#"),e(" Service")],-1),_t=a("p",null,[e("框架提供了一个 Service 基类，并推荐所有的 "),a("a",{href:"https://eggjs.org/zh-cn/basics/service.html",target:"_blank",rel:"noopener noreferrer"},"Service"),e(" 都继承于该基类实现。")],-1),Tt=a("p",null,[e("Service 基类的属性和 "),a("a",{href:"https://eggjs.org/zh-cn/basics/objects.html#controller",target:"_blank",rel:"noopener noreferrer"},"Controller"),e(" 基类属性一致，访问方式也类似：")],-1),$t=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/service/user.js"),e("\n\n"),a("span",{class:"token comment"},"// 从 egg 上获取（推荐）"),e("\n"),a("span",{class:"token keyword"},"const"),e(" Service "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'egg'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),e("Service"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"class"),e(),a("span",{class:"token class-name"},"UserService"),e(),a("span",{class:"token keyword"},"extends"),e(),a("span",{class:"token class-name"},"Service"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token comment"},"// implement"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\nmodule"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(" UserService"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token comment"},"// 从 app 实例上获取"),e("\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"app"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"return"),e(),a("span",{class:"token keyword"},"class"),e(),a("span",{class:"token class-name"},"UserService"),e(),a("span",{class:"token keyword"},"extends"),e(),a("span",{class:"token class-name"},[e("app"),a("span",{class:"token punctuation"},"."),e("Service")]),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token comment"},"// implement"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754410-51913"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/service/user.js\n\n// 从 egg 上获取（推荐）\nconst Service = require('egg').Service;\nclass UserService extends Service {\n  // implement\n}\nmodule.exports = UserService;\n\n// 从 app 实例上获取\nmodule.exports = app => {\n  return class UserService extends app.Service {\n    // implement\n  };\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754410-51913","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br")])],-1),It=a("h5",{id:"helper"},[a("a",{class:"header-anchor",href:"#helper","aria-hidden":"true"},"#"),e(" Helper")],-1),Et=a("p",null,"Helper 用来提供一些实用的 utility 函数。它的作用在于我们可以将一些常用的动作抽离在 helper.js 里面成为一个独立的函数，这样可以用 JavaScript 来写复杂的逻辑，避免逻辑分散各处，同时可以更好的编写测试用例。",-1),Nt=a("p",null,[e("Helper 自身是一个类，有和 "),a("a",{href:"https://eggjs.org/zh-cn/basics/objects.html#controller",target:"_blank",rel:"noopener noreferrer"},"Controller"),e(" 基类一样的属性，它也会在每次请求时进行实例化，因此 Helper 上的所有函数也能获取到当前请求相关的上下文信息。")],-1),At=a("p",null,[a("strong",null,"获取方式")],-1),Pt=a("p",null,[e("可以在 Context 的实例上获取到当前请求的 Helper("),a("code",null,"ctx.helper"),e(") 实例。")],-1),qt=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/controller/user.js"),e("\n"),a("span",{class:"token keyword"},"class"),e(),a("span",{class:"token class-name"},"UserController"),e(),a("span",{class:"token keyword"},"extends"),e(),a("span",{class:"token class-name"},"Controller"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"fetch"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token punctuation"},"{"),e(" app"),a("span",{class:"token punctuation"},","),e(" ctx "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" id "),a("span",{class:"token operator"},"="),e(" ctx"),a("span",{class:"token punctuation"},"."),e("query"),a("span",{class:"token punctuation"},"."),e("id"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" user "),a("span",{class:"token operator"},"="),e(" app"),a("span",{class:"token punctuation"},"."),e("cache"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"get"),a("span",{class:"token punctuation"},"("),e("id"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(" ctx"),a("span",{class:"token punctuation"},"."),e("helper"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"formatUser"),a("span",{class:"token punctuation"},"("),e("user"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754410-69934"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/controller/user.js\nclass UserController extends Controller {\n  async fetch() {\n    const { app, ctx } = this;\n    const id = ctx.query.id;\n    const user = app.cache.get(id);\n    ctx.body = ctx.helper.formatUser(user);\n  }\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754410-69934","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br")])],-1),St=s('',16),Dt=a("div",{class:"language-"},[a("pre",null,[a("code",null,"config\n|- config.default.js\n|- config.prod.js\n|- config.unittest.js\n`- config.local.js\n"),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754410-98423"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"config\n|- config.default.js\n|- config.prod.js\n|- config.unittest.js\n`- config.local.js\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754410-98423","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br")])],-1),Ft=s("",4),Bt=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// 配置 logger 文件的目录，logger 默认配置由框架提供"),e("\nmodule"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  logger"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n    dir"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'/home/admin/logs/demoapp'"),a("span",{class:"token punctuation"},","),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754410-20715"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// 配置 logger 文件的目录，logger 默认配置由框架提供\nmodule.exports = {\n  logger: {\n    dir: '/home/admin/logs/demoapp',\n  },\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754410-20715","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br")])],-1),Rt=a("p",null,[e("配置文件也可以简化的写成 "),a("code",null,"exports.key = value"),e(" 形式")],-1),Lt=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[e("exports"),a("span",{class:"token punctuation"},"."),e("keys "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'my-cookie-secret-key'"),a("span",{class:"token punctuation"},";"),e("\nexports"),a("span",{class:"token punctuation"},"."),e("logger "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  level"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'DEBUG'"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754410-15326"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"exports.keys = 'my-cookie-secret-key';\nexports.logger = {\n  level: 'DEBUG',\n};\n\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754410-15326","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br")])],-1),zt=a("p",null,"配置文件也可以返回一个 function，可以接受 appInfo 参数",-1),Vt=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// 将 logger 目录放到代码目录下"),e("\n"),a("span",{class:"token keyword"},"const"),e(" path "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'path'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"appInfo"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"return"),e(),a("span",{class:"token punctuation"},"{"),e("\n    logger"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n      dir"),a("span",{class:"token operator"},":"),e(" path"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"join"),a("span",{class:"token punctuation"},"("),e("appInfo"),a("span",{class:"token punctuation"},"."),e("baseDir"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token string"},"'logs'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},","),e("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754410-70083"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// 将 logger 目录放到代码目录下\nconst path = require('path');\nmodule.exports = appInfo => {\n  return {\n    logger: {\n      dir: path.join(appInfo.baseDir, 'logs'),\n    },\n  };\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754410-70083","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br")])],-1),Ht=s('',6),Mt=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token operator"},"-"),a("span",{class:"token operator"},">"),e(" 插件 config"),a("span",{class:"token punctuation"},"."),e("default"),a("span",{class:"token punctuation"},"."),e("js\n"),a("span",{class:"token operator"},"-"),a("span",{class:"token operator"},">"),e(" 框架 config"),a("span",{class:"token punctuation"},"."),e("default"),a("span",{class:"token punctuation"},"."),e("js\n"),a("span",{class:"token operator"},"-"),a("span",{class:"token operator"},">"),e(" 应用 config"),a("span",{class:"token punctuation"},"."),e("default"),a("span",{class:"token punctuation"},"."),e("js\n"),a("span",{class:"token operator"},"-"),a("span",{class:"token operator"},">"),e(" 插件 config"),a("span",{class:"token punctuation"},"."),e("prod"),a("span",{class:"token punctuation"},"."),e("js\n"),a("span",{class:"token operator"},"-"),a("span",{class:"token operator"},">"),e(" 框架 config"),a("span",{class:"token punctuation"},"."),e("prod"),a("span",{class:"token punctuation"},"."),e("js\n"),a("span",{class:"token operator"},"-"),a("span",{class:"token operator"},">"),e(" 应用 config"),a("span",{class:"token punctuation"},"."),e("prod"),a("span",{class:"token punctuation"},"."),e("js\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754410-15585"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"-> 插件 config.default.js\n-> 框架 config.default.js\n-> 应用 config.default.js\n-> 插件 config.prod.js\n-> 框架 config.prod.js\n-> 应用 config.prod.js\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754410-15585","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br")])],-1),Wt=a("p",null,[a("strong",null,"合并规则")],-1),Ot=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(" a "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  arr"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"["),e(),a("span",{class:"token number"},"1"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token number"},"2"),e(),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"const"),e(" b "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  arr"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"["),e(),a("span",{class:"token number"},"3"),e(),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token function"},"extend"),a("span",{class:"token punctuation"},"("),a("span",{class:"token boolean"},"true"),a("span",{class:"token punctuation"},","),e(" a"),a("span",{class:"token punctuation"},","),e(" b"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token comment"},"// [3]"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754410-82668"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const a = {\n  arr: [ 1, 2 ],\n};\nconst b = {\n  arr: [ 3 ],\n};\nextend(true, a, b);\n\n// [3]\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754410-82668","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br")])],-1),Ut=s("",5),Kt=a("div",{class:"language-json line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token property"},'"logger"'),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token property"},'"dir"'),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},'"/path/to/config/config.default.js"'),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754410-29288"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'{\n  "logger": {\n    "dir": "/path/to/config/config.default.js"\n  }\n}\n',"data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754410-29288","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br")])],-1),Gt=s('',3),Jt=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/middleware/gzip.js"),e("\n"),a("span",{class:"token keyword"},"const"),e(" isJSON "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'koa-is-json'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"const"),e(" zlib "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'zlib'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token keyword"},"function"),e(),a("span",{class:"token function"},"gzip"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("ctx"),a("span",{class:"token punctuation"},","),e(" next")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"await"),e(),a("span",{class:"token function"},"next"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("  "),a("span",{class:"token comment"},"// app.use过之后的下一个函数"),e("\n\n  "),a("span",{class:"token comment"},"// 后续中间件执行完成后将响应体转换成 gzip"),e("\n  "),a("span",{class:"token keyword"},"let"),e(" body "),a("span",{class:"token operator"},"="),e(" ctx"),a("span",{class:"token punctuation"},"."),e("body"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"if"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token operator"},"!"),e("body"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token keyword"},"return"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"if"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token function"},"isJSON"),a("span",{class:"token punctuation"},"("),e("body"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),e(" body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token constant"},"JSON"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"stringify"),a("span",{class:"token punctuation"},"("),e("body"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n  "),a("span",{class:"token comment"},"// 设置 gzip body，修正响应头"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" stream "),a("span",{class:"token operator"},"="),e(" zlib"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"createGzip"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  stream"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"end"),a("span",{class:"token punctuation"},"("),e("body"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  ctx"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(" stream"),a("span",{class:"token punctuation"},";"),e("\n  ctx"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"set"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'Content-Encoding'"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token string"},"'gzip'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754410-98185"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/middleware/gzip.js\nconst isJSON = require('koa-is-json');\nconst zlib = require('zlib');\n\nasync function gzip(ctx, next) {\n  await next();  // app.use过之后的下一个函数\n\n  // 后续中间件执行完成后将响应体转换成 gzip\n  let body = ctx.body;\n  if (!body) return;\n  if (isJSON(body)) body = JSON.stringify(body);\n\n  // 设置 gzip body，修正响应头\n  const stream = zlib.createGzip();\n  stream.end(body);\n  ctx.body = stream;\n  ctx.set('Content-Encoding', 'gzip');\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754410-98185","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br"),a("span",{class:"line-number"},"17"),a("br"),a("span",{class:"line-number"},"18"),a("br")])],-1),Qt=s('',4),Yt=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/middleware/gzip.js"),e("\n"),a("span",{class:"token keyword"},"const"),e(" isJSON "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'koa-is-json'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"const"),e(" zlib "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'zlib'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"options"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"return"),e(),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token keyword"},"function"),e(),a("span",{class:"token function"},"gzip"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("ctx"),a("span",{class:"token punctuation"},","),e(" next")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"await"),e(),a("span",{class:"token function"},"next"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n    "),a("span",{class:"token comment"},"// 后续中间件执行完成后将响应体转换成 gzip"),e("\n    "),a("span",{class:"token keyword"},"let"),e(" body "),a("span",{class:"token operator"},"="),e(" ctx"),a("span",{class:"token punctuation"},"."),e("body"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token keyword"},"if"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token operator"},"!"),e("body"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token keyword"},"return"),a("span",{class:"token punctuation"},";"),e("\n\n    "),a("span",{class:"token comment"},"// 支持 options.threshold"),e("\n    "),a("span",{class:"token keyword"},"if"),e(),a("span",{class:"token punctuation"},"("),e("options"),a("span",{class:"token punctuation"},"."),e("threshold "),a("span",{class:"token operator"},"&&"),e(" ctx"),a("span",{class:"token punctuation"},"."),e("length "),a("span",{class:"token operator"},"<"),e(" options"),a("span",{class:"token punctuation"},"."),e("threshold"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token keyword"},"return"),a("span",{class:"token punctuation"},";"),e("\n\n    "),a("span",{class:"token keyword"},"if"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token function"},"isJSON"),a("span",{class:"token punctuation"},"("),e("body"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),e(" body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token constant"},"JSON"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"stringify"),a("span",{class:"token punctuation"},"("),e("body"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n    "),a("span",{class:"token comment"},"// 设置 gzip body，修正响应头"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" stream "),a("span",{class:"token operator"},"="),e(" zlib"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"createGzip"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    stream"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"end"),a("span",{class:"token punctuation"},"("),e("body"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(" stream"),a("span",{class:"token punctuation"},";"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"set"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'Content-Encoding'"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token string"},"'gzip'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754410-64197"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/middleware/gzip.js\nconst isJSON = require('koa-is-json');\nconst zlib = require('zlib');\n\nmodule.exports = options => {\n  return async function gzip(ctx, next) {\n    await next();\n\n    // 后续中间件执行完成后将响应体转换成 gzip\n    let body = ctx.body;\n    if (!body) return;\n\n    // 支持 options.threshold\n    if (options.threshold && ctx.length < options.threshold) return;\n\n    if (isJSON(body)) body = JSON.stringify(body);\n\n    // 设置 gzip body，修正响应头\n    const stream = zlib.createGzip();\n    stream.end(body);\n    ctx.body = stream;\n    ctx.set('Content-Encoding', 'gzip');\n  };\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754410-64197","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br"),a("span",{class:"line-number"},"17"),a("br"),a("span",{class:"line-number"},"18"),a("br"),a("span",{class:"line-number"},"19"),a("br"),a("span",{class:"line-number"},"20"),a("br"),a("span",{class:"line-number"},"21"),a("br"),a("span",{class:"line-number"},"22"),a("br"),a("span",{class:"line-number"},"23"),a("br"),a("span",{class:"line-number"},"24"),a("br")])],-1),Xt=a("h5",{id:"使用中间件"},[a("a",{class:"header-anchor",href:"#使用中间件","aria-hidden":"true"},"#"),e(" 使用中间件")],-1),Zt=a("p",null,"中间件编写完成后，我们还需要手动挂载，支持以下方式：",-1),ns=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[e("module"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token comment"},"// 配置需要的中间件，数组顺序即为中间件的加载顺序"),e("\n  middleware"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"["),e(),a("span",{class:"token string"},"'gzip'"),e(),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},","),e("\n\n  "),a("span",{class:"token comment"},"// 配置 gzip 中间件的配置"),e("\n  gzip"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n    threshold"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token number"},"1024"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token comment"},"// 小于 1k 的响应体不压缩"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754411-44071"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"module.exports = {\n  // 配置需要的中间件，数组顺序即为中间件的加载顺序\n  middleware: [ 'gzip' ],\n\n  // 配置 gzip 中间件的配置\n  gzip: {\n    threshold: 1024, // 小于 1k 的响应体不压缩\n  },\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754411-44071","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br")])],-1),ts=a("h5",{id:"在框架和插件中使用中间件"},[a("a",{class:"header-anchor",href:"#在框架和插件中使用中间件","aria-hidden":"true"},"#"),e(" 在框架和插件中使用中间件")],-1),ss=a("p",null,"可以通过app的config对象去个框架添加中间件，因为可能中间件执行顺序有一些要求。",-1),as=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"app"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token comment"},"// 在中间件最前面统计请求时间"),e("\n  app"),a("span",{class:"token punctuation"},"."),e("config"),a("span",{class:"token punctuation"},"."),e("coreMiddleware"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"unshift"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'report'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token comment"},"// app/middleware/report.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"return"),e(),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token keyword"},"function"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("ctx"),a("span",{class:"token punctuation"},","),e(" next")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" startTime "),a("span",{class:"token operator"},"="),e(" Date"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"now"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token keyword"},"await"),e(),a("span",{class:"token function"},"next"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token comment"},"// 上报请求时间"),e("\n    "),a("span",{class:"token function"},"reportTime"),a("span",{class:"token punctuation"},"("),e("Date"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"now"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"-"),e(" startTime"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754411-83741"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app.js\nmodule.exports = app => {\n  // 在中间件最前面统计请求时间\n  app.config.coreMiddleware.unshift('report');\n};\n\n// app/middleware/report.js\nmodule.exports = () => {\n  return async function (ctx, next) {\n    const startTime = Date.now();\n    await next();\n    // 上报请求时间\n    reportTime(Date.now() - startTime);\n  }\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754411-83741","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br")])],-1),es=a("p",null,[e("应用层定义的中间件（"),a("code",null,"app.config.appMiddleware"),e("）和框架默认中间件（"),a("code",null,"app.config.coreMiddleware"),e("）都会被加载器加载，并挂载到 "),a("code",null,"app.middleware"),e(" 上。")],-1),os=a("h5",{id:"单个路由生效"},[a("a",{class:"header-anchor",href:"#单个路由生效","aria-hidden":"true"},"#"),e(" 单个路由生效")],-1),cs=a("p",null,"中间件对象也挂载在app下面",-1),ls=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[e("module"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"app"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" gzip "),a("span",{class:"token operator"},"="),e(" app"),a("span",{class:"token punctuation"},"."),e("middleware"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"gzip"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),e(" threshold"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token number"},"1024"),e(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  app"),a("span",{class:"token punctuation"},"."),e("router"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"get"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'/needgzip'"),a("span",{class:"token punctuation"},","),e(" gzip"),a("span",{class:"token punctuation"},","),e(" app"),a("span",{class:"token punctuation"},"."),e("controller"),a("span",{class:"token punctuation"},"."),e("handler"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754411-72657"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"module.exports = app => {\n  const gzip = app.middleware.gzip({ threshold: 1024 });\n  app.router.get('/needgzip', gzip, app.controller.handler);\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754411-72657","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br")])],-1),ps=a("h5",{id:"框架默认中间件"},[a("a",{class:"header-anchor",href:"#框架默认中间件","aria-hidden":"true"},"#"),e(" 框架默认中间件")],-1),is=a("p",null,[e("除了应用层加载中间件之外，框架自身和其他的插件也会加载许多中间件。所有的这些自带中间件的配置项都通过在配置中修改中间件同名配置项进行修改，例如"),a("a",{href:"https://github.com/eggjs/egg/tree/master/app/middleware",target:"_blank",rel:"noopener noreferrer"},"框架自带的中间件"),e("中有一个 bodyParser 中间件（框架的加载器会将文件名中的各种分隔符都修改成驼峰形式的变量名），我们想要修改 bodyParser 的配置，只需要在 "),a("code",null,"config/config.default.js"),e(" 中编写")],-1),rs=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[e("module"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  bodyParser"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n    jsonLimit"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'10mb'"),a("span",{class:"token punctuation"},","),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754411-43008"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"module.exports = {\n  bodyParser: {\n    jsonLimit: '10mb',\n  },\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754411-43008","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br")])],-1),us=a("h5",{id:"使用koa的中间件"},[a("a",{class:"header-anchor",href:"#使用koa的中间件","aria-hidden":"true"},"#"),e(" 使用koa的中间件")],-1),ds=a("p",null,[e("以 "),a("a",{href:"https://github.com/koajs/compress",target:"_blank",rel:"noopener noreferrer"},"koa-compress"),e(" 为例，在 Koa 中使用时：")],-1),ms=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(" koa "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'koa'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"const"),e(" compress "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'koa-compress'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"const"),e(" app "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"koa"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"const"),e(" options "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e(" threshold"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token number"},"2048"),e(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\napp"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"use"),a("span",{class:"token punctuation"},"("),a("span",{class:"token function"},"compress"),a("span",{class:"token punctuation"},"("),e("options"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754411-49050"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const koa = require('koa');\nconst compress = require('koa-compress');\n\nconst app = koa();\n\nconst options = { threshold: 2048 };\napp.use(compress(options));\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754411-49050","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br")])],-1),ks=a("p",null,"我们按照框架的规范来在应用中加载这个 Koa 的中间件：",-1),bs=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/middleware/compress.js"),e("\n"),a("span",{class:"token comment"},"// koa-compress 暴露的接口(`(options) => middleware`)和框架对中间件要求一致"),e("\nmodule"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'koa-compress'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754411-14547"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/middleware/compress.js\n// koa-compress 暴露的接口(`(options) => middleware`)和框架对中间件要求一致\nmodule.exports = require('koa-compress');\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754411-14547","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br")])],-1),ys=a("div",{class:"language-"},[a("pre",null,[a("code",null,"// config/config.default.js\nmodule.exports = {\n  middleware: [ 'compress' ],\n  compress: {\n    threshold: 2048,\n  },\n};\n"),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754411-76961"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// config/config.default.js\nmodule.exports = {\n  middleware: [ 'compress' ],\n  compress: {\n    threshold: 2048,\n  },\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754411-76961","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br")])],-1),hs=a("p",null,"如果使用到的 Koa 中间件不符合入参规范，则可以自行处理下：",-1),fs=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// config/config.default.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  webpack"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n    compiler"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n    others"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token comment"},"// app/middleware/webpack.js"),e("\n"),a("span",{class:"token keyword"},"const"),e(" webpackMiddleware "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'some-koa-middleware'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("options"),a("span",{class:"token punctuation"},","),e(" app")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"return"),e(),a("span",{class:"token function"},"webpackMiddleware"),a("span",{class:"token punctuation"},"("),e("options"),a("span",{class:"token punctuation"},"."),e("compiler"),a("span",{class:"token punctuation"},","),e(" options"),a("span",{class:"token punctuation"},"."),e("others"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754411-97491"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// config/config.default.js\nmodule.exports = {\n  webpack: {\n    compiler: {},\n    others: {},\n  },\n};\n\n// app/middleware/webpack.js\nconst webpackMiddleware = require('some-koa-middleware');\n\nmodule.exports = (options, app) => {\n  return webpackMiddleware(options.compiler, options.others);\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754411-97491","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br")])],-1),gs=a("h5",{id:"通用配置"},[a("a",{class:"header-anchor",href:"#通用配置","aria-hidden":"true"},"#"),e(" 通用配置")],-1),Cs=a("p",null,"无论是应用层加载的中间件还是框架自带中间件，都支持几个通用的配置项：",-1),xs=a("ul",null,[a("li",null,"enable：控制中间件是否开启。"),a("li",null,"match：设置只有符合某些规则的请求才会经过这个中间件。"),a("li",null,"ignore：设置符合某些规则的请求不经过这个中间件。")],-1),vs=a("p",null,"如果我们的应用并不需要默认的 bodyParser 中间件来进行请求体的解析，此时我们可以通过配置 enable 为 false 来关闭它",-1),ws=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[e("module"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  bodyParser"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n    enable"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token boolean"},"false"),a("span",{class:"token punctuation"},","),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754411-51360"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"module.exports = {\n  bodyParser: {\n    enable: false,\n  },\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754411-51360","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br")])],-1),js=a("p",null,[e("如果我们想让 gzip 只针对 "),a("code",null,"/static"),e(" 前缀开头的 url 请求开启，我们可以配置 match 选项")],-1),_s=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[e("module"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  gzip"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n    match"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'/static'"),a("span",{class:"token punctuation"},","),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754411-15684"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"module.exports = {\n  gzip: {\n    match: '/static',\n  },\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754411-15684","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br")])],-1),Ts=a("p",null,"match 和 ignore 支持多种类型的配置方式",-1),$s=a("ol",null,[a("li",null,"字符串：当参数为字符串类型时，配置的是一个 url 的路径前缀，所有以配置的字符串作为前缀的 url 都会匹配上。 当然，你也可以直接使用字符串数组。"),a("li",null,"正则：当参数为正则时，直接匹配满足正则验证的 url 的路径。"),a("li",null,"函数：当参数为一个函数时，会将请求上下文传递给这个函数，最终取函数返回的结果（true/false）来判断是否匹配。")],-1),Is=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[e("module"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  gzip"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token function"},"match"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"ctx"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n      "),a("span",{class:"token comment"},"// 只有 ios 设备才开启"),e("\n      "),a("span",{class:"token keyword"},"const"),e(" reg "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token regex"},[a("span",{class:"token regex-delimiter"},"/"),a("span",{class:"token regex-source language-regex"},"iphone|ipad|ipod"),a("span",{class:"token regex-delimiter"},"/"),a("span",{class:"token regex-flags"},"i")]),a("span",{class:"token punctuation"},";"),e("\n      "),a("span",{class:"token keyword"},"return"),e(" reg"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"test"),a("span",{class:"token punctuation"},"("),e("ctx"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"get"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'user-agent'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754411-84516"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"module.exports = {\n  gzip: {\n    match(ctx) {\n      // 只有 ios 设备才开启\n      const reg = /iphone|ipad|ipod/i;\n      return reg.test(ctx.get('user-agent'));\n    },\n  },\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754411-84516","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br")])],-1),Es=s('',5),Ns=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/router.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"app"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token punctuation"},"{"),e(" router"),a("span",{class:"token punctuation"},","),e(" controller "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token operator"},"="),e(" app"),a("span",{class:"token punctuation"},";"),e("\n  router"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"get"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'/user/:id'"),a("span",{class:"token punctuation"},","),e(" controller"),a("span",{class:"token punctuation"},"."),e("user"),a("span",{class:"token punctuation"},"."),e("info"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754412-97072"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/router.js\nmodule.exports = app => {\n  const { router, controller } = app;\n  router.get('/user/:id', controller.user.info);\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754412-97072","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br")])],-1),As=a("ul",null,[a("li",null,[a("code",null,"app/controller"),e(" 目录下面实现 Controller")])],-1),Ps=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/controller/user.js"),e("\n"),a("span",{class:"token keyword"},"class"),e(),a("span",{class:"token class-name"},"UserController"),e(),a("span",{class:"token keyword"},"extends"),e(),a("span",{class:"token class-name"},"Controller"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"info"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token punctuation"},"{"),e(" ctx "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},";"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n      name"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token template-string"},[a("span",{class:"token template-punctuation string"},"`"),a("span",{class:"token string"},"hello "),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("ctx"),a("span",{class:"token punctuation"},"."),e("params"),a("span",{class:"token punctuation"},"."),e("id"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token template-punctuation string"},"`")]),a("span",{class:"token punctuation"},","),e("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754412-22198"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/controller/user.js\nclass UserController extends Controller {\n  async info() {\n    const { ctx } = this;\n    ctx.body = {\n      name: `hello ${ctx.params.id}`,\n    };\n  }\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754412-22198","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br")])],-1),qs=s('',5),Ss=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/router.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"app"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token punctuation"},"{"),e(" router"),a("span",{class:"token punctuation"},","),e(" controller "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token operator"},"="),e(" app"),a("span",{class:"token punctuation"},";"),e("\n  router"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"resources"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'/api/user'"),a("span",{class:"token punctuation"},","),e(" controller"),a("span",{class:"token punctuation"},"."),e("posts"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754412-86916"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/router.js\nmodule.exports = app => {\n  const { router, controller } = app;\n  router.resources('/api/user', controller.posts);\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754412-86916","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br")])],-1),Ds=a("p",null,[e("上面代码就在 "),a("code",null,"/posts"),e(" 路径上部署了一组 CRUD 路径结构，对应的 Controller 为 "),a("code",null,"app/controller/posts.js"),e(" 接下来， 你只需要在 "),a("code",null,"posts.js"),e(" 里面实现对应的函数就可以了。")],-1),Fs=a("p",null,[a("img",{src:"https://gitee.com/artiely/Figure-bed/raw/master/images/20200314152255.png",alt:"image-20190629164107094"})],-1),Bs=a("h5",{id:"获取参数"},[a("a",{class:"header-anchor",href:"#获取参数","aria-hidden":"true"},"#"),e(" 获取参数")],-1),Rs=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/router.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"app"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  app"),a("span",{class:"token punctuation"},"."),e("router"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"get"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'/search'"),a("span",{class:"token punctuation"},","),e(" app"),a("span",{class:"token punctuation"},"."),e("controller"),a("span",{class:"token punctuation"},"."),e("search"),a("span",{class:"token punctuation"},"."),e("index"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token comment"},"// app/controller/search.js"),e("\nexports"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"index"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token parameter"},"ctx"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  ctx"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token template-string"},[a("span",{class:"token template-punctuation string"},"`"),a("span",{class:"token string"},"search: "),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("ctx"),a("span",{class:"token punctuation"},"."),e("query"),a("span",{class:"token punctuation"},"."),e("name"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token template-punctuation string"},"`")]),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754412-48432"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/router.js\nmodule.exports = app => {\n  app.router.get('/search', app.controller.search.index);\n};\n\n// app/controller/search.js\nexports.index = async ctx => {\n  ctx.body = `search: ${ctx.query.name}`;\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754412-48432","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br")])],-1),Ls=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/router.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"app"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  app"),a("span",{class:"token punctuation"},"."),e("router"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"get"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'/user/:id/:name'"),a("span",{class:"token punctuation"},","),e(" app"),a("span",{class:"token punctuation"},"."),e("controller"),a("span",{class:"token punctuation"},"."),e("user"),a("span",{class:"token punctuation"},"."),e("info"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token comment"},"// app/controller/user.js"),e("\nexports"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"info"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token parameter"},"ctx"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  ctx"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token template-string"},[a("span",{class:"token template-punctuation string"},"`"),a("span",{class:"token string"},"user: "),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("ctx"),a("span",{class:"token punctuation"},"."),e("params"),a("span",{class:"token punctuation"},"."),e("id"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"},", "),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("ctx"),a("span",{class:"token punctuation"},"."),e("params"),a("span",{class:"token punctuation"},"."),e("name"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token template-punctuation string"},"`")]),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token comment"},"// curl http://127.0.0.1:7001/user/123/xiaoming"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754412-35691"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/router.js\nmodule.exports = app => {\n  app.router.get('/user/:id/:name', app.controller.user.info);\n};\n\n// app/controller/user.js\nexports.info = async ctx => {\n  ctx.body = `user: ${ctx.params.id}, ${ctx.params.name}`;\n};\n\n// curl http://127.0.0.1:7001/user/123/xiaoming\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754412-35691","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br")])],-1),zs=s('',7),Vs=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token string"},"'use strict'"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token comment"},"// import HttpController from './base/http';"),e("\n"),a("span",{class:"token keyword"},"const"),e(" Controller "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'egg'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),e("Controller"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"class"),e(),a("span",{class:"token class-name"},"HomeController"),e(),a("span",{class:"token keyword"},"extends"),e(),a("span",{class:"token class-name"},"Controller"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"index"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token punctuation"},"{"),e(" ctx "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},";"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("service"),a("span",{class:"token punctuation"},"."),e("user"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"find"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token comment"},"// ctx 来自koa"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n\n  "),a("span",{class:"token comment"},"// 1. 需要在 controller定义怎么渲染"),e("\n  "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"hello"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token punctuation"},"{"),e(" ctx "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token keyword"},"await"),e(" ctx"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"render"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'hello.nj'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e(),a("span",{class:"token comment"},"// 自动的读取view/hello.nj"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n\n  "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"addUser"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token punctuation"},"{"),e(" ctx "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},";"),e("\n    console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),e("ctx"),a("span",{class:"token punctuation"},"."),e("request"),a("span",{class:"token punctuation"},"."),e("body"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),e("ctx"),a("span",{class:"token punctuation"},"."),e("csrf"),a("span",{class:"token punctuation"},")"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'success'"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n\n  "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"redirect"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token punctuation"},"{"),e(" ctx "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},";"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"redirect"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'https://taobao.com'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n\nmodule"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(" HomeController"),a("span",{class:"token punctuation"},";"),e("\n\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754412-47743"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"'use strict';\n// import HttpController from './base/http';\nconst Controller = require('egg').Controller;\n\nclass HomeController extends Controller {\n  async index() {\n    const { ctx } = this;\n    ctx.body = await this.service.user.find() // ctx 来自koa\n  }\n\n  // 1. 需要在 controller定义怎么渲染\n  async hello() {\n    const { ctx } = this;\n    await ctx.render('hello.nj'); // 自动的读取view/hello.nj\n  }\n\n  async addUser() {\n    const { ctx } = this;\n    console.log(ctx.request.body);\n    console.log(ctx.csrf)\n    ctx.body = 'success';\n  }\n\n  async redirect() {\n    const { ctx } = this;\n    ctx.redirect('https://taobao.com');\n  }\n}\n\nmodule.exports = HomeController;\n\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754412-47743","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br"),a("span",{class:"line-number"},"17"),a("br"),a("span",{class:"line-number"},"18"),a("br"),a("span",{class:"line-number"},"19"),a("br"),a("span",{class:"line-number"},"20"),a("br"),a("span",{class:"line-number"},"21"),a("br"),a("span",{class:"line-number"},"22"),a("br"),a("span",{class:"line-number"},"23"),a("br"),a("span",{class:"line-number"},"24"),a("br"),a("span",{class:"line-number"},"25"),a("br"),a("span",{class:"line-number"},"26"),a("br"),a("span",{class:"line-number"},"27"),a("br"),a("span",{class:"line-number"},"28"),a("br"),a("span",{class:"line-number"},"29"),a("br"),a("span",{class:"line-number"},"30"),a("br"),a("span",{class:"line-number"},"31"),a("br")])],-1),Hs=a("p",null,[a("strong",null,"router调用")],-1),Ms=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/router.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"app"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token punctuation"},"{"),e(" router"),a("span",{class:"token punctuation"},","),e(" controller "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token operator"},"="),e(" app"),a("span",{class:"token punctuation"},";"),e("\n  router"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"post"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'/api/posts'"),a("span",{class:"token punctuation"},","),e(" controller"),a("span",{class:"token punctuation"},"."),e("post"),a("span",{class:"token punctuation"},"."),e("create"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754412-92536"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/router.js\nmodule.exports = app => {\n  const { router, controller } = app;\n  router.post('/api/posts', controller.post.create);\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754412-92536","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br")])],-1),Ws=a("p",null,[a("strong",null,"Controller 支持多级目录"),e("，例如如果我们将上面的 Controller 代码放到 "),a("code",null,"app/controller/sub/post.js"),e(" 中，则可以在 router 中这样使用：")],-1),Os=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/router.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"app"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  app"),a("span",{class:"token punctuation"},"."),e("router"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"post"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'/api/posts'"),a("span",{class:"token punctuation"},","),e(" app"),a("span",{class:"token punctuation"},"."),e("controller"),a("span",{class:"token punctuation"},"."),e("sub"),a("span",{class:"token punctuation"},"."),e("post"),a("span",{class:"token punctuation"},"."),e("create"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754412-15330"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/router.js\nmodule.exports = app => {\n  app.router.post('/api/posts', app.controller.sub.post.create);\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754412-15330","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br")])],-1),Us=s('',5),Ks=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/controller/base/http.js"),e("\n\n"),a("span",{class:"token keyword"},"const"),e(" Controller "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'egg'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),e("Controller"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"class"),e(),a("span",{class:"token class-name"},"HttpController"),e(),a("span",{class:"token keyword"},"extends"),e(),a("span",{class:"token class-name"},"Controller"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token function"},"success"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"data"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("ctx"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n        msg"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'success'"),a("span",{class:"token punctuation"},","),e("\n        code"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token number"},"0"),a("span",{class:"token punctuation"},","),e("\n        data\n    "),a("span",{class:"token punctuation"},"}"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n\nmodule"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(" HttpController"),a("span",{class:"token punctuation"},";"),e("\n\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754412-55426"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/controller/base/http.js\n\nconst Controller = require('egg').Controller;\n\nclass HttpController extends Controller {\n  success(data) {\n    this.ctx.body = {\n        msg: 'success',\n        code: 0,\n        data\n    }\n  }\n}\n\nmodule.exports = HttpController;\n\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754412-55426","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br")])],-1),Gs=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"//app/controller/post.js"),e("\n"),a("span",{class:"token keyword"},"const"),e(" Controller "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'../core/base_controller'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"class"),e(),a("span",{class:"token class-name"},"PostController"),e(),a("span",{class:"token keyword"},"extends"),e(),a("span",{class:"token class-name"},"Controller"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"list"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" posts "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("service"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"listByUser"),a("span",{class:"token punctuation"},"("),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("user"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"success"),a("span",{class:"token punctuation"},"("),e("posts"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754413-39789"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"//app/controller/post.js\nconst Controller = require('../core/base_controller');\nclass PostController extends Controller {\n  async list() {\n    const posts = await this.service.listByUser(this.user);\n    this.success(posts);\n  }\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754413-39789","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br")])],-1),Js=s('',9),Qs=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// config/config.default.js"),e("\nexports"),a("span",{class:"token punctuation"},"."),e("security "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  domainWhiteList"),a("span",{class:"token operator"},":"),a("span",{class:"token punctuation"},"["),a("span",{class:"token string"},"'.domain.com'"),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},","),e("  "),a("span",{class:"token comment"},"// 安全白名单，以 . 开头"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754413-79211"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// config/config.default.js\nexports.security = {\n  domainWhiteList:['.domain.com'],  // 安全白名单，以 . 开头\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754413-79211","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br")])],-1),Ys=a("h4",{id:"服务service"},[a("a",{class:"header-anchor",href:"#服务service","aria-hidden":"true"},"#"),e(" 服务(Service)")],-1),Xs=a("p",null,"简单来说，Service 就是专门请求和组装数据的。",-1),Zs=a("h5",{id:"使用-场景"},[a("a",{class:"header-anchor",href:"#使用-场景","aria-hidden":"true"},"#"),e(" 使用 场景")],-1),na=a("ul",null,[a("li",null,"复杂数据的处理，比如要展现的信息需要从数据库获取，还要经过一定的规则计算，才能返回用户显示。或者计算完成后，更新到数据库。"),a("li",null,"第三方服务的调用，比如 GitHub 信息获取等。")],-1),ta=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/service/user"),e("\n"),a("span",{class:"token keyword"},"const"),e(" Service "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'egg'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),e("Service"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"class"),e(),a("span",{class:"token class-name"},"UserService"),e(),a("span",{class:"token keyword"},"extends"),e(),a("span",{class:"token class-name"},"Service"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"find"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"uid"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n        "),a("span",{class:"token keyword"},"return"),e(),a("span",{class:"token punctuation"},"["),a("span",{class:"token number"},"1"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token number"},"2"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token number"},"3"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token number"},"4"),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n\nmodule"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(" UserService"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754413-64307"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/service/user\nconst Service = require('egg').Service;\n\nclass UserService extends Service {\n    async find(uid) {\n        return [1, 2, 3, 4];\n    }\n}\n\nmodule.exports = UserService;\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754413-64307","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br")])],-1),sa=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token string"},"'use strict'"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token comment"},"// import HttpController from './base/http';"),e("\n"),a("span",{class:"token keyword"},"const"),e(" Controller "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'egg'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),e("Controller"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"class"),e(),a("span",{class:"token class-name"},"HomeController"),e(),a("span",{class:"token keyword"},"extends"),e(),a("span",{class:"token class-name"},"Controller"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"index"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token punctuation"},"{"),e(" ctx "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},";"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("service"),a("span",{class:"token punctuation"},"."),e("user"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"find"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token comment"},"// ctx 来自koa"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n\nmodule"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(" HomeController"),a("span",{class:"token punctuation"},";"),e("\n\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754413-61035"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"'use strict';\n// import HttpController from './base/http';\nconst Controller = require('egg').Controller;\n\nclass HomeController extends Controller {\n  async index() {\n    const { ctx } = this;\n    ctx.body = await this.service.user.find() // ctx 来自koa\n  }\n}\n\nmodule.exports = HomeController;\n\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754413-61035","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br")])],-1),aa=s('',11),ea=a("div",{class:"language-shell line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token function"},"npm"),e(" i egg-mysql --save\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754413-27546"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"npm i egg-mysql --save\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754413-27546","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br")])],-1),oa=a("p",null,[e("然后需要在应用或框架的 "),a("code",null,"config/plugin.js"),e(" 中声明：")],-1),ca=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// config/plugin.js"),e("\n"),a("span",{class:"token comment"},"// 使用 mysql 插件"),e("\nexports"),a("span",{class:"token punctuation"},"."),e("mysql "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  enable"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token boolean"},"true"),a("span",{class:"token punctuation"},","),e("\n  "),a("span",{class:"token keyword"},"package"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'egg-mysql'"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754413-91944"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// config/plugin.js\n// 使用 mysql 插件\nexports.mysql = {\n  enable: true,\n  package: 'egg-mysql',\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754413-91944","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br")])],-1),la=a("h5",{id:"根据环境配置"},[a("a",{class:"header-anchor",href:"#根据环境配置","aria-hidden":"true"},"#"),e(" 根据环境配置")],-1),pa=a("p",null,[e("同时，我们还支持 "),a("code",null,"plugin.{env}.js"),e(" 这种模式，会根据"),a("a",{href:"https://eggjs.org/zh-cn/basics/env.html",target:"_blank",rel:"noopener noreferrer"},"运行环境"),e("加载插件配置。")],-1),ia=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// config/plugin.local.js"),e("\nexports"),a("span",{class:"token punctuation"},"."),e("dev "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  enable"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token boolean"},"true"),a("span",{class:"token punctuation"},","),e("\n  "),a("span",{class:"token keyword"},"package"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'egg-dev'"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754413-91540"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// config/plugin.local.js\nexports.dev = {\n  enable: true,\n  package: 'egg-dev',\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754413-91540","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br")])],-1),ra=a("h5",{id:"引入"},[a("a",{class:"header-anchor",href:"#引入","aria-hidden":"true"},"#"),e(" 引入")],-1),ua=a("ul",null,[a("li",null,[a("code",null,"package"),e(" 是 "),a("code",null,"npm"),e(" 方式引入，也是最常见的引入方式")]),a("li",null,[a("code",null,"path"),e(" 是绝对路径引入，如应用内部抽了一个插件，但还没达到开源发布独立 "),a("code",null,"npm"),e(" 的阶段，或者是应用自己覆盖了框架的一些插件")])],-1),da=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// config/plugin.js"),e("\n"),a("span",{class:"token keyword"},"const"),e(" path "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'path'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\nexports"),a("span",{class:"token punctuation"},"."),e("mysql "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  enable"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token boolean"},"true"),a("span",{class:"token punctuation"},","),e("\n  path"),a("span",{class:"token operator"},":"),e(" path"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"join"),a("span",{class:"token punctuation"},"("),e("__dirname"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token string"},"'../lib/plugin/egg-mysql'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754413-35361"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// config/plugin.js\nconst path = require('path');\nexports.mysql = {\n  enable: true,\n  path: path.join(__dirname, '../lib/plugin/egg-mysql'),\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754413-35361","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br")])],-1),ma=a("h5",{id:"如何写一个插件"},[a("a",{class:"header-anchor",href:"#如何写一个插件","aria-hidden":"true"},"#"),e(" 如何写一个插件")],-1),ka=a("p",null,[e("你可以直接使用 "),a("a",{href:"https://github.com/eggjs/egg-boilerplate-plugin",target:"_blank",rel:"noopener noreferrer"},"egg-boilerplate-plugin"),e(" 脚手架来快速上手。")],-1),ba=a("div",{class:"language-"},[a("pre",null,[a("code",null,"$ mkdir egg-hello && cd egg-hello\n$ npm init egg --type=plugin\n$ npm i\n"),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754413-39410"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"$ mkdir egg-hello && cd egg-hello\n$ npm init egg --type=plugin\n$ npm i\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754413-39410","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br")])],-1),ya=a("p",null,"一个插件其实就是一个『迷你的应用』，下面展示的是一个插件的目录结构，和应用（app）几乎一样。",-1),ha=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token punctuation"},"."),e(" egg"),a("span",{class:"token operator"},"-"),e("hello\n├── "),a("span",{class:"token keyword"},"package"),a("span",{class:"token punctuation"},"."),e("json\n├── app"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"js"),e(),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n├── agent"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"js"),e(),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n├── app\n│   ├── "),a("span",{class:"token function"},"extend"),e(),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n│   "),a("span",{class:"token operator"},"|"),e("   ├── helper"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"js"),e(),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n│   "),a("span",{class:"token operator"},"|"),e("   ├── request"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"js"),e(),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n│   "),a("span",{class:"token operator"},"|"),e("   ├── response"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"js"),e(),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n│   "),a("span",{class:"token operator"},"|"),e("   ├── context"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"js"),e(),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n│   "),a("span",{class:"token operator"},"|"),e("   ├── application"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"js"),e(),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n│   "),a("span",{class:"token operator"},"|"),e("   └── agent"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"js"),e(),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n│   ├── "),a("span",{class:"token function"},"service"),e(),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n│   └── "),a("span",{class:"token function"},"middleware"),e(),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n│       └── mw"),a("span",{class:"token punctuation"},"."),e("js\n├── config\n"),a("span",{class:"token operator"},"|"),e("   ├── config"),a("span",{class:"token punctuation"},"."),e("default"),a("span",{class:"token punctuation"},"."),e("js\n│   ├── config"),a("span",{class:"token punctuation"},"."),e("prod"),a("span",{class:"token punctuation"},"."),e("js\n"),a("span",{class:"token operator"},"|"),e("   ├── config"),a("span",{class:"token punctuation"},"."),e("test"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"js"),e(),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n"),a("span",{class:"token operator"},"|"),e("   ├── config"),a("span",{class:"token punctuation"},"."),e("local"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"js"),e(),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n"),a("span",{class:"token operator"},"|"),e("   └── config"),a("span",{class:"token punctuation"},"."),e("unittest"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"js"),e(),a("span",{class:"token punctuation"},"("),e("可选"),a("span",{class:"token punctuation"},")"),e("\n└── test\n    └── middleware\n        └── mw"),a("span",{class:"token punctuation"},"."),e("test"),a("span",{class:"token punctuation"},"."),e("js\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754413-8931"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":". egg-hello\n├── package.json\n├── app.js (可选)\n├── agent.js (可选)\n├── app\n│   ├── extend (可选)\n│   |   ├── helper.js (可选)\n│   |   ├── request.js (可选)\n│   |   ├── response.js (可选)\n│   |   ├── context.js (可选)\n│   |   ├── application.js (可选)\n│   |   └── agent.js (可选)\n│   ├── service (可选)\n│   └── middleware (可选)\n│       └── mw.js\n├── config\n|   ├── config.default.js\n│   ├── config.prod.js\n|   ├── config.test.js (可选)\n|   ├── config.local.js (可选)\n|   └── config.unittest.js (可选)\n└── test\n    └── middleware\n        └── mw.test.js\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754413-8931","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br"),a("span",{class:"line-number"},"17"),a("br"),a("span",{class:"line-number"},"18"),a("br"),a("span",{class:"line-number"},"19"),a("br"),a("span",{class:"line-number"},"20"),a("br"),a("span",{class:"line-number"},"21"),a("br"),a("span",{class:"line-number"},"22"),a("br"),a("span",{class:"line-number"},"23"),a("br"),a("span",{class:"line-number"},"24"),a("br")])],-1),fa=s('',4),ga=a("div",{class:"language-json line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token property"},'"name"'),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},'"egg-rpc"'),a("span",{class:"token punctuation"},","),e("\n  "),a("span",{class:"token property"},'"eggPlugin"'),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token property"},'"name"'),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},'"rpc"'),a("span",{class:"token punctuation"},","),e("\n    "),a("span",{class:"token property"},'"dependencies"'),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"["),e(),a("span",{class:"token string"},'"registry"'),e(),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},","),e("\n    "),a("span",{class:"token property"},'"optionalDependencies"'),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"["),e(),a("span",{class:"token string"},'"vip"'),e(),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},","),e("\n    "),a("span",{class:"token property"},'"env"'),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"["),e(),a("span",{class:"token string"},'"local"'),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token string"},'"test"'),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token string"},'"unittest"'),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token string"},'"prod"'),e(),a("span",{class:"token punctuation"},"]"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754413-13460"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'{\n  "name": "egg-rpc",\n  "eggPlugin": {\n    "name": "rpc",\n    "dependencies": [ "registry" ],\n    "optionalDependencies": [ "vip" ],\n    "env": [ "local", "test", "unittest", "prod" ]\n  }\n}\n',"data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754413-13460","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br")])],-1),Ca=s('',8),xa=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(" Subscription "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'egg'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),e("Subscription"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"class"),e(),a("span",{class:"token class-name"},"LogSubscription"),e(),a("span",{class:"token keyword"},"extends"),e(),a("span",{class:"token class-name"},"Subscription"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token comment"},"// 通过 schedule 属性来设置定时任务的执行间隔等配置"),e("\n  "),a("span",{class:"token keyword"},"static"),e(),a("span",{class:"token keyword"},"get"),e(),a("span",{class:"token function"},"schedule"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"return"),e(),a("span",{class:"token punctuation"},"{"),e("\n      interval"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'1s'"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token comment"},"// 1 分钟间隔"),e("\n      type"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'worker'"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token comment"},"// 指定所有的 worker 都需要执行"),e("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n\n  "),a("span",{class:"token comment"},"// subscribe 是真正定时任务执行时被运行的函数"),e("\n  "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"subscribe"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'我是定时任务'"),a("span",{class:"token punctuation"},")"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n\nmodule"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(" LogSubscription"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754414-48012"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const Subscription = require('egg').Subscription;\n\nclass LogSubscription extends Subscription {\n  // 通过 schedule 属性来设置定时任务的执行间隔等配置\n  static get schedule() {\n    return {\n      interval: '1s', // 1 分钟间隔\n      type: 'worker', // 指定所有的 worker 都需要执行\n    };\n  }\n\n  // subscribe 是真正定时任务执行时被运行的函数\n  async subscribe() {\n    console.log('我是定时任务')\n  }\n}\n\nmodule.exports = LogSubscription;\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754414-48012","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br"),a("span",{class:"line-number"},"17"),a("br"),a("span",{class:"line-number"},"18"),a("br")])],-1),va=a("p",null,"另一种写法：",-1),wa=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[e("module"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  schedule"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n    interval"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'1s'"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token comment"},"// 1 分钟间隔"),e("\n    type"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'all'"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token comment"},"// 指定所有的 worker 都需要执行"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n  "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"task"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"ctx"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'我是定时任务'"),a("span",{class:"token punctuation"},")"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754414-28240"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"module.exports = {\n  schedule: {\n    interval: '1s', // 1 分钟间隔\n    type: 'all', // 指定所有的 worker 都需要执行\n  },\n  async task(ctx) {\n    console.log('我是定时任务')\n  },\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754414-28240","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br")])],-1),ja=s('',7),_a=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app.js"),e("\n"),a("span",{class:"token keyword"},"class"),e(),a("span",{class:"token class-name"},"AppBootHook"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token function"},"constructor"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"app"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n      "),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("app "),a("span",{class:"token operator"},"="),e(" app"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token punctuation"},"}"),e("\n  \n    "),a("span",{class:"token function"},"configWillLoad"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n         "),a("span",{class:"token comment"},"// 此时 config 文件已经被读取并合并，但是还并未生效"),e("\n         "),a("span",{class:"token comment"},"// 这是应用层修改配置的最后时机"),e("\n         "),a("span",{class:"token comment"},"// 注意：此函数只支持同步调用"),e("\n        console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'configWillLoad'"),a("span",{class:"token punctuation"},")"),e("\n     \n  \n      "),a("span",{class:"token comment"},"// 例如：参数中的密码是加密的，在此处进行解密"),e("\n    "),a("span",{class:"token comment"},"//   this.app.config.mysql.password = decrypt(this.app.config.mysql.password);"),e("\n    "),a("span",{class:"token comment"},"//   // 例如：插入一个中间件到框架的 coreMiddleware 之间"),e("\n    "),a("span",{class:"token comment"},"//   const statusIdx = this.app.config.coreMiddleware.indexOf('status');"),e("\n    "),a("span",{class:"token comment"},"//   this.app.config.coreMiddleware.splice(statusIdx + 1, 0, 'limit');"),e("\n    "),a("span",{class:"token punctuation"},"}"),e("\n  \n    "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"didLoad"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n        console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'didLoad'"),a("span",{class:"token punctuation"},")"),e("\n      "),a("span",{class:"token comment"},"// 所有的配置已经加载完毕"),e("\n      "),a("span",{class:"token comment"},"// 可以用来加载应用自定义的文件，启动自定义的服务"),e("\n  \n      "),a("span",{class:"token comment"},"// 例如：创建自定义应用的示例"),e("\n    "),a("span",{class:"token comment"},"//   this.app.queue = new Queue(this.app.config.queue);"),e("\n    "),a("span",{class:"token comment"},"//   await this.app.queue.init();"),e("\n  \n    "),a("span",{class:"token comment"},"//   // 例如：加载自定义的目录"),e("\n    "),a("span",{class:"token comment"},"//   this.app.loader.loadToContext(path.join(__dirname, 'app/tasks'), 'tasks', {"),e("\n    "),a("span",{class:"token comment"},"//     fieldClass: 'tasksClasses',"),e("\n    "),a("span",{class:"token comment"},"//   });"),e("\n    "),a("span",{class:"token punctuation"},"}"),e("\n  \n    "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"willReady"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n        console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'willReady'"),a("span",{class:"token punctuation"},")"),e("\n      "),a("span",{class:"token comment"},"// 所有的插件都已启动完毕，但是应用整体还未 ready"),e("\n      "),a("span",{class:"token comment"},"// 可以做一些数据初始化等操作，这些操作成功才会启动应用"),e("\n  \n      "),a("span",{class:"token comment"},"// 例如：从数据库加载数据到内存缓存"),e("\n    "),a("span",{class:"token comment"},"//   this.app.cacheData = await this.app.model.query(QUERY_CACHE_SQL);"),e("\n    "),a("span",{class:"token punctuation"},"}"),e("\n  \n    "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"didReady"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n        console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'didReady'"),a("span",{class:"token punctuation"},")"),e("\n      "),a("span",{class:"token comment"},"// 应用已经启动完毕"),e("\n  \n    "),a("span",{class:"token comment"},"//   const ctx = await this.app.createAnonymousContext();"),e("\n    "),a("span",{class:"token comment"},"//   await ctx.service.Biz.request();"),e("\n    "),a("span",{class:"token punctuation"},"}"),e("\n  \n    "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"serverDidReady"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n        console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'serverDidReady'"),a("span",{class:"token punctuation"},")"),e("\n      "),a("span",{class:"token comment"},"// http / https server 已启动，开始接受外部请求"),e("\n      "),a("span",{class:"token comment"},"// 此时可以从 app.server 拿到 server 的实例"),e("\n  \n    "),a("span",{class:"token comment"},"//   this.app.server.on('timeout', socket => {"),e("\n    "),a("span",{class:"token comment"},"//     // handle socket timeout"),e("\n    "),a("span",{class:"token comment"},"//   });"),e("\n    "),a("span",{class:"token punctuation"},"}"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n  \n  module"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(" AppBootHook"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754414-59666"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app.js\nclass AppBootHook {\n    constructor(app) {\n      this.app = app;\n    }\n  \n    configWillLoad() {\n         // 此时 config 文件已经被读取并合并，但是还并未生效\n         // 这是应用层修改配置的最后时机\n         // 注意：此函数只支持同步调用\n        console.log('configWillLoad')\n     \n  \n      // 例如：参数中的密码是加密的，在此处进行解密\n    //   this.app.config.mysql.password = decrypt(this.app.config.mysql.password);\n    //   // 例如：插入一个中间件到框架的 coreMiddleware 之间\n    //   const statusIdx = this.app.config.coreMiddleware.indexOf('status');\n    //   this.app.config.coreMiddleware.splice(statusIdx + 1, 0, 'limit');\n    }\n  \n    async didLoad() {\n        console.log('didLoad')\n      // 所有的配置已经加载完毕\n      // 可以用来加载应用自定义的文件，启动自定义的服务\n  \n      // 例如：创建自定义应用的示例\n    //   this.app.queue = new Queue(this.app.config.queue);\n    //   await this.app.queue.init();\n  \n    //   // 例如：加载自定义的目录\n    //   this.app.loader.loadToContext(path.join(__dirname, 'app/tasks'), 'tasks', {\n    //     fieldClass: 'tasksClasses',\n    //   });\n    }\n  \n    async willReady() {\n        console.log('willReady')\n      // 所有的插件都已启动完毕，但是应用整体还未 ready\n      // 可以做一些数据初始化等操作，这些操作成功才会启动应用\n  \n      // 例如：从数据库加载数据到内存缓存\n    //   this.app.cacheData = await this.app.model.query(QUERY_CACHE_SQL);\n    }\n  \n    async didReady() {\n        console.log('didReady')\n      // 应用已经启动完毕\n  \n    //   const ctx = await this.app.createAnonymousContext();\n    //   await ctx.service.Biz.request();\n    }\n  \n    async serverDidReady() {\n        console.log('serverDidReady')\n      // http / https server 已启动，开始接受外部请求\n      // 此时可以从 app.server 拿到 server 的实例\n  \n    //   this.app.server.on('timeout', socket => {\n    //     // handle socket timeout\n    //   });\n    }\n  }\n  \n  module.exports = AppBootHook;\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754414-59666","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br"),a("span",{class:"line-number"},"17"),a("br"),a("span",{class:"line-number"},"18"),a("br"),a("span",{class:"line-number"},"19"),a("br"),a("span",{class:"line-number"},"20"),a("br"),a("span",{class:"line-number"},"21"),a("br"),a("span",{class:"line-number"},"22"),a("br"),a("span",{class:"line-number"},"23"),a("br"),a("span",{class:"line-number"},"24"),a("br"),a("span",{class:"line-number"},"25"),a("br"),a("span",{class:"line-number"},"26"),a("br"),a("span",{class:"line-number"},"27"),a("br"),a("span",{class:"line-number"},"28"),a("br"),a("span",{class:"line-number"},"29"),a("br"),a("span",{class:"line-number"},"30"),a("br"),a("span",{class:"line-number"},"31"),a("br"),a("span",{class:"line-number"},"32"),a("br"),a("span",{class:"line-number"},"33"),a("br"),a("span",{class:"line-number"},"34"),a("br"),a("span",{class:"line-number"},"35"),a("br"),a("span",{class:"line-number"},"36"),a("br"),a("span",{class:"line-number"},"37"),a("br"),a("span",{class:"line-number"},"38"),a("br"),a("span",{class:"line-number"},"39"),a("br"),a("span",{class:"line-number"},"40"),a("br"),a("span",{class:"line-number"},"41"),a("br"),a("span",{class:"line-number"},"42"),a("br"),a("span",{class:"line-number"},"43"),a("br"),a("span",{class:"line-number"},"44"),a("br"),a("span",{class:"line-number"},"45"),a("br"),a("span",{class:"line-number"},"46"),a("br"),a("span",{class:"line-number"},"47"),a("br"),a("span",{class:"line-number"},"48"),a("br"),a("span",{class:"line-number"},"49"),a("br"),a("span",{class:"line-number"},"50"),a("br"),a("span",{class:"line-number"},"51"),a("br"),a("span",{class:"line-number"},"52"),a("br"),a("span",{class:"line-number"},"53"),a("br"),a("span",{class:"line-number"},"54"),a("br"),a("span",{class:"line-number"},"55"),a("br"),a("span",{class:"line-number"},"56"),a("br"),a("span",{class:"line-number"},"57"),a("br"),a("span",{class:"line-number"},"58"),a("br"),a("span",{class:"line-number"},"59"),a("br"),a("span",{class:"line-number"},"60"),a("br"),a("span",{class:"line-number"},"61"),a("br"),a("span",{class:"line-number"},"62"),a("br"),a("span",{class:"line-number"},"63"),a("br"),a("span",{class:"line-number"},"64"),a("br")])],-1),Ta=a("p",null,[a("strong",null,"注意：在自定义生命周期函数中不建议做太耗时的操作，框架会有启动的超时检测。")],-1),$a=a("h2",{id:"egg进阶与实战"},[a("a",{class:"header-anchor",href:"#egg进阶与实战","aria-hidden":"true"},"#"),e(" Egg进阶与实战")],-1),Ia=a("h3",{id:"debug"},[a("a",{class:"header-anchor",href:"#debug","aria-hidden":"true"},"#"),e(" Debug")],-1),Ea=a("p",null,[e("添加 "),a("code",null,"npm scripts"),e(" 到 "),a("code",null,"package.json"),e("：")],-1),Na=a("div",{class:"language-json line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token property"},'"scripts"'),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token property"},'"debug"'),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},'"egg-bin debug"'),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754414-53589"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'{\n  "scripts": {\n    "debug": "egg-bin debug"\n  }\n}\n',"data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754414-53589","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br")])],-1),Aa=s('',15),Pa=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// config/config.${env}.js"),e("\nexports"),a("span",{class:"token punctuation"},"."),e("logger "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  dir"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'/path/to/your/custom/log/dir'"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754414-57618"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// config/config.${env}.js\nexports.logger = {\n  dir: '/path/to/your/custom/log/dir',\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754414-57618","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br")])],-1),qa=s('',4),Sa=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// config/config.${env}.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"appInfo"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"return"),e(),a("span",{class:"token punctuation"},"{"),e("\n    logger"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n      appLogName"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token template-string"},[a("span",{class:"token template-punctuation string"},"`"),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("appInfo"),a("span",{class:"token punctuation"},"."),e("name"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"},"-web.log"),a("span",{class:"token template-punctuation string"},"`")]),a("span",{class:"token punctuation"},","),e("\n      coreLogName"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'egg-web.log'"),a("span",{class:"token punctuation"},","),e("\n      agentLogName"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'egg-agent.log'"),a("span",{class:"token punctuation"},","),e("\n      errorLogName"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'common-error.log'"),a("span",{class:"token punctuation"},","),e("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754414-1334"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// config/config.${env}.js\nmodule.exports = appInfo => {\n  return {\n    logger: {\n      appLogName: `${appInfo.name}-web.log`,\n      coreLogName: 'egg-web.log',\n      agentLogName: 'egg-agent.log',\n      errorLogName: 'common-error.log',\n    },\n  };\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754414-1334","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br")])],-1),Da=s('',6),Fa=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[e("ctx"),a("span",{class:"token punctuation"},"."),e("logger"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"debug"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'debug info'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\nctx"),a("span",{class:"token punctuation"},"."),e("logger"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"info"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'info'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\nctx"),a("span",{class:"token punctuation"},"."),e("logger"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"warn"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'WARNNING!!!!'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754414-26820"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"ctx.logger.debug('debug info');\nctx.logger.info('info');\nctx.logger.warn('WARNNING!!!!');\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754414-26820","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br")])],-1),Ba=a("p",null,"如果我们想做一些应用级别的日志记录，如记录启动阶段的一些数据信息，可以通过 App Logger 来完成。",-1),Ra=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"app"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  app"),a("span",{class:"token punctuation"},"."),e("logger"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"debug"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'debug info'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  app"),a("span",{class:"token punctuation"},"."),e("logger"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"info"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'启动耗时 %d ms'"),a("span",{class:"token punctuation"},","),e(" Date"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"now"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"-"),e(" start"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  app"),a("span",{class:"token punctuation"},"."),e("logger"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"warn"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'warning!'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n  app"),a("span",{class:"token punctuation"},"."),e("logger"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"error"),a("span",{class:"token punctuation"},"("),e("someErrorObj"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754414-13604"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app.js\nmodule.exports = app => {\n  app.logger.debug('debug info');\n  app.logger.info('启动耗时 %d ms', Date.now() - start);\n  app.logger.warn('warning!');\n\n  app.logger.error(someErrorObj);\n};\n\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754414-13604","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br")])],-1),La=a("p",null,[e("对于框架和插件开发者会使用到的 App Logger 还有 "),a("code",null,"app.coreLogger"),e("。")],-1),za=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"app"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  app"),a("span",{class:"token punctuation"},"."),e("coreLogger"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"info"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'启动耗时 %d ms'"),a("span",{class:"token punctuation"},","),e(" Date"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"now"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"-"),e(" start"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754415-29383"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app.js\nmodule.exports = app => {\n  app.coreLogger.info('启动耗时 %d ms', Date.now() - start);\n};\n\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754415-29383","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br")])],-1),Va=a("p",null,[e("在开发框架和插件时有时会需要在 Agent 进程运行代码，这时使用 "),a("code",null,"agent.coreLogger"),e("。")],-1),Ha=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// agent.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"agent"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  agent"),a("span",{class:"token punctuation"},"."),e("logger"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"debug"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'debug info'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  agent"),a("span",{class:"token punctuation"},"."),e("logger"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"info"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'启动耗时 %d ms'"),a("span",{class:"token punctuation"},","),e(" Date"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"now"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"-"),e(" start"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  agent"),a("span",{class:"token punctuation"},"."),e("logger"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"warn"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'warning!'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n  agent"),a("span",{class:"token punctuation"},"."),e("logger"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"error"),a("span",{class:"token punctuation"},"("),e("someErrorObj"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754415-62115"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// agent.js\nmodule.exports = agent => {\n  agent.logger.debug('debug info');\n  agent.logger.info('启动耗时 %d ms', Date.now() - start);\n  agent.logger.warn('warning!');\n\n  agent.logger.error(someErrorObj);\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754415-62115","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br")])],-1),Ma=a("h4",{id:"文件日志级别"},[a("a",{class:"header-anchor",href:"#文件日志级别","aria-hidden":"true"},"#"),e(" 文件日志级别")],-1),Wa=a("p",null,[e("默认只会输出 "),a("code",null,"INFO"),e(" 及以上（"),a("code",null,"WARN"),e(" 和 "),a("code",null,"ERROR"),e("）的日志到文件中。")],-1),Oa=a("p",null,"可通过如下方式配置输出到文件日志的级别：",-1),Ua=a("p",null,"打印所有级别日志到文件中：",-1),Ka=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// config/config.${env}.js"),e("\nexports"),a("span",{class:"token punctuation"},"."),e("logger "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  level"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'DEBUG'"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754415-24904"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// config/config.${env}.js\nexports.logger = {\n  level: 'DEBUG',\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754415-24904","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br")])],-1),Ga=a("p",null,"关闭所有打印到文件的日志：",-1),Ja=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// config/config.${env}.js"),e("\nexports"),a("span",{class:"token punctuation"},"."),e("logger "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  level"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'NONE'"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754415-51568"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// config/config.${env}.js\nexports.logger = {\n  level: 'NONE',\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754415-51568","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br")])],-1),Qa=s('',4),Ya=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// config/config.${env}.js"),e("\n"),a("span",{class:"token keyword"},"const"),e(" path "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'path'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"appInfo"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"return"),e(),a("span",{class:"token punctuation"},"{"),e("\n    logrotator"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n      filesRotateBySize"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"["),e("\n        path"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"join"),a("span",{class:"token punctuation"},"("),e("appInfo"),a("span",{class:"token punctuation"},"."),e("root"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token string"},"'logs'"),a("span",{class:"token punctuation"},","),e(" appInfo"),a("span",{class:"token punctuation"},"."),e("name"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token string"},"'egg-web.log'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},","),e("\n      "),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},","),e("\n      maxFileSize"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token number"},"2"),e(),a("span",{class:"token operator"},"*"),e(),a("span",{class:"token number"},"1024"),e(),a("span",{class:"token operator"},"*"),e(),a("span",{class:"token number"},"1024"),e(),a("span",{class:"token operator"},"*"),e(),a("span",{class:"token number"},"1024"),a("span",{class:"token punctuation"},","),e("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754415-7305"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// config/config.${env}.js\nconst path = require('path');\n\nmodule.exports = appInfo => {\n  return {\n    logrotator: {\n      filesRotateBySize: [\n        path.join(appInfo.root, 'logs', appInfo.name, 'egg-web.log'),\n      ],\n      maxFileSize: 2 * 1024 * 1024 * 1024,\n    },\n  };\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754415-7305","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br")])],-1),Xa=a("p",null,[a("strong",null,"我们也可以选择按照小时进行切割，这和默认的按天切割非常类似，只是时间缩短到每小时。")],-1),Za=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// config/config.${env}.js"),e("\n"),a("span",{class:"token keyword"},"const"),e(" path "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'path'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"appInfo"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"return"),e(),a("span",{class:"token punctuation"},"{"),e("\n    logrotator"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n      filesRotateByHour"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"["),e("\n        path"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"join"),a("span",{class:"token punctuation"},"("),e("appInfo"),a("span",{class:"token punctuation"},"."),e("root"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token string"},"'logs'"),a("span",{class:"token punctuation"},","),e(" appInfo"),a("span",{class:"token punctuation"},"."),e("name"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token string"},"'common-error.log'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},","),e("\n      "),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},","),e("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754415-83918"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// config/config.${env}.js\nconst path = require('path');\n\nmodule.exports = appInfo => {\n  return {\n    logrotator: {\n      filesRotateByHour: [\n        path.join(appInfo.root, 'logs', appInfo.name, 'common-error.log'),\n      ],\n    },\n  };\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754415-83918","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br")])],-1),ne=s('',7),te=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(" cluster "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'cluster'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"const"),e(" http "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'http'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"const"),e(" numCPUs "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'os'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"cpus"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),e("length"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"if"),e(),a("span",{class:"token punctuation"},"("),e("cluster"),a("span",{class:"token punctuation"},"."),e("isMaster"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token comment"},"// Fork workers."),e("\n  "),a("span",{class:"token keyword"},"for"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token keyword"},"let"),e(" i "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token number"},"0"),a("span",{class:"token punctuation"},";"),e(" i "),a("span",{class:"token operator"},"<"),e(" numCPUs"),a("span",{class:"token punctuation"},";"),e(" i"),a("span",{class:"token operator"},"++"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    cluster"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"fork"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n\n  cluster"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"on"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'exit'"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token keyword"},"function"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("worker"),a("span",{class:"token punctuation"},","),e(" code"),a("span",{class:"token punctuation"},","),e(" signal")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'worker '"),e(),a("span",{class:"token operator"},"+"),e(" worker"),a("span",{class:"token punctuation"},"."),e("process"),a("span",{class:"token punctuation"},"."),e("pid "),a("span",{class:"token operator"},"+"),e(),a("span",{class:"token string"},"' died'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token keyword"},"else"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token comment"},"// Workers can share any TCP connection"),e("\n  "),a("span",{class:"token comment"},"// In this case it is an HTTP server"),e("\n  http"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"createServer"),a("span",{class:"token punctuation"},"("),a("span",{class:"token keyword"},"function"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("req"),a("span",{class:"token punctuation"},","),e(" res")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    res"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"writeHead"),a("span",{class:"token punctuation"},"("),a("span",{class:"token number"},"200"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    res"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"end"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},'"hello world\\n"'),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"listen"),a("span",{class:"token punctuation"},"("),a("span",{class:"token number"},"8000"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754415-11770"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const cluster = require('cluster');\nconst http = require('http');\nconst numCPUs = require('os').cpus().length;\n\nif (cluster.isMaster) {\n  // Fork workers.\n  for (let i = 0; i < numCPUs; i++) {\n    cluster.fork();\n  }\n\n  cluster.on('exit', function(worker, code, signal) {\n    console.log('worker ' + worker.process.pid + ' died');\n  });\n} else {\n  // Workers can share any TCP connection\n  // In this case it is an HTTP server\n  http.createServer(function(req, res) {\n    res.writeHead(200);\n    res.end(\"hello world\\n\");\n  }).listen(8000);\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754415-11770","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br"),a("span",{class:"line-number"},"17"),a("br"),a("span",{class:"line-number"},"18"),a("br"),a("span",{class:"line-number"},"19"),a("br"),a("span",{class:"line-number"},"20"),a("br"),a("span",{class:"line-number"},"21"),a("br")])],-1),se=s('',27),ae=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// agent.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"agent"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token comment"},"// 在这里写你的初始化逻辑"),e("\n\n  "),a("span",{class:"token comment"},"// 也可以通过 messenger 对象发送消息给 App Worker"),e("\n  "),a("span",{class:"token comment"},"// 但需要等待 App Worker 启动成功后才能发送，不然很可能丢失"),e("\n  agent"),a("span",{class:"token punctuation"},"."),e("messenger"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"on"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'egg-ready'"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" data "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e(),a("span",{class:"token operator"},"..."),e(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n    agent"),a("span",{class:"token punctuation"},"."),e("messenger"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"sendToApp"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'xxx_action'"),a("span",{class:"token punctuation"},","),e(" data"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754415-45390"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// agent.js\nmodule.exports = agent => {\n  // 在这里写你的初始化逻辑\n\n  // 也可以通过 messenger 对象发送消息给 App Worker\n  // 但需要等待 App Worker 启动成功后才能发送，不然很可能丢失\n  agent.messenger.on('egg-ready', () => {\n    const data = { ... };\n    agent.messenger.sendToApp('xxx_action', data);\n  });\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754415-45390","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br")])],-1),ee=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"app"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  app"),a("span",{class:"token punctuation"},"."),e("messenger"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"on"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'xxx_action'"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token parameter"},"data"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token comment"},"// ..."),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754415-66264"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app.js\nmodule.exports = app => {\n  app.messenger.on('xxx_action', data => {\n    // ...\n  });\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754415-66264","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br")])],-1),oe=s('',15),ce=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token string"},"'use strict'"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"const"),e(" cluster "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'cluster'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"if"),e(),a("span",{class:"token punctuation"},"("),e("cluster"),a("span",{class:"token punctuation"},"."),e("isMaster"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" worker "),a("span",{class:"token operator"},"="),e(" cluster"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"fork"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  worker"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"send"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'hi there'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  worker"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"on"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'message'"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token parameter"},"msg"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n    console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),a("span",{class:"token template-string"},[a("span",{class:"token template-punctuation string"},"`"),a("span",{class:"token string"},"msg: "),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("msg"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token string"}," from worker#"),a("span",{class:"token interpolation"},[a("span",{class:"token interpolation-punctuation punctuation"},"${"),e("worker"),a("span",{class:"token punctuation"},"."),e("id"),a("span",{class:"token interpolation-punctuation punctuation"},"}")]),a("span",{class:"token template-punctuation string"},"`")]),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token keyword"},"else"),e(),a("span",{class:"token keyword"},"if"),e(),a("span",{class:"token punctuation"},"("),e("cluster"),a("span",{class:"token punctuation"},"."),e("isWorker"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n  process"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"on"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'message'"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"msg"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n    process"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"send"),a("span",{class:"token punctuation"},"("),e("msg"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754416-95876"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"'use strict';\nconst cluster = require('cluster');\n\nif (cluster.isMaster) {\n  const worker = cluster.fork();\n  worker.send('hi there');\n  worker.on('message', msg => {\n    console.log(`msg: ${msg} from worker#${worker.id}`);\n  });\n} else if (cluster.isWorker) {\n  process.on('message', (msg) => {\n    process.send(msg);\n  });\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754416-95876","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br")])],-1),le=s('',4),pe=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"app"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token comment"},"// 注意，只有在 egg-ready 事件拿到之后才能发送消息"),e("\n  app"),a("span",{class:"token punctuation"},"."),e("messenger"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"once"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'egg-ready'"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n    app"),a("span",{class:"token punctuation"},"."),e("messenger"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"sendToAgent"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'agent-event'"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token punctuation"},"{"),e(" foo"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'bar'"),e(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    app"),a("span",{class:"token punctuation"},"."),e("messenger"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"sendToApp"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'app-event'"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token punctuation"},"{"),e(" foo"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'bar'"),e(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754416-40030"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app.js\nmodule.exports = app => {\n  // 注意，只有在 egg-ready 事件拿到之后才能发送消息\n  app.messenger.once('egg-ready', () => {\n    app.messenger.sendToAgent('agent-event', { foo: 'bar' });\n    app.messenger.sendToApp('app-event', { foo: 'bar' });\n  });\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754416-40030","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br")])],-1),ie=a("p",null,[a("em",null,"上面所有 app.messenger 上的方法都可以在 agent.messenger 上使用。")],-1),re=a("blockquote",null,[a("p",null,[e("上面的示例中提到，需要等 "),a("code",null,"egg-ready"),e(" 消息之后才能发送消息。只有在 Master 确认所有的 Agent 进程和 Worker 进程都已经成功启动（并 ready）之后，才会通过 messenger 发送 "),a("code",null,"egg-ready"),e(" 消息给所有的 Agent 和 Worker，告知一切准备就绪，IPC 通道可以开始使用了。")])],-1),ue=a("p",null,"在 messenger 上监听对应的 action 事件，就可以收到其他进程发送来的信息了。",-1),de=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[e("app"),a("span",{class:"token punctuation"},"."),e("messenger"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"on"),a("span",{class:"token punctuation"},"("),e("action"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token parameter"},"data"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token comment"},"// process data"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\napp"),a("span",{class:"token punctuation"},"."),e("messenger"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"once"),a("span",{class:"token punctuation"},"("),e("action"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token parameter"},"data"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token comment"},"// process data"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754416-18542"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"app.messenger.on(action, data => {\n  // process data\n});\napp.messenger.once(action, data => {\n  // process data\n});\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754416-18542","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br")])],-1),me=a("h3",{id:"异常捕获-错误处理"},[a("a",{class:"header-anchor",href:"#异常捕获-错误处理","aria-hidden":"true"},"#"),e(" 异常捕获( 错误处理 )")],-1),ke=a("p",null,[e("得益于框架支持的异步编程模型，错误完全可以用 "),a("code",null,"try catch"),e(" 来捕获。在编写应用代码时，所有地方都可以直接用 "),a("code",null,"try catch"),e(" 来捕获异常。")],-1),be=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/service/test.js"),e("\n"),a("span",{class:"token keyword"},"try"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"const"),e(" res "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("ctx"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"curl"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'http://eggjs.com/api/echo'"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token punctuation"},"{"),e(" dataType"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'json'"),e(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"if"),e(),a("span",{class:"token punctuation"},"("),e("res"),a("span",{class:"token punctuation"},"."),e("status "),a("span",{class:"token operator"},"!=="),e(),a("span",{class:"token number"},"200"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token keyword"},"throw"),e(),a("span",{class:"token keyword"},"new"),e(),a("span",{class:"token class-name"},"Error"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'response status is not 200'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"return"),e(" res"),a("span",{class:"token punctuation"},"."),e("data"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token keyword"},"catch"),e(),a("span",{class:"token punctuation"},"("),e("err"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("logger"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"error"),a("span",{class:"token punctuation"},"("),e("err"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token keyword"},"return"),e(),a("span",{class:"token punctuation"},"{"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754416-6780"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/service/test.js\ntry {\n  const res = await this.ctx.curl('http://eggjs.com/api/echo', { dataType: 'json' });\n  if (res.status !== 200) throw new Error('response status is not 200');\n  return res.data;\n} catch (err) {\n  this.logger.error(err);\n  return {};\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754416-6780","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br")])],-1),ye=a("p",null,"按照正常代码写法，所有的异常都可以用这个方式进行捕获并处理，但是一定要注意一些特殊的写法可能带来的问题。打一个不太正式的比方，我们的代码全部都在一个异步调用链上，所有的异步操作都通过 await 串接起来了，但是只要有一个地方跳出了异步调用链，异常就捕获不到了。",-1),he=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/controller/home.js"),e("\n"),a("span",{class:"token keyword"},"class"),e(),a("span",{class:"token class-name"},"HomeController"),e(),a("span",{class:"token keyword"},"extends"),e(),a("span",{class:"token class-name"},"Controller"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"buy"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" request "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" config "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" ctx"),a("span",{class:"token punctuation"},"."),e("service"),a("span",{class:"token punctuation"},"."),e("trade"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"buy"),a("span",{class:"token punctuation"},"("),e("request"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token comment"},"// 下单后需要进行一次核对，且不阻塞当前请求"),e("\n    "),a("span",{class:"token function"},"setImmediate"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n      ctx"),a("span",{class:"token punctuation"},"."),e("service"),a("span",{class:"token punctuation"},"."),e("trade"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"check"),a("span",{class:"token punctuation"},"("),e("request"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754416-934"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/controller/home.js\nclass HomeController extends Controller {\n  async buy () {\n    const request = {};\n    const config = await ctx.service.trade.buy(request);\n    // 下单后需要进行一次核对，且不阻塞当前请求\n    setImmediate(() => {\n      ctx.service.trade.check(request);\n    });\n  }\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754416-934","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br")])],-1),fe=a("p",null,[e("在这个场景中，如果 "),a("code",null,"service.trade.check"),e(" 方法中代码有问题，导致执行时抛出了异常，尽管框架会在最外层通过 "),a("code",null,"try catch"),e(" 统一捕获错误，但是由于 "),a("code",null,"setImmediate"),e(" 中的代码『跳出』了异步链，它里面的错误就无法被捕捉到了。因此在编写类似代码的时候一定要注意。")],-1),ge=a("p",null,[e("当然，框架也考虑到了这类场景，提供了 "),a("code",null,"ctx.runInBackground(scope)"),e(" 辅助方法，通过它又包装了一个异步链，所有在这个 scope 里面的错误都会统一捕获。")],-1),Ce=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"class"),e(),a("span",{class:"token class-name"},"HomeController"),e(),a("span",{class:"token keyword"},"extends"),e(),a("span",{class:"token class-name"},"Controller"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"buy"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" request "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" config "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" ctx"),a("span",{class:"token punctuation"},"."),e("service"),a("span",{class:"token punctuation"},"."),e("trade"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"buy"),a("span",{class:"token punctuation"},"("),e("request"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token comment"},"// 下单后需要进行一次核对，且不阻塞当前请求"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"runInBackground"),a("span",{class:"token punctuation"},"("),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n      "),a("span",{class:"token comment"},"// 这里面的异常都会统统被 Backgroud 捕获掉，并打印错误日志"),e("\n      "),a("span",{class:"token keyword"},"await"),e(" ctx"),a("span",{class:"token punctuation"},"."),e("service"),a("span",{class:"token punctuation"},"."),e("trade"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"check"),a("span",{class:"token punctuation"},"("),e("request"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754416-98028"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"class HomeController extends Controller {\n  async buy () {\n    const request = {};\n    const config = await ctx.service.trade.buy(request);\n    // 下单后需要进行一次核对，且不阻塞当前请求\n    ctx.runInBackground(async () => {\n      // 这里面的异常都会统统被 Backgroud 捕获掉，并打印错误日志\n      await ctx.service.trade.check(request);\n    });\n  }\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754416-98028","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br")])],-1),xe=a("p",null,[a("strong",null,"为了保证异常可追踪，必须保证所有抛出的异常都是 Error 类型，因为只有 Error 类型才会带上堆栈信息，定位到问题。")],-1),ve=a("h4",{id:"框架层统一异常处里"},[a("a",{class:"header-anchor",href:"#框架层统一异常处里","aria-hidden":"true"},"#"),e(" 框架层统一异常处里")],-1),we=a("p",null,"尽管框架提供了默认的统一异常处理机制(dev 会显示堆栈信息)，但是应用开发中经常需要对异常时的响应做自定义，特别是在做一些接口开发的时候。框架自带的 onerror 插件支持自定义配置错误处理方法，可以覆盖默认的错误处理方法。",-1),je=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// config/config.default.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  onerror"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token function"},"all"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("err"),a("span",{class:"token punctuation"},","),e(" ctx")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n      "),a("span",{class:"token comment"},"// 在此处定义针对所有响应类型的错误处理方法"),e("\n      "),a("span",{class:"token comment"},"// 注意，定义了 config.all 之后，其他错误处理方法不会再生效"),e("\n      ctx"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'error'"),a("span",{class:"token punctuation"},";"),e("\n      ctx"),a("span",{class:"token punctuation"},"."),e("status "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token number"},"500"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754416-5087"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// config/config.default.js\nmodule.exports = {\n  onerror: {\n    all(err, ctx) {\n      // 在此处定义针对所有响应类型的错误处理方法\n      // 注意，定义了 config.all 之后，其他错误处理方法不会再生效\n      ctx.body = 'error';\n      ctx.status = 500;\n    },\n  },\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754416-5087","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br")])],-1),_e=a("h5",{id:"404"},[a("a",{class:"header-anchor",href:"#404","aria-hidden":"true"},"#"),e(" 404")],-1),Te=a("p",null,"框架并不会将服务端返回的 404 状态当做异常来处理，但是框架提供了当响应为 404 且没有返回 body 时的默认响应。",-1),$e=a("ul",null,[a("li",null,"当请求被框架判定为需要 JSON 格式的响应时，会返回一段 JSON：")],-1),Ie=a("div",{class:"language-"},[a("pre",null,[a("code",null,'{ "message": "Not Found" }\n'),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754416-54242"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'{ "message": "Not Found" }\n',"data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754416-54242","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br")])],-1),Ee=a("ul",null,[a("li",null,"当请求被框架判定为需要 HTML 格式的响应时，会返回一段 HTML：")],-1),Ne=a("div",{class:"language-"},[a("pre",null,[a("code",null,"<h1>404 Not Found</h1>\n"),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754416-36218"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"<h1>404 Not Found</h1>\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754416-36218","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br")])],-1),Ae=a("p",null,"框架支持通过配置，将默认的 HTML 请求的 404 响应重定向到指定的页面。",-1),Pe=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// config/config.default.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  notfound"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n    pageUrl"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'/404.html'"),a("span",{class:"token punctuation"},","),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754416-40087"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// config/config.default.js\nmodule.exports = {\n  notfound: {\n    pageUrl: '/404.html',\n  },\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754416-40087","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br")])],-1),qe=a("h5",{id:"自定义404响应"},[a("a",{class:"header-anchor",href:"#自定义404响应","aria-hidden":"true"},"#"),e(" 自定义404响应")],-1),Se=a("p",null,"在一些场景下，我们需要自定义服务器 404 时的响应，和自定义异常处理一样，我们也只需要加入一个中间件即可对 404 做统一处理：",-1),De=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/middleware/notfound_handler.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"return"),e(),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token keyword"},"function"),e(),a("span",{class:"token function"},"notFoundHandler"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("ctx"),a("span",{class:"token punctuation"},","),e(" next")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"await"),e(),a("span",{class:"token function"},"next"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token keyword"},"if"),e(),a("span",{class:"token punctuation"},"("),e("ctx"),a("span",{class:"token punctuation"},"."),e("status "),a("span",{class:"token operator"},"==="),e(),a("span",{class:"token number"},"404"),e(),a("span",{class:"token operator"},"&&"),e(),a("span",{class:"token operator"},"!"),e("ctx"),a("span",{class:"token punctuation"},"."),e("body"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n      "),a("span",{class:"token keyword"},"if"),e(),a("span",{class:"token punctuation"},"("),e("ctx"),a("span",{class:"token punctuation"},"."),e("acceptJSON"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n        ctx"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e(" error"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'Not Found'"),e(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n      "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token keyword"},"else"),e(),a("span",{class:"token punctuation"},"{"),e("\n        ctx"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token string"},"'<h1>Page Not Found</h1>'"),a("span",{class:"token punctuation"},";"),e("\n      "),a("span",{class:"token punctuation"},"}"),e("\n    "),a("span",{class:"token punctuation"},"}"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754416-19949"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/middleware/notfound_handler.js\nmodule.exports = () => {\n  return async function notFoundHandler(ctx, next) {\n    await next();\n    if (ctx.status === 404 && !ctx.body) {\n      if (ctx.acceptJSON) {\n        ctx.body = { error: 'Not Found' };\n      } else {\n        ctx.body = '<h1>Page Not Found</h1>';\n      }\n    }\n  };\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754416-19949","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br")])],-1),Fe=a("p",null,"在配置中引入中间件：",-1),Be=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// config/config.default.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  middleware"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"["),e(),a("span",{class:"token string"},"'notfoundHandler'"),e(),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754417-8144"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// config/config.default.js\nmodule.exports = {\n  middleware: [ 'notfoundHandler' ],\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754417-8144","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br")])],-1),Re=s('',6),Le=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// egg-mysql/app.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"app"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token comment"},"// 第一个参数 mysql 指定了挂载到 app 上的字段，我们可以通过 `app.mysql` 访问到 MySQL singleton 实例"),e("\n  "),a("span",{class:"token comment"},"// 第二个参数 createMysql 接受两个参数(config, app)，并返回一个 MySQL 的实例"),e("\n  app"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"addSingleton"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'mysql'"),a("span",{class:"token punctuation"},","),e(" createMysql"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n\n"),a("span",{class:"token comment"},"/**\n * @param  {Object} config   框架处理之后的配置项，如果应用配置了多个 MySQL 实例，会将每一个配置项分别传入并调用多次 createMysql\n * @param  {Application} app 当前的应用\n * @return {Object}          返回创建的 MySQL 实例\n */"),e("\n"),a("span",{class:"token keyword"},"function"),e(),a("span",{class:"token function"},"createMysql"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("config"),a("span",{class:"token punctuation"},","),e(" app")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token comment"},"// 省略。。。通过config，创建一个mysql实例"),e("\n\n  "),a("span",{class:"token keyword"},"return"),e(" client"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754417-41067"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// egg-mysql/app.js\nmodule.exports = app => {\n  // 第一个参数 mysql 指定了挂载到 app 上的字段，我们可以通过 `app.mysql` 访问到 MySQL singleton 实例\n  // 第二个参数 createMysql 接受两个参数(config, app)，并返回一个 MySQL 的实例\n  app.addSingleton('mysql', createMysql);\n}\n\n/**\n * @param  {Object} config   框架处理之后的配置项，如果应用配置了多个 MySQL 实例，会将每一个配置项分别传入并调用多次 createMysql\n * @param  {Application} app 当前的应用\n * @return {Object}          返回创建的 MySQL 实例\n */\nfunction createMysql(config, app) {\n  // 省略。。。通过config，创建一个mysql实例\n\n  return client;\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754417-41067","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br"),a("span",{class:"line-number"},"17"),a("br")])],-1),ze=a("p",null,[e("初始化方法也支持 "),a("code",null,"Async function"),e("，便于有些特殊的插件需要异步化获取一些配置文件。")],-1),Ve=a("h4",{id:"单实例"},[a("a",{class:"header-anchor",href:"#单实例","aria-hidden":"true"},"#"),e(" 单实例")],-1),He=a("ol",null,[a("li",null,"在配置文件中声明 MySQL 的配置。")],-1),Me=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// config/config.default.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  mysql"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n    client"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n      host"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'mysql.com'"),a("span",{class:"token punctuation"},","),e("\n      port"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'3306'"),a("span",{class:"token punctuation"},","),e("\n      user"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'test_user'"),a("span",{class:"token punctuation"},","),e("\n      password"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'test_password'"),a("span",{class:"token punctuation"},","),e("\n      database"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'test'"),a("span",{class:"token punctuation"},","),e("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754417-98688"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// config/config.default.js\nmodule.exports = {\n  mysql: {\n    client: {\n      host: 'mysql.com',\n      port: '3306',\n      user: 'test_user',\n      password: 'test_password',\n      database: 'test',\n    },\n  },\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754417-98688","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br")])],-1),We=a("ol",{start:"2"},[a("li",null,[e("直接通过 "),a("code",null,"app.mysql"),e(" 访问数据库。")])],-1),Oe=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/controller/post.js"),e("\n"),a("span",{class:"token keyword"},"class"),e(),a("span",{class:"token class-name"},"PostController"),e(),a("span",{class:"token keyword"},"extends"),e(),a("span",{class:"token class-name"},"Controller"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"list"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" posts "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("app"),a("span",{class:"token punctuation"},"."),e("mysql"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"query"),a("span",{class:"token punctuation"},"("),e("sql"),a("span",{class:"token punctuation"},","),e(" values"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754417-20796"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/controller/post.js\nclass PostController extends Controller {\n  async list() {\n    const posts = await this.app.mysql.query(sql, values);\n  },\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754417-20796","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br")])],-1),Ue=s('',2),Ke=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// config/config.default.js"),e("\nexports"),a("span",{class:"token punctuation"},"."),e("mysql "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  clients"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token comment"},"// clientId, access the client instance by app.mysql.get('clientId')"),e("\n    db1"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n      user"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'user1'"),a("span",{class:"token punctuation"},","),e("\n      password"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'upassword1'"),a("span",{class:"token punctuation"},","),e("\n      database"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'db1'"),a("span",{class:"token punctuation"},","),e("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n    db2"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n      user"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'user2'"),a("span",{class:"token punctuation"},","),e("\n      password"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'upassword2'"),a("span",{class:"token punctuation"},","),e("\n      database"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'db2'"),a("span",{class:"token punctuation"},","),e("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n  "),a("span",{class:"token comment"},"// default configuration for all databases"),e("\n  "),a("span",{class:"token keyword"},"default"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n    host"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'mysql.com'"),a("span",{class:"token punctuation"},","),e("\n    port"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'3306'"),a("span",{class:"token punctuation"},","),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754417-32095"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// config/config.default.js\nexports.mysql = {\n  clients: {\n    // clientId, access the client instance by app.mysql.get('clientId')\n    db1: {\n      user: 'user1',\n      password: 'upassword1',\n      database: 'db1',\n    },\n    db2: {\n      user: 'user2',\n      password: 'upassword2',\n      database: 'db2',\n    },\n  },\n  // default configuration for all databases\n  default: {\n    host: 'mysql.com',\n    port: '3306',\n  },\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754417-32095","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br"),a("span",{class:"line-number"},"17"),a("br"),a("span",{class:"line-number"},"18"),a("br"),a("span",{class:"line-number"},"19"),a("br"),a("span",{class:"line-number"},"20"),a("br"),a("span",{class:"line-number"},"21"),a("br")])],-1),Ge=a("ol",{start:"2"},[a("li",null,[e("通过 "),a("code",null,"app.mysql.get('db1')"),e(" 来获取对应的实例并使用。")])],-1),Je=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/controller/post.js"),e("\n"),a("span",{class:"token keyword"},"class"),e(),a("span",{class:"token class-name"},"PostController"),e(),a("span",{class:"token keyword"},"extends"),e(),a("span",{class:"token class-name"},"Controller"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"list"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" posts "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("app"),a("span",{class:"token punctuation"},"."),e("mysql"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"get"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'db1'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"query"),a("span",{class:"token punctuation"},"("),e("sql"),a("span",{class:"token punctuation"},","),e(" values"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754417-78477"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/controller/post.js\nclass PostController extends Controller {\n  async list() {\n    const posts = await this.app.mysql.get('db1').query(sql, values);\n  },\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754417-78477","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br")])],-1),Qe=a("h4",{id:"动态创建实例"},[a("a",{class:"header-anchor",href:"#动态创建实例","aria-hidden":"true"},"#"),e(" 动态创建实例")],-1),Ye=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"app"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  app"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"beforeStart"),a("span",{class:"token punctuation"},"("),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token comment"},"// 从配置中心获取 MySQL 的配置 { host, post, password, ... }"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" mysqlConfig "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" app"),a("span",{class:"token punctuation"},"."),e("configCenter"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"fetch"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'mysql'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token comment"},"// 动态创建 MySQL 实例"),e("\n    app"),a("span",{class:"token punctuation"},"."),e("database "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" app"),a("span",{class:"token punctuation"},"."),e("mysql"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"createInstanceAsync"),a("span",{class:"token punctuation"},"("),e("mysqlConfig"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754417-69862"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app.js\nmodule.exports = app => {\n  app.beforeStart(async () => {\n    // 从配置中心获取 MySQL 的配置 { host, post, password, ... }\n    const mysqlConfig = await app.configCenter.fetch('mysql');\n    // 动态创建 MySQL 实例\n    app.database = await app.mysql.createInstanceAsync(mysqlConfig);\n  });\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754417-69862","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br")])],-1),Xe=a("p",null,[e("通过 "),a("code",null,"app.database"),e(" 来使用这个实例。")],-1),Ze=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/controller/post.js"),e("\n"),a("span",{class:"token keyword"},"class"),e(),a("span",{class:"token class-name"},"PostController"),e(),a("span",{class:"token keyword"},"extends"),e(),a("span",{class:"token class-name"},"Controller"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"list"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" posts "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("app"),a("span",{class:"token punctuation"},"."),e("database"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"query"),a("span",{class:"token punctuation"},"("),e("sql"),a("span",{class:"token punctuation"},","),e(" values"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754417-51689"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/controller/post.js\nclass PostController extends Controller {\n  async list() {\n    const posts = await this.app.database.query(sql, values);\n  },\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754417-51689","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br")])],-1),no=s('',16),to=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(" Base "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'sdk-base'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"class"),e(),a("span",{class:"token class-name"},"Client"),e(),a("span",{class:"token keyword"},"extends"),e(),a("span",{class:"token class-name"},"Base"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token function"},"constructor"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"options"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"super"),a("span",{class:"token punctuation"},"("),e("options"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token comment"},"// 在初始化成功以后记得 ready"),e("\n    "),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"ready"),a("span",{class:"token punctuation"},"("),a("span",{class:"token boolean"},"true"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n\n  "),a("span",{class:"token comment"},"/**\n   * 订阅\n   *\n   * @param {Object} info - 订阅的信息（一个 JSON 对象，注意尽量不要包含 Function, Buffer, Date 这类属性）\n   * @param {Function} listener - 监听的回调函数，接收一个参数就是监听到的结果对象\n   */"),e("\n  "),a("span",{class:"token function"},"subscribe"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("info"),a("span",{class:"token punctuation"},","),e(" listener")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token comment"},"// ..."),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n\n  "),a("span",{class:"token comment"},"/**\n   * 发布\n   *\n   * @param {Object} info - 发布的信息，和上面 subscribe 的 info 类似\n   */"),e("\n  "),a("span",{class:"token function"},"publish"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"info"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token comment"},"// ..."),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n\n  "),a("span",{class:"token comment"},"/**\n   * 获取数据 (invoke)\n   *\n   * @param {String} id - id\n   * @return {Object} result\n   */"),e("\n  "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"getData"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"id"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token comment"},"// ..."),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754417-53948"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const Base = require('sdk-base');\n\nclass Client extends Base {\n  constructor(options) {\n    super(options);\n    // 在初始化成功以后记得 ready\n    this.ready(true);\n  }\n\n  /**\n   * 订阅\n   *\n   * @param {Object} info - 订阅的信息（一个 JSON 对象，注意尽量不要包含 Function, Buffer, Date 这类属性）\n   * @param {Function} listener - 监听的回调函数，接收一个参数就是监听到的结果对象\n   */\n  subscribe(info, listener) {\n    // ...\n  }\n\n  /**\n   * 发布\n   *\n   * @param {Object} info - 发布的信息，和上面 subscribe 的 info 类似\n   */\n  publish(info) {\n    // ...\n  }\n\n  /**\n   * 获取数据 (invoke)\n   *\n   * @param {String} id - id\n   * @return {Object} result\n   */\n  async getData(id) {\n    // ...\n  }\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754417-53948","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br"),a("span",{class:"line-number"},"17"),a("br"),a("span",{class:"line-number"},"18"),a("br"),a("span",{class:"line-number"},"19"),a("br"),a("span",{class:"line-number"},"20"),a("br"),a("span",{class:"line-number"},"21"),a("br"),a("span",{class:"line-number"},"22"),a("br"),a("span",{class:"line-number"},"23"),a("br"),a("span",{class:"line-number"},"24"),a("br"),a("span",{class:"line-number"},"25"),a("br"),a("span",{class:"line-number"},"26"),a("br"),a("span",{class:"line-number"},"27"),a("br"),a("span",{class:"line-number"},"28"),a("br"),a("span",{class:"line-number"},"29"),a("br"),a("span",{class:"line-number"},"30"),a("br"),a("span",{class:"line-number"},"31"),a("br"),a("span",{class:"line-number"},"32"),a("br"),a("span",{class:"line-number"},"33"),a("br"),a("span",{class:"line-number"},"34"),a("br"),a("span",{class:"line-number"},"35"),a("br"),a("span",{class:"line-number"},"36"),a("br"),a("span",{class:"line-number"},"37"),a("br"),a("span",{class:"line-number"},"38"),a("br")])],-1),so=a("h4",{id:"异常处理"},[a("a",{class:"header-anchor",href:"#异常处理","aria-hidden":"true"},"#"),e(" 异常处理")],-1),ao=a("ul",null,[a("li",null,"Leader 如果“死掉”会触发新一轮的端口争夺，争夺到端口的那个实例被推选为新的 Leader。"),a("li",null,"为保证 Leader 和 Follower 之间的通道健康，需要引入定时心跳检查机制，如果 Follower 在固定时间内没有发送心跳包，那么 Leader 会将 Follower 主动断开，从而触发 Follower 的重新初始化。")],-1),eo=a("h4",{id:"具体使用方法"},[a("a",{class:"header-anchor",href:"#具体使用方法","aria-hidden":"true"},"#"),e(" 具体使用方法")],-1),oo=a("p",null,"下面我用一个简单的例子，介绍在框架里面如何让一个客户端支持 Leader/Follower 模式：",-1),co=a("ul",null,[a("li",null,"第一步，我们的客户端最好是符合上面提到过的接口约定，例如：")],-1),lo=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// registry_client.js     就是进行socket的基础类"),e("\n"),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token constant"},"URL"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'url'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token keyword"},"const"),e(" Base "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'sdk-base'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"class"),e(),a("span",{class:"token class-name"},"RegistryClient"),e(),a("span",{class:"token keyword"},"extends"),e(),a("span",{class:"token class-name"},"Base"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token function"},"constructor"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"options"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"super"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),e("\n      "),a("span",{class:"token comment"},"// 指定异步启动的方法"),e("\n      initMethod"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'init'"),a("span",{class:"token punctuation"},","),e("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("_options "),a("span",{class:"token operator"},"="),e(" options"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("_registered "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"new"),e(),a("span",{class:"token class-name"},"Map"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n\n  "),a("span",{class:"token comment"},"/**\n   * 启动逻辑\n   */"),e("\n  "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"init"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"ready"),a("span",{class:"token punctuation"},"("),a("span",{class:"token boolean"},"true"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n\n  "),a("span",{class:"token comment"},"/**\n   * 获取配置\n   * @param {String} dataId - the dataId\n   * @return {Object} 配置\n   */"),e("\n  "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"getConfig"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"dataId"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"return"),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("_registered"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"get"),a("span",{class:"token punctuation"},"("),e("dataId"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n\n  "),a("span",{class:"token comment"},"/**\n   * 订阅\n   * @param {Object} reg\n   *   - {String} dataId - the dataId\n   * @param {Function}  listener - the listener\n   */"),e("\n  "),a("span",{class:"token function"},"subscribe"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("reg"),a("span",{class:"token punctuation"},","),e(" listener")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" key "),a("span",{class:"token operator"},"="),e(" reg"),a("span",{class:"token punctuation"},"."),e("dataId"),a("span",{class:"token punctuation"},";"),e("  "),a("span",{class:"token comment"},"// 时间名称"),e("\n    "),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"on"),a("span",{class:"token punctuation"},"("),e("key"),a("span",{class:"token punctuation"},","),e(" listener"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n    "),a("span",{class:"token keyword"},"const"),e(" data "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("_registered"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"get"),a("span",{class:"token punctuation"},"("),e("key"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token keyword"},"if"),e(),a("span",{class:"token punctuation"},"("),e("data"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n      process"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"nextTick"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token function"},"listener"),a("span",{class:"token punctuation"},"("),e("data"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token punctuation"},"}"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n\n  "),a("span",{class:"token comment"},"/**\n   * 发布\n   * @param {Object} reg\n   *   - {String} dataId - the dataId\n   *   - {String} publishData - the publish data\n   */"),e("\n  "),a("span",{class:"token function"},"publish"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"reg"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" key "),a("span",{class:"token operator"},"="),e(" reg"),a("span",{class:"token punctuation"},"."),e("dataId"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token keyword"},"let"),e(" changed "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token boolean"},"false"),a("span",{class:"token punctuation"},";"),e("\n\n    "),a("span",{class:"token keyword"},"if"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("_registered"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"has"),a("span",{class:"token punctuation"},"("),e("key"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n      "),a("span",{class:"token keyword"},"const"),e(" arr "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("_registered"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"get"),a("span",{class:"token punctuation"},"("),e("key"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n      "),a("span",{class:"token keyword"},"if"),e(),a("span",{class:"token punctuation"},"("),e("arr"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"indexOf"),a("span",{class:"token punctuation"},"("),e("reg"),a("span",{class:"token punctuation"},"."),e("publishData"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"==="),e(),a("span",{class:"token operator"},"-"),a("span",{class:"token number"},"1"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n        changed "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token boolean"},"true"),a("span",{class:"token punctuation"},";"),e("\n        arr"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"push"),a("span",{class:"token punctuation"},"("),e("reg"),a("span",{class:"token punctuation"},"."),e("publishData"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n      "),a("span",{class:"token punctuation"},"}"),e("\n    "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token keyword"},"else"),e(),a("span",{class:"token punctuation"},"{"),e("\n      changed "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token boolean"},"true"),a("span",{class:"token punctuation"},";"),e("\n      "),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("_registered"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"set"),a("span",{class:"token punctuation"},"("),e("key"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token punctuation"},"["),e("reg"),a("span",{class:"token punctuation"},"."),e("publishData"),a("span",{class:"token punctuation"},"]"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token punctuation"},"}"),e("\n    "),a("span",{class:"token keyword"},"if"),e(),a("span",{class:"token punctuation"},"("),e("changed"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n      "),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"emit"),a("span",{class:"token punctuation"},"("),e("key"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("_registered"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"get"),a("span",{class:"token punctuation"},"("),e("key"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"map"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"url"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token constant"},"URL"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"parse"),a("span",{class:"token punctuation"},"("),e("url"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token boolean"},"true"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token punctuation"},"}"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n\nmodule"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(" RegistryClient"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754418-15752"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// registry_client.js     就是进行socket的基础类\nconst URL = require('url');\nconst Base = require('sdk-base');\n\nclass RegistryClient extends Base {\n  constructor(options) {\n    super({\n      // 指定异步启动的方法\n      initMethod: 'init',\n    });\n    this._options = options;\n    this._registered = new Map();\n  }\n\n  /**\n   * 启动逻辑\n   */\n  async init() {\n    this.ready(true);\n  }\n\n  /**\n   * 获取配置\n   * @param {String} dataId - the dataId\n   * @return {Object} 配置\n   */\n  async getConfig(dataId) {\n    return this._registered.get(dataId);\n  }\n\n  /**\n   * 订阅\n   * @param {Object} reg\n   *   - {String} dataId - the dataId\n   * @param {Function}  listener - the listener\n   */\n  subscribe(reg, listener) {\n    const key = reg.dataId;  // 时间名称\n    this.on(key, listener);\n\n    const data = this._registered.get(key);\n    if (data) {\n      process.nextTick(() => listener(data));\n    }\n  }\n\n  /**\n   * 发布\n   * @param {Object} reg\n   *   - {String} dataId - the dataId\n   *   - {String} publishData - the publish data\n   */\n  publish(reg) {\n    const key = reg.dataId;\n    let changed = false;\n\n    if (this._registered.has(key)) {\n      const arr = this._registered.get(key);\n      if (arr.indexOf(reg.publishData) === -1) {\n        changed = true;\n        arr.push(reg.publishData);\n      }\n    } else {\n      changed = true;\n      this._registered.set(key, [reg.publishData]);\n    }\n    if (changed) {\n      this.emit(key, this._registered.get(key).map(url => URL.parse(url, true)));\n    }\n  }\n}\n\nmodule.exports = RegistryClient;\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754418-15752","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br"),a("span",{class:"line-number"},"17"),a("br"),a("span",{class:"line-number"},"18"),a("br"),a("span",{class:"line-number"},"19"),a("br"),a("span",{class:"line-number"},"20"),a("br"),a("span",{class:"line-number"},"21"),a("br"),a("span",{class:"line-number"},"22"),a("br"),a("span",{class:"line-number"},"23"),a("br"),a("span",{class:"line-number"},"24"),a("br"),a("span",{class:"line-number"},"25"),a("br"),a("span",{class:"line-number"},"26"),a("br"),a("span",{class:"line-number"},"27"),a("br"),a("span",{class:"line-number"},"28"),a("br"),a("span",{class:"line-number"},"29"),a("br"),a("span",{class:"line-number"},"30"),a("br"),a("span",{class:"line-number"},"31"),a("br"),a("span",{class:"line-number"},"32"),a("br"),a("span",{class:"line-number"},"33"),a("br"),a("span",{class:"line-number"},"34"),a("br"),a("span",{class:"line-number"},"35"),a("br"),a("span",{class:"line-number"},"36"),a("br"),a("span",{class:"line-number"},"37"),a("br"),a("span",{class:"line-number"},"38"),a("br"),a("span",{class:"line-number"},"39"),a("br"),a("span",{class:"line-number"},"40"),a("br"),a("span",{class:"line-number"},"41"),a("br"),a("span",{class:"line-number"},"42"),a("br"),a("span",{class:"line-number"},"43"),a("br"),a("span",{class:"line-number"},"44"),a("br"),a("span",{class:"line-number"},"45"),a("br"),a("span",{class:"line-number"},"46"),a("br"),a("span",{class:"line-number"},"47"),a("br"),a("span",{class:"line-number"},"48"),a("br"),a("span",{class:"line-number"},"49"),a("br"),a("span",{class:"line-number"},"50"),a("br"),a("span",{class:"line-number"},"51"),a("br"),a("span",{class:"line-number"},"52"),a("br"),a("span",{class:"line-number"},"53"),a("br"),a("span",{class:"line-number"},"54"),a("br"),a("span",{class:"line-number"},"55"),a("br"),a("span",{class:"line-number"},"56"),a("br"),a("span",{class:"line-number"},"57"),a("br"),a("span",{class:"line-number"},"58"),a("br"),a("span",{class:"line-number"},"59"),a("br"),a("span",{class:"line-number"},"60"),a("br"),a("span",{class:"line-number"},"61"),a("br"),a("span",{class:"line-number"},"62"),a("br"),a("span",{class:"line-number"},"63"),a("br"),a("span",{class:"line-number"},"64"),a("br"),a("span",{class:"line-number"},"65"),a("br"),a("span",{class:"line-number"},"66"),a("br"),a("span",{class:"line-number"},"67"),a("br"),a("span",{class:"line-number"},"68"),a("br"),a("span",{class:"line-number"},"69"),a("br"),a("span",{class:"line-number"},"70"),a("br"),a("span",{class:"line-number"},"71"),a("br"),a("span",{class:"line-number"},"72"),a("br"),a("span",{class:"line-number"},"73"),a("br")])],-1),po=a("ul",null,[a("li",null,[e("第二步，使用 "),a("code",null,"agent.cluster"),e(" 接口对 "),a("code",null,"RegistryClient"),e(" 进行封装：")])],-1),io=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// agent.js"),e("\n"),a("span",{class:"token keyword"},"const"),e(" RegistryClient "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'registry_client'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"agent"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token comment"},"// 对 RegistryClient 进行封装和实例化"),e("\n  agent"),a("span",{class:"token punctuation"},"."),e("registryClient "),a("span",{class:"token operator"},"="),e(" agent"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"cluster"),a("span",{class:"token punctuation"},"("),e("RegistryClient"),a("span",{class:"token punctuation"},")"),e("\n    "),a("span",{class:"token comment"},"// create 方法的参数就是 RegistryClient 构造函数的参数"),e("\n    "),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"create"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n  agent"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"beforeStart"),a("span",{class:"token punctuation"},"("),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"await"),e(" agent"),a("span",{class:"token punctuation"},"."),e("registryClient"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"ready"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    agent"),a("span",{class:"token punctuation"},"."),e("coreLogger"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"info"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'registry client is ready'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754418-20759"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// agent.js\nconst RegistryClient = require('registry_client');\n\nmodule.exports = agent => {\n  // 对 RegistryClient 进行封装和实例化\n  agent.registryClient = agent.cluster(RegistryClient)\n    // create 方法的参数就是 RegistryClient 构造函数的参数\n    .create({});\n\n  agent.beforeStart(async () => {\n    await agent.registryClient.ready();\n    agent.coreLogger.info('registry client is ready');\n  });\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754418-20759","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br")])],-1),ro=a("ul",null,[a("li",null,[e("第三步，使用 "),a("code",null,"app.cluster"),e(" 接口对 "),a("code",null,"RegistryClient"),e(" 进行封装：")])],-1),uo=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(" RegistryClient "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'registry_client'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"app"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  app"),a("span",{class:"token punctuation"},"."),e("registryClient "),a("span",{class:"token operator"},"="),e(" app"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"cluster"),a("span",{class:"token punctuation"},"("),e("RegistryClient"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"create"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  app"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"beforeStart"),a("span",{class:"token punctuation"},"("),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"await"),e(" app"),a("span",{class:"token punctuation"},"."),e("registryClient"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"ready"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    app"),a("span",{class:"token punctuation"},"."),e("coreLogger"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"info"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'registry client is ready'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n    "),a("span",{class:"token comment"},"// 调用 subscribe 进行订阅"),e("\n    app"),a("span",{class:"token punctuation"},"."),e("registryClient"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"subscribe"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),e("\n      dataId"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'demo.DemoService'"),a("span",{class:"token punctuation"},","),e("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token parameter"},"val"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n      "),a("span",{class:"token comment"},"// ..."),e("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n    "),a("span",{class:"token comment"},"// 调用 publish 发布数据"),e("\n    app"),a("span",{class:"token punctuation"},"."),e("registryClient"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"publish"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),e("\n      dataId"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'demo.DemoService'"),a("span",{class:"token punctuation"},","),e("\n      publishData"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'xxx'"),a("span",{class:"token punctuation"},","),e("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n    "),a("span",{class:"token comment"},"// 调用 getConfig 接口"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" res "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" app"),a("span",{class:"token punctuation"},"."),e("registryClient"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"getConfig"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'demo.DemoService'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),e("res"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754418-90610"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const RegistryClient = require('registry_client');\n\nmodule.exports = app => {\n  app.registryClient = app.cluster(RegistryClient).create({});\n  app.beforeStart(async () => {\n    await app.registryClient.ready();\n    app.coreLogger.info('registry client is ready');\n\n    // 调用 subscribe 进行订阅\n    app.registryClient.subscribe({\n      dataId: 'demo.DemoService',\n    }, val => {\n      // ...\n    });\n\n    // 调用 publish 发布数据\n    app.registryClient.publish({\n      dataId: 'demo.DemoService',\n      publishData: 'xxx',\n    });\n\n    // 调用 getConfig 接口\n    const res = await app.registryClient.getConfig('demo.DemoService');\n    console.log(res);\n  });\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754418-90610","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br"),a("span",{class:"line-number"},"17"),a("br"),a("span",{class:"line-number"},"18"),a("br"),a("span",{class:"line-number"},"19"),a("br"),a("span",{class:"line-number"},"20"),a("br"),a("span",{class:"line-number"},"21"),a("br"),a("span",{class:"line-number"},"22"),a("br"),a("span",{class:"line-number"},"23"),a("br"),a("span",{class:"line-number"},"24"),a("br"),a("span",{class:"line-number"},"25"),a("br"),a("span",{class:"line-number"},"26"),a("br")])],-1),mo=s('',10),ko=a("div",{class:"language-"},[a("pre",null,[a("code",null,"npm install mongoose\n"),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754418-45111"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"npm install mongoose\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754418-45111","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br")])],-1),bo=a("h5",{id:"连接"},[a("a",{class:"header-anchor",href:"#连接","aria-hidden":"true"},"#"),e(" 连接")],-1),yo=a("div",{class:"language-javascript line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"var"),e(" mongoose "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'mongoose'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\nmongoose"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"connect"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'mongodb://localhost/test'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754418-7296"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"var mongoose = require('mongoose');\nmongoose.connect('mongodb://localhost/test');\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754418-7296","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br")])],-1),ho=a("h5",{id:"快速开始"},[a("a",{class:"header-anchor",href:"#快速开始","aria-hidden":"true"},"#"),e(" 快速开始")],-1),fo=a("p",null,[e("Mongoose 里，一切都始于"),a("a",{href:"https://mongoosedoc.top/docs/guide.html",target:"_blank",rel:"noopener noreferrer"},"Schema"),e("。 现在我们来看一个例子：")],-1),go=a("ul",null,[a("li",null,[a("p",null,"schema是对数据模型的描述"),a("p",null,"对应数据库存储的字段")])],-1),Co=a("div",{class:"language-javascript line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"var"),e(" postsSchema "),a("span",{class:"token operator"},"="),e(" mongoose"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"Schema"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),e(),a("span",{class:"token comment"},"// 对文章的描述"),e("\n  title"),a("span",{class:"token operator"},":"),e(" String"),a("span",{class:"token punctuation"},","),e("\n  content"),a("span",{class:"token operator"},":"),e(" String\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754418-2695"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"var postsSchema = mongoose.Schema({ // 对文章的描述\n  title: String,\n  content: String\n});\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754418-2695","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br")])],-1),xo=a("p",null,[e("很好，我们得到了一个带有 "),a("code",null,"String"),e(" 类型 "),a("code",null,"name"),e(" 属性的 schema 。 接着我们需要把这个 schema 编译成一个 "),a("a",{href:"https://mongoosedoc.top/docs/models.html",target:"_blank",rel:"noopener noreferrer"},"Model"),e("：")],-1),vo=a("div",{class:"language-javascript line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"var"),e(" Posts "),a("span",{class:"token operator"},"="),e(" mongoose"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"model"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'posts'"),a("span",{class:"token punctuation"},","),e(" postsSchema"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754419-84186"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"var Posts = mongoose.model('posts', postsSchema);\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754419-84186","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br")])],-1),wo=a("p",null,"model 是我们构造 document 的 Class。 在例子中，每个 document 都是一篇文章，它的属性和行为都会被声明在 schema。 现在我们来“创造”一篇文章：",-1),jo=a("div",{class:"language-javascript line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"var"),e(" a_news "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"new"),e(),a("span",{class:"token class-name"},"Posts"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),e(" title"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'xxx'"),a("span",{class:"token punctuation"},","),e(" content"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'xxx'"),e(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754419-26410"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"var a_news = new Posts({ title: 'xxx', content: 'xxx' });\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754419-26410","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br")])],-1),_o=a("p",null,[e("emmmmm虽然我们还没吧它存到数据库里。 每个 document 会在调用他的 "),a("a",{href:"https://mongoosedoc.top/docs/api.html#model_Model-save",target:"_blank",rel:"noopener noreferrer"},"save"),e(" 方法后保存到数据库。 注意回调函数的第一个参数永远是 error 。")],-1),To=a("div",{class:"language-javascript line-numbers-mode"},[a("pre",null,[a("code",null,[e("  a_news"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"save"),a("span",{class:"token punctuation"},"("),a("span",{class:"token keyword"},"function"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("err"),a("span",{class:"token punctuation"},","),e(" fluffy")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"if"),e(),a("span",{class:"token punctuation"},"("),e("err"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token keyword"},"return"),e(" console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"error"),a("span",{class:"token punctuation"},"("),e("err"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754419-79655"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"  a_news.save(function (err, fluffy) {\n    if (err) return console.error(err);\n  });\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754419-79655","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br")])],-1),$o=a("p",null,[e("后来我们收集了好多喵，就可以通过以下方法获取喵星人 "),a("a",{href:"https://mongoosedoc.top/docs/models.html",target:"_blank",rel:"noopener noreferrer"},"model"),e(" 里的所有数据：")],-1),Io=a("div",{class:"language-javascript line-numbers-mode"},[a("pre",null,[a("code",null,[e("Posts"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"find"),a("span",{class:"token punctuation"},"("),a("span",{class:"token keyword"},"function"),e(),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("err"),a("span",{class:"token punctuation"},","),e(" kittens")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"if"),e(),a("span",{class:"token punctuation"},"("),e("err"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token keyword"},"return"),e(" console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"error"),a("span",{class:"token punctuation"},"("),e("err"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  console"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"log"),a("span",{class:"token punctuation"},"("),e("kittens"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754419-69452"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"Posts.find(function (err, kittens) {\n  if (err) return console.error(err);\n  console.log(kittens);\n})\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754419-69452","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br")])],-1),Eo=a("p",null,[e("如果我们想获取特定的数据， 可以了解一下 "),a("a",{href:"https://mongoosedoc.top/docs/queries.html",target:"_blank",rel:"noopener noreferrer"},"query"),e("。")],-1),No=a("div",{class:"language-javascript line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},'// 这么写可以获取所有 name 为 "book" 开头的数据'),e("\nPosts"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"find"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),e(" name"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token regex"},[a("span",{class:"token regex-delimiter"},"/"),a("span",{class:"token regex-source language-regex"},"^book"),a("span",{class:"token regex-delimiter"},"/")]),e(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e(" callback"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754419-99871"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'// 这么写可以获取所有 name 为 "book" 开头的数据\nPosts.find({ name: /^book/ }, callback);\n',"data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754419-99871","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br")])],-1),Ao=s('',7),Po=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// config/plugin.js"),e("\nmongoose"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n    enable"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token boolean"},"true"),a("span",{class:"token punctuation"},","),e("\n    "),a("span",{class:"token keyword"},"package"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'egg-mongoose'"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754419-38259"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// config/plugin.js\nmongoose: {\n    enable: true,\n    package: 'egg-mongoose',\n},\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754419-38259","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br")])],-1),qo=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// config/config.default.js"),e("\nconfig"),a("span",{class:"token punctuation"},"."),e("mongoose "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  url"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'mongodb://127.0.0.1/example'"),a("span",{class:"token punctuation"},","),e("\n  options"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754419-19781"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// config/config.default.js\nconfig.mongoose = {\n  url: 'mongodb://127.0.0.1/example',\n  options: {},\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754419-19781","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br")])],-1),So=a("h5",{id:"路由配置"},[a("a",{class:"header-anchor",href:"#路由配置","aria-hidden":"true"},"#"),e(" 路由配置")],-1),Do=a("ol",null,[a("li",null,"解析用户请求，给相应的controller"),a("li",null,"通过resources 直接创建restFul api")],-1),Fo=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// app/router.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"app"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token punctuation"},"{"),e(" router"),a("span",{class:"token punctuation"},","),e(" controller "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token operator"},"="),e(" app"),a("span",{class:"token punctuation"},";"),e("\n  router"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"resources"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'posts'"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token string"},"'/api/posts'"),a("span",{class:"token punctuation"},","),e("controller"),a("span",{class:"token punctuation"},"."),e("posts"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754419-92628"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// app/router.js\nmodule.exports = app => {\n  const { router, controller } = app;\n  router.resources('posts', '/api/posts',controller.posts);\n};\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754419-92628","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br")])],-1),Bo=a("h5",{id:"控制器-1"},[a("a",{class:"header-anchor",href:"#控制器-1","aria-hidden":"true"},"#"),e(" 控制器")],-1),Ro=a("ol",null,[a("li",null,"解析request参数"),a("li",null,"校验参数"),a("li",null,"调用service"),a("li",null,"返回结果")],-1),Lo=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token string"},"'use strict'"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token comment"},"// const Controller = require('egg').Controller;"),e("\n\n"),a("span",{class:"token keyword"},"const"),e(" httpController "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'./base/http'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token comment"},"// GET /posts -> app.controller.posts.index"),e("\n"),a("span",{class:"token comment"},"// GET /posts/new -> app.controller.posts.new"),e("\n"),a("span",{class:"token comment"},"// GET /posts/:id -> app.controller.posts.show"),e("\n"),a("span",{class:"token comment"},"// GET /posts/:id/edit -> app.controller.posts.edit"),e("\n"),a("span",{class:"token comment"},"// POST /posts -> app.controller.posts.create"),e("\n"),a("span",{class:"token comment"},"// PUT /posts/:id -> app.controller.posts.update"),e("\n"),a("span",{class:"token comment"},"// DELETE /posts/:id -> app.controller.posts.destroy"),e("\n\n"),a("span",{class:"token keyword"},"const"),e(" createRule "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("  "),a("span",{class:"token comment"},"// 参数校验"),e("\n  title"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e(" type"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'string'"),e(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n  content"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e(" type"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'string'"),e(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n\n"),a("span",{class:"token keyword"},"const"),e(" updateRule "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n  title"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e(" type"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'string'"),a("span",{class:"token punctuation"},","),e(" required"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token boolean"},"false"),e(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n  content"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e(" type"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token string"},"'string'"),a("span",{class:"token punctuation"},","),e(" required"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token boolean"},"false"),e(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n\n"),a("span",{class:"token keyword"},"class"),e(),a("span",{class:"token class-name"},"PostsController"),e(),a("span",{class:"token keyword"},"extends"),e(),a("span",{class:"token class-name"},"httpController"),e(),a("span",{class:"token punctuation"},"{"),e("\n  "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"create"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e(),a("span",{class:"token comment"},"// 创建文章"),e("\n    "),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token punctuation"},"{"),e(" ctx "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},";"),e("\n\n    "),a("span",{class:"token keyword"},"const"),e(" requestBody "),a("span",{class:"token operator"},"="),e(" ctx"),a("span",{class:"token punctuation"},"."),e("request"),a("span",{class:"token punctuation"},"."),e("body"),a("span",{class:"token punctuation"},";"),e("\n\n    "),a("span",{class:"token keyword"},"try"),e(),a("span",{class:"token punctuation"},"{"),e("\n      "),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("ctx"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"validate"),a("span",{class:"token punctuation"},"("),e("createRule"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n      "),a("span",{class:"token keyword"},"const"),e(" res "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" ctx"),a("span",{class:"token punctuation"},"."),e("service"),a("span",{class:"token punctuation"},"."),e("posts"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"create"),a("span",{class:"token punctuation"},"("),e("requestBody"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n      "),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"success"),a("span",{class:"token punctuation"},"("),e("res"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token keyword"},"catch"),e(),a("span",{class:"token punctuation"},"("),e("err"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n      "),a("span",{class:"token comment"},"// console.log('=======', err)"),e("\n      "),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"fail"),a("span",{class:"token punctuation"},"("),e("err"),a("span",{class:"token punctuation"},")"),e("\n    "),a("span",{class:"token punctuation"},"}"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n\n  "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"index"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),a("span",{class:"token comment"},"// 读取所有文章"),e("\n    "),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token punctuation"},"{"),e(" ctx "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},";"),e("\n    ctx"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" ctx"),a("span",{class:"token punctuation"},"."),e("service"),a("span",{class:"token punctuation"},"."),e("posts"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"find"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n\n  "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"show"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token punctuation"},"{"),e(" ctx "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},";"),e("\n\n    "),a("span",{class:"token keyword"},"try"),e(),a("span",{class:"token punctuation"},"{"),e("\n      "),a("span",{class:"token keyword"},"const"),e(" params_id "),a("span",{class:"token operator"},"="),e(" ctx"),a("span",{class:"token punctuation"},"."),e("params"),a("span",{class:"token punctuation"},"."),e("id"),a("span",{class:"token punctuation"},";"),e("\n      "),a("span",{class:"token keyword"},"const"),e(" res "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" ctx"),a("span",{class:"token punctuation"},"."),e("service"),a("span",{class:"token punctuation"},"."),e("posts"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"find"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),e("\n        _id"),a("span",{class:"token operator"},":"),e(" params_id\n      "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n      "),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"success"),a("span",{class:"token punctuation"},"("),e("res"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token keyword"},"catch"),e(),a("span",{class:"token punctuation"},"("),e("err"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n      "),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"fail"),a("span",{class:"token punctuation"},"("),e("err"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token punctuation"},"}"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n\n  "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"update"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("  "),a("span",{class:"token comment"},"// 更新文章"),e("\n    "),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token punctuation"},"{"),e(" ctx "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token comment"},"// console.log('================', ctx.request.body)"),e("\n    "),a("span",{class:"token keyword"},"try"),e(),a("span",{class:"token punctuation"},"{"),e("\n      "),a("span",{class:"token keyword"},"const"),e(" params_id "),a("span",{class:"token operator"},"="),e(" ctx"),a("span",{class:"token punctuation"},"."),e("params"),a("span",{class:"token punctuation"},"."),e("id"),a("span",{class:"token punctuation"},";"),e("\n      "),a("span",{class:"token keyword"},"const"),e(" requestBody "),a("span",{class:"token operator"},"="),e(" ctx"),a("span",{class:"token punctuation"},"."),e("request"),a("span",{class:"token punctuation"},"."),e("body"),a("span",{class:"token punctuation"},";"),e("\n      ctx"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"validate"),a("span",{class:"token punctuation"},"("),e("updateRule"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n      "),a("span",{class:"token keyword"},"const"),e(" res "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" ctx"),a("span",{class:"token punctuation"},"."),e("service"),a("span",{class:"token punctuation"},"."),e("posts"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"update"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),e("\n        _id"),a("span",{class:"token operator"},":"),e(" params_id"),a("span",{class:"token punctuation"},","),e("\n      "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e(),a("span",{class:"token punctuation"},"{"),e("\n          $set"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e("\n            "),a("span",{class:"token operator"},"..."),e("requestBody\n          "),a("span",{class:"token punctuation"},"}"),e("\n        "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n      "),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"success"),a("span",{class:"token punctuation"},"("),e("res"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token keyword"},"catch"),e(),a("span",{class:"token punctuation"},"("),e("err"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n      "),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"fail"),a("span",{class:"token punctuation"},"("),e("err"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token punctuation"},"}"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n\n  "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"destroy"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e(),a("span",{class:"token comment"},"// 删除文章"),e("\n\n    "),a("span",{class:"token keyword"},"const"),e(),a("span",{class:"token punctuation"},"{"),e(" ctx "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},";"),e("\n\n    "),a("span",{class:"token comment"},"// console.log('------------', ctx.model);"),e("\n    "),a("span",{class:"token keyword"},"try"),e(),a("span",{class:"token punctuation"},"{"),e("\n      "),a("span",{class:"token keyword"},"const"),e(" params_id "),a("span",{class:"token operator"},"="),e(" ctx"),a("span",{class:"token punctuation"},"."),e("params"),a("span",{class:"token punctuation"},"."),e("id"),a("span",{class:"token punctuation"},";"),e("\n      "),a("span",{class:"token keyword"},"const"),e(" res "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" ctx"),a("span",{class:"token punctuation"},"."),e("service"),a("span",{class:"token punctuation"},"."),e("posts"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"remove"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),e("\n        _id"),a("span",{class:"token operator"},":"),e(" params_id\n      "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n      "),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"success"),a("span",{class:"token punctuation"},"("),e("res"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token punctuation"},"}"),e(),a("span",{class:"token keyword"},"catch"),e(),a("span",{class:"token punctuation"},"("),e("err"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n      "),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"fail"),a("span",{class:"token punctuation"},"("),e("err"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token punctuation"},"}"),e("\n  "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n\nmodule"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(" PostsController"),a("span",{class:"token punctuation"},";"),e("\n\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754419-78643"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"'use strict';\n\n// const Controller = require('egg').Controller;\n\nconst httpController = require('./base/http');\n// GET /posts -> app.controller.posts.index\n// GET /posts/new -> app.controller.posts.new\n// GET /posts/:id -> app.controller.posts.show\n// GET /posts/:id/edit -> app.controller.posts.edit\n// POST /posts -> app.controller.posts.create\n// PUT /posts/:id -> app.controller.posts.update\n// DELETE /posts/:id -> app.controller.posts.destroy\n\nconst createRule = {  // 参数校验\n  title: { type: 'string' },\n  content: { type: 'string' },\n}\n\nconst updateRule = {\n  title: { type: 'string', required: false },\n  content: { type: 'string', required: false },\n}\n\nclass PostsController extends httpController {\n  async create() { // 创建文章\n    const { ctx } = this;\n\n    const requestBody = ctx.request.body;\n\n    try {\n      this.ctx.validate(createRule);\n      const res = await ctx.service.posts.create(requestBody);\n      this.success(res);\n    } catch (err) {\n      // console.log('=======', err)\n      this.fail(err)\n    }\n  }\n\n  async index() {// 读取所有文章\n    const { ctx } = this;\n    ctx.body = await ctx.service.posts.find({});\n  }\n\n  async show() {\n    const { ctx } = this;\n\n    try {\n      const params_id = ctx.params.id;\n      const res = await ctx.service.posts.find({\n        _id: params_id\n      });\n      this.success(res);\n    } catch (err) {\n      this.fail(err);\n    }\n  }\n\n  async update() {  // 更新文章\n    const { ctx } = this;\n    // console.log('================', ctx.request.body)\n    try {\n      const params_id = ctx.params.id;\n      const requestBody = ctx.request.body;\n      ctx.validate(updateRule);\n\n      const res = await ctx.service.posts.update({\n        _id: params_id,\n      }, {\n          $set: {\n            ...requestBody\n          }\n        });\n      this.success(res);\n    } catch (err) {\n      this.fail(err);\n    }\n  }\n\n  async destroy() { // 删除文章\n\n    const { ctx } = this;\n\n    // console.log('------------', ctx.model);\n    try {\n      const params_id = ctx.params.id;\n      const res = await ctx.service.posts.remove({\n        _id: params_id\n      });\n      this.success(res);\n    } catch (err) {\n      this.fail(err);\n    }\n  }\n}\n\nmodule.exports = PostsController;\n\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754419-78643","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br"),a("span",{class:"line-number"},"17"),a("br"),a("span",{class:"line-number"},"18"),a("br"),a("span",{class:"line-number"},"19"),a("br"),a("span",{class:"line-number"},"20"),a("br"),a("span",{class:"line-number"},"21"),a("br"),a("span",{class:"line-number"},"22"),a("br"),a("span",{class:"line-number"},"23"),a("br"),a("span",{class:"line-number"},"24"),a("br"),a("span",{class:"line-number"},"25"),a("br"),a("span",{class:"line-number"},"26"),a("br"),a("span",{class:"line-number"},"27"),a("br"),a("span",{class:"line-number"},"28"),a("br"),a("span",{class:"line-number"},"29"),a("br"),a("span",{class:"line-number"},"30"),a("br"),a("span",{class:"line-number"},"31"),a("br"),a("span",{class:"line-number"},"32"),a("br"),a("span",{class:"line-number"},"33"),a("br"),a("span",{class:"line-number"},"34"),a("br"),a("span",{class:"line-number"},"35"),a("br"),a("span",{class:"line-number"},"36"),a("br"),a("span",{class:"line-number"},"37"),a("br"),a("span",{class:"line-number"},"38"),a("br"),a("span",{class:"line-number"},"39"),a("br"),a("span",{class:"line-number"},"40"),a("br"),a("span",{class:"line-number"},"41"),a("br"),a("span",{class:"line-number"},"42"),a("br"),a("span",{class:"line-number"},"43"),a("br"),a("span",{class:"line-number"},"44"),a("br"),a("span",{class:"line-number"},"45"),a("br"),a("span",{class:"line-number"},"46"),a("br"),a("span",{class:"line-number"},"47"),a("br"),a("span",{class:"line-number"},"48"),a("br"),a("span",{class:"line-number"},"49"),a("br"),a("span",{class:"line-number"},"50"),a("br"),a("span",{class:"line-number"},"51"),a("br"),a("span",{class:"line-number"},"52"),a("br"),a("span",{class:"line-number"},"53"),a("br"),a("span",{class:"line-number"},"54"),a("br"),a("span",{class:"line-number"},"55"),a("br"),a("span",{class:"line-number"},"56"),a("br"),a("span",{class:"line-number"},"57"),a("br"),a("span",{class:"line-number"},"58"),a("br"),a("span",{class:"line-number"},"59"),a("br"),a("span",{class:"line-number"},"60"),a("br"),a("span",{class:"line-number"},"61"),a("br"),a("span",{class:"line-number"},"62"),a("br"),a("span",{class:"line-number"},"63"),a("br"),a("span",{class:"line-number"},"64"),a("br"),a("span",{class:"line-number"},"65"),a("br"),a("span",{class:"line-number"},"66"),a("br"),a("span",{class:"line-number"},"67"),a("br"),a("span",{class:"line-number"},"68"),a("br"),a("span",{class:"line-number"},"69"),a("br"),a("span",{class:"line-number"},"70"),a("br"),a("span",{class:"line-number"},"71"),a("br"),a("span",{class:"line-number"},"72"),a("br"),a("span",{class:"line-number"},"73"),a("br"),a("span",{class:"line-number"},"74"),a("br"),a("span",{class:"line-number"},"75"),a("br"),a("span",{class:"line-number"},"76"),a("br"),a("span",{class:"line-number"},"77"),a("br"),a("span",{class:"line-number"},"78"),a("br"),a("span",{class:"line-number"},"79"),a("br"),a("span",{class:"line-number"},"80"),a("br"),a("span",{class:"line-number"},"81"),a("br"),a("span",{class:"line-number"},"82"),a("br"),a("span",{class:"line-number"},"83"),a("br"),a("span",{class:"line-number"},"84"),a("br"),a("span",{class:"line-number"},"85"),a("br"),a("span",{class:"line-number"},"86"),a("br"),a("span",{class:"line-number"},"87"),a("br"),a("span",{class:"line-number"},"88"),a("br"),a("span",{class:"line-number"},"89"),a("br"),a("span",{class:"line-number"},"90"),a("br"),a("span",{class:"line-number"},"91"),a("br"),a("span",{class:"line-number"},"92"),a("br"),a("span",{class:"line-number"},"93"),a("br"),a("span",{class:"line-number"},"94"),a("br"),a("span",{class:"line-number"},"95"),a("br"),a("span",{class:"line-number"},"96"),a("br"),a("span",{class:"line-number"},"97"),a("br"),a("span",{class:"line-number"},"98"),a("br")])],-1),zo=a("h5",{id:"base-controller"},[a("a",{class:"header-anchor",href:"#base-controller","aria-hidden":"true"},"#"),e(" base controller")],-1),Vo=a("ol",null,[a("li",null,"对controller的一种抽象"),a("li",null,"抽取通用逻辑")],-1),Ho=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// controller/base/http.js"),e("\n"),a("span",{class:"token string"},"'use strict'"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"const"),e(" Controller "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'egg'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),e("Controller"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"class"),e(),a("span",{class:"token class-name"},"HttpController"),e(),a("span",{class:"token keyword"},"extends"),e(),a("span",{class:"token class-name"},"Controller"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token function"},"success"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"data"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n        "),a("span",{class:"token comment"},"// msg 和 code这样的2个字段 在所有的请求里面都需要返回。"),e("\n        "),a("span",{class:"token comment"},"// 好好理解oop"),e("\n        "),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("ctx"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n            msg"),a("span",{class:"token operator"},":"),e(" data "),a("span",{class:"token operator"},"&&"),e(" data"),a("span",{class:"token punctuation"},"."),e("msg "),a("span",{class:"token operator"},"||"),e(),a("span",{class:"token string"},"'success'"),a("span",{class:"token punctuation"},","),e("\n            code"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token number"},"0"),a("span",{class:"token punctuation"},","),e("\n            data\n        "),a("span",{class:"token punctuation"},"}"),e("\n    "),a("span",{class:"token punctuation"},"}"),e("\n\n    "),a("span",{class:"token function"},"fail"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"data"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("\n        "),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("logger"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"error"),a("span",{class:"token punctuation"},"("),e("data"),a("span",{class:"token punctuation"},")"),e("\n        "),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("ctx"),a("span",{class:"token punctuation"},"."),e("body "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token punctuation"},"{"),e("\n            msg"),a("span",{class:"token operator"},":"),e(" data "),a("span",{class:"token operator"},"&&"),e(" data"),a("span",{class:"token punctuation"},"."),e("msg "),a("span",{class:"token operator"},"||"),e(),a("span",{class:"token string"},"'fail'"),a("span",{class:"token punctuation"},","),e("\n            code"),a("span",{class:"token operator"},":"),e(" data "),a("span",{class:"token operator"},"&&"),e(" data"),a("span",{class:"token punctuation"},"."),e("code "),a("span",{class:"token operator"},"||"),e(),a("span",{class:"token number"},"1"),a("span",{class:"token punctuation"},","),e("\n            data\n        "),a("span",{class:"token punctuation"},"}"),e("\n    "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n\nmodule"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(" HttpController"),a("span",{class:"token punctuation"},";"),e("\n\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754420-56740"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// controller/base/http.js\n'use strict';\n\nconst Controller = require('egg').Controller;\n\nclass HttpController extends Controller {\n    success(data) {\n        // msg 和 code这样的2个字段 在所有的请求里面都需要返回。\n        // 好好理解oop\n        this.ctx.body = {\n            msg: data && data.msg || 'success',\n            code: 0,\n            data\n        }\n    }\n\n    fail(data) {\n        this.logger.error(data)\n        this.ctx.body = {\n            msg: data && data.msg || 'fail',\n            code: data && data.code || 1,\n            data\n        }\n    }\n}\n\nmodule.exports = HttpController;\n\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754420-56740","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br"),a("span",{class:"line-number"},"17"),a("br"),a("span",{class:"line-number"},"18"),a("br"),a("span",{class:"line-number"},"19"),a("br"),a("span",{class:"line-number"},"20"),a("br"),a("span",{class:"line-number"},"21"),a("br"),a("span",{class:"line-number"},"22"),a("br"),a("span",{class:"line-number"},"23"),a("br"),a("span",{class:"line-number"},"24"),a("br"),a("span",{class:"line-number"},"25"),a("br"),a("span",{class:"line-number"},"26"),a("br"),a("span",{class:"line-number"},"27"),a("br"),a("span",{class:"line-number"},"28"),a("br")])],-1),Mo=a("h5",{id:"model"},[a("a",{class:"header-anchor",href:"#model","aria-hidden":"true"},"#"),e(" model")],-1),Wo=a("ol",null,[a("li",null,"对数据模型的描述和创建")],-1),Oo=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token comment"},"// {app_root}/app/model/user.js"),e("\nmodule"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function-variable function"},"exports"),e(),a("span",{class:"token operator"},"="),e(),a("span",{class:"token parameter"},"app"),e(),a("span",{class:"token operator"},"=>"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" mongoose "),a("span",{class:"token operator"},"="),e(" app"),a("span",{class:"token punctuation"},"."),e("mongoose"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" Schema "),a("span",{class:"token operator"},"="),e(" mongoose"),a("span",{class:"token punctuation"},"."),e("Schema"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token keyword"},"const"),e(" postsSchema "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"new"),e(),a("span",{class:"token class-name"},"Schema"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),e("\n        title"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e(" type"),a("span",{class:"token operator"},":"),e(" String"),a("span",{class:"token punctuation"},","),e(" unique"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token boolean"},"true"),e(),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n        content"),a("span",{class:"token operator"},":"),e(),a("span",{class:"token punctuation"},"{"),e(" type"),a("span",{class:"token operator"},":"),e(" String "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},","),e("\n    "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token keyword"},"return"),e(" mongoose"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"model"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'Posts'"),a("span",{class:"token punctuation"},","),e(" postsSchema"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754420-61496"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"// {app_root}/app/model/user.js\nmodule.exports = app => {\n    const mongoose = app.mongoose;\n    const Schema = mongoose.Schema;\n    const postsSchema = new Schema({\n        title: { type: String, unique: true },\n        content: { type: String },\n    });\n    return mongoose.model('Posts', postsSchema);\n}\n\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754420-61496","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br")])],-1),Uo=a("h5",{id:"service-1"},[a("a",{class:"header-anchor",href:"#service-1","aria-hidden":"true"},"#"),e(" service")],-1),Ko=a("ol",null,[a("li",null,"具体操作数据库的逻辑"),a("li",null,"进行增删改查，并暴露方法给控制器调用")],-1),Go=a("div",{class:"language-js line-numbers-mode"},[a("pre",null,[a("code",null,[a("span",{class:"token keyword"},"const"),e(" Service "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token function"},"require"),a("span",{class:"token punctuation"},"("),a("span",{class:"token string"},"'egg'"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},"."),e("Service"),a("span",{class:"token punctuation"},";"),e("\n\n"),a("span",{class:"token keyword"},"class"),e(),a("span",{class:"token class-name"},"PostsService"),e(),a("span",{class:"token keyword"},"extends"),e(),a("span",{class:"token class-name"},"Service"),e(),a("span",{class:"token punctuation"},"{"),e("\n    "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"find"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"data"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("  "),a("span",{class:"token comment"},"// 查"),e("\n        "),a("span",{class:"token keyword"},"const"),e(" res "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("ctx"),a("span",{class:"token punctuation"},"."),e("model"),a("span",{class:"token punctuation"},"."),e("Posts"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"find"),a("span",{class:"token punctuation"},"("),e("data"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n        "),a("span",{class:"token keyword"},"return"),e(" res\n    "),a("span",{class:"token punctuation"},"}"),e("\n\n    "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"update"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},[e("findData"),a("span",{class:"token punctuation"},","),e(" updateData")]),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e(),a("span",{class:"token comment"},"// 改"),e("\n        "),a("span",{class:"token keyword"},"const"),e(" res "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("ctx"),a("span",{class:"token punctuation"},"."),e("model"),a("span",{class:"token punctuation"},"."),e("Posts"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"update"),a("span",{class:"token punctuation"},"("),e("findData"),a("span",{class:"token punctuation"},","),e(" updateData"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n        "),a("span",{class:"token keyword"},"return"),e(" res"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token punctuation"},"}"),e("\n\n    "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"remove"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"data"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("  "),a("span",{class:"token comment"},"// 删除"),e("\n        "),a("span",{class:"token keyword"},"const"),e(" res "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(),a("span",{class:"token keyword"},"this"),a("span",{class:"token punctuation"},"."),e("ctx"),a("span",{class:"token punctuation"},"."),e("model"),a("span",{class:"token punctuation"},"."),e("Posts"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"remove"),a("span",{class:"token punctuation"},"("),e("data"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n        "),a("span",{class:"token keyword"},"return"),e(" res"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token punctuation"},"}"),e("\n\n    "),a("span",{class:"token keyword"},"async"),e(),a("span",{class:"token function"},"create"),a("span",{class:"token punctuation"},"("),a("span",{class:"token parameter"},"data"),a("span",{class:"token punctuation"},")"),e(),a("span",{class:"token punctuation"},"{"),e("  "),a("span",{class:"token comment"},"// 增"),e("\n        "),a("span",{class:"token comment"},"// console.log(this.ctx.model)"),e("\n        "),a("span",{class:"token keyword"},"const"),e(" postsInstance "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"new"),e(),a("span",{class:"token class-name"},[e("this"),a("span",{class:"token punctuation"},"."),e("ctx"),a("span",{class:"token punctuation"},"."),e("model"),a("span",{class:"token punctuation"},"."),e("Posts")]),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},"{"),e("\n            title"),a("span",{class:"token operator"},":"),e(" data"),a("span",{class:"token punctuation"},"."),e("title"),a("span",{class:"token punctuation"},","),e("\n            content"),a("span",{class:"token operator"},":"),e(" data"),a("span",{class:"token punctuation"},"."),e("content\n        "),a("span",{class:"token punctuation"},"}"),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n\n        "),a("span",{class:"token keyword"},"const"),e(" res "),a("span",{class:"token operator"},"="),e(),a("span",{class:"token keyword"},"await"),e(" postsInstance"),a("span",{class:"token punctuation"},"."),a("span",{class:"token function"},"save"),a("span",{class:"token punctuation"},"("),a("span",{class:"token punctuation"},")"),a("span",{class:"token punctuation"},";"),e("\n        "),a("span",{class:"token keyword"},"return"),e(" res"),a("span",{class:"token punctuation"},";"),e("\n    "),a("span",{class:"token punctuation"},"}"),e("\n"),a("span",{class:"token punctuation"},"}"),e("\n\nmodule"),a("span",{class:"token punctuation"},"."),e("exports "),a("span",{class:"token operator"},"="),e(" PostsService"),a("span",{class:"token punctuation"},";"),e("\n")]),a("div",{class:"m-mdic-copy-wrapper"},[a("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558754420-35387"},"复制成功"),a("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const Service = require('egg').Service;\n\nclass PostsService extends Service {\n    async find(data) {  // 查\n        const res = await this.ctx.model.Posts.find(data);\n        return res\n    }\n\n    async update(findData, updateData) { // 改\n        const res = await this.ctx.model.Posts.update(findData, updateData);\n        return res;\n    }\n\n    async remove(data) {  // 删除\n        const res = await this.ctx.model.Posts.remove(data);\n        return res;\n    }\n\n    async create(data) {  // 增\n        // console.log(this.ctx.model)\n        const postsInstance = new this.ctx.model.Posts({\n            title: data.title,\n            content: data.content\n        });\n\n        const res = await postsInstance.save();\n        return res;\n    }\n}\n\nmodule.exports = PostsService;\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558754420-35387","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),a("div",{class:"line-numbers-wrapper"},[a("span",{class:"line-number"},"1"),a("br"),a("span",{class:"line-number"},"2"),a("br"),a("span",{class:"line-number"},"3"),a("br"),a("span",{class:"line-number"},"4"),a("br"),a("span",{class:"line-number"},"5"),a("br"),a("span",{class:"line-number"},"6"),a("br"),a("span",{class:"line-number"},"7"),a("br"),a("span",{class:"line-number"},"8"),a("br"),a("span",{class:"line-number"},"9"),a("br"),a("span",{class:"line-number"},"10"),a("br"),a("span",{class:"line-number"},"11"),a("br"),a("span",{class:"line-number"},"12"),a("br"),a("span",{class:"line-number"},"13"),a("br"),a("span",{class:"line-number"},"14"),a("br"),a("span",{class:"line-number"},"15"),a("br"),a("span",{class:"line-number"},"16"),a("br"),a("span",{class:"line-number"},"17"),a("br"),a("span",{class:"line-number"},"18"),a("br"),a("span",{class:"line-number"},"19"),a("br"),a("span",{class:"line-number"},"20"),a("br"),a("span",{class:"line-number"},"21"),a("br"),a("span",{class:"line-number"},"22"),a("br"),a("span",{class:"line-number"},"23"),a("br"),a("span",{class:"line-number"},"24"),a("br"),a("span",{class:"line-number"},"25"),a("br"),a("span",{class:"line-number"},"26"),a("br"),a("span",{class:"line-number"},"27"),a("br"),a("span",{class:"line-number"},"28"),a("br"),a("span",{class:"line-number"},"29"),a("br"),a("span",{class:"line-number"},"30"),a("br"),a("span",{class:"line-number"},"31"),a("br")])],-1),Jo=a("h3",{id:"未来展望"},[a("a",{class:"header-anchor",href:"#未来展望","aria-hidden":"true"},"#"),e(" 未来展望")],-1),Qo=a("ul",null,[a("li",null,"登录，鉴权，用户"),a("li",null,"服务部署"),a("li",null,"监控预警，日志分析系统"),a("li",null,"数据库优化"),a("li",null,"多进程，分布式集群"),a("li",null,"大数据处理，分析")],-1);c.render=function(s,a,e,o,c,Yo){return n(),t("div",null,[l,p,i,r,u,d,m,k,b,y,h,f,g,C,x,v,w,j,_,T,$,I,E,N,A,P,q,S,D,F,B,R,L,z,V,H,M,W,O,U,K,G,J,Q,Y,X,Z,nn,tn,sn,an,en,on,cn,ln,pn,rn,un,dn,mn,kn,bn,yn,hn,fn,gn,Cn,xn,vn,wn,jn,_n,Tn,$n,In,En,Nn,An,Pn,qn,Sn,Dn,Fn,Bn,Rn,Ln,zn,Vn,Hn,Mn,Wn,On,Un,Kn,Gn,Jn,Qn,Yn,Xn,Zn,nt,tt,st,at,et,ot,ct,lt,pt,it,rt,ut,dt,mt,kt,bt,yt,ht,ft,gt,Ct,xt,vt,wt,jt,_t,Tt,$t,It,Et,Nt,At,Pt,qt,St,Dt,Ft,Bt,Rt,Lt,zt,Vt,Ht,Mt,Wt,Ot,Ut,Kt,Gt,Jt,Qt,Yt,Xt,Zt,ns,ts,ss,as,es,os,cs,ls,ps,is,rs,us,ds,ms,ks,bs,ys,hs,fs,gs,Cs,xs,vs,ws,js,_s,Ts,$s,Is,Es,Ns,As,Ps,qs,Ss,Ds,Fs,Bs,Rs,Ls,zs,Vs,Hs,Ms,Ws,Os,Us,Ks,Gs,Js,Qs,Ys,Xs,Zs,na,ta,sa,aa,ea,oa,ca,la,pa,ia,ra,ua,da,ma,ka,ba,ya,ha,fa,ga,Ca,xa,va,wa,ja,_a,Ta,$a,Ia,Ea,Na,Aa,Pa,qa,Sa,Da,Fa,Ba,Ra,La,za,Va,Ha,Ma,Wa,Oa,Ua,Ka,Ga,Ja,Qa,Ya,Xa,Za,ne,te,se,ae,ee,oe,ce,le,pe,ie,re,ue,de,me,ke,be,ye,he,fe,ge,Ce,xe,ve,we,je,_e,Te,$e,Ie,Ee,Ne,Ae,Pe,qe,Se,De,Fe,Be,Re,Le,ze,Ve,He,Me,We,Oe,Ue,Ke,Ge,Je,Qe,Ye,Xe,Ze,no,to,so,ao,eo,oo,co,lo,po,io,ro,uo,mo,ko,bo,yo,ho,fo,go,Co,xo,vo,wo,jo,_o,To,$o,Io,Eo,No,Ao,Po,qo,So,Do,Fo,Bo,Ro,Lo,zo,Vo,Ho,Mo,Wo,Oo,Uo,Ko,Go,Jo,Qo])};export default c;export{o as __pageData};
