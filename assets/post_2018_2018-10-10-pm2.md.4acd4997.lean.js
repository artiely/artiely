import{o as n,c as e,a as t,x as c,f as o}from"./app.5f3fb606.js";const a='{"title":"pm2进阶使用之一键发布","description":"","frontmatter":{"title":"pm2进阶使用之一键发布","tag":["pm2","nodejs"],"author":"Artiely","date":"2018-10-10","cover":"https://gitee.com/artiely/Figure-bed/raw/master/images/20200315160740.png","base64":301286},"headers":[{"level":2,"title":"启用集群模式","slug":"启用集群模式"},{"level":2,"title":"一键发布","slug":"一键发布"},{"level":2,"title":"注意事项","slug":"注意事项"},{"level":2,"title":"最后","slug":"最后"}],"relativePath":"post/2018/2018-10-10-pm2.md","lastUpdated":1629110800377}',i={},s=t("h1",{id:"pm2进阶使用之一键发布"},[t("a",{class:"header-anchor",href:"#pm2进阶使用之一键发布","aria-hidden":"true"},"#"),c(" pm2进阶使用之一键发布")],-1),d=t("h2",{id:"启用集群模式"},[t("a",{class:"header-anchor",href:"#启用集群模式","aria-hidden":"true"},"#"),c(" 启用集群模式")],-1),l=t("p",null,"只需要在启动应用时带上i参数",-1),r=t("div",{class:"language-"},[t("pre",null,[t("code",null,"pm2 start app.js -i max\n"),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556981659-91444"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"pm2 start app.js -i max\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556981659-91444","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br")])],-1),p=t("p",null,"max：意味着PM2将自动检测可用的CPU数量和运行多个进程可以在负载均衡模式(但是不推荐使用)",-1),m=t("p",null,"或者使用json文件启动的",-1),y=t("div",{class:"language-"},[t("pre",null,[t("code",null,'{\n  "apps" : [{\n    "script"    : "api.js",\n    "instances" : "max",\n    "exec_mode" : "cluster"\n  }]\n}\n'),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556981659-22824"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'{\n  "apps" : [{\n    "script"    : "api.js",\n    "instances" : "max",\n    "exec_mode" : "cluster"\n  }]\n}\n',"data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556981659-22824","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br"),t("span",{class:"line-number"},"4"),t("br"),t("span",{class:"line-number"},"5"),t("br"),t("span",{class:"line-number"},"6"),t("br"),t("span",{class:"line-number"},"7"),t("br")])],-1),u=t("p",null,[c("当然还支持js和ylm文件,js示例如下"),t("br"),t("a",{href:"http://pm2.keymetrics.io/docs/usage/application-declaration/",target:"_blank",rel:"noopener noreferrer"},"相关资料")],-1),b=t("div",{class:"language-"},[t("pre",null,[t("code",null,'module.exports = {\n  apps : [{\n    name        : "worker",//应用名称\n    script      : "./worker.js", //脚本路径相对于pm2开始\n    watch       : true, //开启监察，文件改变自动重启\n    env: {\n      "PORT": 3000,\n      "NODE_ENV": "development",\n    },\n    env_production : {\n        "PORT": 80\n       "NODE_ENV": "production"\n    }\n  },{\n    name       : "api-app",\n    script     : "./api.js",\n    cwd         : "/home/www/project_root/current",// \n    "error_file": "./logs/app.err.log",\n    "out_file": "./logs/app.out.log", \n    "log_date_format" : "YYYY-MM-DD HH:mm Z"\n    instances  : 4, // 实例（多核）\n    exec_mode  : "cluster" // 集群模式\n  }]\n}\n'),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556981659-77951"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'module.exports = {\n  apps : [{\n    name        : "worker",//应用名称\n    script      : "./worker.js", //脚本路径相对于pm2开始\n    watch       : true, //开启监察，文件改变自动重启\n    env: {\n      "PORT": 3000,\n      "NODE_ENV": "development",\n    },\n    env_production : {\n        "PORT": 80\n       "NODE_ENV": "production"\n    }\n  },{\n    name       : "api-app",\n    script     : "./api.js",\n    cwd         : "/home/www/project_root/current",// \n    "error_file": "./logs/app.err.log",\n    "out_file": "./logs/app.out.log", \n    "log_date_format" : "YYYY-MM-DD HH:mm Z"\n    instances  : 4, // 实例（多核）\n    exec_mode  : "cluster" // 集群模式\n  }]\n}\n',"data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556981659-77951","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br"),t("span",{class:"line-number"},"4"),t("br"),t("span",{class:"line-number"},"5"),t("br"),t("span",{class:"line-number"},"6"),t("br"),t("span",{class:"line-number"},"7"),t("br"),t("span",{class:"line-number"},"8"),t("br"),t("span",{class:"line-number"},"9"),t("br"),t("span",{class:"line-number"},"10"),t("br"),t("span",{class:"line-number"},"11"),t("br"),t("span",{class:"line-number"},"12"),t("br"),t("span",{class:"line-number"},"13"),t("br"),t("span",{class:"line-number"},"14"),t("br"),t("span",{class:"line-number"},"15"),t("br"),t("span",{class:"line-number"},"16"),t("br"),t("span",{class:"line-number"},"17"),t("br"),t("span",{class:"line-number"},"18"),t("br"),t("span",{class:"line-number"},"19"),t("br"),t("span",{class:"line-number"},"20"),t("br"),t("span",{class:"line-number"},"21"),t("br"),t("span",{class:"line-number"},"22"),t("br"),t("span",{class:"line-number"},"23"),t("br"),t("span",{class:"line-number"},"24"),t("br")])],-1),h=t("p",null,"然后再启动进程",-1),f=t("div",{class:"language-"},[t("pre",null,[t("code",null,"pm2 start processes.json\n"),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556981659-12621"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"pm2 start processes.json\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556981659-12621","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br")])],-1),C=t("p",null,"重载应用",-1),g=t("div",{class:"language-"},[t("pre",null,[t("code",null,"pm2 reload <app_name>\n"),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556981659-55475"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"pm2 reload <app_name>\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556981659-55475","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br")])],-1),v=t("p",null,"或者",-1),k=t("div",{class:"language-"},[t("pre",null,[t("code",null,"pm2 reload process.json\npm2 reload process.json --only api\n"),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556981659-89685"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"pm2 reload process.json\npm2 reload process.json --only api\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556981659-89685","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br")])],-1),w=t("h2",{id:"一键发布"},[t("a",{class:"header-anchor",href:"#一键发布","aria-hidden":"true"},"#"),c(" 一键发布")],-1),x=t("p",null,"yml的书写方式(process.yml)",-1),_=t("div",{class:"language-"},[t("pre",null,[t("code",null,"apps:\n  - script   : server.js\n    name : 'pm2 test'\n    watch  : true\n    env    :\n      NODE_ENV: development\n    env_production:\n      NODE_ENV: production\ndeploy :\n  production :\n    user : root\n    key : C:/Windows/SSH-ubuntu.pem  #服务器sshkey(阿里云再服务器镜像创建的时候会生成 然后保存到本地)\n    host : \n      - 120.78.174.212                #服务器ip\n    port : 22\n    ref : origin/master\n    repo : git@gitee.com:artiely/pm2test.git  #仓库地址\n    path : /www/pm2test/production               #发布地址\n    ssh_options : StrictHostKeyChecking=no       #ssh权限\n    pre-deploy : git fetch --all                 #发布前的操作\n    post-deploy : 'npm install && npm run build && pm2 startOrRestart process.yml --env production'\n    env : \n      NODE_ENV : production\n"),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556981659-50498"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"apps:\n  - script   : server.js\n    name : 'pm2 test'\n    watch  : true\n    env    :\n      NODE_ENV: development\n    env_production:\n      NODE_ENV: production\ndeploy :\n  production :\n    user : root\n    key : C:/Windows/SSH-ubuntu.pem  #服务器sshkey(阿里云再服务器镜像创建的时候会生成 然后保存到本地)\n    host : \n      - 120.78.174.212                #服务器ip\n    port : 22\n    ref : origin/master\n    repo : git@gitee.com:artiely/pm2test.git  #仓库地址\n    path : /www/pm2test/production               #发布地址\n    ssh_options : StrictHostKeyChecking=no       #ssh权限\n    pre-deploy : git fetch --all                 #发布前的操作\n    post-deploy : 'npm install && npm run build && pm2 startOrRestart process.yml --env production'\n    env : \n      NODE_ENV : production\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556981659-50498","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br"),t("span",{class:"line-number"},"4"),t("br"),t("span",{class:"line-number"},"5"),t("br"),t("span",{class:"line-number"},"6"),t("br"),t("span",{class:"line-number"},"7"),t("br"),t("span",{class:"line-number"},"8"),t("br"),t("span",{class:"line-number"},"9"),t("br"),t("span",{class:"line-number"},"10"),t("br"),t("span",{class:"line-number"},"11"),t("br"),t("span",{class:"line-number"},"12"),t("br"),t("span",{class:"line-number"},"13"),t("br"),t("span",{class:"line-number"},"14"),t("br"),t("span",{class:"line-number"},"15"),t("br"),t("span",{class:"line-number"},"16"),t("br"),t("span",{class:"line-number"},"17"),t("br"),t("span",{class:"line-number"},"18"),t("br"),t("span",{class:"line-number"},"19"),t("br"),t("span",{class:"line-number"},"20"),t("br"),t("span",{class:"line-number"},"21"),t("br"),t("span",{class:"line-number"},"22"),t("br"),t("span",{class:"line-number"},"23"),t("br")])],-1),j=t("p",null,"第一次发布本地执行",-1),E=t("div",{class:"language-"},[t("pre",null,[t("code",null,"pm2 deploy process.yml production setup\n"),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556981659-50898"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"pm2 deploy process.yml production setup\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556981659-50898","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br")])],-1),N=t("p",null,"然后每次发布只需本地执行如下命令，服务器就会自动拉取创库代码并发布",-1),T=t("div",{class:"language-"},[t("pre",null,[t("code",null,"pm2 deploy process.yml production\n"),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556981659-14075"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"pm2 deploy process.yml production\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556981659-14075","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br")])],-1),$=o('',11);i.render=function(t,c,o,a,i,D){return n(),e("div",null,[s,d,l,r,p,m,y,u,b,h,f,C,g,v,k,w,x,_,j,E,N,T,$])};export default i;export{a as __pageData};
