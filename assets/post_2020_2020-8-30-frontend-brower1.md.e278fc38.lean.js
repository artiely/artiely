import{o as n,c as t,t as e,a as s,x as a}from"./app.746f22cf.js";const o='{"title":"前端面试题汇总-浏览器篇-1","description":"","frontmatter":{"title":"前端面试题汇总-浏览器篇-1","tag":["javaScript"],"cover":"https://gitee.com/artiely/Figure-bed/raw/master/image/20200831112934.png","base64":"2b4dd7","author":"artiely","date":"2020-8-30"},"headers":[{"level":2,"title":"1. 浏览器渲染机制","slug":"1-浏览器渲染机制"},{"level":2,"title":"2. 重绘","slug":"2-重绘"},{"level":2,"title":"3. 回流","slug":"3-回流"},{"level":2,"title":"浏览器与Node的事件循环有何区别?","slug":"浏览器与node的事件循环有何区别"},{"level":3,"title":"浏览器","slug":"浏览器"},{"level":3,"title":"Node","slug":"node"},{"level":3,"title":"一、线程与进程","slug":"一-线程与进程"},{"level":3,"title":"1.概念","slug":"1概念"},{"level":3,"title":"2.多进程与多线程","slug":"2多进程与多线程"},{"level":2,"title":"二、浏览器内核","slug":"二-浏览器内核"},{"level":3,"title":"1.GUI渲染线程","slug":"1gui渲染线程"},{"level":3,"title":"2.JS引擎线程","slug":"2js引擎线程"},{"level":3,"title":"3.定时器触发线程","slug":"3定时器触发线程"},{"level":3,"title":"4.事件触发线程","slug":"4事件触发线程"},{"level":3,"title":"5.异步http请求线程","slug":"5异步http请求线程"},{"level":2,"title":"三、浏览器中的 Event Loop","slug":"三-浏览器中的-event-loop"},{"level":3,"title":"1.Micro-Task 与 Macro-Task","slug":"1micro-task-与-macro-task"},{"level":3,"title":"2.Event Loop 过程解析","slug":"2event-loop-过程解析"},{"level":2,"title":"四、Node 中的 Event Loop","slug":"四-node-中的-event-loop"},{"level":3,"title":"1.Node简介","slug":"1node简介"},{"level":3,"title":"2.六个阶段","slug":"2六个阶段"},{"level":3,"title":"3.Micro-Task 与 Macro-Task","slug":"3micro-task-与-macro-task"},{"level":3,"title":"4.注意点","slug":"4注意点"},{"level":2,"title":"五、Node与浏览器的 Event Loop 差异","slug":"五-node与浏览器的-event-loop-差异"},{"level":2,"title":"六、总结","slug":"六-总结"}],"relativePath":"post/2020/2020-8-30-frontend-brower1.md","lastUpdated":1629110864092}',c={},l=e('',7),i=s("div",{class:"language-js line-numbers-mode"},[s("pre",null,[s("code",null,[s("span",{class:"token operator"},"<"),a("body"),s("span",{class:"token operator"},">"),a("\n"),s("span",{class:"token operator"},"<"),a("div "),s("span",{class:"token keyword"},"class"),s("span",{class:"token operator"},"="),s("span",{class:"token string"},'"error"'),s("span",{class:"token operator"},">"),a("\n    "),s("span",{class:"token operator"},"<"),a("h4"),s("span",{class:"token operator"},">"),a("我的组件"),s("span",{class:"token operator"},"<"),s("span",{class:"token operator"},"/"),a("h4"),s("span",{class:"token operator"},">"),a("\n    "),s("span",{class:"token operator"},"<"),a("p"),s("span",{class:"token operator"},">"),s("span",{class:"token operator"},"<"),a("strong"),s("span",{class:"token operator"},">"),a("错误："),s("span",{class:"token operator"},"<"),s("span",{class:"token operator"},"/"),a("strong"),s("span",{class:"token operator"},">"),a("错误的描述…"),s("span",{class:"token operator"},"<"),s("span",{class:"token operator"},"/"),a("p"),s("span",{class:"token operator"},">"),a("\n    "),s("span",{class:"token operator"},"<"),a("h5"),s("span",{class:"token operator"},">"),a("错误纠正"),s("span",{class:"token operator"},"<"),s("span",{class:"token operator"},"/"),a("h5"),s("span",{class:"token operator"},">"),a("\n    "),s("span",{class:"token operator"},"<"),a("ol"),s("span",{class:"token operator"},">"),a("\n        "),s("span",{class:"token operator"},"<"),a("li"),s("span",{class:"token operator"},">"),a("第一步"),s("span",{class:"token operator"},"<"),s("span",{class:"token operator"},"/"),a("li"),s("span",{class:"token operator"},">"),a("\n        "),s("span",{class:"token operator"},"<"),a("li"),s("span",{class:"token operator"},">"),a("第二步"),s("span",{class:"token operator"},"<"),s("span",{class:"token operator"},"/"),a("li"),s("span",{class:"token operator"},">"),a("\n    "),s("span",{class:"token operator"},"<"),s("span",{class:"token operator"},"/"),a("ol"),s("span",{class:"token operator"},">"),a("\n"),s("span",{class:"token operator"},"<"),s("span",{class:"token operator"},"/"),a("div"),s("span",{class:"token operator"},">"),a("\n"),s("span",{class:"token operator"},"<"),s("span",{class:"token operator"},"/"),a("body"),s("span",{class:"token operator"},">"),a("\n")]),s("div",{class:"m-mdic-copy-wrapper"},[s("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558019146-63486"},"复制成功"),s("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'<body>\n<div class="error">\n    <h4>我的组件</h4>\n    <p><strong>错误：</strong>错误的描述…</p>\n    <h5>错误纠正</h5>\n    <ol>\n        <li>第一步</li>\n        <li>第二步</li>\n    </ol>\n</div>\n</body>\n',"data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558019146-63486","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),s("div",{class:"line-numbers-wrapper"},[s("span",{class:"line-number"},"1"),s("br"),s("span",{class:"line-number"},"2"),s("br"),s("span",{class:"line-number"},"3"),s("br"),s("span",{class:"line-number"},"4"),s("br"),s("span",{class:"line-number"},"5"),s("br"),s("span",{class:"line-number"},"6"),s("br"),s("span",{class:"line-number"},"7"),s("br"),s("span",{class:"line-number"},"8"),s("br"),s("span",{class:"line-number"},"9"),s("br"),s("span",{class:"line-number"},"10"),s("br"),s("span",{class:"line-number"},"11"),s("br")])],-1),p=e('',8),r=s("ol",null,[s("li",null,[s("p",null,"CSS"),s("ul",null,[s("li",null,[s("p",null,[s("strong",null,[a("使用 "),s("code",null,"transform"),a(" 替代 "),s("code",null,"top")])])]),s("li",null,[s("p",null,[s("strong",null,[a("使用 "),s("code",null,"visibility"),a(" 替换 "),s("code",null,"display: none")]),a(" ，因为前者只会引起重绘，后者会引发回流（改变了布局")])]),s("li",null,[s("p",null,[s("strong",null,[a("避免使用"),s("code",null,"table"),a("布局")]),a("，可能很小的一个小改动会造成整个 "),s("code",null,"table"),a(" 的重新布局。")])]),s("li",null,[s("p",null,[s("strong",null,[a("尽可能在"),s("code",null,"DOM"),a("树的最末端改变"),s("code",null,"class")]),a("，回流是不可避免的，但可以减少其影响。尽可能在DOM树的最末端改变class，可以限制了回流的范围，使其影响尽可能少的节点。")])]),s("li",null,[s("p",null,[s("strong",null,"避免设置多层内联样式"),a("，CSS 选择符"),s("strong",null,"从右往左"),a("匹配查找，避免节点层级过多。")]),s("div",{class:"language-js line-numbers-mode"},[s("pre",null,[s("code",null,[s("span",{class:"token operator"},"<"),a("div"),s("span",{class:"token operator"},">"),a("\n  "),s("span",{class:"token operator"},"<"),a("a"),s("span",{class:"token operator"},">"),a(),s("span",{class:"token operator"},"<"),a("span"),s("span",{class:"token operator"},">"),s("span",{class:"token operator"},"<"),s("span",{class:"token operator"},"/"),a("span"),s("span",{class:"token operator"},">"),a(),s("span",{class:"token operator"},"<"),s("span",{class:"token operator"},"/"),a("a"),s("span",{class:"token operator"},">"),a("\n"),s("span",{class:"token operator"},"<"),s("span",{class:"token operator"},"/"),a("div"),s("span",{class:"token operator"},">"),a("\n"),s("span",{class:"token operator"},"<"),a("style"),s("span",{class:"token operator"},">"),a("\n  span "),s("span",{class:"token punctuation"},"{"),a("\n    color"),s("span",{class:"token operator"},":"),a(" red"),s("span",{class:"token punctuation"},";"),a("\n  "),s("span",{class:"token punctuation"},"}"),a("\n  div "),s("span",{class:"token operator"},">"),a(" a "),s("span",{class:"token operator"},">"),a(" span "),s("span",{class:"token punctuation"},"{"),a("\n    color"),s("span",{class:"token operator"},":"),a(" red"),s("span",{class:"token punctuation"},";"),a("\n  "),s("span",{class:"token punctuation"},"}"),a("\n"),s("span",{class:"token operator"},"<"),s("span",{class:"token operator"},"/"),a("style"),s("span",{class:"token operator"},">"),a("\n")]),s("div",{class:"m-mdic-copy-wrapper"},[s("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558019146-58028"},"复制成功"),s("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"<div>\n  <a> <span></span> </a>\n</div>\n<style>\n  span {\n    color: red;\n  }\n  div > a > span {\n    color: red;\n  }\n</style>\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558019146-58028","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),s("div",{class:"line-numbers-wrapper"},[s("span",{class:"line-number"},"1"),s("br"),s("span",{class:"line-number"},"2"),s("br"),s("span",{class:"line-number"},"3"),s("br"),s("span",{class:"line-number"},"4"),s("br"),s("span",{class:"line-number"},"5"),s("br"),s("span",{class:"line-number"},"6"),s("br"),s("span",{class:"line-number"},"7"),s("br"),s("span",{class:"line-number"},"8"),s("br"),s("span",{class:"line-number"},"9"),s("br"),s("span",{class:"line-number"},"10"),s("br"),s("span",{class:"line-number"},"11"),s("br")])]),s("p",null,[a("对于第一种设置样式的方式来说，浏览器只需要找到页面中所有的 "),s("code",null,"span"),a(" 标签然后设置颜色，但是对于第二种设置样式的方式来说，浏览器首先需要找到所有的 "),s("code",null,"span"),a(" 标签，然后找到 "),s("code",null,"span"),a(" 标签上的 "),s("code",null,"a"),a(" 标签，最后再去找到 "),s("code",null,"div"),a(" 标签，然后给符合这种条件的 "),s("code",null,"span"),a(" 标签设置颜色，这样的递归过程就很复杂。所以我们应该尽可能的避免写"),s("strong",null,"过于具体"),a("的 CSS 选择器，然后对于 HTML 来说也尽量少的添加无意义标签，保证"),s("strong",null,"层级扁平"),a("。")])]),s("li",null,[s("p",null,[s("strong",null,[a("将动画效果应用到"),s("code",null,"position"),a("属性为"),s("code",null,"absolute"),a("或"),s("code",null,"fixed"),a("的元素上")]),a("，避免影响其他元素的布局，这样只是一个重绘，而不是回流，同时，控制动画速度可以选择 "),s("code",null,"requestAnimationFrame"),a("，详见"),s("a",{href:"https://github.com/LuNaHaiJiao/blog/issues/30",target:"_blank",rel:"noopener noreferrer"},"探讨 requestAnimationFrame"),a("。")])]),s("li",null,[s("p",null,[s("strong",null,[a("避免使用"),s("code",null,"CSS"),a("表达式")]),a("，可能会引发回流。")])]),s("li",null,[s("p",null,[s("strong",null,"将频繁重绘或者回流的节点设置为图层"),a("，图层能够阻止该节点的渲染行为影响别的节点，例如"),s("code",null,"will-change"),a("、"),s("code",null,"video"),a("、"),s("code",null,"iframe"),a("等标签，浏览器会自动将该节点变为图层。")])]),s("li",null,[s("p",null,[s("strong",null,"CSS3 硬件加速（GPU加速）"),a("，使用css3硬件加速，可以让"),s("code",null,"transform"),a("、"),s("code",null,"opacity"),a("、"),s("code",null,"filters"),a("这些动画不会引起回流重绘 。但是对于动画的其它属性，比如"),s("code",null,"background-color"),a("这些，还是会引起回流重绘的，不过它还是可以提升这些动画的性能。")])])])]),s("li",null,[s("p",null,"JavaScript"),s("ul",null,[s("li",null,[s("strong",null,"避免频繁操作样式"),a("，最好一次性重写"),s("code",null,"style"),a("属性，或者将样式列表定义为"),s("code",null,"class"),a("并一次性更改"),s("code",null,"class"),a("属性。")]),s("li",null,[s("strong",null,[a("避免频繁操作"),s("code",null,"DOM")]),a("，创建一个"),s("code",null,"documentFragment"),a("，在它上面应用所有"),s("code",null,"DOM操作"),a("，最后再把它添加到文档中。")]),s("li",null,[s("strong",null,"避免频繁读取会引发回流/重绘的属性"),a("，如果确实需要多次使用，就用一个变量缓存起来。")]),s("li",null,[s("strong",null,"对具有复杂动画的元素使用绝对定位"),a("，使它脱离文档流，否则会引起父元素及后续元素频繁回流。")])]),s("h2",{id:"浏览器与node的事件循环有何区别"},[s("a",{class:"header-anchor",href:"#浏览器与node的事件循环有何区别","aria-hidden":"true"},"#"),a(" 浏览器与Node的事件循环有何区别?")])])],-1),u=e('',51),d=s("div",{class:"language-"},[s("pre",null,[s("code",null,"Promise.resolve().then(()=>{\n  console.log('Promise1')  \n  setTimeout(()=>{\n    console.log('setTimeout2')\n  },0)\n})\nsetTimeout(()=>{\n  console.log('setTimeout1')\n  Promise.resolve().then(()=>{\n    console.log('Promise2')    \n  })\n},0)\n"),s("div",{class:"m-mdic-copy-wrapper"},[s("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558019147-9126"},"复制成功"),s("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"Promise.resolve().then(()=>{\n  console.log('Promise1')  \n  setTimeout(()=>{\n    console.log('setTimeout2')\n  },0)\n})\nsetTimeout(()=>{\n  console.log('setTimeout1')\n  Promise.resolve().then(()=>{\n    console.log('Promise2')    \n  })\n},0)\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558019147-9126","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),s("div",{class:"line-numbers-wrapper"},[s("span",{class:"line-number"},"1"),s("br"),s("span",{class:"line-number"},"2"),s("br"),s("span",{class:"line-number"},"3"),s("br"),s("span",{class:"line-number"},"4"),s("br"),s("span",{class:"line-number"},"5"),s("br"),s("span",{class:"line-number"},"6"),s("br"),s("span",{class:"line-number"},"7"),s("br"),s("span",{class:"line-number"},"8"),s("br"),s("span",{class:"line-number"},"9"),s("br"),s("span",{class:"line-number"},"10"),s("br"),s("span",{class:"line-number"},"11"),s("br"),s("span",{class:"line-number"},"12"),s("br")])],-1),m=e('',27),k=s("div",{class:"language-js line-numbers-mode"},[s("pre",null,[s("code",null,[a("console"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"log"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'start'"),s("span",{class:"token punctuation"},")"),a("\n"),s("span",{class:"token function"},"setTimeout"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),a(),s("span",{class:"token operator"},"=>"),a(),s("span",{class:"token punctuation"},"{"),a("\n  console"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"log"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'timer1'"),s("span",{class:"token punctuation"},")"),a("\n  Promise"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"resolve"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"then"),s("span",{class:"token punctuation"},"("),s("span",{class:"token keyword"},"function"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),a(),s("span",{class:"token punctuation"},"{"),a("\n    console"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"log"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'promise1'"),s("span",{class:"token punctuation"},")"),a("\n  "),s("span",{class:"token punctuation"},"}"),s("span",{class:"token punctuation"},")"),a("\n"),s("span",{class:"token punctuation"},"}"),s("span",{class:"token punctuation"},","),a(),s("span",{class:"token number"},"0"),s("span",{class:"token punctuation"},")"),a("\n"),s("span",{class:"token function"},"setTimeout"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),a(),s("span",{class:"token operator"},"=>"),a(),s("span",{class:"token punctuation"},"{"),a("\n  console"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"log"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'timer2'"),s("span",{class:"token punctuation"},")"),a("\n  Promise"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"resolve"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"then"),s("span",{class:"token punctuation"},"("),s("span",{class:"token keyword"},"function"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),a(),s("span",{class:"token punctuation"},"{"),a("\n    console"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"log"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'promise2'"),s("span",{class:"token punctuation"},")"),a("\n  "),s("span",{class:"token punctuation"},"}"),s("span",{class:"token punctuation"},")"),a("\n"),s("span",{class:"token punctuation"},"}"),s("span",{class:"token punctuation"},","),a(),s("span",{class:"token number"},"0"),s("span",{class:"token punctuation"},")"),a("\nPromise"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"resolve"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"then"),s("span",{class:"token punctuation"},"("),s("span",{class:"token keyword"},"function"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),a(),s("span",{class:"token punctuation"},"{"),a("\n  console"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"log"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'promise3'"),s("span",{class:"token punctuation"},")"),a("\n"),s("span",{class:"token punctuation"},"}"),s("span",{class:"token punctuation"},")"),a("\nconsole"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"log"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'end'"),s("span",{class:"token punctuation"},")"),a("\n"),s("span",{class:"token comment"},"//start=>end=>promise3=>timer1=>timer2=>promise1=>promise2"),a("\n\n")]),s("div",{class:"m-mdic-copy-wrapper"},[s("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558019147-68239"},"复制成功"),s("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"console.log('start')\nsetTimeout(() => {\n  console.log('timer1')\n  Promise.resolve().then(function() {\n    console.log('promise1')\n  })\n}, 0)\nsetTimeout(() => {\n  console.log('timer2')\n  Promise.resolve().then(function() {\n    console.log('promise2')\n  })\n}, 0)\nPromise.resolve().then(function() {\n  console.log('promise3')\n})\nconsole.log('end')\n//start=>end=>promise3=>timer1=>timer2=>promise1=>promise2\n\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558019147-68239","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),s("div",{class:"line-numbers-wrapper"},[s("span",{class:"line-number"},"1"),s("br"),s("span",{class:"line-number"},"2"),s("br"),s("span",{class:"line-number"},"3"),s("br"),s("span",{class:"line-number"},"4"),s("br"),s("span",{class:"line-number"},"5"),s("br"),s("span",{class:"line-number"},"6"),s("br"),s("span",{class:"line-number"},"7"),s("br"),s("span",{class:"line-number"},"8"),s("br"),s("span",{class:"line-number"},"9"),s("br"),s("span",{class:"line-number"},"10"),s("br"),s("span",{class:"line-number"},"11"),s("br"),s("span",{class:"line-number"},"12"),s("br"),s("span",{class:"line-number"},"13"),s("br"),s("span",{class:"line-number"},"14"),s("br"),s("span",{class:"line-number"},"15"),s("br"),s("span",{class:"line-number"},"16"),s("br"),s("span",{class:"line-number"},"17"),s("br"),s("span",{class:"line-number"},"18"),s("br"),s("span",{class:"line-number"},"19"),s("br")])],-1),h=e('',8),b=s("div",{class:"language-js line-numbers-mode"},[s("pre",null,[s("code",null,[s("span",{class:"token function"},"setTimeout"),s("span",{class:"token punctuation"},"("),s("span",{class:"token keyword"},"function"),a(),s("span",{class:"token function"},"timeout"),a(),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),a(),s("span",{class:"token punctuation"},"{"),a("\n  console"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"log"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'timeout'"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";"),a("\n"),s("span",{class:"token punctuation"},"}"),s("span",{class:"token punctuation"},","),s("span",{class:"token number"},"0"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";"),a("\n"),s("span",{class:"token function"},"setImmediate"),s("span",{class:"token punctuation"},"("),s("span",{class:"token keyword"},"function"),a(),s("span",{class:"token function"},"immediate"),a(),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),a(),s("span",{class:"token punctuation"},"{"),a("\n  console"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"log"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'immediate'"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";"),a("\n"),s("span",{class:"token punctuation"},"}"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";"),a("\n")]),s("div",{class:"m-mdic-copy-wrapper"},[s("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558019147-38933"},"复制成功"),s("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"setTimeout(function timeout () {\n  console.log('timeout');\n},0);\nsetImmediate(function immediate () {\n  console.log('immediate');\n});\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558019147-38933","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),s("div",{class:"line-numbers-wrapper"},[s("span",{class:"line-number"},"1"),s("br"),s("span",{class:"line-number"},"2"),s("br"),s("span",{class:"line-number"},"3"),s("br"),s("span",{class:"line-number"},"4"),s("br"),s("span",{class:"line-number"},"5"),s("br"),s("span",{class:"line-number"},"6"),s("br")])],-1),g=s("ul",null,[s("li",null,"对于以上代码来说，setTimeout 可能执行在前，也可能执行在后。"),s("li",null,"首先 setTimeout(fn, 0) === setTimeout(fn, 1)，这是由源码决定的 进入事件循环也是需要成本的，如果在准备时候花费了大于 1ms 的时间，那么在 timer 阶段就会直接执行 setTimeout 回调"),s("li",null,"如果准备时间花费小于 1ms，那么就是 setImmediate 回调先执行了")],-1),y=s("p",null,"但当二者在异步i/o callback内部调用时，总是先执行setImmediate，再执行setTimeout",-1),f=s("div",{class:"language-js line-numbers-mode"},[s("pre",null,[s("code",null,[s("span",{class:"token keyword"},"const"),a(" fs "),s("span",{class:"token operator"},"="),a(),s("span",{class:"token function"},"require"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'fs'"),s("span",{class:"token punctuation"},")"),a("\nfs"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"readFile"),s("span",{class:"token punctuation"},"("),a("__filename"),s("span",{class:"token punctuation"},","),a(),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),a(),s("span",{class:"token operator"},"=>"),a(),s("span",{class:"token punctuation"},"{"),a("\n    "),s("span",{class:"token function"},"setTimeout"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),a(),s("span",{class:"token operator"},"=>"),a(),s("span",{class:"token punctuation"},"{"),a("\n        console"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"log"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'timeout'"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";"),a("\n    "),s("span",{class:"token punctuation"},"}"),s("span",{class:"token punctuation"},","),a(),s("span",{class:"token number"},"0"),s("span",{class:"token punctuation"},")"),a("\n    "),s("span",{class:"token function"},"setImmediate"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),a(),s("span",{class:"token operator"},"=>"),a(),s("span",{class:"token punctuation"},"{"),a("\n        console"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"log"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'immediate'"),s("span",{class:"token punctuation"},")"),a("\n    "),s("span",{class:"token punctuation"},"}"),s("span",{class:"token punctuation"},")"),a("\n"),s("span",{class:"token punctuation"},"}"),s("span",{class:"token punctuation"},")"),a("\n"),s("span",{class:"token comment"},"// immediate"),a("\n"),s("span",{class:"token comment"},"// timeout"),a("\n")]),s("div",{class:"m-mdic-copy-wrapper"},[s("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558019147-27930"},"复制成功"),s("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const fs = require('fs')\nfs.readFile(__filename, () => {\n    setTimeout(() => {\n        console.log('timeout');\n    }, 0)\n    setImmediate(() => {\n        console.log('immediate')\n    })\n})\n// immediate\n// timeout\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558019147-27930","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),s("div",{class:"line-numbers-wrapper"},[s("span",{class:"line-number"},"1"),s("br"),s("span",{class:"line-number"},"2"),s("br"),s("span",{class:"line-number"},"3"),s("br"),s("span",{class:"line-number"},"4"),s("br"),s("span",{class:"line-number"},"5"),s("br"),s("span",{class:"line-number"},"6"),s("br"),s("span",{class:"line-number"},"7"),s("br"),s("span",{class:"line-number"},"8"),s("br"),s("span",{class:"line-number"},"9"),s("br"),s("span",{class:"line-number"},"10"),s("br"),s("span",{class:"line-number"},"11"),s("br")])],-1),v=s("p",null,"在上述代码中，setImmediate 永远先执行。因为两个代码写在 IO 回调中，IO 回调是在 poll 阶段执行，当回调执行完毕后队列为空，发现存在 setImmediate 回调，所以就直接跳转到 check 阶段去执行回调了。",-1),T=s("h4",{id:"2-processnexttick"},[s("a",{class:"header-anchor",href:"#2-processnexttick","aria-hidden":"true"},"#"),a(" (2) process.nextTick")],-1),C=s("p",null,"这个函数其实是独立于 Event Loop 之外的，它有一个自己的队列，当每个阶段完成后，如果存在 nextTick 队列，就会清空队列中的所有回调函数，并且优先于其他 microtask 执行。",-1),I=s("div",{class:"language-js line-numbers-mode"},[s("pre",null,[s("code",null,[s("span",{class:"token function"},"setTimeout"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),a(),s("span",{class:"token operator"},"=>"),a(),s("span",{class:"token punctuation"},"{"),a("\n console"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"log"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'timer1'"),s("span",{class:"token punctuation"},")"),a("\n Promise"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"resolve"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"then"),s("span",{class:"token punctuation"},"("),s("span",{class:"token keyword"},"function"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),a(),s("span",{class:"token punctuation"},"{"),a("\n   console"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"log"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'promise1'"),s("span",{class:"token punctuation"},")"),a("\n "),s("span",{class:"token punctuation"},"}"),s("span",{class:"token punctuation"},")"),a("\n"),s("span",{class:"token punctuation"},"}"),s("span",{class:"token punctuation"},","),a(),s("span",{class:"token number"},"0"),s("span",{class:"token punctuation"},")"),a("\nprocess"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"nextTick"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),a(),s("span",{class:"token operator"},"=>"),a(),s("span",{class:"token punctuation"},"{"),a("\n console"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"log"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'nextTick'"),s("span",{class:"token punctuation"},")"),a("\n process"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"nextTick"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),a(),s("span",{class:"token operator"},"=>"),a(),s("span",{class:"token punctuation"},"{"),a("\n   console"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"log"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'nextTick'"),s("span",{class:"token punctuation"},")"),a("\n   process"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"nextTick"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),a(),s("span",{class:"token operator"},"=>"),a(),s("span",{class:"token punctuation"},"{"),a("\n     console"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"log"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'nextTick'"),s("span",{class:"token punctuation"},")"),a("\n     process"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"nextTick"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),a(),s("span",{class:"token operator"},"=>"),a(),s("span",{class:"token punctuation"},"{"),a("\n       console"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"log"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'nextTick'"),s("span",{class:"token punctuation"},")"),a("\n     "),s("span",{class:"token punctuation"},"}"),s("span",{class:"token punctuation"},")"),a("\n   "),s("span",{class:"token punctuation"},"}"),s("span",{class:"token punctuation"},")"),a("\n "),s("span",{class:"token punctuation"},"}"),s("span",{class:"token punctuation"},")"),a("\n"),s("span",{class:"token punctuation"},"}"),s("span",{class:"token punctuation"},")"),a("\n"),s("span",{class:"token comment"},"// nextTick=>nextTick=>nextTick=>nextTick=>timer1=>promise1"),a("\n")]),s("div",{class:"m-mdic-copy-wrapper"},[s("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558019148-12380"},"复制成功"),s("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"setTimeout(() => {\n console.log('timer1')\n Promise.resolve().then(function() {\n   console.log('promise1')\n })\n}, 0)\nprocess.nextTick(() => {\n console.log('nextTick')\n process.nextTick(() => {\n   console.log('nextTick')\n   process.nextTick(() => {\n     console.log('nextTick')\n     process.nextTick(() => {\n       console.log('nextTick')\n     })\n   })\n })\n})\n// nextTick=>nextTick=>nextTick=>nextTick=>timer1=>promise1\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558019148-12380","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),s("div",{class:"line-numbers-wrapper"},[s("span",{class:"line-number"},"1"),s("br"),s("span",{class:"line-number"},"2"),s("br"),s("span",{class:"line-number"},"3"),s("br"),s("span",{class:"line-number"},"4"),s("br"),s("span",{class:"line-number"},"5"),s("br"),s("span",{class:"line-number"},"6"),s("br"),s("span",{class:"line-number"},"7"),s("br"),s("span",{class:"line-number"},"8"),s("br"),s("span",{class:"line-number"},"9"),s("br"),s("span",{class:"line-number"},"10"),s("br"),s("span",{class:"line-number"},"11"),s("br"),s("span",{class:"line-number"},"12"),s("br"),s("span",{class:"line-number"},"13"),s("br"),s("span",{class:"line-number"},"14"),s("br"),s("span",{class:"line-number"},"15"),s("br"),s("span",{class:"line-number"},"16"),s("br"),s("span",{class:"line-number"},"17"),s("br"),s("span",{class:"line-number"},"18"),s("br"),s("span",{class:"line-number"},"19"),s("br")])],-1),_=s("h2",{id:"五-node与浏览器的-event-loop-差异"},[s("a",{class:"header-anchor",href:"#五-node与浏览器的-event-loop-差异","aria-hidden":"true"},"#"),a(" 五、Node与浏览器的 Event Loop 差异")],-1),x=s("p",null,[s("strong",null,"浏览器环境下，microtask的任务队列是每个macrotask执行完之后执行。而在Node.js中，microtask会在事件循环的各个阶段之间执行，也就是一个阶段执行完毕，就会去执行microtask队列的任务"),a("。")],-1),P=s("p",null,[s("img",{src:"https://gitee.com/artiely/Figure-bed/raw/master/image/20200831103717.png",alt:""})],-1),S=s("p",null,"接下我们通过一个例子来说明两者区别：",-1),w=s("div",{class:"language-js line-numbers-mode"},[s("pre",null,[s("code",null,[s("span",{class:"token function"},"setTimeout"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),s("span",{class:"token operator"},"=>"),s("span",{class:"token punctuation"},"{"),a("\n    console"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"log"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'timer1'"),s("span",{class:"token punctuation"},")"),a("\n    Promise"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"resolve"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"then"),s("span",{class:"token punctuation"},"("),s("span",{class:"token keyword"},"function"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),a(),s("span",{class:"token punctuation"},"{"),a("\n        console"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"log"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'promise1'"),s("span",{class:"token punctuation"},")"),a("\n    "),s("span",{class:"token punctuation"},"}"),s("span",{class:"token punctuation"},")"),a("\n"),s("span",{class:"token punctuation"},"}"),s("span",{class:"token punctuation"},","),a(),s("span",{class:"token number"},"0"),s("span",{class:"token punctuation"},")"),a("\n"),s("span",{class:"token function"},"setTimeout"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),s("span",{class:"token operator"},"=>"),s("span",{class:"token punctuation"},"{"),a("\n    console"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"log"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'timer2'"),s("span",{class:"token punctuation"},")"),a("\n    Promise"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"resolve"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"then"),s("span",{class:"token punctuation"},"("),s("span",{class:"token keyword"},"function"),s("span",{class:"token punctuation"},"("),s("span",{class:"token punctuation"},")"),a(),s("span",{class:"token punctuation"},"{"),a("\n        console"),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"log"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'promise2'"),s("span",{class:"token punctuation"},")"),a("\n    "),s("span",{class:"token punctuation"},"}"),s("span",{class:"token punctuation"},")"),a("\n"),s("span",{class:"token punctuation"},"}"),s("span",{class:"token punctuation"},","),a(),s("span",{class:"token number"},"0"),s("span",{class:"token punctuation"},")"),a("\n\n")]),s("div",{class:"m-mdic-copy-wrapper"},[s("div",{class:"u-mdic-copy-notify",id:"j-notify-1629558019148-57168"},"复制成功"),s("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"setTimeout(()=>{\n    console.log('timer1')\n    Promise.resolve().then(function() {\n        console.log('promise1')\n    })\n}, 0)\nsetTimeout(()=>{\n    console.log('timer2')\n    Promise.resolve().then(function() {\n        console.log('promise2')\n    })\n}, 0)\n\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629558019148-57168","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),s("div",{class:"line-numbers-wrapper"},[s("span",{class:"line-number"},"1"),s("br"),s("span",{class:"line-number"},"2"),s("br"),s("span",{class:"line-number"},"3"),s("br"),s("span",{class:"line-number"},"4"),s("br"),s("span",{class:"line-number"},"5"),s("br"),s("span",{class:"line-number"},"6"),s("br"),s("span",{class:"line-number"},"7"),s("br"),s("span",{class:"line-number"},"8"),s("br"),s("span",{class:"line-number"},"9"),s("br"),s("span",{class:"line-number"},"10"),s("br"),s("span",{class:"line-number"},"11"),s("br"),s("span",{class:"line-number"},"12"),s("br"),s("span",{class:"line-number"},"13"),s("br")])],-1),N=e('',13);c.render=function(e,s,a,o,c,j){return n(),t("div",null,[l,i,p,r,u,d,m,k,h,b,g,y,f,v,T,C,I,_,x,P,S,w,N])};export default c;export{o as __pageData};
