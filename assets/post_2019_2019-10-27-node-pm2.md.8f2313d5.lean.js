import{o as n,c as s,f as a,a as t,x as e}from"./app.5f3fb606.js";const o='{"title":"Nodejs通用业务模块","description":"","frontmatter":{"title":"Nodejs通用业务模块","tag":["nodejs","daemon","shell","pm2","forever","egg","npm link"],"author":"Artiely","date":"2019-10-27","cover":"https://gitee.com/artiely/Figure-bed/raw/master/images/20200315143706.png","base64":"2c3033"},"headers":[{"level":2,"title":"目标","slug":"目标"},{"level":2,"title":"进程守护","slug":"进程守护"},{"level":3,"title":"控制终端 是什么？","slug":"控制终端-是什么"},{"level":3,"title":"如何实现守护进程","slug":"如何实现守护进程"},{"level":2,"title":"需要进程守护的原因","slug":"需要进程守护的原因"},{"level":2,"title":"常用进程守护方案","slug":"常用进程守护方案"},{"level":3,"title":"PM2","slug":"pm2"},{"level":3,"title":"Forever","slug":"forever"},{"level":3,"title":"Egg","slug":"egg"},{"level":2,"title":"从源码分析EGG进程管理","slug":"从源码分析egg进程管理"},{"level":3,"title":"从命令行开始","slug":"从命令行开始"},{"level":3,"title":"npm link","slug":"npm-link"},{"level":3,"title":"Egg-Scripts流程","slug":"egg-scripts流程"},{"level":3,"title":"egg-cluster","slug":"egg-cluster"}],"relativePath":"post/2019/2019-10-27-node-pm2.md","lastUpdated":1629110830206}',c={},p=a('',15),l=t("div",{class:"language-"},[t("pre",null,[t("code",null,"nohup node http.js &\n"),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989441-58738"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"nohup node http.js &\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989441-58738","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br")])],-1),i=t("h4",{id:"nodejs"},[t("a",{class:"header-anchor",href:"#nodejs","aria-hidden":"true"},"#"),e(" nodejs")],-1),r=t("p",null,"核心： detached， 帮助父子进程脱离关系",-1),u=t("div",{class:"language-js line-numbers-mode"},[t("pre",null,[t("code",null,[t("span",{class:"token keyword"},"var"),e(" spawn "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'child_process'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},"."),e("spawn"),t("span",{class:"token punctuation"},";"),e("\n\n"),t("span",{class:"token keyword"},"const"),e(" ls "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"spawn"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'node'"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token punctuation"},"["),t("span",{class:"token string"},"'http.js'"),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token punctuation"},"{"),e("\n    detached"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token boolean"},"true"),e("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n\nls"),t("span",{class:"token punctuation"},"."),e("stdout"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"on"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'data'"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},"data"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token operator"},"=>"),e(),t("span",{class:"token punctuation"},"{"),e("\n  console"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"log"),t("span",{class:"token punctuation"},"("),t("span",{class:"token template-string"},[t("span",{class:"token template-punctuation string"},"`"),t("span",{class:"token string"},"stdout: "),t("span",{class:"token interpolation"},[t("span",{class:"token interpolation-punctuation punctuation"},"${"),e("data"),t("span",{class:"token interpolation-punctuation punctuation"},"}")]),t("span",{class:"token template-punctuation string"},"`")]),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n\nls"),t("span",{class:"token punctuation"},"."),e("stderr"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"on"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'data'"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},"data"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token operator"},"=>"),e(),t("span",{class:"token punctuation"},"{"),e("\n  console"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"error"),t("span",{class:"token punctuation"},"("),t("span",{class:"token template-string"},[t("span",{class:"token template-punctuation string"},"`"),t("span",{class:"token string"},"stderr: "),t("span",{class:"token interpolation"},[t("span",{class:"token interpolation-punctuation punctuation"},"${"),e("data"),t("span",{class:"token interpolation-punctuation punctuation"},"}")]),t("span",{class:"token template-punctuation string"},"`")]),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n\nls"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"on"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'close'"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},"code"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token operator"},"=>"),e(),t("span",{class:"token punctuation"},"{"),e("\n  console"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"log"),t("span",{class:"token punctuation"},"("),t("span",{class:"token template-string"},[t("span",{class:"token template-punctuation string"},"`"),t("span",{class:"token string"},"子进程退出，退出码 "),t("span",{class:"token interpolation"},[t("span",{class:"token interpolation-punctuation punctuation"},"${"),e("code"),t("span",{class:"token interpolation-punctuation punctuation"},"}")]),t("span",{class:"token template-punctuation string"},"`")]),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n\n")]),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989441-47034"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"var spawn = require('child_process').spawn;\n\nconst ls = spawn('node', ['http.js'], {\n    detached: true\n});\n\nls.stdout.on('data', (data) => {\n  console.log(`stdout: ${data}`);\n});\n\nls.stderr.on('data', (data) => {\n  console.error(`stderr: ${data}`);\n});\n\nls.on('close', (code) => {\n  console.log(`子进程退出，退出码 ${code}`);\n});\n\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989441-47034","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br"),t("span",{class:"line-number"},"4"),t("br"),t("span",{class:"line-number"},"5"),t("br"),t("span",{class:"line-number"},"6"),t("br"),t("span",{class:"line-number"},"7"),t("br"),t("span",{class:"line-number"},"8"),t("br"),t("span",{class:"line-number"},"9"),t("br"),t("span",{class:"line-number"},"10"),t("br"),t("span",{class:"line-number"},"11"),t("br"),t("span",{class:"line-number"},"12"),t("br"),t("span",{class:"line-number"},"13"),t("br"),t("span",{class:"line-number"},"14"),t("br"),t("span",{class:"line-number"},"15"),t("br"),t("span",{class:"line-number"},"16"),t("br"),t("span",{class:"line-number"},"17"),t("br"),t("span",{class:"line-number"},"18"),t("br")])],-1),k=a('',7),d=t("div",{class:"language-js line-numbers-mode"},[t("pre",null,[t("code",null,[t("span",{class:"token keyword"},"var"),e(" http "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'http'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n\n"),t("span",{class:"token keyword"},"var"),e(" server "),t("span",{class:"token operator"},"="),e(" http"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"createServer"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},[e("req"),t("span",{class:"token punctuation"},","),e(" res")]),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token operator"},"=>"),e(),t("span",{class:"token punctuation"},"{"),e("\n    "),t("span",{class:"token keyword"},"if"),t("span",{class:"token punctuation"},"("),e("req"),t("span",{class:"token punctuation"},"."),e("url "),t("span",{class:"token operator"},"==="),e(),t("span",{class:"token string"},"'/zqz'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},"{"),e("\n        "),t("span",{class:"token keyword"},"throw"),e(),t("span",{class:"token string"},"'req Error'"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token punctuation"},"}"),e("\n    res"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"end"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'Hello world!'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"listen"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'3000'"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'localhost'"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token operator"},"=>"),e(),t("span",{class:"token punctuation"},"{"),e("\n    console"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"log"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'Server running...'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n")]),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989442-85067"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"var http = require('http');\n\nvar server = http.createServer((req, res) => {\n    if(req.url === '/zqz'){\n        throw 'req Error';\n    }\n    res.end('Hello world!');\n}).listen('3000', 'localhost', () => {\n    console.log('Server running...');\n});\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989442-85067","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br"),t("span",{class:"line-number"},"4"),t("br"),t("span",{class:"line-number"},"5"),t("br"),t("span",{class:"line-number"},"6"),t("br"),t("span",{class:"line-number"},"7"),t("br"),t("span",{class:"line-number"},"8"),t("br"),t("span",{class:"line-number"},"9"),t("br"),t("span",{class:"line-number"},"10"),t("br")])],-1),m=t("p",null,"我们请求localhost:3000",-1),b=t("div",{class:"language-"},[t("pre",null,[t("code",null," $  node index.js\nServer running...\n"),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989442-80951"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":" $  node index.js\nServer running...\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989442-80951","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br")])],-1),g=a('',5),y=t("div",{class:"language-"},[t("pre",null,[t("code",null,"npm install pm2 -g\n"),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989442-89934"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"npm install pm2 -g\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989442-89934","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br")])],-1),h=t("p",null,"启动服务：",-1),f=t("div",{class:"language-"},[t("pre",null,[t("code",null,"pm2 start app.js\n"),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989442-82616"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"pm2 start app.js\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989442-82616","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br")])],-1),v=t("p",null,[t("img",{src:"https://gitee.com/artiely/Figure-bed/raw/master/images/20200314161902.png",alt:"image-20191027012935914"})],-1),w=t("h3",{id:"forever"},[t("a",{class:"header-anchor",href:"#forever","aria-hidden":"true"},"#"),e(" Forever")],-1),C=t("p",null,[t("img",{src:"https://gitee.com/artiely/Figure-bed/raw/master/images/20200314161909.png",alt:"image-20191027012925383"})],-1),j=t("div",{class:"language-"},[t("pre",null,[t("code",null,"npm install forever -g\n"),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989442-88390"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"npm install forever -g\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989442-88390","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br")])],-1),x=t("p",null,"启动服务:",-1),_=t("div",{class:"language-"},[t("pre",null,[t("code",null,"forever start app.js\n"),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989442-46832"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"forever start app.js\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989442-46832","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br")])],-1),E=t("h3",{id:"egg"},[t("a",{class:"header-anchor",href:"#egg","aria-hidden":"true"},"#"),e(" Egg")],-1),A=t("p",null,"启动命令",-1),$=t("div",{class:"language-"},[t("pre",null,[t("code",null,"npm run start\n"),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989442-69993"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"npm run start\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989442-69993","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br")])],-1),D=t("p",null,"引用：package.json",-1),T=t("div",{class:"language-js line-numbers-mode"},[t("pre",null,[t("code",null,[e("  "),t("span",{class:"token string"},'"scripts"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token punctuation"},"{"),e("\n    "),t("span",{class:"token string"},'"start"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"egg-scripts start --daemon --title=egg-server-demo"'),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token string"},'"stop"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"egg-scripts stop --title=egg-server-demo"'),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token string"},'"dev"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"egg-bin dev"'),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token string"},'"debug"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"egg-bin debug"'),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token string"},'"test"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"npm run lint -- --fix && npm run test-local"'),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token string"},'"test-local"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"egg-bin test"'),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token string"},'"cov"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"egg-bin cov"'),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token string"},'"lint"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"eslint ."'),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token string"},'"ci"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"npm run lint && npm run cov"'),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token string"},'"autod"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"autod"'),e("\n  "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},","),e("\n")]),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989442-83263"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'  "scripts": {\n    "start": "egg-scripts start --daemon --title=egg-server-demo",\n    "stop": "egg-scripts stop --title=egg-server-demo",\n    "dev": "egg-bin dev",\n    "debug": "egg-bin debug",\n    "test": "npm run lint -- --fix && npm run test-local",\n    "test-local": "egg-bin test",\n    "cov": "egg-bin cov",\n    "lint": "eslint .",\n    "ci": "npm run lint && npm run cov",\n    "autod": "autod"\n  },\n',"data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989442-83263","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br"),t("span",{class:"line-number"},"4"),t("br"),t("span",{class:"line-number"},"5"),t("br"),t("span",{class:"line-number"},"6"),t("br"),t("span",{class:"line-number"},"7"),t("br"),t("span",{class:"line-number"},"8"),t("br"),t("span",{class:"line-number"},"9"),t("br"),t("span",{class:"line-number"},"10"),t("br"),t("span",{class:"line-number"},"11"),t("br"),t("span",{class:"line-number"},"12"),t("br")])],-1),S=a('',6),N=t("div",{class:"language-js line-numbers-mode"},[t("pre",null,[t("code",null,[t("span",{class:"token punctuation"},"{"),e("\n  "),t("span",{class:"token string"},'"name"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"demo"'),t("span",{class:"token punctuation"},","),e("\n  "),t("span",{class:"token string"},'"version"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"1.0.0"'),t("span",{class:"token punctuation"},","),e("\n  "),t("span",{class:"token string"},'"description"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'""'),t("span",{class:"token punctuation"},","),e("\n  "),t("span",{class:"token string"},'"private"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token boolean"},"true"),t("span",{class:"token punctuation"},","),e("\n  "),t("span",{class:"token string"},'"egg"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token punctuation"},"{"),e("\n    "),t("span",{class:"token string"},'"declarations"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token boolean"},"true"),e("\n  "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},","),e("\n  "),t("span",{class:"token string"},'"dependencies"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token punctuation"},"{"),e("\n    "),t("span",{class:"token string"},'"egg"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"^2.15.1"'),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token string"},'"egg-scripts"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"^2.11.0"'),e("\n  "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},","),e("\n  "),t("span",{class:"token string"},'"devDependencies"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token punctuation"},"{"),e("\n    "),t("span",{class:"token string"},'"autod"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"^3.0.1"'),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token string"},'"autod-egg"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"^1.1.0"'),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token string"},'"egg-bin"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"^4.11.0"'),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token string"},'"egg-ci"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"^1.11.0"'),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token string"},'"egg-mock"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"^3.21.0"'),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token string"},'"eslint"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"^5.13.0"'),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token string"},'"eslint-config-egg"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"^7.1.0"'),e("\n  "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},","),e("\n  "),t("span",{class:"token string"},'"engines"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token punctuation"},"{"),e("\n    "),t("span",{class:"token string"},'"node"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'">=10.0.0"'),e("\n  "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},","),e("\n  "),t("span",{class:"token string"},'"scripts"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token punctuation"},"{"),e("\n    "),t("span",{class:"token string"},'"start"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"egg-scripts start --daemon --title=egg-server-demo"'),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token string"},'"stop"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"egg-scripts stop --title=egg-server-demo"'),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token string"},'"dev"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"egg-bin dev"'),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token string"},'"debug"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"egg-bin debug"'),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token string"},'"test"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"npm run lint -- --fix && npm run test-local"'),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token string"},'"test-local"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"egg-bin test"'),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token string"},'"cov"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"egg-bin cov"'),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token string"},'"lint"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"eslint ."'),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token string"},'"ci"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"npm run lint && npm run cov"'),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token string"},'"autod"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"autod"'),e("\n  "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},","),e("\n  "),t("span",{class:"token string"},'"ci"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token punctuation"},"{"),e("\n    "),t("span",{class:"token string"},'"version"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"10"'),e("\n  "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},","),e("\n  "),t("span",{class:"token string"},'"repository"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token punctuation"},"{"),e("\n    "),t("span",{class:"token string"},'"type"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"git"'),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token string"},'"url"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'""'),e("\n  "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},","),e("\n  "),t("span",{class:"token string"},'"author"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'""'),t("span",{class:"token punctuation"},","),e("\n  "),t("span",{class:"token string"},'"license"'),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},'"MIT"'),e("\n"),t("span",{class:"token punctuation"},"}"),e("\n\n")]),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989442-81787"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":'{\n  "name": "demo",\n  "version": "1.0.0",\n  "description": "",\n  "private": true,\n  "egg": {\n    "declarations": true\n  },\n  "dependencies": {\n    "egg": "^2.15.1",\n    "egg-scripts": "^2.11.0"\n  },\n  "devDependencies": {\n    "autod": "^3.0.1",\n    "autod-egg": "^1.1.0",\n    "egg-bin": "^4.11.0",\n    "egg-ci": "^1.11.0",\n    "egg-mock": "^3.21.0",\n    "eslint": "^5.13.0",\n    "eslint-config-egg": "^7.1.0"\n  },\n  "engines": {\n    "node": ">=10.0.0"\n  },\n  "scripts": {\n    "start": "egg-scripts start --daemon --title=egg-server-demo",\n    "stop": "egg-scripts stop --title=egg-server-demo",\n    "dev": "egg-bin dev",\n    "debug": "egg-bin debug",\n    "test": "npm run lint -- --fix && npm run test-local",\n    "test-local": "egg-bin test",\n    "cov": "egg-bin cov",\n    "lint": "eslint .",\n    "ci": "npm run lint && npm run cov",\n    "autod": "autod"\n  },\n  "ci": {\n    "version": "10"\n  },\n  "repository": {\n    "type": "git",\n    "url": ""\n  },\n  "author": "",\n  "license": "MIT"\n}\n\n',"data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989442-81787","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br"),t("span",{class:"line-number"},"4"),t("br"),t("span",{class:"line-number"},"5"),t("br"),t("span",{class:"line-number"},"6"),t("br"),t("span",{class:"line-number"},"7"),t("br"),t("span",{class:"line-number"},"8"),t("br"),t("span",{class:"line-number"},"9"),t("br"),t("span",{class:"line-number"},"10"),t("br"),t("span",{class:"line-number"},"11"),t("br"),t("span",{class:"line-number"},"12"),t("br"),t("span",{class:"line-number"},"13"),t("br"),t("span",{class:"line-number"},"14"),t("br"),t("span",{class:"line-number"},"15"),t("br"),t("span",{class:"line-number"},"16"),t("br"),t("span",{class:"line-number"},"17"),t("br"),t("span",{class:"line-number"},"18"),t("br"),t("span",{class:"line-number"},"19"),t("br"),t("span",{class:"line-number"},"20"),t("br"),t("span",{class:"line-number"},"21"),t("br"),t("span",{class:"line-number"},"22"),t("br"),t("span",{class:"line-number"},"23"),t("br"),t("span",{class:"line-number"},"24"),t("br"),t("span",{class:"line-number"},"25"),t("br"),t("span",{class:"line-number"},"26"),t("br"),t("span",{class:"line-number"},"27"),t("br"),t("span",{class:"line-number"},"28"),t("br"),t("span",{class:"line-number"},"29"),t("br"),t("span",{class:"line-number"},"30"),t("br"),t("span",{class:"line-number"},"31"),t("br"),t("span",{class:"line-number"},"32"),t("br"),t("span",{class:"line-number"},"33"),t("br"),t("span",{class:"line-number"},"34"),t("br"),t("span",{class:"line-number"},"35"),t("br"),t("span",{class:"line-number"},"36"),t("br"),t("span",{class:"line-number"},"37"),t("br"),t("span",{class:"line-number"},"38"),t("br"),t("span",{class:"line-number"},"39"),t("br"),t("span",{class:"line-number"},"40"),t("br"),t("span",{class:"line-number"},"41"),t("br"),t("span",{class:"line-number"},"42"),t("br"),t("span",{class:"line-number"},"43"),t("br"),t("span",{class:"line-number"},"44"),t("br"),t("span",{class:"line-number"},"45"),t("br"),t("span",{class:"line-number"},"46"),t("br"),t("span",{class:"line-number"},"47"),t("br")])],-1),I=t("h3",{id:"从命令行开始"},[t("a",{class:"header-anchor",href:"#从命令行开始","aria-hidden":"true"},"#"),e(" 从命令行开始")],-1),q=t("div",{class:"language-js line-numbers-mode"},[t("pre",null,[t("code",null,[t("span",{class:"token keyword"},"class"),e(),t("span",{class:"token class-name"},"EggScripts"),e(),t("span",{class:"token keyword"},"extends"),e(),t("span",{class:"token class-name"},"Command"),e(),t("span",{class:"token punctuation"},"{"),e("\n  "),t("span",{class:"token function"},"constructor"),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},"rawArgv"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e("\n    "),t("span",{class:"token keyword"},"super"),t("span",{class:"token punctuation"},"("),e("rawArgv"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("usage "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token string"},"'Usage: egg-scripts [command] [options]'"),t("span",{class:"token punctuation"},";"),e("\n\n    "),t("span",{class:"token comment"},"// load directory"),e("\n    "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"load"),t("span",{class:"token punctuation"},"("),e("path"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"join"),t("span",{class:"token punctuation"},"("),e("__dirname"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'lib/cmd'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n  "),t("span",{class:"token punctuation"},"}"),e("\n"),t("span",{class:"token punctuation"},"}"),e("\n")]),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989442-15484"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"class EggScripts extends Command {\n  constructor(rawArgv) {\n    super(rawArgv);\n    this.usage = 'Usage: egg-scripts [command] [options]';\n\n    // load directory\n    this.load(path.join(__dirname, 'lib/cmd'));\n  }\n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989442-15484","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br"),t("span",{class:"line-number"},"4"),t("br"),t("span",{class:"line-number"},"5"),t("br"),t("span",{class:"line-number"},"6"),t("br"),t("span",{class:"line-number"},"7"),t("br"),t("span",{class:"line-number"},"8"),t("br"),t("span",{class:"line-number"},"9"),t("br")])],-1),P=t("p",null,"看看Command来自哪里？",-1),R=t("div",{class:"language-js line-numbers-mode"},[t("pre",null,[t("code",null,[t("span",{class:"token keyword"},"const"),e(" BaseCommand "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'common-bin'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n"),t("span",{class:"token keyword"},"class"),e(),t("span",{class:"token class-name"},"Command"),e(),t("span",{class:"token keyword"},"extends"),e(),t("span",{class:"token class-name"},"BaseCommand"),e(),t("span",{class:"token punctuation"},"{"),e("\n  \n"),t("span",{class:"token punctuation"},"}"),e("\n")]),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989442-64356"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"const BaseCommand = require('common-bin');\nclass Command extends BaseCommand {\n  \n}\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989442-64356","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br"),t("span",{class:"line-number"},"4"),t("br")])],-1),F=t("h4",{id:"common-bin"},[t("a",{class:"header-anchor",href:"#common-bin","aria-hidden":"true"},"#"),e(" common-bin")],-1),O=t("p",null,[t("a",{href:"https://github.com/node-modules/common-bin",target:"_blank",rel:"noopener noreferrer"},"https://github.com/node-modules/common-bin")],-1),G=t("p",null,"BaseCommand其实是对命令行的一种抽象，可以方便我们进行命令行工具的业务编写。",-1),B=t("p",null,"目录规范：与Egg-scripts一致",-1),z=t("div",{class:"language-"},[t("pre",null,[t("code",null,"test/fixtures/my-git\n├── bin\n│   └── my-git.js\n├── command\n│   ├── remote\n│   │   ├── add.js\n│   │   └── remove.js\n│   ├── clone.js\n│   └── remote.js\n├── index.js\n└── package.json\n"),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989442-29806"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"test/fixtures/my-git\n├── bin\n│   └── my-git.js\n├── command\n│   ├── remote\n│   │   ├── add.js\n│   │   └── remove.js\n│   ├── clone.js\n│   └── remote.js\n├── index.js\n└── package.json\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989442-29806","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br"),t("span",{class:"line-number"},"4"),t("br"),t("span",{class:"line-number"},"5"),t("br"),t("span",{class:"line-number"},"6"),t("br"),t("span",{class:"line-number"},"7"),t("br"),t("span",{class:"line-number"},"8"),t("br"),t("span",{class:"line-number"},"9"),t("br"),t("span",{class:"line-number"},"10"),t("br"),t("span",{class:"line-number"},"11"),t("br")])],-1),V=t("h4",{id:"commandjs"},[t("a",{class:"header-anchor",href:"#commandjs","aria-hidden":"true"},"#"),e(" command.js")],-1),M=t("p",null,"主要集中在sourcemap参数的处理。",-1),L=t("div",{class:"language-js line-numbers-mode"},[t("pre",null,[t("code",null,[t("span",{class:"token string"},"'use strict'"),t("span",{class:"token punctuation"},";"),e("\n\n"),t("span",{class:"token keyword"},"const"),e(" fs "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'fs'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n"),t("span",{class:"token keyword"},"const"),e(" path "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'path'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n"),t("span",{class:"token keyword"},"const"),e(" BaseCommand "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'common-bin'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n"),t("span",{class:"token keyword"},"const"),e(" Logger "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'zlogger'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n"),t("span",{class:"token keyword"},"const"),e(" helper "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'./helper'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n\n"),t("span",{class:"token keyword"},"class"),e(),t("span",{class:"token class-name"},"Command"),e(),t("span",{class:"token keyword"},"extends"),e(),t("span",{class:"token class-name"},"BaseCommand"),e(),t("span",{class:"token punctuation"},"{"),e("\n  "),t("span",{class:"token function"},"constructor"),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},"rawArgv"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e("\n    "),t("span",{class:"token keyword"},"super"),t("span",{class:"token punctuation"},"("),e("rawArgv"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n\n    Object"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"assign"),t("span",{class:"token punctuation"},"("),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("helper"),t("span",{class:"token punctuation"},","),e(" helper"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n\n    "),t("span",{class:"token comment"},"// 参数的解析规则"),e("\n    "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("parserOptions "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token punctuation"},"{"),e("\n      removeAlias"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token boolean"},"true"),t("span",{class:"token punctuation"},","),e("\n      removeCamelCase"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token boolean"},"true"),t("span",{class:"token punctuation"},","),e("\n      execArgv"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token boolean"},"true"),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},";"),e("\n\n    "),t("span",{class:"token comment"},"// common-bin setter, don't care about override at sub class"),e("\n    "),t("span",{class:"token comment"},"// https://github.com/node-modules/common-bin/blob/master/lib/command.js#L158"),e("\n    "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("options "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token punctuation"},"{"),e("\n      sourcemap"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token punctuation"},"{"),e("\n        description"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},"'whether enable sourcemap support, will load `source-map-support` etc'"),t("span",{class:"token punctuation"},","),e("\n        type"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},"'boolean'"),t("span",{class:"token punctuation"},","),e("\n        alias"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token punctuation"},"["),e(),t("span",{class:"token string"},"'ts'"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'typescript'"),e(),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},","),e("\n      "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},";"),e("\n\n    "),t("span",{class:"token comment"},"// 日志对于服务器来说也非常的重要  "),e("\n    "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("logger "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token keyword"},"new"),e(),t("span",{class:"token class-name"},"Logger"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},"{"),e("\n      prefix"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},"'[egg-scripts] '"),t("span",{class:"token punctuation"},","),e("\n      time"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token boolean"},"false"),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n  "),t("span",{class:"token punctuation"},"}"),e("\n\n  "),t("span",{class:"token keyword"},"get"),e(),t("span",{class:"token function"},"context"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e("\n    "),t("span",{class:"token comment"},"// 环境信息 以及参数"),e("\n    "),t("span",{class:"token keyword"},"const"),e(" context "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token keyword"},"super"),t("span",{class:"token punctuation"},"."),e("context"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token keyword"},"const"),e(),t("span",{class:"token punctuation"},"{"),e(" argv"),t("span",{class:"token punctuation"},","),e(" execArgvObj"),t("span",{class:"token punctuation"},","),e(" cwd "),t("span",{class:"token punctuation"},"}"),e(),t("span",{class:"token operator"},"="),e(" context"),t("span",{class:"token punctuation"},";"),e("\n\n    "),t("span",{class:"token comment"},"// read `egg.typescript` from package.json"),e("\n    "),t("span",{class:"token keyword"},"let"),e(" baseDir "),t("span",{class:"token operator"},"="),e(" argv"),t("span",{class:"token punctuation"},"."),e("_"),t("span",{class:"token punctuation"},"["),t("span",{class:"token number"},"0"),t("span",{class:"token punctuation"},"]"),e(),t("span",{class:"token operator"},"||"),e(" cwd"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token keyword"},"if"),e(),t("span",{class:"token punctuation"},"("),t("span",{class:"token operator"},"!"),e("path"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"isAbsolute"),t("span",{class:"token punctuation"},"("),e("baseDir"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),e(" baseDir "),t("span",{class:"token operator"},"="),e(" path"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"join"),t("span",{class:"token punctuation"},"("),e("cwd"),t("span",{class:"token punctuation"},","),e(" baseDir"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token keyword"},"const"),e(" pkgFile "),t("span",{class:"token operator"},"="),e(" path"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"join"),t("span",{class:"token punctuation"},"("),e("baseDir"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'package.json'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token keyword"},"if"),e(),t("span",{class:"token punctuation"},"("),e("fs"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"existsSync"),t("span",{class:"token punctuation"},"("),e("pkgFile"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e("\n      "),t("span",{class:"token keyword"},"const"),e(" pkgInfo "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),e("pkgFile"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n      "),t("span",{class:"token keyword"},"if"),e(),t("span",{class:"token punctuation"},"("),e("pkgInfo "),t("span",{class:"token operator"},"&&"),e(" pkgInfo"),t("span",{class:"token punctuation"},"."),e("egg "),t("span",{class:"token operator"},"&&"),e(" pkgInfo"),t("span",{class:"token punctuation"},"."),e("egg"),t("span",{class:"token punctuation"},"."),e("typescript"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e("\n        argv"),t("span",{class:"token punctuation"},"."),e("sourcemap "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token boolean"},"true"),t("span",{class:"token punctuation"},";"),e("\n      "),t("span",{class:"token punctuation"},"}"),e("\n    "),t("span",{class:"token punctuation"},"}"),e("\n\n    "),t("span",{class:"token comment"},"// execArgv"),e("\n    "),t("span",{class:"token keyword"},"if"),e(),t("span",{class:"token punctuation"},"("),e("argv"),t("span",{class:"token punctuation"},"."),e("sourcemap"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e("\n      execArgvObj"),t("span",{class:"token punctuation"},"."),e("require "),t("span",{class:"token operator"},"="),e(" execArgvObj"),t("span",{class:"token punctuation"},"."),e("require "),t("span",{class:"token operator"},"||"),e(),t("span",{class:"token punctuation"},"["),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},";"),e("\n      execArgvObj"),t("span",{class:"token punctuation"},"."),e("require"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"push"),t("span",{class:"token punctuation"},"("),e("require"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"resolve"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'source-map-support/register'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token punctuation"},"}"),e("\n\n    argv"),t("span",{class:"token punctuation"},"."),e("sourcemap "),t("span",{class:"token operator"},"="),e(" argv"),t("span",{class:"token punctuation"},"."),e("typescript "),t("span",{class:"token operator"},"="),e(" argv"),t("span",{class:"token punctuation"},"."),e("ts "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token keyword"},"undefined"),t("span",{class:"token punctuation"},";"),e("\n\n    "),t("span",{class:"token keyword"},"return"),e(" context"),t("span",{class:"token punctuation"},";"),e("\n  "),t("span",{class:"token punctuation"},"}"),e("\n\n  "),t("span",{class:"token function"},"exit"),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},"code"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e("\n    process"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"exit"),t("span",{class:"token punctuation"},"("),e("code"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n  "),t("span",{class:"token punctuation"},"}"),e("\n"),t("span",{class:"token punctuation"},"}"),e("\n\nmodule"),t("span",{class:"token punctuation"},"."),e("exports "),t("span",{class:"token operator"},"="),e(" Command"),t("span",{class:"token punctuation"},";"),e("\n\n")]),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989442-91157"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"'use strict';\n\nconst fs = require('fs');\nconst path = require('path');\nconst BaseCommand = require('common-bin');\nconst Logger = require('zlogger');\nconst helper = require('./helper');\n\nclass Command extends BaseCommand {\n  constructor(rawArgv) {\n    super(rawArgv);\n\n    Object.assign(this.helper, helper);\n\n    // 参数的解析规则\n    this.parserOptions = {\n      removeAlias: true,\n      removeCamelCase: true,\n      execArgv: true,\n    };\n\n    // common-bin setter, don't care about override at sub class\n    // https://github.com/node-modules/common-bin/blob/master/lib/command.js#L158\n    this.options = {\n      sourcemap: {\n        description: 'whether enable sourcemap support, will load `source-map-support` etc',\n        type: 'boolean',\n        alias: [ 'ts', 'typescript' ],\n      },\n    };\n\n    // 日志对于服务器来说也非常的重要  \n    this.logger = new Logger({\n      prefix: '[egg-scripts] ',\n      time: false,\n    });\n  }\n\n  get context() {\n    // 环境信息 以及参数\n    const context = super.context;\n    const { argv, execArgvObj, cwd } = context;\n\n    // read `egg.typescript` from package.json\n    let baseDir = argv._[0] || cwd;\n    if (!path.isAbsolute(baseDir)) baseDir = path.join(cwd, baseDir);\n    const pkgFile = path.join(baseDir, 'package.json');\n    if (fs.existsSync(pkgFile)) {\n      const pkgInfo = require(pkgFile);\n      if (pkgInfo && pkgInfo.egg && pkgInfo.egg.typescript) {\n        argv.sourcemap = true;\n      }\n    }\n\n    // execArgv\n    if (argv.sourcemap) {\n      execArgvObj.require = execArgvObj.require || [];\n      execArgvObj.require.push(require.resolve('source-map-support/register'));\n    }\n\n    argv.sourcemap = argv.typescript = argv.ts = undefined;\n\n    return context;\n  }\n\n  exit(code) {\n    process.exit(code);\n  }\n}\n\nmodule.exports = Command;\n\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989442-91157","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br"),t("span",{class:"line-number"},"4"),t("br"),t("span",{class:"line-number"},"5"),t("br"),t("span",{class:"line-number"},"6"),t("br"),t("span",{class:"line-number"},"7"),t("br"),t("span",{class:"line-number"},"8"),t("br"),t("span",{class:"line-number"},"9"),t("br"),t("span",{class:"line-number"},"10"),t("br"),t("span",{class:"line-number"},"11"),t("br"),t("span",{class:"line-number"},"12"),t("br"),t("span",{class:"line-number"},"13"),t("br"),t("span",{class:"line-number"},"14"),t("br"),t("span",{class:"line-number"},"15"),t("br"),t("span",{class:"line-number"},"16"),t("br"),t("span",{class:"line-number"},"17"),t("br"),t("span",{class:"line-number"},"18"),t("br"),t("span",{class:"line-number"},"19"),t("br"),t("span",{class:"line-number"},"20"),t("br"),t("span",{class:"line-number"},"21"),t("br"),t("span",{class:"line-number"},"22"),t("br"),t("span",{class:"line-number"},"23"),t("br"),t("span",{class:"line-number"},"24"),t("br"),t("span",{class:"line-number"},"25"),t("br"),t("span",{class:"line-number"},"26"),t("br"),t("span",{class:"line-number"},"27"),t("br"),t("span",{class:"line-number"},"28"),t("br"),t("span",{class:"line-number"},"29"),t("br"),t("span",{class:"line-number"},"30"),t("br"),t("span",{class:"line-number"},"31"),t("br"),t("span",{class:"line-number"},"32"),t("br"),t("span",{class:"line-number"},"33"),t("br"),t("span",{class:"line-number"},"34"),t("br"),t("span",{class:"line-number"},"35"),t("br"),t("span",{class:"line-number"},"36"),t("br"),t("span",{class:"line-number"},"37"),t("br"),t("span",{class:"line-number"},"38"),t("br"),t("span",{class:"line-number"},"39"),t("br"),t("span",{class:"line-number"},"40"),t("br"),t("span",{class:"line-number"},"41"),t("br"),t("span",{class:"line-number"},"42"),t("br"),t("span",{class:"line-number"},"43"),t("br"),t("span",{class:"line-number"},"44"),t("br"),t("span",{class:"line-number"},"45"),t("br"),t("span",{class:"line-number"},"46"),t("br"),t("span",{class:"line-number"},"47"),t("br"),t("span",{class:"line-number"},"48"),t("br"),t("span",{class:"line-number"},"49"),t("br"),t("span",{class:"line-number"},"50"),t("br"),t("span",{class:"line-number"},"51"),t("br"),t("span",{class:"line-number"},"52"),t("br"),t("span",{class:"line-number"},"53"),t("br"),t("span",{class:"line-number"},"54"),t("br"),t("span",{class:"line-number"},"55"),t("br"),t("span",{class:"line-number"},"56"),t("br"),t("span",{class:"line-number"},"57"),t("br"),t("span",{class:"line-number"},"58"),t("br"),t("span",{class:"line-number"},"59"),t("br"),t("span",{class:"line-number"},"60"),t("br"),t("span",{class:"line-number"},"61"),t("br"),t("span",{class:"line-number"},"62"),t("br"),t("span",{class:"line-number"},"63"),t("br"),t("span",{class:"line-number"},"64"),t("br"),t("span",{class:"line-number"},"65"),t("br"),t("span",{class:"line-number"},"66"),t("br"),t("span",{class:"line-number"},"67"),t("br"),t("span",{class:"line-number"},"68"),t("br"),t("span",{class:"line-number"},"69"),t("br"),t("span",{class:"line-number"},"70"),t("br"),t("span",{class:"line-number"},"71"),t("br"),t("span",{class:"line-number"},"72"),t("br")])],-1),H=a('',6),Y=t("div",{class:"language-js line-numbers-mode"},[t("pre",null,[t("code",null,[t("span",{class:"token string"},"'use strict'"),t("span",{class:"token punctuation"},";"),e("\n\n"),t("span",{class:"token keyword"},"const"),e(" path "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'path'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n\n"),t("span",{class:"token keyword"},"const"),e(" Command "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'../command'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n"),t("span",{class:"token keyword"},"const"),e(" debug "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'debug'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'egg-script:start'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n"),t("span",{class:"token keyword"},"const"),e(),t("span",{class:"token punctuation"},"{"),e(" execFile "),t("span",{class:"token punctuation"},"}"),e(),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'mz/child_process'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n"),t("span",{class:"token keyword"},"const"),e(" fs "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'mz/fs'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n"),t("span",{class:"token keyword"},"const"),e(" homedir "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'node-homedir'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n"),t("span",{class:"token keyword"},"const"),e(" mkdirp "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'mz-modules/mkdirp'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n"),t("span",{class:"token keyword"},"const"),e(" moment "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'moment'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n"),t("span",{class:"token keyword"},"const"),e(" sleep "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'mz-modules/sleep'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n"),t("span",{class:"token keyword"},"const"),e(" spawn "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'child_process'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},"."),e("spawn"),t("span",{class:"token punctuation"},";"),e("\n"),t("span",{class:"token comment"},"// 工具库"),e("\n"),t("span",{class:"token keyword"},"const"),e(" utils "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'egg-utils'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n\n"),t("span",{class:"token keyword"},"class"),e(),t("span",{class:"token class-name"},"StartCommand"),e(),t("span",{class:"token keyword"},"extends"),e(),t("span",{class:"token class-name"},"Command"),e(),t("span",{class:"token punctuation"},"{"),e("\n  "),t("span",{class:"token function"},"constructor"),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},"rawArgv"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e("\n    "),t("span",{class:"token keyword"},"super"),t("span",{class:"token punctuation"},"("),e("rawArgv"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("usage "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token string"},"'Usage: egg-scripts start [options] [baseDir]'"),t("span",{class:"token punctuation"},";"),e("\n\n    "),t("span",{class:"token comment"},"//自定义方法"),e("\n    "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("serverBin "),t("span",{class:"token operator"},"="),e(" path"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"join"),t("span",{class:"token punctuation"},"("),e("__dirname"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'../start-cluster'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token comment"},"// 参数定义"),e("\n    "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("options "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token punctuation"},"{"),e("\n      "),t("span",{class:"token comment"},"// 进程名称"),e("\n      title"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token punctuation"},"{"),e("\n        description"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},"'process title description, use for kill grep, default to `egg-server-${APP_NAME}`'"),t("span",{class:"token punctuation"},","),e("\n        type"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},"'string'"),t("span",{class:"token punctuation"},","),e("\n      "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},","),e("\n      "),t("span",{class:"token comment"},"// 指定创建多少个子进程"),e("\n      workers"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token punctuation"},"{"),e("\n        description"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},"'numbers of app workers, default to `os.cpus().length`'"),t("span",{class:"token punctuation"},","),e("\n        type"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},"'number'"),t("span",{class:"token punctuation"},","),e("\n        alias"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token punctuation"},"["),e(),t("span",{class:"token string"},"'c'"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'cluster'"),e(),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},","),e("\n        "),t("span",{class:"token keyword"},"default"),t("span",{class:"token operator"},":"),e(" process"),t("span",{class:"token punctuation"},"."),e("env"),t("span",{class:"token punctuation"},"."),t("span",{class:"token constant"},"EGG_WORKERS"),t("span",{class:"token punctuation"},","),e("\n      "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},","),e("\n\n      port"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token punctuation"},"{"),e("\n        description"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},[e("'listening port, default to `process."),t("wbr"),e("env.PORT`'")]),t("span",{class:"token punctuation"},","),e("\n        type"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},"'number'"),t("span",{class:"token punctuation"},","),e("\n        alias"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},"'p'"),t("span",{class:"token punctuation"},","),e("\n        "),t("span",{class:"token keyword"},"default"),t("span",{class:"token operator"},":"),e(" process"),t("span",{class:"token punctuation"},"."),e("env"),t("span",{class:"token punctuation"},"."),t("span",{class:"token constant"},"PORT"),t("span",{class:"token punctuation"},","),e("\n      "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},","),e("\n      env"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token punctuation"},"{"),e("\n        description"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},[e("'server env, default to `process."),t("wbr"),e("env.EGG_SERVER_ENV`'")]),t("span",{class:"token punctuation"},","),e("\n        "),t("span",{class:"token keyword"},"default"),t("span",{class:"token operator"},":"),e(" process"),t("span",{class:"token punctuation"},"."),e("env"),t("span",{class:"token punctuation"},"."),t("span",{class:"token constant"},"EGG_SERVER_ENV"),t("span",{class:"token punctuation"},","),e("\n      "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},","),e("\n      "),t("span",{class:"token comment"},"// egg业务代码"),e("\n      framework"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token punctuation"},"{"),e("\n        description"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},"'specify framework that can be absolute path or npm package'"),t("span",{class:"token punctuation"},","),e("\n        type"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},"'string'"),t("span",{class:"token punctuation"},","),e("\n      "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},","),e("\n      daemon"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token punctuation"},"{"),e("\n        description"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},"'whether run at background daemon mode'"),t("span",{class:"token punctuation"},","),e("\n        type"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},"'boolean'"),t("span",{class:"token punctuation"},","),e("\n      "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},","),e("\n      stdout"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token punctuation"},"{"),e("\n        description"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},"'customize stdout file'"),t("span",{class:"token punctuation"},","),e("\n        type"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},"'string'"),t("span",{class:"token punctuation"},","),e("\n      "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},","),e("\n      stderr"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token punctuation"},"{"),e("\n        description"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},"'customize stderr file'"),t("span",{class:"token punctuation"},","),e("\n        type"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},"'string'"),t("span",{class:"token punctuation"},","),e("\n      "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},","),e("\n      timeout"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token punctuation"},"{"),e("\n        description"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},"'the maximum timeout when app starts'"),t("span",{class:"token punctuation"},","),e("\n        type"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},"'number'"),t("span",{class:"token punctuation"},","),e("\n        "),t("span",{class:"token keyword"},"default"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token number"},"300"),e(),t("span",{class:"token operator"},"*"),e(),t("span",{class:"token number"},"1000"),t("span",{class:"token punctuation"},","),e("\n      "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},","),e("\n      "),t("span",{class:"token string"},"'ignore-stderr'"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token punctuation"},"{"),e("\n        description"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},"'whether ignore stderr when app starts'"),t("span",{class:"token punctuation"},","),e("\n        type"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},"'boolean'"),t("span",{class:"token punctuation"},","),e("\n      "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},","),e("\n      node"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token punctuation"},"{"),e("\n        description"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},"'customize node command path'"),t("span",{class:"token punctuation"},","),e("\n        type"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},"'string'"),t("span",{class:"token punctuation"},","),e("\n      "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},";"),e("\n  "),t("span",{class:"token punctuation"},"}"),e("\n\n  "),t("span",{class:"token keyword"},"get"),e(),t("span",{class:"token function"},"description"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e("\n    "),t("span",{class:"token keyword"},"return"),e(),t("span",{class:"token string"},"'Start server at prod mode'"),t("span",{class:"token punctuation"},";"),e("\n  "),t("span",{class:"token punctuation"},"}"),e("\n\n  "),t("span",{class:"token operator"},"*"),e(),t("span",{class:"token function"},"run"),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},"context"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e("\n    "),t("span",{class:"token keyword"},"const"),e(),t("span",{class:"token punctuation"},"{"),e(" argv"),t("span",{class:"token punctuation"},","),e(" env"),t("span",{class:"token punctuation"},","),e(" cwd"),t("span",{class:"token punctuation"},","),e(" execArgv "),t("span",{class:"token punctuation"},"}"),e(),t("span",{class:"token operator"},"="),e(" context"),t("span",{class:"token punctuation"},";"),e("\n\n    "),t("span",{class:"token comment"},"// 当前用户的根目录"),e("\n    "),t("span",{class:"token keyword"},"const"),e(),t("span",{class:"token constant"},"HOME"),e(),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"homedir"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n\n    "),t("span",{class:"token comment"},"// 日志文件路径"),e("\n    "),t("span",{class:"token keyword"},"const"),e(" logDir "),t("span",{class:"token operator"},"="),e(" path"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"join"),t("span",{class:"token punctuation"},"("),t("span",{class:"token constant"},"HOME"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'logs'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n\n    "),t("span",{class:"token comment"},"// egg-script start "),e("\n    "),t("span",{class:"token comment"},"// egg-script start ./server"),e("\n    "),t("span",{class:"token comment"},"// egg-script start /opt/app"),e("\n    "),t("span",{class:"token keyword"},"let"),e(" baseDir "),t("span",{class:"token operator"},"="),e(" argv"),t("span",{class:"token punctuation"},"."),e("_"),t("span",{class:"token punctuation"},"["),t("span",{class:"token number"},"0"),t("span",{class:"token punctuation"},"]"),e(),t("span",{class:"token operator"},"||"),e(" cwd"),t("span",{class:"token punctuation"},";"),e("\n\n    "),t("span",{class:"token comment"},"// baseDir处理"),e("\n    "),t("span",{class:"token keyword"},"if"),e(),t("span",{class:"token punctuation"},"("),t("span",{class:"token operator"},"!"),e("path"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"isAbsolute"),t("span",{class:"token punctuation"},"("),e("baseDir"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),e(" baseDir "),t("span",{class:"token operator"},"="),e(" path"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"join"),t("span",{class:"token punctuation"},"("),e("cwd"),t("span",{class:"token punctuation"},","),e(" baseDir"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n    argv"),t("span",{class:"token punctuation"},"."),e("baseDir "),t("span",{class:"token operator"},"="),e(" baseDir"),t("span",{class:"token punctuation"},";"),e("\n\n    "),t("span",{class:"token comment"},"// 是否守护"),e("\n    "),t("span",{class:"token keyword"},"const"),e(" isDaemon "),t("span",{class:"token operator"},"="),e(" argv"),t("span",{class:"token punctuation"},"."),e("daemon"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token comment"},"// 获取 framework 地址"),e("\n    argv"),t("span",{class:"token punctuation"},"."),e("framework "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token keyword"},"yield"),e(),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"getFrameworkPath"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},"{"),e("\n      framework"),t("span",{class:"token operator"},":"),e(" argv"),t("span",{class:"token punctuation"},"."),e("framework"),t("span",{class:"token punctuation"},","),e("\n      baseDir"),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n\n    "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("frameworkName "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token keyword"},"yield"),e(),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"getFrameworkName"),t("span",{class:"token punctuation"},"("),e("argv"),t("span",{class:"token punctuation"},"."),e("framework"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n\n    "),t("span",{class:"token keyword"},"const"),e(" pkgInfo "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),e("path"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"join"),t("span",{class:"token punctuation"},"("),e("baseDir"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'package.json'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n    argv"),t("span",{class:"token punctuation"},"."),e("title "),t("span",{class:"token operator"},"="),e(" argv"),t("span",{class:"token punctuation"},"."),e("title "),t("span",{class:"token operator"},"||"),e(),t("span",{class:"token template-string"},[t("span",{class:"token template-punctuation string"},"`"),t("span",{class:"token string"},"egg-server-"),t("span",{class:"token interpolation"},[t("span",{class:"token interpolation-punctuation punctuation"},"${"),e("pkgInfo"),t("span",{class:"token punctuation"},"."),e("name"),t("span",{class:"token interpolation-punctuation punctuation"},"}")]),t("span",{class:"token template-punctuation string"},"`")]),t("span",{class:"token punctuation"},";"),e("\n\n    argv"),t("span",{class:"token punctuation"},"."),e("stdout "),t("span",{class:"token operator"},"="),e(" argv"),t("span",{class:"token punctuation"},"."),e("stdout "),t("span",{class:"token operator"},"||"),e(" path"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"join"),t("span",{class:"token punctuation"},"("),e("logDir"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'master-stdout.log'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n    argv"),t("span",{class:"token punctuation"},"."),e("stderr "),t("span",{class:"token operator"},"="),e(" argv"),t("span",{class:"token punctuation"},"."),e("stderr "),t("span",{class:"token operator"},"||"),e(" path"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"join"),t("span",{class:"token punctuation"},"("),e("logDir"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'master-stderr.log'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n\n    "),t("span",{class:"token comment"},"// normalize env"),e("\n    env"),t("span",{class:"token punctuation"},"."),t("span",{class:"token constant"},"HOME"),e(),t("span",{class:"token operator"},"="),e(),t("span",{class:"token constant"},"HOME"),t("span",{class:"token punctuation"},";"),e("\n\n    "),t("span",{class:"token comment"},"// egg-scripts start 会把环境变为生产环境"),e("\n    env"),t("span",{class:"token punctuation"},"."),t("span",{class:"token constant"},"NODE_ENV"),e(),t("span",{class:"token operator"},"="),e(),t("span",{class:"token string"},"'production'"),t("span",{class:"token punctuation"},";"),e("\n\n    "),t("span",{class:"token comment"},"// it makes env big but more robust"),e("\n    env"),t("span",{class:"token punctuation"},"."),t("span",{class:"token constant"},"PATH"),e(),t("span",{class:"token operator"},"="),e(" env"),t("span",{class:"token punctuation"},"."),e("Path "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token punctuation"},"["),e("\n      "),t("span",{class:"token comment"},"// for nodeinstall"),e("\n      path"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"join"),t("span",{class:"token punctuation"},"("),e("baseDir"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'node_modules/.bin'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},","),e("\n      "),t("span",{class:"token comment"},"// support `.node/bin`, due to npm5 will remove `node_modules/.bin`"),e("\n      path"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"join"),t("span",{class:"token punctuation"},"("),e("baseDir"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'.node/bin'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},","),e("\n      "),t("span",{class:"token comment"},"// adjust env for win"),e("\n      env"),t("span",{class:"token punctuation"},"."),t("span",{class:"token constant"},"PATH"),e(),t("span",{class:"token operator"},"||"),e(" env"),t("span",{class:"token punctuation"},"."),e("Path"),t("span",{class:"token punctuation"},","),e("\n    "),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"filter"),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},"x"),e(),t("span",{class:"token operator"},"=>"),e(),t("span",{class:"token operator"},"!"),t("span",{class:"token operator"},"!"),e("x"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"join"),t("span",{class:"token punctuation"},"("),e("path"),t("span",{class:"token punctuation"},"."),e("delimiter"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n\n    "),t("span",{class:"token comment"},"// for alinode"),e("\n    env"),t("span",{class:"token punctuation"},"."),t("span",{class:"token constant"},"ENABLE_NODE_LOG"),e(),t("span",{class:"token operator"},"="),e(),t("span",{class:"token string"},"'YES'"),t("span",{class:"token punctuation"},";"),e("\n    env"),t("span",{class:"token punctuation"},"."),t("span",{class:"token constant"},"NODE_LOG_DIR"),e(),t("span",{class:"token operator"},"="),e(" env"),t("span",{class:"token punctuation"},"."),t("span",{class:"token constant"},"NODE_LOG_DIR"),e(),t("span",{class:"token operator"},"||"),e(" path"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"join"),t("span",{class:"token punctuation"},"("),e("logDir"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'alinode'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token keyword"},"yield"),e(),t("span",{class:"token function"},"mkdirp"),t("span",{class:"token punctuation"},"("),e("env"),t("span",{class:"token punctuation"},"."),t("span",{class:"token constant"},"NODE_LOG_DIR"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n\n    "),t("span",{class:"token comment"},[e("// cli argv -> process."),t("wbr"),e("env.EGG_SERVER_ENV -> `undefined` then egg will use `prod`")]),e("\n    "),t("span",{class:"token keyword"},"if"),e(),t("span",{class:"token punctuation"},"("),e("argv"),t("span",{class:"token punctuation"},"."),e("env"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e("\n      "),t("span",{class:"token comment"},"// if undefined, should not pass key due to `spwan`, https://github.com/nodejs/node/blob/master/lib/child_process.js#L470"),e("\n      env"),t("span",{class:"token punctuation"},"."),t("span",{class:"token constant"},"EGG_SERVER_ENV"),e(),t("span",{class:"token operator"},"="),e(" argv"),t("span",{class:"token punctuation"},"."),e("env"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token punctuation"},"}"),e("\n\n    "),t("span",{class:"token keyword"},"const"),e(" command "),t("span",{class:"token operator"},"="),e(" argv"),t("span",{class:"token punctuation"},"."),e("node "),t("span",{class:"token operator"},"||"),e(),t("span",{class:"token string"},"'node'"),t("span",{class:"token punctuation"},";"),e("\n\n    "),t("span",{class:"token keyword"},"const"),e(" options "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token punctuation"},"{"),e("\n      execArgv"),t("span",{class:"token punctuation"},","),e("\n      env"),t("span",{class:"token punctuation"},","),e("\n      stdio"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token string"},"'inherit'"),t("span",{class:"token punctuation"},","),e("\n      detached"),t("span",{class:"token operator"},":"),e(),t("span",{class:"token boolean"},"false"),t("span",{class:"token punctuation"},","),e("  "),t("span",{class:"token comment"},"// 在创建子进程的时候可以脱离父亲"),e("\n    "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},";"),e("\n\n    "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("logger"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"info"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'Starting %s application at %s'"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("frameworkName"),t("span",{class:"token punctuation"},","),e(" baseDir"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n\n    "),t("span",{class:"token comment"},"// remove unused properties from stringify, alias had been remove by `removeAlias`"),e("\n    "),t("span",{class:"token keyword"},"const"),e(" ignoreKeys "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token punctuation"},"["),e(),t("span",{class:"token string"},"'_'"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'$0'"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'env'"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'daemon'"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'stdout'"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'stderr'"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'timeout'"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'ignore-stderr'"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'node'"),e(),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token keyword"},"const"),e(" clusterOptions "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"stringify"),t("span",{class:"token punctuation"},"("),e("argv"),t("span",{class:"token punctuation"},","),e(" ignoreKeys"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token comment"},"// Note: `spawn` is not like `fork`, had to pass `execArgv` youself"),e("\n    "),t("span",{class:"token keyword"},"const"),e(" eggArgs "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token punctuation"},"["),e(),t("span",{class:"token operator"},"..."),t("span",{class:"token punctuation"},"("),e("execArgv "),t("span",{class:"token operator"},"||"),e(),t("span",{class:"token punctuation"},"["),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("serverBin"),t("span",{class:"token punctuation"},","),e(" clusterOptions"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token template-string"},[t("span",{class:"token template-punctuation string"},"`"),t("span",{class:"token string"},"--title="),t("span",{class:"token interpolation"},[t("span",{class:"token interpolation-punctuation punctuation"},"${"),e("argv"),t("span",{class:"token punctuation"},"."),e("title"),t("span",{class:"token interpolation-punctuation punctuation"},"}")]),t("span",{class:"token template-punctuation string"},"`")]),e(),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("logger"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"info"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'Run node %s'"),t("span",{class:"token punctuation"},","),e(" eggArgs"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"join"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"' '"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n\n    "),t("span",{class:"token comment"},"// whether run in the background."),e("\n    "),t("span",{class:"token keyword"},"if"),e(),t("span",{class:"token punctuation"},"("),e("isDaemon"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e(),t("span",{class:"token comment"},"// 守护进程 "),e("\n\n      "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("logger"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"info"),t("span",{class:"token punctuation"},"("),t("span",{class:"token template-string"},[t("span",{class:"token template-punctuation string"},"`"),t("span",{class:"token string"},"Save log file to "),t("span",{class:"token interpolation"},[t("span",{class:"token interpolation-punctuation punctuation"},"${"),e("logDir"),t("span",{class:"token interpolation-punctuation punctuation"},"}")]),t("span",{class:"token template-punctuation string"},"`")]),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n\n      "),t("span",{class:"token keyword"},"const"),e(),t("span",{class:"token punctuation"},"["),e(" stdout"),t("span",{class:"token punctuation"},","),e(" stderr "),t("span",{class:"token punctuation"},"]"),e(),t("span",{class:"token operator"},"="),e(),t("span",{class:"token keyword"},"yield"),e(),t("span",{class:"token punctuation"},"["),e(),t("span",{class:"token function"},"getRotatelog"),t("span",{class:"token punctuation"},"("),e("argv"),t("span",{class:"token punctuation"},"."),e("stdout"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token function"},"getRotatelog"),t("span",{class:"token punctuation"},"("),e("argv"),t("span",{class:"token punctuation"},"."),e("stderr"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},";"),e("\n      options"),t("span",{class:"token punctuation"},"."),e("stdio "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token punctuation"},"["),e(),t("span",{class:"token string"},"'ignore'"),t("span",{class:"token punctuation"},","),e(" stdout"),t("span",{class:"token punctuation"},","),e(" stderr"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'ipc'"),e(),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},";"),e("\n      options"),t("span",{class:"token punctuation"},"."),e("detached "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token boolean"},"true"),t("span",{class:"token punctuation"},";"),e("\n      \n      "),t("span",{class:"token comment"},"// debug('Run spawn `%s %s`', command, eggArgs.join(' '));"),e("\n      "),t("span",{class:"token comment"},"// debug('=======', command, eggArgs, options );"),e("\n\n      "),t("span",{class:"token keyword"},"const"),e(" child "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("child "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"spawn"),t("span",{class:"token punctuation"},"("),e("command"),t("span",{class:"token punctuation"},","),e(" eggArgs"),t("span",{class:"token punctuation"},","),e(" options"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n      "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("isReady "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token boolean"},"false"),t("span",{class:"token punctuation"},";"),e("\n      child"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"on"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'message'"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token parameter"},"msg"),e(),t("span",{class:"token operator"},"=>"),e(),t("span",{class:"token punctuation"},"{"),e("\n        "),t("span",{class:"token comment"},"/* istanbul ignore else */"),e("\n        "),t("span",{class:"token keyword"},"if"),e(),t("span",{class:"token punctuation"},"("),e("msg "),t("span",{class:"token operator"},"&&"),e(" msg"),t("span",{class:"token punctuation"},"."),e("action "),t("span",{class:"token operator"},"==="),e(),t("span",{class:"token string"},"'egg-ready'"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e("\n          "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("isReady "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token boolean"},"true"),t("span",{class:"token punctuation"},";"),e("\n          "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("logger"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"info"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'%s started on %s'"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("frameworkName"),t("span",{class:"token punctuation"},","),e(" msg"),t("span",{class:"token punctuation"},"."),e("data"),t("span",{class:"token punctuation"},"."),e("address"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n          child"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"unref"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n          child"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"disconnect"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n          "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"exit"),t("span",{class:"token punctuation"},"("),t("span",{class:"token number"},"0"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n        "),t("span",{class:"token punctuation"},"}"),e("\n      "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n\n      "),t("span",{class:"token comment"},"// check start status"),e("\n      "),t("span",{class:"token keyword"},"yield"),e(),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"checkStatus"),t("span",{class:"token punctuation"},"("),e("argv"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token punctuation"},"}"),e(),t("span",{class:"token keyword"},"else"),e(),t("span",{class:"token punctuation"},"{"),e("\n      options"),t("span",{class:"token punctuation"},"."),e("stdio "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token punctuation"},"["),e(),t("span",{class:"token string"},"'inherit'"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'inherit'"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'inherit'"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'ipc'"),e(),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},";"),e("\n      "),t("span",{class:"token function"},"debug"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'Run spawn `%s %s`'"),t("span",{class:"token punctuation"},","),e(" command"),t("span",{class:"token punctuation"},","),e(" eggArgs"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"join"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"' '"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n      "),t("span",{class:"token keyword"},"const"),e(" child "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("child "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"spawn"),t("span",{class:"token punctuation"},"("),e("command"),t("span",{class:"token punctuation"},","),e(" eggArgs"),t("span",{class:"token punctuation"},","),e(" options"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n      child"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"once"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'exit'"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token parameter"},"code"),e(),t("span",{class:"token operator"},"=>"),e(),t("span",{class:"token punctuation"},"{"),e("\n        "),t("span",{class:"token comment"},"// command should exit after child process exit"),e("\n        "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"exit"),t("span",{class:"token punctuation"},"("),e("code"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n      "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n\n      "),t("span",{class:"token comment"},"// attach master signal to child"),e("\n      "),t("span",{class:"token keyword"},"let"),e(" signal"),t("span",{class:"token punctuation"},";"),e("\n      "),t("span",{class:"token punctuation"},"["),e(),t("span",{class:"token string"},"'SIGINT'"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'SIGQUIT'"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'SIGTERM'"),e(),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"forEach"),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},"event"),e(),t("span",{class:"token operator"},"=>"),e(),t("span",{class:"token punctuation"},"{"),e("\n        process"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"once"),t("span",{class:"token punctuation"},"("),e("event"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token operator"},"=>"),e(),t("span",{class:"token punctuation"},"{"),e("\n          "),t("span",{class:"token function"},"debug"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'Kill child %s with %s'"),t("span",{class:"token punctuation"},","),e(" child"),t("span",{class:"token punctuation"},"."),e("pid"),t("span",{class:"token punctuation"},","),e(" signal"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n          child"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"kill"),t("span",{class:"token punctuation"},"("),e("event"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n        "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n      "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token punctuation"},"}"),e("\n  "),t("span",{class:"token punctuation"},"}"),e("\n\n  "),t("span",{class:"token operator"},"*"),e(),t("span",{class:"token function"},"getFrameworkPath"),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},"params"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e("\n    "),t("span",{class:"token keyword"},"return"),e(" utils"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"getFrameworkPath"),t("span",{class:"token punctuation"},"("),e("params"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n  "),t("span",{class:"token punctuation"},"}"),e("\n\n  "),t("span",{class:"token operator"},"*"),e(),t("span",{class:"token function"},"getFrameworkName"),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},"framework"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e("\n    "),t("span",{class:"token keyword"},"const"),e(" pkgPath "),t("span",{class:"token operator"},"="),e(" path"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"join"),t("span",{class:"token punctuation"},"("),e("framework"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'package.json'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token keyword"},"let"),e(" name "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token string"},"'egg'"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token keyword"},"try"),e(),t("span",{class:"token punctuation"},"{"),e("\n      "),t("span",{class:"token keyword"},"const"),e(" pkg "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"require"),t("span",{class:"token punctuation"},"("),e("pkgPath"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n      "),t("span",{class:"token comment"},"/* istanbul ignore else */"),e("\n      "),t("span",{class:"token keyword"},"if"),e(),t("span",{class:"token punctuation"},"("),e("pkg"),t("span",{class:"token punctuation"},"."),e("name"),t("span",{class:"token punctuation"},")"),e(" name "),t("span",{class:"token operator"},"="),e(" pkg"),t("span",{class:"token punctuation"},"."),e("name"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token punctuation"},"}"),e(),t("span",{class:"token keyword"},"catch"),e(),t("span",{class:"token punctuation"},"("),e("_"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e("\n      "),t("span",{class:"token comment"},"/* istanbul next */"),e("\n    "),t("span",{class:"token punctuation"},"}"),e("\n    "),t("span",{class:"token keyword"},"return"),e(" name"),t("span",{class:"token punctuation"},";"),e("\n  "),t("span",{class:"token punctuation"},"}"),e("\n\n  "),t("span",{class:"token operator"},"*"),e(),t("span",{class:"token function"},"checkStatus"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},"{"),e(" stderr"),t("span",{class:"token punctuation"},","),e(" timeout"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'ignore-stderr'"),t("span",{class:"token operator"},":"),e(" ignoreStdErr "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e("\n    "),t("span",{class:"token keyword"},"let"),e(" count "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token number"},"0"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token keyword"},"let"),e(" hasError "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token boolean"},"false"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token keyword"},"let"),e(" isSuccess "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token boolean"},"true"),t("span",{class:"token punctuation"},";"),e("\n    timeout "),t("span",{class:"token operator"},"="),e(" timeout "),t("span",{class:"token operator"},"/"),e(),t("span",{class:"token number"},"1000"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token keyword"},"while"),e(),t("span",{class:"token punctuation"},"("),t("span",{class:"token operator"},"!"),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("isReady"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e("\n      "),t("span",{class:"token keyword"},"try"),e(),t("span",{class:"token punctuation"},"{"),e("\n        "),t("span",{class:"token keyword"},"const"),e(" stat "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token keyword"},"yield"),e(" fs"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"stat"),t("span",{class:"token punctuation"},"("),e("stderr"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n        "),t("span",{class:"token keyword"},"if"),e(),t("span",{class:"token punctuation"},"("),e("stat "),t("span",{class:"token operator"},"&&"),e(" stat"),t("span",{class:"token punctuation"},"."),e("size "),t("span",{class:"token operator"},">"),e(),t("span",{class:"token number"},"0"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e("\n          hasError "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token boolean"},"true"),t("span",{class:"token punctuation"},";"),e("\n          "),t("span",{class:"token keyword"},"break"),t("span",{class:"token punctuation"},";"),e("\n        "),t("span",{class:"token punctuation"},"}"),e("\n      "),t("span",{class:"token punctuation"},"}"),e(),t("span",{class:"token keyword"},"catch"),e(),t("span",{class:"token punctuation"},"("),e("_"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e("\n        "),t("span",{class:"token comment"},"// nothing"),e("\n      "),t("span",{class:"token punctuation"},"}"),e("\n\n      "),t("span",{class:"token keyword"},"if"),e(),t("span",{class:"token punctuation"},"("),e("count "),t("span",{class:"token operator"},">="),e(" timeout"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e("\n        "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("logger"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"error"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'Start failed, %ds timeout'"),t("span",{class:"token punctuation"},","),e(" timeout"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n        isSuccess "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token boolean"},"false"),t("span",{class:"token punctuation"},";"),e("\n        "),t("span",{class:"token keyword"},"break"),t("span",{class:"token punctuation"},";"),e("\n      "),t("span",{class:"token punctuation"},"}"),e("\n\n      "),t("span",{class:"token keyword"},"yield"),e(),t("span",{class:"token function"},"sleep"),t("span",{class:"token punctuation"},"("),t("span",{class:"token number"},"1000"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n      "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("logger"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"log"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'Wait Start: %d...'"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token operator"},"++"),e("count"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token punctuation"},"}"),e("\n\n    "),t("span",{class:"token keyword"},"if"),e(),t("span",{class:"token punctuation"},"("),e("hasError"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e("\n      "),t("span",{class:"token keyword"},"try"),e(),t("span",{class:"token punctuation"},"{"),e("\n        "),t("span",{class:"token keyword"},"const"),e(" args "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token punctuation"},"["),e(),t("span",{class:"token string"},"'-n'"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'100'"),t("span",{class:"token punctuation"},","),e(" stderr "),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},";"),e("\n        "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("logger"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"error"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'tail %s'"),t("span",{class:"token punctuation"},","),e(" args"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"join"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"' '"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n        "),t("span",{class:"token keyword"},"const"),e(),t("span",{class:"token punctuation"},"["),e(" stdout "),t("span",{class:"token punctuation"},"]"),e(),t("span",{class:"token operator"},"="),e(),t("span",{class:"token keyword"},"yield"),e(),t("span",{class:"token function"},"execFile"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'tail'"),t("span",{class:"token punctuation"},","),e(" args"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n        "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("logger"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"error"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'Got error when startup: '"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n        "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("logger"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"error"),t("span",{class:"token punctuation"},"("),e("stdout"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n      "),t("span",{class:"token punctuation"},"}"),e(),t("span",{class:"token keyword"},"catch"),e(),t("span",{class:"token punctuation"},"("),e("err"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e("\n        "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("logger"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"error"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'ignore tail error: %s'"),t("span",{class:"token punctuation"},","),e(" err"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n      "),t("span",{class:"token punctuation"},"}"),e("\n\n      isSuccess "),t("span",{class:"token operator"},"="),e(" ignoreStdErr"),t("span",{class:"token punctuation"},";"),e("\n      "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("logger"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"error"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'Start got error, see %s'"),t("span",{class:"token punctuation"},","),e(" stderr"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n      "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("logger"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"error"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'Or use `--ignore-stderr` to ignore stderr at startup.'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token punctuation"},"}"),e("\n\n    "),t("span",{class:"token keyword"},"if"),e(),t("span",{class:"token punctuation"},"("),t("span",{class:"token operator"},"!"),e("isSuccess"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e("\n      "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),e("child"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"kill"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'SIGTERM'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n      "),t("span",{class:"token keyword"},"yield"),e(),t("span",{class:"token function"},"sleep"),t("span",{class:"token punctuation"},"("),t("span",{class:"token number"},"1000"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n      "),t("span",{class:"token keyword"},"this"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"exit"),t("span",{class:"token punctuation"},"("),t("span",{class:"token number"},"1"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token punctuation"},"}"),e("\n  "),t("span",{class:"token punctuation"},"}"),e("\n"),t("span",{class:"token punctuation"},"}"),e("\n\n"),t("span",{class:"token keyword"},"function"),t("span",{class:"token operator"},"*"),e(),t("span",{class:"token function"},"getRotatelog"),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},"logfile"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e("\n  "),t("span",{class:"token keyword"},"yield"),e(),t("span",{class:"token function"},"mkdirp"),t("span",{class:"token punctuation"},"("),e("path"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"dirname"),t("span",{class:"token punctuation"},"("),e("logfile"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n\n  "),t("span",{class:"token keyword"},"if"),e(),t("span",{class:"token punctuation"},"("),t("span",{class:"token keyword"},"yield"),e(" fs"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"exists"),t("span",{class:"token punctuation"},"("),e("logfile"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e("\n    "),t("span",{class:"token comment"},"// format style: .20150602.193100"),e("\n    "),t("span",{class:"token keyword"},"const"),e(" timestamp "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token function"},"moment"),t("span",{class:"token punctuation"},"("),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"format"),t("span",{class:"token punctuation"},"("),t("span",{class:"token string"},"'.YYYYMMDD.HHmmss'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token comment"},"// Note: rename last log to next start time, not when last log file created"),e("\n    "),t("span",{class:"token keyword"},"yield"),e(" fs"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"rename"),t("span",{class:"token punctuation"},"("),e("logfile"),t("span",{class:"token punctuation"},","),e(" logfile "),t("span",{class:"token operator"},"+"),e(" timestamp"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n  "),t("span",{class:"token punctuation"},"}"),e("\n\n  "),t("span",{class:"token keyword"},"return"),e(),t("span",{class:"token keyword"},"yield"),e(" fs"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"open"),t("span",{class:"token punctuation"},"("),e("logfile"),t("span",{class:"token punctuation"},","),e(),t("span",{class:"token string"},"'a'"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n"),t("span",{class:"token punctuation"},"}"),e("\n\n"),t("span",{class:"token keyword"},"function"),e(),t("span",{class:"token function"},"stringify"),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},[e("obj"),t("span",{class:"token punctuation"},","),e(" ignore")]),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e("\n  "),t("span",{class:"token keyword"},"const"),e(" result "),t("span",{class:"token operator"},"="),e(),t("span",{class:"token punctuation"},"{"),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},";"),e("\n  Object"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"keys"),t("span",{class:"token punctuation"},"("),e("obj"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"forEach"),t("span",{class:"token punctuation"},"("),t("span",{class:"token parameter"},"key"),e(),t("span",{class:"token operator"},"=>"),e(),t("span",{class:"token punctuation"},"{"),e("\n    "),t("span",{class:"token keyword"},"if"),e(),t("span",{class:"token punctuation"},"("),t("span",{class:"token operator"},"!"),e("ignore"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"includes"),t("span",{class:"token punctuation"},"("),e("key"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},")"),e(),t("span",{class:"token punctuation"},"{"),e("\n      result"),t("span",{class:"token punctuation"},"["),e("key"),t("span",{class:"token punctuation"},"]"),e(),t("span",{class:"token operator"},"="),e(" obj"),t("span",{class:"token punctuation"},"["),e("key"),t("span",{class:"token punctuation"},"]"),t("span",{class:"token punctuation"},";"),e("\n    "),t("span",{class:"token punctuation"},"}"),e("\n  "),t("span",{class:"token punctuation"},"}"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n  "),t("span",{class:"token keyword"},"return"),e(),t("span",{class:"token constant"},"JSON"),t("span",{class:"token punctuation"},"."),t("span",{class:"token function"},"stringify"),t("span",{class:"token punctuation"},"("),e("result"),t("span",{class:"token punctuation"},")"),t("span",{class:"token punctuation"},";"),e("\n"),t("span",{class:"token punctuation"},"}"),e("\n\nmodule"),t("span",{class:"token punctuation"},"."),e("exports "),t("span",{class:"token operator"},"="),e(" StartCommand"),t("span",{class:"token punctuation"},";"),e("\n\n")]),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989443-55412"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"'use strict';\n\nconst path = require('path');\n\nconst Command = require('../command');\nconst debug = require('debug')('egg-script:start');\nconst { execFile } = require('mz/child_process');\nconst fs = require('mz/fs');\nconst homedir = require('node-homedir');\nconst mkdirp = require('mz-modules/mkdirp');\nconst moment = require('moment');\nconst sleep = require('mz-modules/sleep');\nconst spawn = require('child_process').spawn;\n// 工具库\nconst utils = require('egg-utils');\n\nclass StartCommand extends Command {\n  constructor(rawArgv) {\n    super(rawArgv);\n    this.usage = 'Usage: egg-scripts start [options] [baseDir]';\n\n    //自定义方法\n    this.serverBin = path.join(__dirname, '../start-cluster');\n    // 参数定义\n    this.options = {\n      // 进程名称\n      title: {\n        description: 'process title description, use for kill grep, default to `egg-server-${APP_NAME}`',\n        type: 'string',\n      },\n      // 指定创建多少个子进程\n      workers: {\n        description: 'numbers of app workers, default to `os.cpus().length`',\n        type: 'number',\n        alias: [ 'c', 'cluster' ],\n        default: process.<wbr/>env.EGG_WORKERS,\n      },\n\n      port: {\n        description: 'listening port, default to `process.<wbr/>env.PORT`',\n        type: 'number',\n        alias: 'p',\n        default: process.<wbr/>env.PORT,\n      },\n      env: {\n        description: 'server env, default to `process.<wbr/>env.EGG_SERVER_ENV`',\n        default: process.<wbr/>env.EGG_SERVER_ENV,\n      },\n      // egg业务代码\n      framework: {\n        description: 'specify framework that can be absolute path or npm package',\n        type: 'string',\n      },\n      daemon: {\n        description: 'whether run at background daemon mode',\n        type: 'boolean',\n      },\n      stdout: {\n        description: 'customize stdout file',\n        type: 'string',\n      },\n      stderr: {\n        description: 'customize stderr file',\n        type: 'string',\n      },\n      timeout: {\n        description: 'the maximum timeout when app starts',\n        type: 'number',\n        default: 300 * 1000,\n      },\n      'ignore-stderr': {\n        description: 'whether ignore stderr when app starts',\n        type: 'boolean',\n      },\n      node: {\n        description: 'customize node command path',\n        type: 'string',\n      },\n    };\n  }\n\n  get description() {\n    return 'Start server at prod mode';\n  }\n\n  * run(context) {\n    const { argv, env, cwd, execArgv } = context;\n\n    // 当前用户的根目录\n    const HOME = homedir();\n\n    // 日志文件路径\n    const logDir = path.join(HOME, 'logs');\n\n    // egg-script start \n    // egg-script start ./server\n    // egg-script start /opt/app\n    let baseDir = argv._[0] || cwd;\n\n    // baseDir处理\n    if (!path.isAbsolute(baseDir)) baseDir = path.join(cwd, baseDir);\n    argv.baseDir = baseDir;\n\n    // 是否守护\n    const isDaemon = argv.daemon;\n    // 获取 framework 地址\n    argv.framework = yield this.getFrameworkPath({\n      framework: argv.framework,\n      baseDir,\n    });\n\n    this.frameworkName = yield this.getFrameworkName(argv.framework);\n\n    const pkgInfo = require(path.join(baseDir, 'package.json'));\n    argv.title = argv.title || `egg-server-${pkgInfo.name}`;\n\n    argv.stdout = argv.stdout || path.join(logDir, 'master-stdout.log');\n    argv.stderr = argv.stderr || path.join(logDir, 'master-stderr.log');\n\n    // normalize env\n    env.HOME = HOME;\n\n    // egg-scripts start 会把环境变为生产环境\n    env.NODE_ENV = 'production';\n\n    // it makes env big but more robust\n    env.PATH = env.Path = [\n      // for nodeinstall\n      path.join(baseDir, 'node_modules/.bin'),\n      // support `.node/bin`, due to npm5 will remove `node_modules/.bin`\n      path.join(baseDir, '.node/bin'),\n      // adjust env for win\n      env.PATH || env.Path,\n    ].filter(x => !!x).join(path.delimiter);\n\n    // for alinode\n    env.ENABLE_NODE_LOG = 'YES';\n    env.NODE_LOG_DIR = env.NODE_LOG_DIR || path.join(logDir, 'alinode');\n    yield mkdirp(env.NODE_LOG_DIR);\n\n    // cli argv -> process.<wbr/>env.EGG_SERVER_ENV -> `undefined` then egg will use `prod`\n    if (argv.env) {\n      // if undefined, should not pass key due to `spwan`, https://github.com/nodejs/node/blob/master/lib/child_process.js#L470\n      env.EGG_SERVER_ENV = argv.env;\n    }\n\n    const command = argv.node || 'node';\n\n    const options = {\n      execArgv,\n      env,\n      stdio: 'inherit',\n      detached: false,  // 在创建子进程的时候可以脱离父亲\n    };\n\n    this.logger.info('Starting %s application at %s', this.frameworkName, baseDir);\n\n    // remove unused properties from stringify, alias had been remove by `removeAlias`\n    const ignoreKeys = [ '_', '$0', 'env', 'daemon', 'stdout', 'stderr', 'timeout', 'ignore-stderr', 'node' ];\n    const clusterOptions = stringify(argv, ignoreKeys);\n    // Note: `spawn` is not like `fork`, had to pass `execArgv` youself\n    const eggArgs = [ ...(execArgv || []), this.serverBin, clusterOptions, `--title=${argv.title}` ];\n    this.logger.info('Run node %s', eggArgs.join(' '));\n\n    // whether run in the background.\n    if (isDaemon) { // 守护进程 \n\n      this.logger.info(`Save log file to ${logDir}`);\n\n      const [ stdout, stderr ] = yield [ getRotatelog(argv.stdout), getRotatelog(argv.stderr) ];\n      options.stdio = [ 'ignore', stdout, stderr, 'ipc' ];\n      options.detached = true;\n      \n      // debug('Run spawn `%s %s`', command, eggArgs.join(' '));\n      // debug('=======', command, eggArgs, options );\n\n      const child = this.child = spawn(command, eggArgs, options);\n      this.isReady = false;\n      child.on('message', msg => {\n        /* istanbul ignore else */\n        if (msg && msg.action === 'egg-ready') {\n          this.isReady = true;\n          this.logger.info('%s started on %s', this.frameworkName, msg.data.address);\n          child.unref();\n          child.disconnect();\n          this.exit(0);\n        }\n      });\n\n      // check start status\n      yield this.checkStatus(argv);\n    } else {\n      options.stdio = [ 'inherit', 'inherit', 'inherit', 'ipc' ];\n      debug('Run spawn `%s %s`', command, eggArgs.join(' '));\n      const child = this.child = spawn(command, eggArgs, options);\n      child.once('exit', code => {\n        // command should exit after child process exit\n        this.exit(code);\n      });\n\n      // attach master signal to child\n      let signal;\n      [ 'SIGINT', 'SIGQUIT', 'SIGTERM' ].forEach(event => {\n        process.once(event, () => {\n          debug('Kill child %s with %s', child.pid, signal);\n          child.kill(event);\n        });\n      });\n    }\n  }\n\n  * getFrameworkPath(params) {\n    return utils.getFrameworkPath(params);\n  }\n\n  * getFrameworkName(framework) {\n    const pkgPath = path.join(framework, 'package.json');\n    let name = 'egg';\n    try {\n      const pkg = require(pkgPath);\n      /* istanbul ignore else */\n      if (pkg.name) name = pkg.name;\n    } catch (_) {\n      /* istanbul next */\n    }\n    return name;\n  }\n\n  * checkStatus({ stderr, timeout, 'ignore-stderr': ignoreStdErr }) {\n    let count = 0;\n    let hasError = false;\n    let isSuccess = true;\n    timeout = timeout / 1000;\n    while (!this.isReady) {\n      try {\n        const stat = yield fs.stat(stderr);\n        if (stat && stat.size > 0) {\n          hasError = true;\n          break;\n        }\n      } catch (_) {\n        // nothing\n      }\n\n      if (count >= timeout) {\n        this.logger.error('Start failed, %ds timeout', timeout);\n        isSuccess = false;\n        break;\n      }\n\n      yield sleep(1000);\n      this.logger.log('Wait Start: %d...', ++count);\n    }\n\n    if (hasError) {\n      try {\n        const args = [ '-n', '100', stderr ];\n        this.logger.error('tail %s', args.join(' '));\n        const [ stdout ] = yield execFile('tail', args);\n        this.logger.error('Got error when startup: ');\n        this.logger.error(stdout);\n      } catch (err) {\n        this.logger.error('ignore tail error: %s', err);\n      }\n\n      isSuccess = ignoreStdErr;\n      this.logger.error('Start got error, see %s', stderr);\n      this.logger.error('Or use `--ignore-stderr` to ignore stderr at startup.');\n    }\n\n    if (!isSuccess) {\n      this.child.kill('SIGTERM');\n      yield sleep(1000);\n      this.exit(1);\n    }\n  }\n}\n\nfunction* getRotatelog(logfile) {\n  yield mkdirp(path.dirname(logfile));\n\n  if (yield fs.exists(logfile)) {\n    // format style: .20150602.193100\n    const timestamp = moment().format('.YYYYMMDD.HHmmss');\n    // Note: rename last log to next start time, not when last log file created\n    yield fs.rename(logfile, logfile + timestamp);\n  }\n\n  return yield fs.open(logfile, 'a');\n}\n\nfunction stringify(obj, ignore) {\n  const result = {};\n  Object.keys(obj).forEach(key => {\n    if (!ignore.includes(key)) {\n      result[key] = obj[key];\n    }\n  });\n  return JSON.stringify(result);\n}\n\nmodule.exports = StartCommand;\n\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989443-55412","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br"),t("span",{class:"line-number"},"4"),t("br"),t("span",{class:"line-number"},"5"),t("br"),t("span",{class:"line-number"},"6"),t("br"),t("span",{class:"line-number"},"7"),t("br"),t("span",{class:"line-number"},"8"),t("br"),t("span",{class:"line-number"},"9"),t("br"),t("span",{class:"line-number"},"10"),t("br"),t("span",{class:"line-number"},"11"),t("br"),t("span",{class:"line-number"},"12"),t("br"),t("span",{class:"line-number"},"13"),t("br"),t("span",{class:"line-number"},"14"),t("br"),t("span",{class:"line-number"},"15"),t("br"),t("span",{class:"line-number"},"16"),t("br"),t("span",{class:"line-number"},"17"),t("br"),t("span",{class:"line-number"},"18"),t("br"),t("span",{class:"line-number"},"19"),t("br"),t("span",{class:"line-number"},"20"),t("br"),t("span",{class:"line-number"},"21"),t("br"),t("span",{class:"line-number"},"22"),t("br"),t("span",{class:"line-number"},"23"),t("br"),t("span",{class:"line-number"},"24"),t("br"),t("span",{class:"line-number"},"25"),t("br"),t("span",{class:"line-number"},"26"),t("br"),t("span",{class:"line-number"},"27"),t("br"),t("span",{class:"line-number"},"28"),t("br"),t("span",{class:"line-number"},"29"),t("br"),t("span",{class:"line-number"},"30"),t("br"),t("span",{class:"line-number"},"31"),t("br"),t("span",{class:"line-number"},"32"),t("br"),t("span",{class:"line-number"},"33"),t("br"),t("span",{class:"line-number"},"34"),t("br"),t("span",{class:"line-number"},"35"),t("br"),t("span",{class:"line-number"},"36"),t("br"),t("span",{class:"line-number"},"37"),t("br"),t("span",{class:"line-number"},"38"),t("br"),t("span",{class:"line-number"},"39"),t("br"),t("span",{class:"line-number"},"40"),t("br"),t("span",{class:"line-number"},"41"),t("br"),t("span",{class:"line-number"},"42"),t("br"),t("span",{class:"line-number"},"43"),t("br"),t("span",{class:"line-number"},"44"),t("br"),t("span",{class:"line-number"},"45"),t("br"),t("span",{class:"line-number"},"46"),t("br"),t("span",{class:"line-number"},"47"),t("br"),t("span",{class:"line-number"},"48"),t("br"),t("span",{class:"line-number"},"49"),t("br"),t("span",{class:"line-number"},"50"),t("br"),t("span",{class:"line-number"},"51"),t("br"),t("span",{class:"line-number"},"52"),t("br"),t("span",{class:"line-number"},"53"),t("br"),t("span",{class:"line-number"},"54"),t("br"),t("span",{class:"line-number"},"55"),t("br"),t("span",{class:"line-number"},"56"),t("br"),t("span",{class:"line-number"},"57"),t("br"),t("span",{class:"line-number"},"58"),t("br"),t("span",{class:"line-number"},"59"),t("br"),t("span",{class:"line-number"},"60"),t("br"),t("span",{class:"line-number"},"61"),t("br"),t("span",{class:"line-number"},"62"),t("br"),t("span",{class:"line-number"},"63"),t("br"),t("span",{class:"line-number"},"64"),t("br"),t("span",{class:"line-number"},"65"),t("br"),t("span",{class:"line-number"},"66"),t("br"),t("span",{class:"line-number"},"67"),t("br"),t("span",{class:"line-number"},"68"),t("br"),t("span",{class:"line-number"},"69"),t("br"),t("span",{class:"line-number"},"70"),t("br"),t("span",{class:"line-number"},"71"),t("br"),t("span",{class:"line-number"},"72"),t("br"),t("span",{class:"line-number"},"73"),t("br"),t("span",{class:"line-number"},"74"),t("br"),t("span",{class:"line-number"},"75"),t("br"),t("span",{class:"line-number"},"76"),t("br"),t("span",{class:"line-number"},"77"),t("br"),t("span",{class:"line-number"},"78"),t("br"),t("span",{class:"line-number"},"79"),t("br"),t("span",{class:"line-number"},"80"),t("br"),t("span",{class:"line-number"},"81"),t("br"),t("span",{class:"line-number"},"82"),t("br"),t("span",{class:"line-number"},"83"),t("br"),t("span",{class:"line-number"},"84"),t("br"),t("span",{class:"line-number"},"85"),t("br"),t("span",{class:"line-number"},"86"),t("br"),t("span",{class:"line-number"},"87"),t("br"),t("span",{class:"line-number"},"88"),t("br"),t("span",{class:"line-number"},"89"),t("br"),t("span",{class:"line-number"},"90"),t("br"),t("span",{class:"line-number"},"91"),t("br"),t("span",{class:"line-number"},"92"),t("br"),t("span",{class:"line-number"},"93"),t("br"),t("span",{class:"line-number"},"94"),t("br"),t("span",{class:"line-number"},"95"),t("br"),t("span",{class:"line-number"},"96"),t("br"),t("span",{class:"line-number"},"97"),t("br"),t("span",{class:"line-number"},"98"),t("br"),t("span",{class:"line-number"},"99"),t("br"),t("span",{class:"line-number"},"100"),t("br"),t("span",{class:"line-number"},"101"),t("br"),t("span",{class:"line-number"},"102"),t("br"),t("span",{class:"line-number"},"103"),t("br"),t("span",{class:"line-number"},"104"),t("br"),t("span",{class:"line-number"},"105"),t("br"),t("span",{class:"line-number"},"106"),t("br"),t("span",{class:"line-number"},"107"),t("br"),t("span",{class:"line-number"},"108"),t("br"),t("span",{class:"line-number"},"109"),t("br"),t("span",{class:"line-number"},"110"),t("br"),t("span",{class:"line-number"},"111"),t("br"),t("span",{class:"line-number"},"112"),t("br"),t("span",{class:"line-number"},"113"),t("br"),t("span",{class:"line-number"},"114"),t("br"),t("span",{class:"line-number"},"115"),t("br"),t("span",{class:"line-number"},"116"),t("br"),t("span",{class:"line-number"},"117"),t("br"),t("span",{class:"line-number"},"118"),t("br"),t("span",{class:"line-number"},"119"),t("br"),t("span",{class:"line-number"},"120"),t("br"),t("span",{class:"line-number"},"121"),t("br"),t("span",{class:"line-number"},"122"),t("br"),t("span",{class:"line-number"},"123"),t("br"),t("span",{class:"line-number"},"124"),t("br"),t("span",{class:"line-number"},"125"),t("br"),t("span",{class:"line-number"},"126"),t("br"),t("span",{class:"line-number"},"127"),t("br"),t("span",{class:"line-number"},"128"),t("br"),t("span",{class:"line-number"},"129"),t("br"),t("span",{class:"line-number"},"130"),t("br"),t("span",{class:"line-number"},"131"),t("br"),t("span",{class:"line-number"},"132"),t("br"),t("span",{class:"line-number"},"133"),t("br"),t("span",{class:"line-number"},"134"),t("br"),t("span",{class:"line-number"},"135"),t("br"),t("span",{class:"line-number"},"136"),t("br"),t("span",{class:"line-number"},"137"),t("br"),t("span",{class:"line-number"},"138"),t("br"),t("span",{class:"line-number"},"139"),t("br"),t("span",{class:"line-number"},"140"),t("br"),t("span",{class:"line-number"},"141"),t("br"),t("span",{class:"line-number"},"142"),t("br"),t("span",{class:"line-number"},"143"),t("br"),t("span",{class:"line-number"},"144"),t("br"),t("span",{class:"line-number"},"145"),t("br"),t("span",{class:"line-number"},"146"),t("br"),t("span",{class:"line-number"},"147"),t("br"),t("span",{class:"line-number"},"148"),t("br"),t("span",{class:"line-number"},"149"),t("br"),t("span",{class:"line-number"},"150"),t("br"),t("span",{class:"line-number"},"151"),t("br"),t("span",{class:"line-number"},"152"),t("br"),t("span",{class:"line-number"},"153"),t("br"),t("span",{class:"line-number"},"154"),t("br"),t("span",{class:"line-number"},"155"),t("br"),t("span",{class:"line-number"},"156"),t("br"),t("span",{class:"line-number"},"157"),t("br"),t("span",{class:"line-number"},"158"),t("br"),t("span",{class:"line-number"},"159"),t("br"),t("span",{class:"line-number"},"160"),t("br"),t("span",{class:"line-number"},"161"),t("br"),t("span",{class:"line-number"},"162"),t("br"),t("span",{class:"line-number"},"163"),t("br"),t("span",{class:"line-number"},"164"),t("br"),t("span",{class:"line-number"},"165"),t("br"),t("span",{class:"line-number"},"166"),t("br"),t("span",{class:"line-number"},"167"),t("br"),t("span",{class:"line-number"},"168"),t("br"),t("span",{class:"line-number"},"169"),t("br"),t("span",{class:"line-number"},"170"),t("br"),t("span",{class:"line-number"},"171"),t("br"),t("span",{class:"line-number"},"172"),t("br"),t("span",{class:"line-number"},"173"),t("br"),t("span",{class:"line-number"},"174"),t("br"),t("span",{class:"line-number"},"175"),t("br"),t("span",{class:"line-number"},"176"),t("br"),t("span",{class:"line-number"},"177"),t("br"),t("span",{class:"line-number"},"178"),t("br"),t("span",{class:"line-number"},"179"),t("br"),t("span",{class:"line-number"},"180"),t("br"),t("span",{class:"line-number"},"181"),t("br"),t("span",{class:"line-number"},"182"),t("br"),t("span",{class:"line-number"},"183"),t("br"),t("span",{class:"line-number"},"184"),t("br"),t("span",{class:"line-number"},"185"),t("br"),t("span",{class:"line-number"},"186"),t("br"),t("span",{class:"line-number"},"187"),t("br"),t("span",{class:"line-number"},"188"),t("br"),t("span",{class:"line-number"},"189"),t("br"),t("span",{class:"line-number"},"190"),t("br"),t("span",{class:"line-number"},"191"),t("br"),t("span",{class:"line-number"},"192"),t("br"),t("span",{class:"line-number"},"193"),t("br"),t("span",{class:"line-number"},"194"),t("br"),t("span",{class:"line-number"},"195"),t("br"),t("span",{class:"line-number"},"196"),t("br"),t("span",{class:"line-number"},"197"),t("br"),t("span",{class:"line-number"},"198"),t("br"),t("span",{class:"line-number"},"199"),t("br"),t("span",{class:"line-number"},"200"),t("br"),t("span",{class:"line-number"},"201"),t("br"),t("span",{class:"line-number"},"202"),t("br"),t("span",{class:"line-number"},"203"),t("br"),t("span",{class:"line-number"},"204"),t("br"),t("span",{class:"line-number"},"205"),t("br"),t("span",{class:"line-number"},"206"),t("br"),t("span",{class:"line-number"},"207"),t("br"),t("span",{class:"line-number"},"208"),t("br"),t("span",{class:"line-number"},"209"),t("br"),t("span",{class:"line-number"},"210"),t("br"),t("span",{class:"line-number"},"211"),t("br"),t("span",{class:"line-number"},"212"),t("br"),t("span",{class:"line-number"},"213"),t("br"),t("span",{class:"line-number"},"214"),t("br"),t("span",{class:"line-number"},"215"),t("br"),t("span",{class:"line-number"},"216"),t("br"),t("span",{class:"line-number"},"217"),t("br"),t("span",{class:"line-number"},"218"),t("br"),t("span",{class:"line-number"},"219"),t("br"),t("span",{class:"line-number"},"220"),t("br"),t("span",{class:"line-number"},"221"),t("br"),t("span",{class:"line-number"},"222"),t("br"),t("span",{class:"line-number"},"223"),t("br"),t("span",{class:"line-number"},"224"),t("br"),t("span",{class:"line-number"},"225"),t("br"),t("span",{class:"line-number"},"226"),t("br"),t("span",{class:"line-number"},"227"),t("br"),t("span",{class:"line-number"},"228"),t("br"),t("span",{class:"line-number"},"229"),t("br"),t("span",{class:"line-number"},"230"),t("br"),t("span",{class:"line-number"},"231"),t("br"),t("span",{class:"line-number"},"232"),t("br"),t("span",{class:"line-number"},"233"),t("br"),t("span",{class:"line-number"},"234"),t("br"),t("span",{class:"line-number"},"235"),t("br"),t("span",{class:"line-number"},"236"),t("br"),t("span",{class:"line-number"},"237"),t("br"),t("span",{class:"line-number"},"238"),t("br"),t("span",{class:"line-number"},"239"),t("br"),t("span",{class:"line-number"},"240"),t("br"),t("span",{class:"line-number"},"241"),t("br"),t("span",{class:"line-number"},"242"),t("br"),t("span",{class:"line-number"},"243"),t("br"),t("span",{class:"line-number"},"244"),t("br"),t("span",{class:"line-number"},"245"),t("br"),t("span",{class:"line-number"},"246"),t("br"),t("span",{class:"line-number"},"247"),t("br"),t("span",{class:"line-number"},"248"),t("br"),t("span",{class:"line-number"},"249"),t("br"),t("span",{class:"line-number"},"250"),t("br"),t("span",{class:"line-number"},"251"),t("br"),t("span",{class:"line-number"},"252"),t("br"),t("span",{class:"line-number"},"253"),t("br"),t("span",{class:"line-number"},"254"),t("br"),t("span",{class:"line-number"},"255"),t("br"),t("span",{class:"line-number"},"256"),t("br"),t("span",{class:"line-number"},"257"),t("br"),t("span",{class:"line-number"},"258"),t("br"),t("span",{class:"line-number"},"259"),t("br"),t("span",{class:"line-number"},"260"),t("br"),t("span",{class:"line-number"},"261"),t("br"),t("span",{class:"line-number"},"262"),t("br"),t("span",{class:"line-number"},"263"),t("br"),t("span",{class:"line-number"},"264"),t("br"),t("span",{class:"line-number"},"265"),t("br"),t("span",{class:"line-number"},"266"),t("br"),t("span",{class:"line-number"},"267"),t("br"),t("span",{class:"line-number"},"268"),t("br"),t("span",{class:"line-number"},"269"),t("br"),t("span",{class:"line-number"},"270"),t("br"),t("span",{class:"line-number"},"271"),t("br"),t("span",{class:"line-number"},"272"),t("br"),t("span",{class:"line-number"},"273"),t("br"),t("span",{class:"line-number"},"274"),t("br"),t("span",{class:"line-number"},"275"),t("br"),t("span",{class:"line-number"},"276"),t("br"),t("span",{class:"line-number"},"277"),t("br"),t("span",{class:"line-number"},"278"),t("br"),t("span",{class:"line-number"},"279"),t("br"),t("span",{class:"line-number"},"280"),t("br"),t("span",{class:"line-number"},"281"),t("br"),t("span",{class:"line-number"},"282"),t("br"),t("span",{class:"line-number"},"283"),t("br"),t("span",{class:"line-number"},"284"),t("br"),t("span",{class:"line-number"},"285"),t("br"),t("span",{class:"line-number"},"286"),t("br"),t("span",{class:"line-number"},"287"),t("br"),t("span",{class:"line-number"},"288"),t("br"),t("span",{class:"line-number"},"289"),t("br"),t("span",{class:"line-number"},"290"),t("br"),t("span",{class:"line-number"},"291"),t("br"),t("span",{class:"line-number"},"292"),t("br"),t("span",{class:"line-number"},"293"),t("br"),t("span",{class:"line-number"},"294"),t("br"),t("span",{class:"line-number"},"295"),t("br"),t("span",{class:"line-number"},"296"),t("br"),t("span",{class:"line-number"},"297"),t("br"),t("span",{class:"line-number"},"298"),t("br"),t("span",{class:"line-number"},"299"),t("br"),t("span",{class:"line-number"},"300"),t("br"),t("span",{class:"line-number"},"301"),t("br"),t("span",{class:"line-number"},"302"),t("br"),t("span",{class:"line-number"},"303"),t("br")])],-1),K=t("h3",{id:"npm-link"},[t("a",{class:"header-anchor",href:"#npm-link","aria-hidden":"true"},"#"),e(" npm link")],-1),U=t("p",null,"node 应用开发中，我们不可避免的需要使用或拆分为 npm 模块，经常遇到的一个问题是：",-1),W=t("blockquote",null,[t("p",null,"新开发或修改的 npm 模块，如何在项目中试验？")],-1),J=t("p",null,[e("但其实 npm 本身已经对此类情况提供了专门的 "),t("code",null,"npm link"),e(" 指令。")],-1),Q=t("p",null,[e("相关文档： "),t("a",{href:"https://yq.aliyun.com/go/articleRenderRedirect?url=https%3A%2F%2Flink.juejin.im%2F%3Ftarget%3Dhttps%3A%2F%2Fdocs.npmjs.com%2Fcli%2Flink",target:"_blank",rel:"noopener noreferrer"},"docs.npmjs.com/cli/link")],-1),X=t("div",{class:"language-none line-numbers-mode"},[t("pre",null,[t("code",null,"$ cd path/to/my-project\n$ npm link path/to/my-utils\n"),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989446-72092"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"$ cd path/to/my-project\n$ npm link path/to/my-utils\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989446-72092","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br")])],-1),Z=t("p",null,"简单的替换一个单词，就搞定了，cool~",-1),nn=t("p",null,"如果这两种的目录不在一起，那还有一种方法：",-1),sn=t("div",{class:"language-none line-numbers-mode"},[t("pre",null,[t("code",null,"$ # 先去到模块目录，把它 link 到全局\n$ cd path/to/my-utils\n$ npm link\n$\n$ # 再去项目目录通过包名来 link\n$ cd path/to/my-project\n$ npm link my-utils\n"),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989446-23660"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"$ # 先去到模块目录，把它 link 到全局\n$ cd path/to/my-utils\n$ npm link\n$\n$ # 再去项目目录通过包名来 link\n$ cd path/to/my-project\n$ npm link my-utils\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989446-23660","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br"),t("span",{class:"line-number"},"4"),t("br"),t("span",{class:"line-number"},"5"),t("br"),t("span",{class:"line-number"},"6"),t("br"),t("span",{class:"line-number"},"7"),t("br")])],-1),an=t("p",null,"该指令还可以用来调试 node cli 模块，譬如需要本地调试我们的 egg-init，可以这样：",-1),tn=t("div",{class:"language-none line-numbers-mode"},[t("pre",null,[t("code",null,"$ cd path/to/egg-init\n$ npm link\n$ # 此时全局的 egg-init 指令就已经指向你的本地开发目录了\n$ egg-init # 即可\n"),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989446-36031"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"$ cd path/to/egg-init\n$ npm link\n$ # 此时全局的 egg-init 指令就已经指向你的本地开发目录了\n$ egg-init # 即可\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989446-36031","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br"),t("span",{class:"line-number"},"2"),t("br"),t("span",{class:"line-number"},"3"),t("br"),t("span",{class:"line-number"},"4"),t("br")])],-1),en=t("p",null,"想去掉 link 也很简单：",-1),on=t("div",{class:"language-none line-numbers-mode"},[t("pre",null,[t("code",null,"npm unlink my-utils\n"),t("div",{class:"m-mdic-copy-wrapper"},[t("div",{class:"u-mdic-copy-notify",id:"j-notify-1629556989446-96034"},"复制成功"),t("button",{class:"u-mdic-copy-btn j-mdic-copy-btn","data-mdic-content":"npm unlink my-utils\n","data-mdic-attach-content":"copyright | [artiely]","data-mdic-notify-id":"j-notify-1629556989446-96034","data-mdic-notify-delay":"1000","data-mdic-copy-fail-text":"copy fail",onclick:"!function(t){const e={copy:(t='',e='')=>new Promise((c,o)=>{const n=document.createElement('textarea'),d=e?`\\n\\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&&t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=>{n.style.display='block',setTimeout(()=>{n.style.display='none'},d)}).catch(()=>{alert(i)})}};e.btnClick(t)}(this);"},"复制")])]),t("div",{class:"line-numbers-wrapper"},[t("span",{class:"line-number"},"1"),t("br")])],-1),cn=a('',3);c.render=function(a,t,e,o,c,pn){return n(),s("div",null,[p,l,i,r,u,k,d,m,b,g,y,h,f,v,w,C,j,x,_,E,A,$,D,T,S,N,I,q,P,R,F,O,G,B,z,V,M,L,H,Y,K,U,W,J,Q,X,Z,nn,sn,an,tn,en,on,cn])};export default c;export{o as __pageData};
