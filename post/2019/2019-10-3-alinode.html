<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nodejs通用业务模块 | Artiely' blog</title>
    <meta name="description" content="随便玩玩">
    <link rel="stylesheet" href="/assets/style.514056dd.css">
    <link rel="modulepreload" href="/assets/Home.e48ff0e9.js">
    <link rel="modulepreload" href="/assets/lottie.42100ed3.js">
    <link rel="modulepreload" href="/assets/lightgallery.es5.f43f3494.js">
    <link rel="modulepreload" href="/assets/TextPlugin.8595634c.js">
    <link rel="modulepreload" href="/assets/app.5f3fb606.js">
    <link rel="modulepreload" href="/assets/post_2019_2019-10-3-alinode.md.9554b8d8.lean.js">
    <link rel="modulepreload" href="/assets/app.5f3fb606.js">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_2707633_ayah6j2r7wi.css">
    <script type="text/javascript" src="/js/twikoo.js"></script>
    <meta name="twitter:title" content="Nodejs通用业务模块 | Artiely&#39; blog">
    <meta property="og:title" content="Nodejs通用业务模块 | Artiely&#39; blog">
  </head>
  <body>
    <div id="app"><!--[--><!----><!----><div class="content dark" style="height:100%;"><div style="position:relative;"><div><h1 id="nodejs通用业务模块"><a class="header-anchor" href="#nodejs通用业务模块" aria-hidden="true">#</a> Nodejs通用业务模块</h1><h2 id="目标"><a class="header-anchor" href="#目标" aria-hidden="true">#</a> 目标</h2><ul><li>了解nodejs的生态与未来</li><li>理解alinode监控体系的应用场景与使用</li><li>理解nodejs在云原生应用领域的生态与发展</li></ul><h2 id="why"><a class="header-anchor" href="#why" aria-hidden="true">#</a> why</h2><ul><li>知己知彼，百战不殆</li><li>开阔技术视野，技术的提升不能仅仅停留在crud领域</li></ul><h2 id="nodejs之生态"><a class="header-anchor" href="#nodejs之生态" aria-hidden="true">#</a> nodejs之生态</h2><h3 id="2019年前端选择nodejs-还是-php"><a class="header-anchor" href="#2019年前端选择nodejs-还是-php" aria-hidden="true">#</a> 2019年前端，选择Nodejs 还是 PHP？</h3><p>观点：</p><ul><li>作为前端玩一玩可以学nodejs，真正的后端还是选择php</li><li>未来语言不重要，nodejs必有一席之地</li></ul><p><a href="https://www.zhihu.com/question/333368965/answer/771411673" target="_blank" rel="noopener noreferrer">https://www.zhihu.com/question/333368965/answer/771411673</a></p><p>总结：</p><ul><li>反对前端写js也有道理，有些前端确实连本职工作都没做好，就去写nodejs后端，确实不太好，造成不必要的麻烦</li><li>但是也鼓励前端去深入的学习后端领域的知识，技术是没有界限的</li><li>在后端基础扎实的情况下，未来nodejs大有可为</li></ul><h3 id="nodejs-在双十一中有哪些应用表现如何"><a class="header-anchor" href="#nodejs-在双十一中有哪些应用表现如何" aria-hidden="true">#</a> Node.js 在双十一中有哪些应用，表现如何？</h3><p><a href="https://www.zhihu.com/question/37379084/answer/74601296" target="_blank" rel="noopener noreferrer">https://www.zhihu.com/question/37379084/answer/74601296</a></p><p>观点：</p><ul><li><p>观点1</p><ul><li>nodejs大放异彩，整个双十一期间未出现任何由nodejs引发的故障</li><li>覆盖业务 <ul><li>天猫首页，大部分天猫频道页，活动页面</li><li>商品详情，店铺和搜索页等</li><li>页面搭建平台</li></ul></li><li>nodejs角色 <ul><li>完整的web业务流程</li><li>页面渲染服务</li></ul></li><li>稳定性 <ul><li>自动化测试</li><li>监控和报警,alinode</li></ul></li><li>多节点部署</li></ul></li><li><p>观点2</p><ul><li><p>node在阿里内部遍地开花</p></li><li><p>业务场景</p><ul><li>淘宝，支付宝，1688 等直面用户</li><li>内部系统</li><li>本地工具</li></ul></li><li><p>架构形态</p><ul><li>前后端分离</li><li>全栈应用(内部)</li></ul></li><li><p>nodejs对比java</p><ul><li>技术和人才储备上来看，依然差距比较大</li></ul></li></ul></li><li><p>生态差距也比较大</p></li><li><p><strong>总结：</strong> <strong>nodejs到底该如何使用？何时使用？</strong></p><p>主流企业级微服务架构体系简化图：</p><p><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200314161555.png" alt="image-20191130234831856"></p><ul><li>nodejs的异步非阻塞模型比较擅长处理i/o操作，也就是上层服务(api，渲染)，所以nodejs的绝大部分应用场景都是在上层( 大厂 )</li><li>当然nodejs也可以同时做上下层服务，前提是应用并发较小 ( 产品试错阶段，或者内部管理系统 )</li><li>优点 <ul><li>擅长游走于上层服务领域 (接口聚合，渲染等)</li><li>小快灵，快速堆砌产品原型</li><li>对前端工程师友好</li></ul></li><li>缺点 <ul><li>在下层服务领域的生态远远跟不上Java，goLang等正统服务端语言(特别是微服务架构体系)</li></ul></li></ul></li></ul><h2 id="接入alinode性能平台"><a class="header-anchor" href="#接入alinode性能平台" aria-hidden="true">#</a> 接入alinode性能平台</h2><h3 id="产品概述"><a class="header-anchor" href="#产品概述" aria-hidden="true">#</a> 产品概述</h3><p>Node.js 性能平台( Node.js Performance Platform )是面向所有 Node.js 应用提供 <strong>性能监控、安全提醒、故障排查、性能优化</strong> 等服务的整体性解决方案，尤其适用于中大型 Node.js 应用。</p><p>Node.js 性能平台凭借对 Node.js 内核深入的理解,提供完善的工具链和服务,协助客户主动、快速发现和定位线上问题。</p><h3 id="应用场景"><a class="header-anchor" href="#应用场景" aria-hidden="true">#</a> 应用场景</h3><p>Node.js 性能平台可以应用于所有 Node.js 应用，尤其适用于中大型 Node.js 应用。</p><p>Node.js 提供的精确到虚拟机级别的深度监控，能够如实的反应应用运行状态，通过配置报警规则，用户可以在发现系统出现故障（内存泄露或者 CPU 热点等）趋势时，通过诊断接口迅速定位故障点。</p><p>Node.js 性能平台特别适合业务发展迅速、应用发布频繁、流量上升明显的 Node.js 应用。</p><h3 id="功能特性"><a class="header-anchor" href="#功能特性" aria-hidden="true">#</a> 功能特性</h3><h4 id="系统层面"><a class="header-anchor" href="#系统层面" aria-hidden="true">#</a> 系统层面</h4><p>针对服务器（物理机、虚拟机、Docker 等）级别，提供如下监控指标：</p><ul><li>内存使用</li><li>CPU 使用率</li><li>系统负载</li><li>系统 QPS</li><li>硬性性能指标</li><li>磁盘使用率</li><li>GC 统计</li><li>……</li></ul><h4 id="进程层面"><a class="header-anchor" href="#进程层面" aria-hidden="true">#</a> 进程层面</h4><p>针对每个 Node.js 进程，提供如下监控指标：</p><ul><li>堆内（total 和 used）和堆外内存统计</li><li>堆内各个内存空间占用内存统计</li><li>垃圾回收（GC）占整个进程运行时间比例</li><li>QPS</li><li>按 1s、15s、30s、60s 的 CPU 统计</li><li>libuv 句柄，定时器统计</li><li>……</li></ul><h4 id="安全提醒"><a class="header-anchor" href="#安全提醒" aria-hidden="true">#</a> 安全提醒</h4><ul><li>npm 模块安全漏洞提醒</li></ul><h4 id="故障排查"><a class="header-anchor" href="#故障排查" aria-hidden="true">#</a> 故障排查</h4><ul><li>热点函数分析，通过线上 CPU Profiling 分析定位到热点函数</li><li>内存泄露分析，通过线上堆快照分析定位到内存泄露可疑点</li><li>GC 过程追踪</li><li>堆时间线</li><li>…..</li></ul><h4 id="性能优化"><a class="header-anchor" href="#性能优化" aria-hidden="true">#</a> 性能优化</h4><ul><li>Node.js 性能平台可以提供性能优化建议</li></ul><h3 id="快速入门"><a class="header-anchor" href="#快速入门" aria-hidden="true">#</a> 快速入门</h3><ul><li>阿里云账号，在这里 <a href="https://www.aliyun.com/product/nodejs" target="_blank" rel="noopener noreferrer">https://www.aliyun.com/product/nodejs</a> 开通服务</li><li>一台可以连接到互联网的服务器，或者开发机器</li></ul><h3 id="i-创建应用"><a class="header-anchor" href="#i-创建应用" aria-hidden="true">#</a> I. 创建应用</h3><ul><li>登录阿里云官网 <a href="https://www.aliyun.com/" target="_blank" rel="noopener noreferrer">https://www.aliyun.com/</a></li><li>前往 <a href="https://node.console.aliyun.com/" target="_blank" rel="noopener noreferrer">Node.js性能平台控制台</a> <code>创建新应用</code> 输入应用名 <code>demo</code> ,记录下 <code>App ID</code> 和 <code>App Secret</code> ，后面可以从应用界面的 <code>设置</code> 中查看该设置。</li></ul><h3 id="ii-服务器部署-nodejs-性能平台"><a class="header-anchor" href="#ii-服务器部署-nodejs-性能平台" aria-hidden="true">#</a> II. 服务器部署 Node.js 性能平台</h3><h4 id="a-安装-nodejs-性能平台所需组件"><a class="header-anchor" href="#a-安装-nodejs-性能平台所需组件" aria-hidden="true">#</a> a. 安装 Node.js 性能平台所需组件</h4><div class="language-shell line-numbers-mode"><pre><code><span class="token comment"># 安装版本管理工具 tnvm，安装过程出错参考：https://github.com/aliyun-node/tnvm</span>
<span class="token function">wget</span> -O- https://raw.githubusercontent.com/aliyun-node/tnvm/master/install.sh <span class="token operator">|</span> <span class="token function">bash</span>
<span class="token builtin class-name">source</span> ~/.bashrc
<span class="token comment"># tnvm ls-remote alinode 查看需要的版本</span>
tnvm <span class="token function">install</span> alinode-v3.11.4 <span class="token comment"># 安装需要的版本</span>
tnvm use alinode-v3.11.4 <span class="token comment"># 使用需要的版本</span>
<span class="token function">npm</span> <span class="token function">install</span> @alicloud/agenthub -g <span class="token comment"># 安装 agenthub</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629556989786-575">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="# 安装版本管理工具 tnvm，安装过程出错参考：https://github.com/aliyun-node/tnvm
wget -O- https://raw.githubusercontent.com/aliyun-node/tnvm/master/install.sh | bash
source ~/.bashrc
# tnvm ls-remote alinode 查看需要的版本
tnvm install alinode-v3.11.4 # 安装需要的版本
tnvm use alinode-v3.11.4 # 使用需要的版本
npm install @alicloud/agenthub -g # 安装 agenthub
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629556989786-575" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>验证安装是否成功,需要确保<code>which node</code> 和<code>which agenthub</code>的路径中包括<code>.tnvm</code>即可。</p><div class="language-shell line-numbers-mode"><pre><code>root@iZbp1gqe9a9t5d246bp7vqZ:~<span class="token comment"># which node/root/.tnvm/versions/alinode/v3.11.4/bin/noderoot@iZbp1gqe9a9t5d246bp7vqZ:~# which agenthub /root/.tnvm/versions/alinode/v3.11.4/bin/agenthub</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629556989788-74430">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="root@iZbp1gqe9a9t5d246bp7vqZ:~# which node/root/.tnvm/versions/alinode/v3.11.4/bin/noderoot@iZbp1gqe9a9t5d246bp7vqZ:~# which agenthub /root/.tnvm/versions/alinode/v3.11.4/bin/agenthub
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629556989788-74430" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>将<code>创建新应用</code>中获得的<code>App ID</code> 和 <code>App Secret</code> 按如下所示保存为 <code>yourconfig.json</code>。</p><div class="language-shell line-numbers-mode"><pre><code><span class="token punctuation">{</span>  <span class="token string">&quot;appid&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;12345&quot;</span>,                          <span class="token comment"># 前面申请到的 appid，保存时删掉这条注释。  	     &quot;secret&quot;: &quot;kflajglkajlgjalsgjlajdgfakjkgj&quot; # 前面申请到的 secret，保存时删掉这条注释。</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629556989788-10055">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="{  &quot;appid&quot;: &quot;12345&quot;,                          # 前面申请到的 appid，保存时删掉这条注释。  	     &quot;secret&quot;: &quot;kflajglkajlgjalsgjlajdgfakjkgj&quot; # 前面申请到的 secret，保存时删掉这条注释。
}
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629556989788-10055" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>注意：</strong></p><p><strong>1. 本例未配置 错误日志、报警 等功能。</strong></p><p><strong>2. 性能平台每分钟上传一次日志，请等待几分钟后查看数据。</strong></p><p><strong>3. 更详细的 Node.js 性能平台 runtime 部署参见 自助式部署 runtime</strong></p><h4 id="b使用egg接入nodejs性能平台"><a class="header-anchor" href="#b使用egg接入nodejs性能平台" aria-hidden="true">#</a> b.使用egg接入nodejs性能平台</h4><ol><li>安装runtime</li></ol><div class="language-"><pre><code>npm i nodeinstall -g
nodeinstall --install-alinode ^3
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629556989789-14388">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="npm i nodeinstall -g
nodeinstall --install-alinode ^3
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629556989789-14388" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="2"><li>安装egg-alinode插件</li></ol><div class="language-"><pre><code>npm i egg-alinode --save
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629556989789-97591">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="npm i egg-alinode --save
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629556989789-97591" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="3"><li>在 Egg 项目的 config/plugin.js 中启用此插件</li></ol><div class="language-js line-numbers-mode"><pre><code><span class="token comment">// config/plugin.js</span>
exports<span class="token punctuation">.</span>alinode <span class="token operator">=</span> <span class="token punctuation">{</span>
  enable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token keyword">package</span><span class="token operator">:</span> <span class="token string">&#39;egg-alinode&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629556989789-93457">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="// config/plugin.js
exports.alinode = {
  enable: true,
  package: &#39;egg-alinode&#39;
};
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629556989789-93457" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="4"><li>在 Egg 项目的 config/config.default.js 中添加配置</li></ol><div class="language-js line-numbers-mode"><pre><code><span class="token comment">// config/config.default.js</span>
exports<span class="token punctuation">.</span>alinode <span class="token operator">=</span> <span class="token punctuation">{</span>
  server<span class="token operator">:</span> <span class="token string">&#39;wss://agentserver.node.aliyun.com:8080&#39;</span><span class="token punctuation">,</span>
  appid<span class="token operator">:</span> <span class="token string">&#39;Node.js 性能平台给您的项目生成的 appid&#39;</span><span class="token punctuation">,</span>
  secret<span class="token operator">:</span> <span class="token string">&#39;Node.js 性能平台给您的项目生成的 secret&#39;</span><span class="token punctuation">,</span>
  logdir<span class="token operator">:</span> <span class="token string">&#39;Node.js 性能平台日志输出地址绝对路径，与 NODE_LOG_DIR 保持一致。如：/tmp/&#39;</span><span class="token punctuation">,</span>
  error_log<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;您的应用在业务层面产生的异常日志的路径，数组，可选，可配置多个&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;例如：/root/.logs/error.#YYYY#-#MM#-#DD#.log&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;不更改 Egg 默认日志输出路径可不配置本项目&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  agentidMode<span class="token operator">:</span><span class="token string">&#39;IP&#39;</span> <span class="token string">&#39;可选，如果设置，则在实例ID中添加部分IP信息，用于多个实例 hostname 相同的场景（以容器为主）&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629556989789-86342">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="// config/config.default.js
exports.alinode = {
  server: &#39;wss://agentserver.node.aliyun.com:8080&#39;,
  appid: &#39;Node.js 性能平台给您的项目生成的 appid&#39;,
  secret: &#39;Node.js 性能平台给您的项目生成的 secret&#39;,
  logdir: &#39;Node.js 性能平台日志输出地址绝对路径，与 NODE_LOG_DIR 保持一致。如：/tmp/&#39;,
  error_log: [
    &#39;您的应用在业务层面产生的异常日志的路径，数组，可选，可配置多个&#39;,
    &#39;例如：/root/.logs/error.#YYYY#-#MM#-#DD#.log&#39;,
    &#39;不更改 Egg 默认日志输出路径可不配置本项目&#39;,
  ],
  agentidMode:&#39;IP&#39; &#39;可选，如果设置，则在实例ID中添加部分IP信息，用于多个实例 hostname 相同的场景（以容器为主）&#39;
};
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629556989789-86342" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="5"><li>启动应用</li></ol><div class="language-js line-numbers-mode"><pre><code>egg<span class="token operator">-</span>scripts start <span class="token operator">--</span>daemon
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629556989789-94009">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="egg-scripts start --daemon
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629556989789-94009" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="性能指标"><a class="header-anchor" href="#性能指标" aria-hidden="true">#</a> 性能指标</h3><h4 id="memory"><a class="header-anchor" href="#memory" aria-hidden="true">#</a> Memory</h4><p>内存</p><h4 id="cpu"><a class="header-anchor" href="#cpu" aria-hidden="true">#</a> CPU</h4><h4 id="load"><a class="header-anchor" href="#load" aria-hidden="true">#</a> Load</h4><p>Load &lt; 0.7时：系统很闲，马路上没什么车，要考虑多部署一些服务</p><p>0.7 &lt; Load &lt; 1时：系统状态不错，马路可以轻松应对</p><p>Load == 1时：系统马上要处理不多来了，赶紧找一下原因</p><p>Load &gt; 1时：马路已经非常繁忙了，进入马路的每辆汽车都要无法很快的运行</p><h4 id="gc_avg-gc_max"><a class="header-anchor" href="#gc_avg-gc_max" aria-hidden="true">#</a> gc_avg gc_max</h4><p>gc所花费的时间百分比</p><h4 id="apdex"><a class="header-anchor" href="#apdex" aria-hidden="true">#</a> Apdex</h4><p>性能指标</p><p>0 代表失望</p><p>1 代表满意</p></div></div></div><div class="footer"><div class="follow"><a href="https://github.com/artiely" target="_target" title="github"><i class="icon iconfont"></i></a><a href="https://gitee.com/artiely" target="_target" title="gitee"><i class="icon iconfont"></i></a><a href="https://www.npmjs.com/~artiely" target="_target" title="npm"><i class="icon iconfont"></i></a><a href="mailto:artiely1024@gmail.com" title="gmail"><i class="icon iconfont"></i></a><a href="https://www.youtube.com/channel/UC3U9zfLMepBqyQjlvEVhQDQ?view_as=subscriber" target="_target" title="youtube"><i class="icon iconfont"></i></a><a href="https://www.zhihu.com/people/artiely-19" target="_target" title="zhihu"><i class="icon iconfont"></i></a><a href="https://space.bilibili.com/31432769?spm_id_from=333.33.b_73656375726974794f75744c696e6b.1" target="_target" title="bilibili"><i class="icon iconfont"></i></a></div><p class="footer-copyright"> ©Artiely <span class="time">-2019-2021</span></p></div><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"1dd82a23\",\"about_index.md\":\"8cacf850\",\"code_index.md\":\"bc9afb37\",\"comment_index.md\":\"305643b2\",\"tags_index.md\":\"b394f281\",\"timeline_index.md\":\"64c3604b\",\"post_2017_2017-6-10-tcp.md\":\"4bff6220\",\"post_2017_2017-6-6-css-1px.md\":\"8b792530\",\"post_2017_2017-6-6-css-ios-android.md\":\"34b21ff6\",\"post_2017_2017-6-6-css-sticky-footer.md\":\"bdbb7d21\",\"post_2017_2017-6-6-git.md\":\"ce988f32\",\"post_2017_2017-6-7-css-mobile-scroll-through.md\":\"24eda4a4\",\"post_2017_2017-6-8-yahoo-rules14.md\":\"d04ad885\",\"post_2017_2017-6-9-form-default-submit.md\":\"c81e706c\",\"post_2017_2017-7-4-moment.md\":\"7ac67b06\",\"post_2017_2017-7-7-css-rules.md\":\"3eaaa51d\",\"post_2017_2017-7-7-js-rules.md\":\"295f14fe\",\"post_2017_2017-7-7-rules-file.md\":\"3059937d\",\"post_2017_2017-7-7-rules-html.md\":\"81d1f61b\",\"post_2018_2018-1-30-centos-setup-nodejs.md\":\"21e1e8d2\",\"post_2018_2018-10-10-axios.md\":\"f0be1150\",\"post_2018_2018-10-10-chrome-dev-tips.md\":\"6fa08b9c\",\"post_2018_2018-10-10-get-post.md\":\"29221919\",\"post_2018_2018-10-10-git-green-pointer.md\":\"3ccf6966\",\"post_2018_2018-10-10-js-bit-operation.md\":\"1c33ecb0\",\"post_2018_2018-10-10-npm-nrm.md\":\"e96c01f5\",\"post_2018_2018-10-10-pm2.md\":\"4acd4997\",\"post_2018_2018-10-10-vue-pracel.md\":\"88950f83\",\"post_2018_2018-10-7-node-spider.md\":\"bef70d64\",\"post_2018_2018-3-12-nodejs-npm.md\":\"fde5fdb4\",\"post_2018_2018-6-26-web-koa-egg.md\":\"cb1f0540\",\"post_2018_2018-6-9-nuxt.md\":\"1d060bc9\",\"post_2018_2018-7-10-electron-message.md\":\"7eed85c9\",\"post_2018_2018-7-10-websocket.md\":\"59c778c1\",\"post_2018_2018-7-11-electron-nedb.md\":\"3b6797a4\",\"post_2018_2018-7-11-electron-shortcut-cliboard-nativeimage.md\":\"5ee44930\",\"post_2018_2018-7-3-electron-init.md\":\"8b66007e\",\"post_2018_2018-7-4-electron-base.md\":\"3c793fd1\",\"post_2018_2018-7-5-electron-model.md\":\"6e6cf702\",\"post_2018_2018-7-6-electron-menu-shortcut.md\":\"a62700a1\",\"post_2018_2018-7-7-electron-main-render.md\":\"d352cedc\",\"post_2018_2018-7-8-electron-dialog.md\":\"fc50cba3\",\"post_2018_2018-7-8-electron-shell-url-webview.md\":\"a87fc727\",\"post_2018_2018-7-9-electron-ico.md\":\"c39bd6aa\",\"post_2018_2018-8-7-egg-start.md\":\"e7e79807\",\"post_2018_2018-8-8-question.md\":\"797ebe6c\",\"post_2018_2018-8-8-vue-rules.md\":\"a5746d17\",\"post_2018_2018-9-7-js.md\":\"9a4e4d4e\",\"post_2019_2019-10-27-node-pm2.md\":\"8f2313d5\",\"post_2019_2019-10-3-alinode.md\":\"9554b8d8\",\"post_2019_2019-11-16-nodejs-api.md\":\"b944daff\",\"post_2019_2019-4-15-nodejs-tcp-udp-h2.md\":\"13c8f913\",\"post_2019_2019-4-16-vue-cli3+to-plugin.md\":\"cebf025d\",\"post_2019_2019-4-3-sentry-sourcemap.md\":\"acc86577\",\"post_2019_2019-4-3-vuepress-theme.md\":\"e82d2094\",\"post_2019_2019-5-5-restful-graphql.md\":\"2549d917\",\"post_2019_2019-6-1-linux.md\":\"0441d4f2\",\"post_2019_2019-6-12-deploy.md\":\"ef098d91\",\"post_2019_2019-6-19-fontend-performance-optimization.md\":\"e9fccd4a\",\"post_2019_2019-6-27-eslint-test.md\":\"bd81c131\",\"post_2019_2019-6-4-docker.md\":\"a2cdc2e6\",\"post_2019_2019-6-4-nodejs-events.md\":\"2de88a80\",\"post_2019_2019-6-6-css-fixedleft-autoright.md\":\"6962b704\",\"post_2019_2019-6-6-vue-observable.md\":\"f8055807\",\"post_2019_2019-7-13-automated-testing.md\":\"dc7fff88\",\"post_2019_2019-7-6-android-studio-flutter-shortcut.md\":\"17f60f4f\",\"post_2019_2019-7-6-dart-flutter-conf.md\":\"3230a015\",\"post_2019_2019-8-14-nosql.md\":\"1cf5fd04\",\"post_2021_2021-1-3-puppeteer.md\":\"4c94f00f\",\"post_2021_2021-2-23-proxy.md\":\"7c36be8c\",\"post_2021_2021-3-18-appleid.md\":\"8ddc761d\",\"post_2021_2021-6-15-mini.md\":\"05666a55\",\"post_2021_2021-7-23-pixijs.md\":\"b95d0749\",\"post_2021_2021-8-15-resize-observer.md\":\"4ba0de13\",\"post_2021_2021-8-16-min-share.md\":\"013ca983\",\"post_2020_2020-12-31-css.md\":\"722b6fa6\",\"post_2020_2020-3-16-chrome-plugin.md\":\"6501a2b9\",\"post_2020_2020-3-16-vscode-plugin.md\":\"961b1b51\",\"post_2020_2020-3-16-windows-plugin.md\":\"1f353ace\",\"post_2020_2020-3-18-electron-mirror-down.md\":\"ab5d3d5c\",\"post_2020_2020-3-18-electron-updater.md\":\"c7688116\",\"post_2020_2020-3-19-timer.js.md\":\"14c8b7c6\",\"post_2020_2020-3-20-antd-vue-pro.md\":\"9a2580c6\",\"post_2020_2020-3-20-js-how-to-work.md\":\"e38478bf\",\"post_2020_2020-3-29-vuepress-plugin.md\":\"91c1a89b\",\"post_2020_2020-3-31-shituzhengmei.md\":\"11b00859\",\"post_2020_2020-4-1-plupload.md\":\"587d84f1\",\"post_2020_2020-4-2-cmder.md\":\"2e104658\",\"post_2020_2020-4-29-vue-hook-lifecycle.md\":\"a0a9aafe\",\"post_2020_2020-4-4-yiqin.md\":\"1dcf7488\",\"post_2020_2020-4-6-plop.md\":\"d5e34049\",\"post_2020_2020-5-22-ali-oss.md\":\"51cb76e6\",\"post_2020_2020-5-29-axios.md\":\"ea12ce2a\",\"post_2020_2020-6-12-icon.md\":\"05971bed\",\"post_2020_2020-6-20-limit-chars.md\":\"5e0c91e8\",\"post_2020_2020-6-23-charslimit.md\":\"8ba59092\",\"post_2020_2020-6-25-custom-event.md\":\"4f21e6c9\",\"post_2020_2020-6-25-photo.md\":\"860d4695\",\"post_2020_2020-6-29-component.md\":\"6a33d1fd\",\"post_2020_2020-6-5-01-vue-cli.md\":\"6de83173\",\"post_2020_2020-6-5-02-vue-dir.md\":\"60fc7303\",\"post_2020_2020-6-5-03-vue-config.md\":\"a4de14f5\",\"post_2020_2020-6-5-04-vue.webpack.md\":\"73a7bdeb\",\"post_2020_2020-6-5-05-env-mode.md\":\"0ad8955b\",\"post_2020_2020-6-5-06-local-preview.md\":\"1fdf61de\",\"post_2020_2020-6-9-01-plugin.md\":\"d86d3952\",\"post_2020_2020-7-1-vue-api.md\":\"d61e9535\",\"post_2020_2020-7-1-vuex-api.md\":\"e27fd0d6\",\"post_2020_2020-7-13-madel.md\":\"aa2808a9\",\"post_2020_2020-7-14-share.md\":\"9b4315d6\",\"post_2020_2020-7-21-taro.md\":\"48553bac\",\"post_2020_2020-7-23-temp.md\":\"02e1964d\",\"post_2020_2020-7-9-thks-js.md\":\"72987a61\",\"post_2020_2020-8-17.md\":\"b5f0f831\",\"post_2020_2020-8-27-frontend-css1.md\":\"e9fa7268\",\"post_2020_2020-8-28-frontend-css2.md\":\"891ecf04\",\"post_2020_2020-8-29-frontend-js1.md\":\"23f7ba39\",\"post_2020_2020-8-29-frontend-js2.md\":\"25adeb71\",\"post_2020_2020-8-29-frontend-js3.md\":\"a44e3c94\",\"post_2020_2020-8-30-frontend-brower1.md\":\"dc1f1b98\",\"post_2020_2020-8-30-frontend-brower2.md\":\"0705e6f3\",\"post_2020_2020-8-31-frontend-brower3.md\":\"a019d3cc\",\"post_2020_2020-8-31-frontend-brower4.md\":\"88ef8b8e\",\"post_2020_2020-9-1-fw.md\":\"78bcad63\",\"post_2020_2020-9-1-fw2.md\":\"aff579a3\",\"post_2020_2020-9-15-js-arr.md\":\"9f45a83c\",\"post_2020_2020-9-2-proxy.md\":\"76b3628d\",\"post_2020_2020-9-24-interview.md\":\"8129eb80\",\"post_2020_2020-9-3-brower.md\":\"5f258a3a\",\"post_2020_2020-9-5-what-happens.md\":\"f5479f80\",\"post_2020_2020-9-7-recursive.md\":\"94dd0c9a\"}")</script>
    <script type="module" async src="/assets/app.5f3fb606.js"></script>
  </body>
</html>