<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>自动化测试 | Artiely' blog</title>
    <meta name="description" content="随便玩玩">
    <link rel="stylesheet" href="/vitepress-blog/assets/style.a7d0faf2.css">
    <link rel="modulepreload" href="/vitepress-blog/assets/Home.551898b1.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/lottie.42100ed3.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/lightgallery.es5.f43f3494.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/TextPlugin.8595634c.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/app.746f22cf.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/post_2019_2019-7-13-automated-testing.md.09bf2db1.lean.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/app.746f22cf.js">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_2707633_ayah6j2r7wi.css">
    <script type="text/javascript" src="/js/twikoo.js"></script>
    <meta name="twitter:title" content="自动化测试 | Artiely&#39; blog">
    <meta property="og:title" content="自动化测试 | Artiely&#39; blog">
  </head>
  <body>
    <div id="app"><!--[--><!----><!----><div class="content dark" style="height:100%;"><div style="position:relative;"><div><h1 id="自动化测试"><a class="header-anchor" href="#自动化测试" aria-hidden="true">#</a> 自动化测试</h1><h2 id="介绍"><a class="header-anchor" href="#介绍" aria-hidden="true">#</a> 介绍</h2><p>在前端界，浏览器兼容性是让工程师们头疼的问题，对于经验丰富的人来说，很清楚浏览器有哪些坑，但是对于大部分程序员，最可怕的是代码明明在这个浏览器运行得很好，但是到了另一个浏览器中就不能正常运行了。对于这部分的程序员，保障代码能正常运行的方法便是能尽早发现问题，然后将其解决。</p><p><strong>为什么需要自动化测试？</strong></p><p>项目经过不断的开发，最终肯定会趋于稳定，在<strong>适当的时机下</strong>引入自动化测试能及早发现问题，<strong>保证产品的质量</strong>。</p><p>测试作为完整的开发流程中最后的一环，是保证产品质量重要的一环。而前端测试一般在产品开发流程中属于偏后的环节，在整个开发架构中属于较高层次，前端测试更加偏向于GUI的特性，因此前端的测试难度很大。</p><p>测试的目的：</p><ul><li>有利于写出高质量的代码，尽早发现问题</li><li>有利于代码的扩展</li><li>有利于代码的维护</li></ul><p><strong>学习路径：</strong></p><ul><li>学习基础的概念，清晰测试不同的应用场景</li><li>学习不同的前端测试工具，了解如何进行选择</li><li>在项目中进行实践</li></ul><p><strong>主要内容：</strong></p><ul><li>介绍测试框架的分类</li><li>单元测试工具介绍：Mocha，Jest，AVA，Karma</li><li>E2E测试工具介绍：Nightmare</li></ul><p><strong>准备：</strong></p><ul><li>IDE vscode，node LTS</li><li>包管理工具：yarn, cnpm</li></ul><h2 id="前端自动化测试"><a class="header-anchor" href="#前端自动化测试" aria-hidden="true">#</a> 前端自动化测试</h2><p>测试是一个庞大的主题，包括各种分类的测试，诸如黑盒测试/白盒测试、单元测试/集成测试/端到端测试等。通常程序员在测试自己的代码的时候用得最多的便是单元测试，但是因为测试也是需要代价，很多人是不喜欢写测试的，甚至是一点都不写。</p><p>那么是什么原因让大家不愿意写呢？</p><ol><li>不熟悉</li><li>浪费时间</li><li>知识不成体系</li><li>团队氛围</li><li>缺少实践</li></ol><p>我们要从基础的东西学起，打消对测试的恐惧。</p><h3 id="测试的分类"><a class="header-anchor" href="#测试的分类" aria-hidden="true">#</a> 测试的分类</h3><p>在多浏览器的自动化测试，我们多半是进行端到端的测试工作，一小部分是大粒度的单元测试。端到端测试测试模拟用户的行为。在 Web 应用程序中，他们会启动服务器，打开浏览器，模拟用户的行为进行点击、输入、提交等动作，断言浏览器中发生了特定的事情或者是得到了期待的结果，从而让我们相信功能可以正常的运行。</p><p>而单元测试根据代码单元的公共 API 运行它们。这些测试需要创建一个类的实例，使用特定的输入调用它的方法，断言被调用的方法达到了预期的效果。在下文中我们会看到这两种测试的实践，当然有时候区分度并不大，可能无法明显地区分哪些是端对端测试哪些是单元测试，有时候他们是混合起来的，不过只要记住我们的目标是保证功能可以正常运行救足够了。</p><p>按照软件工程自底而上的概念，前端测试一般分为单元测试（Unit Testing ）、集成测试（Integration Testing）和端到端测试（E2E Testing）。从下面的图可以看出，从底向上测试的复杂度将不断提高，另一方面测试的收益反而不断降低的。</p><p><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200310105717.png" alt="img"></p><blockquote><p>关于软件测试分类，可见<a href="#%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95%E7%9A%84%E5%88%86%E7%B1%BB">软件测试的分类</a></p></blockquote><h3 id="测试工具对比"><a class="header-anchor" href="#测试工具对比" aria-hidden="true">#</a> 测试工具对比</h3><p>在进行项目实践前，很重要的一项工作是选择合适的技术栈。好比在前端开发时应该选择 React，Vue 还是 Angular 作为框架一样，前端的测试工作也需要选择一套技术栈。很多时候大家在制定技术栈时容易走偏，在选择技术框架时不是选择最合适的框架，而是选择最热门的框架。当然一定程度上热门的框架能反应其受欢迎程度，可能是因为其出众的优点，如较高的开发效率、高效的渲染特性或者是活跃的社区。在前端开发中，很容易有这样的感受，就是只要半个月没有关注业界的最新动态，就感觉恍若隔世，新的解决方案层出不穷，让人喘不过气。</p><p>经过几年的前端洗礼之后，就已经过了慌乱的年纪，再也不会盲目地追寻新技术，而转向关注技术背后解决的痛点，原理等。</p><p><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200310105718.png" alt="img"></p><h4 id="如何选择测试框架"><a class="header-anchor" href="#如何选择测试框架" aria-hidden="true">#</a> 如何选择测试框架</h4><p>测试框架基本上都做了一件事儿：</p><ul><li>描述你要测试的东西</li><li>对其进行测试</li><li>判断是否符合预期</li></ul><p>选择框架会考虑下面的点：</p><ul><li><p>测试框架是否有简明的语法与文档。</p><p>Mocha、Jasmine、Jest、AVA、Karma、Nightmare</p></li><li><p>断言(Assertions)：用于判断结果是否符合预期。有些框架需要单独的断言库。</p><p>Should.js、chai、expect.js等等，断言库提供了很多语义化的方法来对值做各种各样的判断。当然也可以不用断言库，Node.js中也可以直接使用原生assert库。</p></li><li><p>适合 TDD / BDD：是否适合 测试驱动型 / 行为驱动型 的测试风格。</p><blockquote><p>BDD(Bebavior Driven Developement，行为驱动测试)和TDD(Testing Driven Developement，测试驱动开发)</p></blockquote><p>BDD和TDD均有各自的适用场景，BDD一般更偏向于系统功能和业务逻辑的自动化测试设计，而TDD在快速开发并测试功能模块的过程中则更加高效，以快速完成开发为目的。下面我们看下BDD和TDD具体的特点：</p><p>BDD的特点：</p><ul><li>从业务逻辑的角度定义具体的输入与预期输出，以及可衡量的目标；</li><li>尽可能覆盖所有的测试用例情况；</li><li>描述一系列可执行的行为，根据业务的分析来定义预期输出。例如，expect, should, assert；</li><li>设定关键的测试通过节点输出提示，便于测试人员理解；</li><li>最大程度的交付出符合用户期望的产品，避免输出不一致带来的问题。</li></ul><p>TDD的特点：</p><ul><li>需求分析，快速编写对应的输入输出测试脚本；</li><li><strong>仅在自动测试失败时才编写新代码</strong>。</li><li>重构去除不必要的依赖关系，然后重复测试，最终让程序符合所有要求。</li></ul></li><li><p>异步测试：有些框架对异步测试支持良好。</p></li><li><p>使用的语言：大部分 js 测试框架使用 js。</p></li><li><p>用于特定目的：每个框架可能会擅长处理不同的问题。</p><p>是要测试单个功能、单个组件、还是集成化测试？</p><p>是要测试GUI逻辑、交互？</p><p>是要测试非功能性指标？兼容性？</p></li><li><p>社区是否活跃。</p></li></ul><h4 id="测试工具的类型"><a class="header-anchor" href="#测试工具的类型" aria-hidden="true">#</a> 测试工具的类型</h4><p>测试工具可分为以下功能。有些只为我们提供了一种功能，有些功能为我们提供了一种组合。</p><p>为了实现最灵活的集合功能，通常使用多种工具的组合。</p><ul><li><p>提供UI界面或者CLI工具：（<a href="https://karma-runner.github.io/" target="_blank" rel="noopener noreferrer">Karma</a>，<a href="http://jasmine.github.io/" target="_blank" rel="noopener noreferrer">Jasmine</a>，<a href="https://facebook.github.io/jest/" target="_blank" rel="noopener noreferrer">Jest</a>，<a href="https://github.com/DevExpress/testcafe" target="_blank" rel="noopener noreferrer">TestCafe</a>，<a href="https://www.cypress.io/" target="_blank" rel="noopener noreferrer">Cypress</a>）</p><p><strong>CLI工具</strong>会给出一系列测试，以及运行这些测试所需的各种配置和脚手架（运行什么浏览器，使用什么babel插件，如何格式化输出等）</p></li><li><p>提供测试框架（形成文件目录）：(<a href="https://mochajs.org/" target="_blank" rel="noopener noreferrer">Mocha</a>, <a href="http://jasmine.github.io/" target="_blank" rel="noopener noreferrer">Jasmine</a>, <a href="https://facebook.github.io/jest/" target="_blank" rel="noopener noreferrer">Jest</a>, <a href="https://github.com/cucumber/cucumber-js" target="_blank" rel="noopener noreferrer">Cucumber</a>, <a href="https://github.com/DevExpress/testcafe" target="_blank" rel="noopener noreferrer">TestCafe</a>, <a href="https://www.cypress.io/" target="_blank" rel="noopener noreferrer">Cypress</a>)</p></li><li><p>提供断言：（<a href="http://chaijs.com/" target="_blank" rel="noopener noreferrer">Chai</a>，<a href="http://jasmine.github.io/" target="_blank" rel="noopener noreferrer">Jasmine</a>，<a href="https://facebook.github.io/jest/" target="_blank" rel="noopener noreferrer">Jest</a>，<a href="http://unexpected.js.org/" target="_blank" rel="noopener noreferrer">Unexpected</a>，<a href="https://github.com/DevExpress/testcafe" target="_blank" rel="noopener noreferrer">TestCafe</a>，<a href="https://www.cypress.io/" target="_blank" rel="noopener noreferrer">Cypress</a>）</p><p><strong>断言函数</strong>检查测试返回的结果是否符合预期</p></li><li><p>生成，展示测试结果（<a href="https://mochajs.org/" target="_blank" rel="noopener noreferrer">Mocha</a>，<a href="http://jasmine.github.io/" target="_blank" rel="noopener noreferrer">Jasmine</a>，<a href="https://facebook.github.io/jest/" target="_blank" rel="noopener noreferrer">Jest</a>，<a href="https://karma-runner.github.io/" target="_blank" rel="noopener noreferrer">Karma</a>，<a href="https://github.com/DevExpress/testcafe" target="_blank" rel="noopener noreferrer">TestCafe</a>，<a href="https://www.cypress.io/" target="_blank" rel="noopener noreferrer">Cypress</a>）</p></li><li><p>快照测试（<a href="https://facebook.github.io/jest/" target="_blank" rel="noopener noreferrer">Jest</a>，<a href="https://github.com/avajs/ava" target="_blank" rel="noopener noreferrer">Ava</a>）</p><p>快照测试(snapshot testing)，测试 UI 或数据结构是否和之前完全一致，通常 UI 测试不在单元测试中</p></li><li><p>提供仿真（<a href="http://sinonjs.org/" target="_blank" rel="noopener noreferrer">Sinon</a>，<a href="http://jasmine.github.io/" target="_blank" rel="noopener noreferrer">Jasmine</a>，<a href="http://airbnb.io/enzyme/docs/api/" target="_blank" rel="noopener noreferrer">enzyme</a>，<a href="https://facebook.github.io/jest/" target="_blank" rel="noopener noreferrer">Jest</a>，<a href="https://testdouble.com/" target="_blank" rel="noopener noreferrer">testdouble</a>）</p><p>仿真(mocks, spies, and stubs)：获取方法的调用信息，模拟方法，模块，甚至服务器</p></li><li><p>生成测试覆盖率报告 (<a href="https://gotwarlost.github.io/istanbul/" target="_blank" rel="noopener noreferrer">Istanbul</a>, <a href="https://facebook.github.io/jest/" target="_blank" rel="noopener noreferrer">Jest</a>, <a href="http://blanketjs.org/" target="_blank" rel="noopener noreferrer">Blanket</a>)</p></li><li><p>提供类浏览器环境(<a href="http://nightwatchjs.org/" target="_blank" rel="noopener noreferrer">Nightwatch</a>, <a href="http://www.nightmarejs.org/" target="_blank" rel="noopener noreferrer">Nightmare</a>, <a href="http://phantomjs.org/" target="_blank" rel="noopener noreferrer">Phantom</a><strong>,</strong> <a href="https://github.com/GoogleChrome/puppeteer" target="_blank" rel="noopener noreferrer">Puppeteer</a>, <a href="https://github.com/DevExpress/testcafe" target="_blank" rel="noopener noreferrer">TestCafe</a>, <a href="https://www.cypress.io/" target="_blank" rel="noopener noreferrer">Cypress</a>)</p></li><li><p>可视化回归工具(<a href="https://applitools.com/" target="_blank" rel="noopener noreferrer">Applitools</a>, <a href="https://percy.io/" target="_blank" rel="noopener noreferrer">Percy</a>, <a href="http://bbc-news.github.io/wraith/" target="_blank" rel="noopener noreferrer">Wraith</a>, <a href="https://github.com/webdriverio-boneyard/webdrivercss" target="_blank" rel="noopener noreferrer">WebdriverCSS</a>)</p></li></ul><h4 id="单元测试类工具"><a class="header-anchor" href="#单元测试类工具" aria-hidden="true">#</a> 单元测试类工具</h4><p>npm trends: <a href="https://www.npmtrends.com/mocha-vs-jest-vs-ava-vs-jasmine-core" target="_blank" rel="noopener noreferrer">点击链接</a></p><p><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200310105719.jpg" alt="image-20190706101634263"></p><p><strong>Karma</strong></p><p>Karma是一个Runner（即运行环境），具体详细的介绍见 <a href="#%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83&amp;%E5%B8%AE%E6%89%8BKarma">后面的章节Karma</a></p><blockquote><p>A test runner is the library or tool that picks up an assembly (or a source code directory) that contains unit tests, and a bunch of settings, and then executes them and writes the test results to the console or log files.<br> there are many runners for different languages. See Nunit and MSTest for C#, or Junit for Java.</p></blockquote><p>karma 设计目标主要有下面四点：</p><blockquote><p>高效<br> 扩展性<br> 运行在真实设备<br> 无缝的使用流程</p></blockquote><p>karma 是一个典型的 C/S 程序，包含 client 和 server ，通讯方式基于 Http ，通常情况下，客户端和服务端基本都运行在开发者本地机器上。</p><p>一个服务端实例对应一个项目，假如想同时运行多个项目，得同时开启多个服务端实例。</p><p>Karma 的<strong>优点</strong>是能通过插件和配置的方式集成大部分的主流的测试框架和前端库，能方便的一次在多浏览器环境执行测试用例，并集成了测试覆盖率生成功能，生成页面形式覆盖率报告并能导出不同形式的覆盖率报告数据。</p><p>它的<strong>缺点</strong>是，对测试页面环境的搭建和资源文件的加载不是常见的形式，最开始搭建环境时会有很多跟预期不一致的情况，配置不直观。</p><p><strong>Jasmine</strong></p><p>Jasmine 带有 assertions(断言)，spies (用来模拟函数的执行环境)和 mocks (mock 工具)，Jasmine 初始化设置简单，同时，如果你需要一些单元功能的时候你仍然可以加一些库进来。</p><p><strong>Mocha</strong></p><p>Mocha 是一个灵活的库，提供给开发者的只有一个基础测试结构。然后，其它功能性的功能如 assertions， spies和mocks，这些功能<strong>需要引用添加其它库</strong>/插件来完成。</p><p><strong>Jest</strong></p><p>被 Facebook 和各种 React 应用推荐和使用，Jest 得到了很好的支持。Jest 也被发现是一个非常快速的测试库在平行测试报告中。</p><p>对于小型项目来说你可能在开始的时候不用过多担心，而性能的提高，对于希望全天持续部署的大型应用 app 来说是非常之好的。</p><p>而开发人员主要是用 Jest 去测试 React 应用，Jest 可以很容易地集成到其它应用程序中充许你使用更独特的特性在其它地方</p><p>快照测试是一个非常好用的工具，去确保你的应用 UI 不会有超出预期的错误，在产品发布替换的期间发生。虽然大部分功能，专门设计都是使用在 React 上。</p><p>Jest 有着很广阔的 API 。</p><p><strong>AVA</strong></p><p>AVA 它的优势是 JavaScript 的异步特性和并发运行测试.</p><p>利用了 JavaScript 的异步特性优势，优化了在部署的时间等待</p><p>保留了简单的 API 为你提供你所需要的功能。</p><p>如果搭配 mocking 来使用它会显得更加友好，但是必须安装一个单独的库。</p><h4 id="e2e测试类工具"><a class="header-anchor" href="#e2e测试类工具" aria-hidden="true">#</a> E2E测试类工具</h4><p>npm trends: <a href="https://www.npmtrends.com/cypress-vs-nightmare-vs-nightwatch-vs-testcafe-vs-webdriverio" target="_blank" rel="noopener noreferrer">点击链接</a></p><p><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200310105720.png" alt="image-20190706100636750"></p><h3 id="最佳实践"><a class="header-anchor" href="#最佳实践" aria-hidden="true">#</a> 最佳实践</h3><p>测试有很多好处，但不代表一上来就要写出100%场景覆盖的测试用例。</p><p><strong>最佳的实践：基于投入产出比来做测试</strong></p><p>由于维护测试用例也是一大笔开销（毕竟没有多少测试会专门帮前端写业务测试用例，而前端使用的流程自动化工具更是没有测试参与了）。</p><p>对于像基础组件、基础模型之类的不常变更且复用较多的部分，可以考虑去写测试用例来保证质量。个</p><p>先写少量的测试用例覆盖到80%+的场景，保证覆盖主要使用流程。</p><p>一些极端场景出现的bug可以在迭代中形成测试用例沉淀，场景覆盖也将逐渐趋近100%。</p><p>但对于迭代较快的业务逻辑以及生存时间不长的活动页面之类的就别花时间写测试用例了，维护测试用例的时间大了去了，成本太高。</p><p>大型项目，可以使用Jest快速形成配置并且开始单元测试。</p><p>需要测试快照，则可以选择Jest或者Ava。</p><p>对于配置性要求高，对测试框架性能有要求的可以选择mocha。</p><p>对模拟还原浏览器业务操作有很大的需求的，可以选择nightmare</p><p>配合CI工具完成自动化测试、测试覆盖率、测试结果推送。</p><h2 id="喜欢简单选择mocha"><a class="header-anchor" href="#喜欢简单选择mocha" aria-hidden="true">#</a> 喜欢简单，选择Mocha</h2><p><a href="https://mochajs.org/" target="_blank" rel="noopener noreferrer"><code>Mocha</code></a>（发音&quot;摩卡&quot;）诞生于2011年，是现在最流行的JavaScript测试框架之一，在浏览器和Node环境都可以使用。所谓&quot;测试框架&quot;，就是运行测试的工具。通过它，可以为JavaScript应用添加测试，从而保证代码的质量。</p><h3 id="安装"><a class="header-anchor" href="#安装" aria-hidden="true">#</a> 安装</h3><p>全局安装Mocha</p><div class="language-bash line-numbers-mode"><pre><code><span class="token function">npm</span> <span class="token function">install</span> -g mocha
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005714-64156">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="npm install -g mocha
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005714-64156" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>项目中也安装Mocha</p><div class="language-bash line-numbers-mode"><pre><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev mocha
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005714-5954">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="npm install --save-dev mocha
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005714-5954" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在package.json中加入下面脚本：</p><div class="language-bash line-numbers-mode"><pre><code><span class="token string">&quot;scripts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;test&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;mocha&quot;</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005714-29765">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="&quot;scripts&quot;: {
    &quot;test&quot;: &quot;mocha&quot;
}
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005714-29765" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Chai 是一个针对 Node.js 和浏览器的行为驱动测试和测试驱动测试的<strong>断言库</strong>，可与任何 JavaScript 测试框架集成。它是Mocha的好帮手~~</p><div class="language-bash line-numbers-mode"><pre><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev chai
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005714-64048">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="npm install --save-dev chai
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005714-64048" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在package.json中加入下面脚本：</p><div class="language-json line-numbers-mode"><pre><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mocha&quot;</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005714-17595">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="&quot;scripts&quot;: {
    &quot;test&quot;: &quot;mocha&quot;
}
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005714-17595" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="关于断言"><a class="header-anchor" href="#关于断言" aria-hidden="true">#</a> 关于断言</h3><p><code>expect</code>断言的优点是很接近自然语言，下面是一些例子。</p><div class="language-js line-numbers-mode"><pre><code><span class="token comment">// 相等或不相等</span>
<span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">expect</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span>deep<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token punctuation">{</span> bar<span class="token operator">:</span> <span class="token string">&#39;baz&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 布尔值为true</span>
<span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&#39;everthing&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span>ok<span class="token punctuation">;</span>
<span class="token function">expect</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>not<span class="token punctuation">.</span>be<span class="token punctuation">.</span>ok<span class="token punctuation">;</span>

<span class="token comment">// typeof</span>
<span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">&#39;bar&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">an</span><span class="token punctuation">(</span><span class="token string">&#39;object&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">expect</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span>an<span class="token punctuation">.</span><span class="token function">instanceof</span><span class="token punctuation">(</span>Foo<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// include</span>
<span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">include</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&#39;foobar&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">contain</span><span class="token punctuation">(</span><span class="token string">&#39;foo&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">&#39;bar&#39;</span><span class="token punctuation">,</span> hello<span class="token operator">:</span> <span class="token string">&#39;universe&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>include<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token string">&#39;foo&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// empty</span>
<span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span>empty<span class="token punctuation">;</span>
<span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span>empty<span class="token punctuation">;</span>
<span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span>empty<span class="token punctuation">;</span>

<span class="token comment">// match</span>
<span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&#39;foobar&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^foo</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005714-17901">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="// 相等或不相等
expect(4 + 5).to.be.equal(9);
expect(4 + 5).to.be.not.equal(10);
expect(foo).to.be.deep.equal({ bar: &#39;baz&#39; });

// 布尔值为true
expect(&#39;everthing&#39;).to.be.ok;
expect(false).to.not.be.ok;

// typeof
expect(&#39;test&#39;).to.be.a(&#39;string&#39;);
expect({ foo: &#39;bar&#39; }).to.be.an(&#39;object&#39;);
expect(foo).to.be.an.instanceof(Foo);

// include
expect([1,2,3]).to.include(2);
expect(&#39;foobar&#39;).to.contain(&#39;foo&#39;);
expect({ foo: &#39;bar&#39;, hello: &#39;universe&#39; }).to.include.keys(&#39;foo&#39;);

// empty
expect([]).to.be.empty;
expect(&#39;&#39;).to.be.empty;
expect({}).to.be.empty;

// match
expect(&#39;foobar&#39;).to.match(/^foo/);
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005714-17901" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>两种使用方式：</p><div class="language-js line-numbers-mode"><pre><code><span class="token comment">// commonjs</span>
<span class="token keyword">const</span> expect <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;chai&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>expect

<span class="token comment">// es6</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> expect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;chai&#39;</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005714-35465">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="// commonjs
const expect = require(&#39;chai&#39;).expect

// es6
import { expect } from &#39;chai&#39;
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005714-35465" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="测试案例"><a class="header-anchor" href="#测试案例" aria-hidden="true">#</a> 测试案例</h3><p>其中index.js为我们的被测试代码：</p><div class="language-js line-numbers-mode"><pre><code><span class="token comment">/**
 * 加法函数
 * @param {第一个数} a 
 * @param {第二个数} b 
 */</span>
<span class="token keyword">function</span> <span class="token function">addNum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> a<span class="token operator">+</span>b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span>addNum<span class="token punctuation">;</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005714-91480">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="/**
 * 加法函数
 * @param {第一个数} a 
 * @param {第二个数} b 
 */
function addNum(a,b){
    return a+b;
}
module.exports=addNum;
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005714-91480" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>新建测试脚本<code>test/demo.js</code></p><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">const</span> expect <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;chai&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>expect<span class="token punctuation">;</span>
<span class="token keyword">const</span> addNum <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;../src/index&#39;</span><span class="token punctuation">)</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;测试index.js&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;测试addNum函数&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;两数相加结果为两个数字的和&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">addNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 以上语法为chai的expect语法，它还有should语法和asset语法。</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// 等价的意思</span>
<span class="token keyword">var</span> addNum<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;../src/index&#39;</span><span class="token punctuation">)</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;测试index.js&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;测试addNum函数&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;两数相加结果为两个数字的和&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">addNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;两数相加结果不为两个数字的和&quot;</span><span class="token punctuation">)</span>；
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005714-32141">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="const expect = require(&#39;chai&#39;).expect;
const addNum = require(&#39;../src/index&#39;)

describe(&#39;测试index.js&#39;, function() {
  describe(&#39;测试addNum函数&#39;, function() {
    it(&#39;两数相加结果为两个数字的和&#39;, function() {
      expect(addNum(1,2)).to.be.equal(3);
      // 以上语法为chai的expect语法，它还有should语法和asset语法。
    });
  });
});


// 等价的意思
var addNum=require(&#39;../src/index&#39;)

describe(&#39;测试index.js&#39;, function() {
  describe(&#39;测试addNum函数&#39;, function() {
    it(&#39;两数相加结果为两个数字的和&#39;, function() {
       if(addNum(1,2)!==3){
         throw new Error(&quot;两数相加结果不为两个数字的和&quot;)；
       }
    });
  });
});
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005714-32141" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="mocha测试命令"><a class="header-anchor" href="#mocha测试命令" aria-hidden="true">#</a> Mocha测试命令</h3><p>如果想测试单一的测试js，可以用：</p><div class="language-bash line-numbers-mode"><pre><code>mocha test/index.test.js
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005715-6601">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="mocha test/index.test.js
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005715-6601" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>或者多个js</p><div class="language-bash line-numbers-mode"><pre><code>mocha test/index.test.js test/add.test.js
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005715-69349">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="mocha test/index.test.js test/add.test.js
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005715-69349" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>当然也可以用通配符测试某个文件夹下所有的js和jsx：</p><div class="language-bash line-numbers-mode"><pre><code><span class="token comment"># node 通配符</span>
mocha <span class="token string">&#39;test/some/*.@(js|jsx)&#39;</span>

<span class="token comment"># shell 通配符</span>
mocha test/unit/*.js

mocha spec/<span class="token punctuation">{</span>my,awesome<span class="token punctuation">}</span>.js
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005715-90479">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="# node 通配符
mocha &#39;test/some/*.@(js|jsx)&#39;

# shell 通配符
mocha test/unit/*.js

mocha spec/{my,awesome}.js
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005715-90479" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="es6语法支持"><a class="header-anchor" href="#es6语法支持" aria-hidden="true">#</a> ES6语法支持</h3><p>在上面我们用的并非是ES6的语法，那么让我们把其中的代码都改为ES6的语法。<br> 其中index.js为：</p><div class="language-js line-numbers-mode"><pre><code><span class="token comment">/**
 * 加法函数
 * @param {第一个数} a 
 * @param {第二个数} b 
 */</span>
<span class="token keyword">function</span> <span class="token function">addNum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span>
  addNum
<span class="token punctuation">}</span> 
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005715-25280">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="/**
 * 加法函数
 * @param {第一个数} a 
 * @param {第二个数} b 
 */
function addNum(a, b) {
  return a + b
}

export {
  addNum
} 
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005715-25280" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>而index.test.js为：</p><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> expect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;chai&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> addNum <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../src/index&#39;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;测试index.js&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;测试addNum函数&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;两个参数相加结果为两个数字的和&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">addNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;两个参数相加结果不为和以外的数&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">addNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005715-49706">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="import { expect } from &#39;chai&#39;
import { addNum } from &#39;../src/index&#39;

describe(&#39;测试index.js&#39;, function () {
  describe(&#39;测试addNum函数&#39;, function () {
    it(&#39;两个参数相加结果为两个数字的和&#39;, function () {
      expect(addNum(1, 2)).to.be.equal(3);
    })
    it(&#39;两个参数相加结果不为和以外的数&#39;, function () {
      expect(addNum(1, 2)).to.be.not.equal(4);
    })
  })
})
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005715-49706" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>此时直接运行mocha肯定是不行的，我们现需要安装一下babel：</p><div class="language-bash line-numbers-mode"><pre><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev @babel/cli @babel/core @babel/node @babel/register @babel/preset-env chai mocha nodemon
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005715-90687">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="npm install --save-dev @babel/cli @babel/core @babel/node @babel/register @babel/preset-env chai mocha nodemon
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005715-90687" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后，在项目目录下面，新建一个.babelrc文件：</p><div class="language-json line-numbers-mode"><pre><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005715-90845">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="{
  &quot;presets&quot;: [&quot;@babel/preset-env&quot;]
}
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005715-90845" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>接着讲package.json中的脚本改为：</p><div class="language-json line-numbers-mode"><pre><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mocha --require @babel/register&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005715-35381">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="&quot;scripts&quot;: {
  &quot;test&quot;: &quot;mocha --require @babel/register&quot;
},
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005715-35381" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>命令变得更加简单了</p><h3 id="更多用法"><a class="header-anchor" href="#更多用法" aria-hidden="true">#</a> 更多用法</h3><h4 id="超时"><a class="header-anchor" href="#超时" aria-hidden="true">#</a> 超时</h4><div class="language-bash line-numbers-mode"><pre><code>  --timeout, -t, --timeouts  Specify <span class="token builtin class-name">test</span> <span class="token function">timeout</span> threshold <span class="token punctuation">(</span>in milliseconds<span class="token punctuation">)</span>
                                                        <span class="token punctuation">[</span>number<span class="token punctuation">]</span> <span class="token punctuation">[</span>default: <span class="token number">2000</span><span class="token punctuation">]</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005715-49398">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="  --timeout, -t, --timeouts  Specify test timeout threshold (in milliseconds)
                                                        [number] [default: 2000]
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005715-49398" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>官方默认的超时是2000毫秒，即2s。</p><p>有三种方式来修改超时：</p><p><code>--no-timeout</code>参数或者<code>debug</code>模式中，全局禁用了超时；</p><p><code>--timeout</code>后面接时间（毫秒），全局修改了本次执行测试用例的超时时间；</p><p>在测试用例里面，使用<code>this.timeout</code>方法：</p><div class="language-js line-numbers-mode"><pre><code><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;should take less than 500ms&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">timeout</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span>done<span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005715-70681">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="it(&#39;should take less than 500ms&#39;, function(done) {
  this.timeout(500);
  setTimeout(done, 300);
});
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005715-70681" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>在<a href="#%E9%92%A9%E5%AD%90%E6%96%B9%E6%B3%95%EF%BC%88%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%87%BD%E6%95%B0%EF%BC%89">钩子方法</a>里面使用：</p><div class="language-js line-numbers-mode"><pre><code><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;a suite of tests&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">timeout</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// A very long environment setup.</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>done<span class="token punctuation">,</span> <span class="token number">2500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005716-35542">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="describe(&#39;a suite of tests&#39;, function() {
  beforeEach(function(done) {
    this.timeout(3000); // A very long environment setup.
    setTimeout(done, 2500);
  });
});
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005716-35542" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>同样，可以使用<code>this.timeout(0)</code>去禁用超时。</p></blockquote><h4 id="钩子方法生命周期函数"><a class="header-anchor" href="#钩子方法生命周期函数" aria-hidden="true">#</a> 钩子方法（生命周期函数）</h4><p>Mocha在describe块之中，提供测试用例的四个钩子：before()、after()、beforeEach()和afterEach()。它们会在指定时间执行。</p><div class="language-js line-numbers-mode"><pre><code><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;测试index.js&#39;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;在本区块的所有测试用例之前执行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;在本区块的所有测试用例之后执行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;在本区块的每个测试用例之前执行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;在本区块的每个测试用例之后执行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;测试addNum函数&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;两数相加结果为两个数字的和&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token function">addNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005716-23615">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="describe(&#39;测试index.js&#39;,()=&gt; {
  before(()=&gt;console.info(&quot;在本区块的所有测试用例之前执行&quot;))

  after(()=&gt;console.info(&quot;在本区块的所有测试用例之后执行&quot;))

  beforeEach(()=&gt;console.info(&quot;在本区块的每个测试用例之前执行&quot;))

  afterEach(()=&gt;console.info(&quot;在本区块的每个测试用例之后执行&quot;))

  describe(&#39;测试addNum函数&#39;, ()=&gt; {
    it(&#39;两数相加结果为两个数字的和&#39;, ()=&gt; {
      assert.equal(addNum(1,2),3)
    })
  })
})
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005716-23615" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="异步测试"><a class="header-anchor" href="#异步测试" aria-hidden="true">#</a> 异步测试</h4><p>Mocha本身是支持异步测试的。只需要为<code>describe</code>回调函数添加一个<code>done</code>参数， 成功时调用<code>done()</code>，失败时调用<code>done(err)</code>。例如：</p><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">var</span> expect <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;chai&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>expect<span class="token punctuation">;</span>
<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;db&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;#get&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        db<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;foo&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> foo</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">done</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>        
            <span class="token function">expect</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">&#39;bar&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005716-18148">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="var expect = require(&#39;chai&#39;).expect;
describe(&#39;db&#39;, function() {
    it(&#39;#get&#39;, function(done) {
        db.get(&#39;foo&#39;, function(err, foo){
            if(err) done(err);        
            expect(foo).to.equal(&#39;bar&#39;);
            done();
        });
    });
});
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005716-18148" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>如果未调用<code>done</code>函数，Mocha会一直等待直到超时。</li><li>如果未添加<code>done</code>参数，Mocha会直接返回成功，不会捕获到异步的断言失败。例如：</li></ul><div class="language-js line-numbers-mode"><pre><code><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;#get&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005716-48194">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="it(&#39;#get&#39;, function(){
    setTimeout(function(){
        expect(1).to.equal(2);
    }, 100);
});
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005716-48194" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>运行上述测试<a href="https://mochajs.org/" target="_blank" rel="noopener noreferrer">Mocha</a>总会提示Passing。</p><blockquote><p>Mocha怎么知道是否要等待异步断言呢？因为JavaScript中的<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noopener noreferrer">Function</a>有一个<code>length</code>属性， 通过它可以获得该函数的形参个数。Mocha通过传入回调的<code>length</code>来判断是否需要等待。</p></blockquote><p>或者，<code>done()</code>您可以返回<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noopener noreferrer">Promise</a>，而不是使用回调。如果您正在测试的API返回promises而不是回调，可以这样进行使用：</p><div class="language-js line-numbers-mode"><pre><code><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">[</span>tobi<span class="token punctuation">,</span> loki<span class="token punctuation">,</span> jane<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;#find()&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;respond with matching records&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">&#39;User&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>should<span class="token punctuation">.</span>eventually<span class="token punctuation">.</span>have<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005716-42218">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="beforeEach(function() {
  return db.clear().then(function() {
    return db.save([tobi, loki, jane]);
  });
});

describe(&#39;#find()&#39;, function() {
  it(&#39;respond with matching records&#39;, function() {
    return db.find({type: &#39;User&#39;}).should.eventually.have.length(3);
  });
});
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005716-42218" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>同样，可以使用<a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Statements/async_function" target="_blank" rel="noopener noreferrer">async / await</a>，您还可以编写如下的异步测试：</p><div class="language-js line-numbers-mode"><pre><code><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">[</span>tobi<span class="token punctuation">,</span> loki<span class="token punctuation">,</span> jane<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;#find()&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;responds with matching records&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">&#39;User&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    users<span class="token punctuation">.</span>should<span class="token punctuation">.</span>have<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005716-41404">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="beforeEach(async function() {
  await db.clear();
  await db.save([tobi, loki, jane]);
});

describe(&#39;#find()&#39;, function() {
  it(&#39;responds with matching records&#39;, async function() {
    const users = await db.find({type: &#39;User&#39;});
    users.should.have.length(3);
  });
});
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005716-41404" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><blockquote><p>需要Babel支持~~~</p></blockquote><h3 id="示例项目"><a class="header-anchor" href="#示例项目" aria-hidden="true">#</a> 示例项目</h3><h4 id="创建项目安装依赖"><a class="header-anchor" href="#创建项目安装依赖" aria-hidden="true">#</a> 创建项目&amp;安装依赖</h4><div class="language-bash line-numbers-mode"><pre><code><span class="token comment"># 初始化一个nodejs项目</span>
<span class="token function">npm</span> init -y

<span class="token comment"># 安装依赖</span>
<span class="token function">npm</span> <span class="token function">install</span> --save-dev @babel/cli @babel/core @babel/node @babel/register @babel/preset-env chai mocha nodemon
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005716-32770">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="# 初始化一个nodejs项目
npm init -y

# 安装依赖
npm install --save-dev @babel/cli @babel/core @babel/node @babel/register @babel/preset-env chai mocha nodemon
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005716-32770" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>形成package.json</p><div class="language-json line-numbers-mode"><pre><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;projects&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@babel/cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.5.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@babel/core&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.5.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@babel/node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.5.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@babel/preset-env&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.5.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@babel/register&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.4.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;chai&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;mocha&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^6.1.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;nodemon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.19.1&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005716-36916">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="{
  &quot;name&quot;: &quot;projects&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;&quot;,
  &quot;main&quot;: &quot;index.js&quot;,
  &quot;scripts&quot;: {
  },
  &quot;keywords&quot;: [],
  &quot;author&quot;: &quot;&quot;,
  &quot;license&quot;: &quot;ISC&quot;,
  &quot;devDependencies&quot;: {
    &quot;@babel/cli&quot;: &quot;^7.5.0&quot;,
    &quot;@babel/core&quot;: &quot;^7.5.0&quot;,
    &quot;@babel/node&quot;: &quot;^7.5.0&quot;,
    &quot;@babel/preset-env&quot;: &quot;^7.5.0&quot;,
    &quot;@babel/register&quot;: &quot;^7.4.4&quot;,
    &quot;chai&quot;: &quot;^4.2.0&quot;,
    &quot;mocha&quot;: &quot;^6.1.4&quot;,
    &quot;nodemon&quot;: &quot;^1.19.1&quot;
  }
}
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005716-36916" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h4 id="测试过程"><a class="header-anchor" href="#测试过程" aria-hidden="true">#</a> 测试过程</h4><p>新建一个待测试的方法<code>./src/index.js</code></p><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">const</span> <span class="token function-variable function">sayHello</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">&quot;Hello world!!!&quot;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// ES6语法</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> sayHello
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005716-90789">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="const sayHello = () =&gt; &quot;Hello world!!!&quot;

console.log(sayHello())

// ES6语法
export default sayHello
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005716-90789" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>测试脚本<code>./test/index.spec.js</code></p><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> expect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;chai&quot;</span>
<span class="token keyword">import</span> sayHello <span class="token keyword">from</span> <span class="token string">&quot;../src/index&quot;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;index test&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;sayHello function&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;should say Hello guys!&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

      <span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">&quot;Hello guys!&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005717-29379">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="import { expect } from &quot;chai&quot;
import sayHello from &quot;../src/index&quot;

describe(&quot;index test&quot;, () =&gt; {
  describe(&quot;sayHello function&quot;, () =&gt; {
    it(&quot;should say Hello guys!&quot;, () =&gt; {

      const str = sayHello();
      expect(str).to.equal(&quot;Hello guys!&quot;)
    })
  })
})
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005717-29379" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><code>package.json</code>中的脚本：</p><div class="language-json line-numbers-mode"><pre><code>  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// &quot;start&quot;: &quot;nodemon ./src/index.js&quot;,  // 针对ES5语法</span>
    <span class="token property">&quot;start:babel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon --exec babel-node ./src/index.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;test:watch&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mocha --require @babel/register --watch&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mocha --require @babel/register&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;babel src --out-dir ./dist --source-maps&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;serve&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node ./dist/index.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;debug&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node --inspect-brk ./dist/index.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005717-41108">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="  &quot;scripts&quot;: {
    // &quot;start&quot;: &quot;nodemon ./src/index.js&quot;,  // 针对ES5语法
    &quot;start:babel&quot;: &quot;nodemon --exec babel-node ./src/index.js&quot;,
    &quot;test:watch&quot;: &quot;mocha --require @babel/register --watch&quot;,
    &quot;test&quot;: &quot;mocha --require @babel/register&quot;,
    &quot;build&quot;: &quot;babel src --out-dir ./dist --source-maps&quot;,
    &quot;serve&quot;: &quot;node ./dist/index.js&quot;,
    &quot;debug&quot;: &quot;node --inspect-brk ./dist/index.js&quot;
  },
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005717-41108" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>开始测试：<code>npm run test</code></p><p>报错了，因为期望的值与实际值不一致。</p><div class="language-bash line-numbers-mode"><pre><code>Hello world<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span>


  index <span class="token builtin class-name">test</span>
    sayHello <span class="token keyword">function</span>
      <span class="token number">1</span><span class="token punctuation">)</span> should say Hello guys<span class="token operator">!</span>


  <span class="token number">0</span> passing <span class="token punctuation">(</span>9ms<span class="token punctuation">)</span>
  <span class="token number">1</span> failing

  <span class="token number">1</span><span class="token punctuation">)</span> index <span class="token builtin class-name">test</span>
       sayHello <span class="token keyword">function</span>
         should say Hello guys<span class="token operator">!</span>:

      AssertionError: expected <span class="token string">&#39;Hello world!!!&#39;</span> to equal <span class="token string">&#39;Hello guys!&#39;</span>
      + expected - actual

      -Hello world<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span>
      +Hello guys<span class="token operator">!</span>
      
      at Context.equal <span class="token punctuation">(</span>test/index.spec.js:9:22<span class="token punctuation">)</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005717-37685">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="Hello world!!!


  index test
    sayHello function
      1) should say Hello guys!


  0 passing (9ms)
  1 failing

  1) index test
       sayHello function
         should say Hello guys!:

      AssertionError: expected &#39;Hello world!!!&#39; to equal &#39;Hello guys!&#39;
      + expected - actual

      -Hello world!!!
      +Hello guys!
      
      at Context.equal (test/index.spec.js:9:22)
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005717-37685" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>修改测试脚本，或者修改index.js文件：</p><p>修改<code>./test/index.spec.js</code></p><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> expect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;chai&quot;</span>
<span class="token keyword">import</span> sayHello <span class="token keyword">from</span> <span class="token string">&quot;../src/index&quot;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;index test&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;sayHello function&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;should say Hello world!!!&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

      <span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">&quot;Hello world!!!&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005717-19920">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="import { expect } from &quot;chai&quot;
import sayHello from &quot;../src/index&quot;

describe(&quot;index test&quot;, () =&gt; {
  describe(&quot;sayHello function&quot;, () =&gt; {
    it(&quot;should say Hello world!!!&quot;, () =&gt; {

      const str = sayHello();
      expect(str).to.equal(&quot;Hello world!!!&quot;)
    })
  })
})
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005717-19920" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>再次测试：</p><div class="language-bash line-numbers-mode"><pre><code><span class="token operator">&gt;</span> mocha --require @babel/register

Hello world<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span>


  index <span class="token builtin class-name">test</span>
    sayHello <span class="token keyword">function</span>
      ✓ should say Hello world<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span>


  <span class="token number">1</span> passing <span class="token punctuation">(</span>6ms<span class="token punctuation">)</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005717-80783">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="&gt; mocha --require @babel/register

Hello world!!!


  index test
    sayHello function
      ✓ should say Hello world!!!


  1 passing (6ms)
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005717-80783" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>使用<code>mochawesome</code>展示你的测试结果：</p><div class="language-bash line-numbers-mode"><pre><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev mochawesome
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005717-20288">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="npm install --save-dev mochawesome
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005717-20288" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后在<code>package.json</code>的<code>scripts</code>中添加如下内容，</p><div class="language-json line-numbers-mode"><pre><code><span class="token punctuation">{</span>
	<span class="token property">&quot;report&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mocha --require @babel/register --reporter mochawesome&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005717-22796">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="{
	&quot;report&quot;: &quot;mocha --require @babel/register --reporter mochawesome&quot;,
}
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005717-22796" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>使用方式：</p><div class="language-bash line-numbers-mode"><pre><code><span class="token function">npm</span> run report
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005717-94242">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="npm run report
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005717-94242" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>形成出来的报告在浏览器中打开：</p><p><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200310105721.png" alt="image-20190707212821248"></p><p>在Vscode中可以安装Live Server这个插件快速打开：</p><p><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200310105722.png" alt="image-20190707212923919"></p><h2 id="开箱即用jest"><a class="header-anchor" href="#开箱即用jest" aria-hidden="true">#</a> 开箱即用Jest</h2><p>Jest是由Facebook发布的开源的、基于<a href="http://jasmine.github.io/" target="_blank" rel="noopener noreferrer">Jasmine</a>的JavaScript单元测试框架。Jest源于Facebook的构想，用于快速、可靠地测试Web聊天应用。它吸引了公司内部的兴趣，Facebook的一名软件工程师Jeff Morrison半年前又重拾这个项目，改善它的性能，并将其开源。Jest的目标是减少开始测试一个项目所要花费的时间和认知负荷，因此它提供了大部分你需要的现成工具：快速的命令行接口、Mock工具集以及它的自动模块Mock系统。此外，如果你在寻找隔离工具例如Mock库，大部分其它工具将让你在测试中（甚至经常在你的主代码中）写一些不尽如人意的样板代码，以使其生效。Jest与Jasmine框架的区别是在后者之上增加了一些层。最值得注意的是，运行测试时，Jest会自动模拟依赖。Jest自动为每个依赖的模块生成Mock，并默认提供这些Mock，这样就可以很容易地隔离模块的依赖。</p><p>Jest支持Babel，我们将很轻松的使用ES6的高级语法</p><p>Jest支持webpack，非常方便的使用它来管理我们的项目</p><p>Jest支持TypeScript，书写测试用例更加严谨</p><ol><li><p>简化API</p><p>Jest既简单又强大，内置支持以下功能：</p><ul><li>灵活的配置：比如，可以用文件名通配符来检测测试文件。</li><li>测试的事前步骤(Setup)和事后步骤(Teardown)，同时也包括测试范围。</li><li>匹配表达式(Matchers)：能使用期望<code>expect</code>句法来验证不同的内容。</li><li>测试异步代码：支持承诺(promise)数据类型和异步等待<code>async</code> / <code>await</code>功能。</li><li>模拟函数：可以修改或监查某个函数的行为。</li><li>手动模拟：测试代码时可以忽略模块的依存关系。</li><li>虚拟计时：帮助控制时间推移。</li></ul></li><li><p>性能与隔离</p><p>Jest文档里写道：</p><p>Jest能运用所有的工作部分，并列运行测试，使性能最大化。终端上的信息经过缓冲，最后与测试结果一起打印出来。沙盒中生成的测试文件，以及自动全局状态在每个测试里都会得到重置，这样就不会出现两个测试冲突的情况。</p><p>Mocha用一个进程运行所有的测试，和它比较起来，Jest则完全不同。要在测试之间模拟出隔离效果，我们必须要引入几个测试辅助函数来妥善管理清除工作。这种做法虽然不怎么理想，但99%的情况都可以用，因为测试是按顺序进行的。</p></li><li><p>沉浸式监控模式</p><p>快速互动式监控模式可以监控到哪些测试文件有过改动，只运行与改动过的文件相关的测试，并且由于优化作用，能迅速放出监控信号。设置起来非常简单，而且还有一些别的选项，可以用文件名或测试名来过滤测试。我们用Mocha时也有监控模式，不过没有那么强大，要运行某个特定的测试文件夹或文件，就不得不自己创造解决方法，而这些功能Jest本身就已经提供了，不用花力气。</p></li><li><p>代码覆盖率&amp;测试报告</p><p>Jest内置有代码覆盖率报告功能，设置起来易如反掌。可以在整个项目范围里收集代码覆盖率信息，包括未经受测试的文件。</p><p>要使完善Circle CI整合，只需要一个自定义报告功能。有了Jest，用<a href="https://github.com/michaelleeallen/jest-junit-reporter" target="_blank" rel="noopener noreferrer">jest-junit-reporter</a>就可以做到，其用法和Mocha几乎相同。</p></li><li><p>快照功能</p><p>快照测试的目的不是要替换现有的单元测试，而是要使之更有价值，让测试更轻松。在某些情况下，某些功能比如React组件功能，有了快照测试意味着无需再做单元测试，但同样这两者不是非此即彼。</p></li></ol><h3 id="安装-1"><a class="header-anchor" href="#安装-1" aria-hidden="true">#</a> 安装</h3><p>新建文件夹然后通过npm 命令安装：</p><div class="language-bash line-numbers-mode"><pre><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev jest
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005717-83360">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="npm install --save-dev jest
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005717-83360" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>或者通过yarn来安装：</p><div class="language-bash line-numbers-mode"><pre><code><span class="token function">yarn</span> <span class="token function">add</span> --dev jest
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005717-93232">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="yarn add --dev jest
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005717-93232" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后就可以开始测试了</p><p>也可用<code>npm install -g jest</code>进行全局安装；并在 package.json 中指定 test 脚本：</p><div class="language-json line-numbers-mode"><pre><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005717-44446">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="{
  &quot;scripts&quot;: {
    &quot;test&quot;: &quot;jest&quot;
  }
}
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005717-44446" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Jest 的测试脚本名形如<code>.test.js</code>，不论 Jest 是全局运行还是通过<code>npm test</code>运行，它都会执行当前目录下所有的<code>*.test.js</code> 或 <code>*.spec.js</code> 文件、完成测试。</p><p>ES6语法支持：</p><ol><li>安装依赖</li></ol><div class="language-bash line-numbers-mode"><pre><code><span class="token function">yarn</span> <span class="token function">add</span> --dev babel-jest @babel/core @babel/preset-env
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005717-50352">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="yarn add --dev babel-jest @babel/core @babel/preset-env
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005717-50352" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>配置<code>.babelrc</code></li></ol><div class="language-json line-numbers-mode"><pre><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;targets&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;current&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005717-29347">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="{
  &quot;presets&quot;: [
    [
      &quot;@babel/preset-env&quot;,
      {
        &quot;targets&quot;: {
          &quot;node&quot;: &quot;current&quot;
        }
      }
    ]
  ]
}
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005717-29347" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>接下来就可以使用ES6的语法了~~~</p><p>更多高阶的ES6/7/8…语法，可以参见：<a href="https://babeljs.io/" target="_blank" rel="noopener noreferrer">babel官网</a></p><p>关于Typescript的支持，可以参见 ：<a href="https://jestjs.io/docs/en/getting-started#using-typescript" target="_blank" rel="noopener noreferrer">Using Typescript</a></p><h3 id="举个例子"><a class="header-anchor" href="#举个例子" aria-hidden="true">#</a> 举个例子</h3><p>关于test suite与test case：</p><p><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200310105723.png" alt="img"></p><p>describe属于 test suite 的描述，而每个 test 或者 it 则描述了每个 test case。</p><p>例如：<code>math.js</code></p><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">multiple</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005717-40932">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="export const add = (a, b) =&gt; a + b;

export const multiple = (a, b) =&gt; a * b;
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005717-40932" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>测试脚本：<code>math.test.js</code></p><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">const</span> math <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./src/math&#39;</span><span class="token punctuation">)</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;math&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> a
  <span class="token keyword">let</span> b

  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    b <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;#should return result as a+b&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// test code</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;#should return result as a*b&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//test code</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">multiple</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005717-24736">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="const math = require(&#39;./src/math&#39;)

describe(&quot;math&quot;, () =&gt; {
  let a
  let b

  beforeEach(function () {
    a = 2;
    b = 3;
  });

  test(&quot;#should return result as a+b&quot;, () =&gt; {
    // test code
    const result = math.add(a, b)
    expect(result).toEqual(5)
  });

  it(&quot;#should return result as a*b&quot;, () =&gt; {
    //test code
    const result = math.multiple(a, b)
    expect(result).toEqual(6)
  });
});
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005717-24736" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>test suite 可以进行嵌套：</p><div class="language-js line-numbers-mode"><pre><code><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;foo bar&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">//test code</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005718-62182">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="describe(&quot;foo&quot;, () =&gt; {
  describe(&quot;bar&quot;, () =&gt; {
    it(&quot;foo bar&quot;, () =&gt; {
      //test code
    });
  });
});
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005718-62182" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>test case 也可以脱离 test suite 独立运行：</p><div class="language-js line-numbers-mode"><pre><code><span class="token comment">// hello.js</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">&#39;Hello world&#39;</span>

<span class="token comment">// hello.test.js</span>
<span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;hello.js&#39;</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;should get &quot;Hello world&quot;&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&#39;Hello world&#39;</span><span class="token punctuation">)</span> <span class="token comment">// 测试成功</span>
<span class="token comment">// expect(hello()).toBe(&#39;Hello&#39;) // 测试失败</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005718-71522">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="// hello.js
module.exports = () =&gt; &#39;Hello world&#39;

// hello.test.js
let hello = require(&#39;hello.js&#39;)

test(&#39;should get &quot;Hello world&quot;&#39;, () =&gt; {
    expect(hello()).toBe(&#39;Hello world&#39;) // 测试成功
// expect(hello()).toBe(&#39;Hello&#39;) // 测试失败
})
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005718-71522" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="mock与spy"><a class="header-anchor" href="#mock与spy" aria-hidden="true">#</a> Mock与Spy</h3><p><strong>mock</strong>测试就是在测试过程中，对于某些不容易构造或者不容易获取的对象，用一个虚拟的对象来创建以便测试的测试方法。</p><p>Mock 是单元测试中经常使用的一种技术。单元测试，顾名思义测试的重点是某个具体单元。但是在实际代码中，代码与代码之间，模块与模块之间总是会存在着相互引用。这个时候，剥离出这种单元的依赖，让测试更加独立，使用到的技术就是 Mock。</p><p><strong>为什么要使用Mock函数？</strong></p><p>在项目中，一个模块的方法内常常会去调用另外一个模块的方法。在单元测试中，我们可能并不需要关心内部调用的方法的执行过程和结果，只想知道它是否被正确调用即可，甚至会指定该函数的返回值。此时，使用Mock函数是十分有必要。</p><p>Mock函数提供的以下三种特性，在我们写测试代码时十分有用：</p><ul><li>捕获函数调用情况</li><li>设置函数返回值</li><li>改变函数的内部实现</li></ul><p><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200310105724.jpg" alt="img"></p><p>举个例子：</p><div class="language-js line-numbers-mode"><pre><code><span class="token comment">// math.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getFooResult</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// foo logic here</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getBarResult</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// bar logic here</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// caculate.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getFooResult<span class="token punctuation">,</span> getBarResult <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./math&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getFooBarResult</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">getFooResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">getBarResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005718-70206">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="// math.js
export const getFooResult = () =&gt; {
  // foo logic here
};
export const getBarResult = () =&gt; {
  // bar logic here
};

// caculate.js
import { getFooResult, getBarResult } from &quot;./math&quot;;

export const getFooBarResult = () =&gt; getFooResult() + getBarResult();
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005718-70206" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>此时，getFooResult() 和 getBarResult() 就是 getFooBarResult 这个函数的依赖。如果我们关注的点是 getFooBarResult 这个函数，我们就应该把 getFooResult 和 getBarResult Mock 掉，剥离这种依赖。下面是一个使用 Jest 进行 Mock 的例子。</p><p><code>jest.fn()</code>是创建Mock函数最简单的方式，如果没有定义函数内部的实现，<code>jest.fn()</code>会返回<code>undefined</code>作为返回值。</p><div class="language-javascript line-numbers-mode"><pre><code><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;测试jest.fn()调用&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> mockFn <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">mockFn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 断言mockFn的执行后返回undefined</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeUndefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 断言mockFn被调用</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>mockFn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 断言mockFn被调用了一次</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>mockFn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 断言mockFn传入的参数为1, 2, 3</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>mockFn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005718-27090">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="test(&#39;测试jest.fn()调用&#39;, () =&gt; {
  let mockFn = jest.fn();
  let result = mockFn(1, 2, 3);

  // 断言mockFn的执行后返回undefined
  expect(result).toBeUndefined();
  // 断言mockFn被调用
  expect(mockFn).toBeCalled();
  // 断言mockFn被调用了一次
  expect(mockFn).toBeCalledTimes(1);
  // 断言mockFn传入的参数为1, 2, 3
  expect(mockFn).toHaveBeenCalledWith(1, 2, 3);
})
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005718-27090" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>情景一：设置函数 的返回值</strong></p><div class="language-js line-numbers-mode"><pre><code><span class="token comment">// calculate.test.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getFooBarResult <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./calculate&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> fooBar <span class="token keyword">from</span> <span class="token string">&#39;./math&#39;</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;getResult should return result getFooResult() + getBarResult()&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// mock add方法和multiple方法</span>
  fooBar<span class="token punctuation">.</span>getFooBarResult <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  fooBar<span class="token punctuation">.</span>getBarResult <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">getFooBarResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005721-4240">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="// calculate.test.js
import { getFooBarResult } from &quot;./calculate&quot;;
import * as fooBar from &#39;./math&#39;;

test(&#39;getResult should return result getFooResult() + getBarResult()&#39;, () =&gt; {
  // mock add方法和multiple方法
  fooBar.getFooBarResult = jest.fn(() =&gt; 10);
  fooBar.getBarResult = jest.fn(() =&gt; 5);

  const result = getFooBarResult();

  expect(result).toEqual(15);
});
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005721-4240" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Mock其实就是一种Spies，在Jest中使用spies来“spy”(窥探)一个函数的行为。</p><p><a href="https://jestjs.io/docs/en/mock-function-api.html#content" target="_blank" rel="noopener noreferrer">Jest文档</a>对于spies的解释:</p><blockquote><p>Mock函数也称为“spies”，因为它们让你窥探一些由其他代码间接调用的函数的行为，而不仅仅是测试输出。你可以通过使用 <code>jest.fn()</code> 创建一个mock函数。</p></blockquote><p>简单来说，一个spy是另一个内置的能够记录对其调用细节的函数：调用它的次数，使用什么参数。</p><div class="language-js line-numbers-mode"><pre><code><span class="token comment">// calculate.test.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getFooBarResult <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./calculate&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> fooBar <span class="token keyword">from</span> <span class="token string">&#39;./math&#39;</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;getResult should return result getFooResult() + getBarResult()&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// mock add方法和multiple方法</span>
  fooBar<span class="token punctuation">.</span>getFooResult <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  fooBar<span class="token punctuation">.</span>getBarResult <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">getFooBarResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 监控getFooResult和getBarResult的调用情况.</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>fooBar<span class="token punctuation">.</span>getFooResult<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>fooBar<span class="token punctuation">.</span>getBarResult<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005721-53094">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="// calculate.test.js
import { getFooBarResult } from &quot;./calculate&quot;;
import * as fooBar from &#39;./math&#39;;

test(&#39;getResult should return result getFooResult() + getBarResult()&#39;, () =&gt; {
  // mock add方法和multiple方法
  fooBar.getFooResult = jest.fn(() =&gt; 10);
  fooBar.getBarResult = jest.fn(() =&gt; 5);

  const result = getFooBarResult();

  // 监控getFooResult和getBarResult的调用情况.
  expect(fooBar.getFooResult).toHaveBeenCalled();
  expect(fooBar.getBarResult).toHaveBeenCalled();
});
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005721-53094" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>情景二：捕获函数调用情况</strong></p><div class="language-js line-numbers-mode"><pre><code><span class="token comment">// bot method</span>
<span class="token keyword">const</span> bot <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">sayHello</span><span class="token operator">:</span> <span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// test.js</span>
<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;bot&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;should say hello&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> spy <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>bot<span class="token punctuation">,</span> <span class="token string">&quot;sayHello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    bot<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token string">&quot;Michael&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">&quot;Michael&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    spy<span class="token punctuation">.</span><span class="token function">mockRestore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005722-644">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="// bot method
const bot = {
  sayHello: name =&gt; {
    console.log(`Hello ${name}!`);
  }
};

// test.js
describe(&quot;bot&quot;, () =&gt; {
  it(&quot;should say hello&quot;, () =&gt; {
    const spy = jest.spyOn(bot, &quot;sayHello&quot;);

    bot.sayHello(&quot;Michael&quot;);

    expect(spy).toHaveBeenCalledWith(&quot;Michael&quot;);

    spy.mockRestore();
  });
});
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005722-644" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>我们通过 <code>jest.spyOn</code> 创建了一个监听 <code>bot</code> 对象的 <code>sayHello</code> 方法的 spy。它就像间谍一样监听了所有对 <code>bot#sayHello</code> 方法的调用。由于创建 spy 时，Jest 实际上修改了 <code>bot</code> 对象的 <code>sayHello</code> 属性，所以在断言完成后，我们还要通过 <code>mockRestore</code> 来恢复 <code>bot</code> 对象原本的 <code>sayHello</code>方法。</p><p>Jest的<a href="https://jestjs.io/docs/en/jest-object#jestspyonobject-methodname" target="_blank" rel="noopener noreferrer">spyOn介绍</a></p><p><strong>情景三：修改函数的内容实现</strong></p><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">const</span> bot <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">sayHello</span><span class="token operator">:</span> <span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;bot&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;should say hello&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> spy <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>bot<span class="token punctuation">,</span> <span class="token string">&quot;sayHello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello mix </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    bot<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token string">&quot;Michael&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">&quot;Michael&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    spy<span class="token punctuation">.</span><span class="token function">mockRestore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005722-47130">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="const bot = {
  sayHello: name =&gt; {
    console.log(`Hello ${name}!`);
  }
};

describe(&quot;bot&quot;, () =&gt; {
  it(&quot;should say hello&quot;, () =&gt; {
    const spy = jest.spyOn(bot, &quot;sayHello&quot;).mockImplementation(name =&gt; {
      console.log(`Hello mix ${name}`)
    });

    bot.sayHello(&quot;Michael&quot;);

    expect(spy).toHaveBeenCalledWith(&quot;Michael&quot;);

    spy.mockRestore();
  });
});
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005722-47130" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>使用spyOn方法，还可以去修改Math.random这样的函数</p><div class="language-js line-numbers-mode"><pre><code>jest<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>Math<span class="token punctuation">,</span> <span class="token string">&quot;random&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0.9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005722-72114">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="jest.spyOn(Math, &quot;random&quot;).mockImplementation(() =&gt; 0.9);
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005722-72114" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>举个例子：</p><div class="language-js line-numbers-mode"><pre><code><span class="token comment">// getNum.js</span>
<span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">getNum</span> <span class="token operator">=</span> <span class="token parameter">index</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> arr<span class="token punctuation">[</span>index <span class="token operator">%</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> arr<span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// num.test.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getNum <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../src/getNum&#39;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;getNum&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;should select numbber based on index if provided&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;should select a random number based on Math.random if skuId not available&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> spy <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>Math<span class="token punctuation">,</span> <span class="token string">&quot;random&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0.9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    spy<span class="token punctuation">.</span><span class="token function">mockRestore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005722-82980">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="// getNum.js
const arr = [1,2,3,4,5,6];

const getNum = index =&gt; {
  if (index) {
    return arr[index % 6];
  } else {
    return arr[Math.floor(Math.random() * 6)];
  }
};

// num.test.js
import { getNum } from &#39;../src/getNum&#39;

describe(&quot;getNum&quot;, () =&gt; {
  it(&quot;should select numbber based on index if provided&quot;, () =&gt; {
    expect(getNum(1)).toBe(2);
  });

  it(&quot;should select a random number based on Math.random if skuId not available&quot;, () =&gt; {
    const spy = jest.spyOn(Math, &quot;random&quot;).mockImplementation(() =&gt; 0.9);

    expect(getNum()).toBe(6);
    expect(spy).toHaveBeenCalled();

    spy.mockRestore();
  });
});
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005722-82980" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="cli命令"><a class="header-anchor" href="#cli命令" aria-hidden="true">#</a> CLI命令</h3><div class="language-sh line-numbers-mode"><pre><code>➜ npx jest --help
Usage: jest [--config=&lt;pathToConfigFile&gt;] [TestPathPattern]

选项：
  --help, -h                    显示帮助信息                              [布尔]
  --version, -v                 Print the version and exit                [布尔]
  --config, -c                  The path to a jest config file specifying how to
                                find and execute tests. If no rootDir is set in
                                the config, the directory containing the config
                                file is assumed to be the rootDir for the
                                project.This can also be a JSON encoded value
                                which Jest will use as configuration.   [字符串]
  --coverage                    Indicates that test coverage information should
                                be collected and reported in the output.  [布尔] 
  --timers                      Setting this value to fake allows the use of
                                fake timers for functions such as setTimeout.
                                                                        [字符串]
  --verbose                     Display individual test results with the test
                                suite hierarchy.                          [布尔]
  --watch                       Watch files for changes and rerun tests related
                                to changed files. If you want to re-run all
                                tests when a file has changed, use the
                                `--watchAll` option.                      [布尔]
  --watchAll                    Watch files for changes and rerun all tests. If
                                you want to re-run only the tests related to the
                                changed files, use the `--watch` option.  [布尔]
...
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005722-56485">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="➜ npx jest --help
Usage: jest [--config=&lt;pathToConfigFile&gt;] [TestPathPattern]

选项：
  --help, -h                    显示帮助信息                              [布尔]
  --version, -v                 Print the version and exit                [布尔]
  --config, -c                  The path to a jest config file specifying how to
                                find and execute tests. If no rootDir is set in
                                the config, the directory containing the config
                                file is assumed to be the rootDir for the
                                project.This can also be a JSON encoded value
                                which Jest will use as configuration.   [字符串]
  --coverage                    Indicates that test coverage information should
                                be collected and reported in the output.  [布尔] 
  --timers                      Setting this value to fake allows the use of
                                fake timers for functions such as setTimeout.
                                                                        [字符串]
  --verbose                     Display individual test results with the test
                                suite hierarchy.                          [布尔]
  --watch                       Watch files for changes and rerun tests related
                                to changed files. If you want to re-run all
                                tests when a file has changed, use the
                                `--watchAll` option.                      [布尔]
  --watchAll                    Watch files for changes and rerun all tests. If
                                you want to re-run only the tests related to the
                                changed files, use the `--watch` option.  [布尔]
...
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005722-56485" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>常见使用：</p><p><code>--verbose</code>显示详细的测试信息，包括测试suite和case：</p><div class="language-bash line-numbers-mode"><pre><code>➜ npx jest --verbose
 PASS  test/mock.test.js
  bot
    ✓ should say hello <span class="token punctuation">(</span>7ms<span class="token punctuation">)</span>

  console.log test/mock.test.js:10
    Hello mix Michael

 PASS  test/domain.test.js
  getImageDomain
    ✓ should <span class="token keyword">select</span> domain based on skuId <span class="token keyword">if</span> provided <span class="token punctuation">(</span>1ms<span class="token punctuation">)</span>
    ✓ should <span class="token keyword">select</span> a random domain based on Math.random <span class="token keyword">if</span> skuId not available <span class="token punctuation">(</span>1ms<span class="token punctuation">)</span>

  console.log test/sayhello.test.js:3
    Hello Michael<span class="token operator">!</span>

 PASS  test/sayhello.test.js
  bot
    ✓ should say hello <span class="token punctuation">(</span>6ms<span class="token punctuation">)</span>

 PASS  test/num.test.js
  getNum
    ✓ should <span class="token keyword">select</span> numbber based on index <span class="token keyword">if</span> provided <span class="token punctuation">(</span>1ms<span class="token punctuation">)</span>
    ✓ should <span class="token keyword">select</span> a random number based on Math.random <span class="token keyword">if</span> skuId not available

 PASS  test/math.test.js
  math
    ✓ <span class="token comment">#should return result as a+b (1ms)</span>
    ✓ <span class="token comment">#should return result as a*b (4ms)</span>

Test Suites: <span class="token number">5</span> passed, <span class="token number">5</span> total
Tests:       <span class="token number">8</span> passed, <span class="token number">8</span> total
Snapshots:   <span class="token number">0</span> total
Time:        <span class="token number">1</span>.075s
Ran all <span class="token builtin class-name">test</span> suites.
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005723-78582">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="➜ npx jest --verbose
 PASS  test/mock.test.js
  bot
    ✓ should say hello (7ms)

  console.log test/mock.test.js:10
    Hello mix Michael

 PASS  test/domain.test.js
  getImageDomain
    ✓ should select domain based on skuId if provided (1ms)
    ✓ should select a random domain based on Math.random if skuId not available (1ms)

  console.log test/sayhello.test.js:3
    Hello Michael!

 PASS  test/sayhello.test.js
  bot
    ✓ should say hello (6ms)

 PASS  test/num.test.js
  getNum
    ✓ should select numbber based on index if provided (1ms)
    ✓ should select a random number based on Math.random if skuId not available

 PASS  test/math.test.js
  math
    ✓ #should return result as a+b (1ms)
    ✓ #should return result as a*b (4ms)

Test Suites: 5 passed, 5 total
Tests:       8 passed, 8 total
Snapshots:   0 total
Time:        1.075s
Ran all test suites.
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005723-78582" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p><code>--watch</code>和<code>--watchAll</code>用来监听测试文件的变化</p><div class="language-bash line-numbers-mode"><pre><code>Ran all <span class="token builtin class-name">test</span> suites.

Watch Usage
 › Press f to run only failed tests.
 › Press o to only run tests related to changed files.
 › Press p to filter by a filename regex pattern.
 › Press t to filter by a <span class="token builtin class-name">test</span> name regex pattern.
 › Press q to quit <span class="token function">watch</span> mode.
 › Press Enter to trigger a <span class="token builtin class-name">test</span> run.
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005723-31666">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="Ran all test suites.

Watch Usage
 › Press f to run only failed tests.
 › Press o to only run tests related to changed files.
 › Press p to filter by a filename regex pattern.
 › Press t to filter by a test name regex pattern.
 › Press q to quit watch mode.
 › Press Enter to trigger a test run.
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005723-31666" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><code>--coverage</code>用来形成测试覆盖率报告</p><div class="language-bash line-numbers-mode"><pre><code>-----------<span class="token operator">|</span>----------<span class="token operator">|</span>----------<span class="token operator">|</span>----------<span class="token operator">|</span>----------<span class="token operator">|</span>-------------------<span class="token operator">|</span>
File       <span class="token operator">|</span>  % Stmts <span class="token operator">|</span> % Branch <span class="token operator">|</span>  % Funcs <span class="token operator">|</span>  % Lines <span class="token operator">|</span> Uncovered Line <span class="token comment">#s |</span>
-----------<span class="token operator">|</span>----------<span class="token operator">|</span>----------<span class="token operator">|</span>----------<span class="token operator">|</span>----------<span class="token operator">|</span>-------------------<span class="token operator">|</span>
All files  <span class="token operator">|</span>      <span class="token number">100</span> <span class="token operator">|</span>      <span class="token number">100</span> <span class="token operator">|</span>      <span class="token number">100</span> <span class="token operator">|</span>      <span class="token number">100</span> <span class="token operator">|</span>                   <span class="token operator">|</span>
 getNum.js <span class="token operator">|</span>      <span class="token number">100</span> <span class="token operator">|</span>      <span class="token number">100</span> <span class="token operator">|</span>      <span class="token number">100</span> <span class="token operator">|</span>      <span class="token number">100</span> <span class="token operator">|</span>                   <span class="token operator">|</span>
 math.js   <span class="token operator">|</span>      <span class="token number">100</span> <span class="token operator">|</span>      <span class="token number">100</span> <span class="token operator">|</span>      <span class="token number">100</span> <span class="token operator">|</span>      <span class="token number">100</span> <span class="token operator">|</span>                   <span class="token operator">|</span>
-----------<span class="token operator">|</span>----------<span class="token operator">|</span>----------<span class="token operator">|</span>----------<span class="token operator">|</span>----------<span class="token operator">|</span>-------------------<span class="token operator">|</span>

Test Suites: <span class="token number">5</span> passed, <span class="token number">5</span> total
Tests:       <span class="token number">8</span> passed, <span class="token number">8</span> total
Snapshots:   <span class="token number">0</span> total
Time:        <span class="token number">1</span>.497s
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005723-88028">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="-----------|----------|----------|----------|----------|-------------------|
File       |  % Stmts | % Branch |  % Funcs |  % Lines | Uncovered Line #s |
-----------|----------|----------|----------|----------|-------------------|
All files  |      100 |      100 |      100 |      100 |                   |
 getNum.js |      100 |      100 |      100 |      100 |                   |
 math.js   |      100 |      100 |      100 |      100 |                   |
-----------|----------|----------|----------|----------|-------------------|

Test Suites: 5 passed, 5 total
Tests:       8 passed, 8 total
Snapshots:   0 total
Time:        1.497s
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005723-88028" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="jest在react-vue项目中的应用"><a class="header-anchor" href="#jest在react-vue项目中的应用" aria-hidden="true">#</a> Jest在React、Vue项目中的应用</h3><p>在<code>create-react-app</code>中的应用：</p><p>安装对应的依赖：</p><div class="language-"><pre><code>npm install react-test-renderer enzyme enzyme-adapter-react-16 
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005724-61879">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="npm install react-test-renderer enzyme enzyme-adapter-react-16 
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005724-61879" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><a href="https://github.com/airbnb/enzyme" target="_blank" rel="noopener noreferrer">Enzyme</a>是一个非常棒的React组件测试测试库。</p><blockquote><p>Enzyme is a JavaScript Testing utility for React that makes it easier to test your React Components&#39; output. You can also manipulate, traverse, and in some ways simulate runtime given the output.</p><p>Enzyme&#39;s API is meant to be intuitive and flexible by mimicking jQuery&#39;s API for DOM manipulation and traversal</p></blockquote><p>需要注意的两点是：</p><ul><li>需要配置Adapter，不同的React的Adapter不同</li></ul><table><thead><tr><th>Enzyme Adapter Package</th><th>React semver compatibility</th></tr></thead><tbody><tr><td><code>enzyme-adapter-react-16</code></td><td><code>^16.4.0-0</code></td></tr><tr><td><code>enzyme-adapter-react-16.3</code></td><td><code>~16.3.0-0</code></td></tr><tr><td><code>enzyme-adapter-react-16.2</code></td><td><code>~16.2</code></td></tr><tr><td><code>enzyme-adapter-react-16.1</code></td><td>`~16.0.0-0</td></tr><tr><td><code>enzyme-adapter-react-15</code></td><td><code>^15.5.0</code></td></tr><tr><td><code>enzyme-adapter-react-15.4</code></td><td><code>15.0.0-0 - 15.4.x</code></td></tr><tr><td><code>enzyme-adapter-react-14</code></td><td><code>^0.14.0</code></td></tr><tr><td><code>enzyme-adapter-react-13</code></td><td><code>^0.13.0</code></td></tr></tbody></table><ul><li><p>需要初始化配置<code>setUpTests.js</code></p><p>官方文档在Package.json中设置jest配置，已经过时，Jest框架最新会默认加载文件<code>src/setUpTests.js</code></p></li><li><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> configure <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;enzyme&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Adapter <span class="token keyword">from</span> <span class="token string">&#39;enzyme-adapter-react-16&#39;</span>

<span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">{</span> adapter<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Adapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005724-89452">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="import { configure } from &#39;enzyme&#39;;
import Adapter from &#39;enzyme-adapter-react-16&#39;

configure({ adapter: new Adapter() })
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005724-89452" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul><p>在vue工程化项目中：</p><div class="language-json line-numbers-mode"><pre><code><span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;@vue/cli-plugin-unit-jest&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.9.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;@vue/test-utils&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0-beta.29&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;babel-core&quot;</span><span class="token operator">:</span> <span class="token string">&quot;7.0.0-bridge.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;babel-eslint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^10.0.1&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;babel-jest&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^23.6.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;babel-preset-env&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.7.0&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005724-71142">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="&quot;devDependencies&quot;: {
  &quot;@vue/cli-plugin-unit-jest&quot;: &quot;^3.9.0&quot;,
  &quot;@vue/test-utils&quot;: &quot;1.0.0-beta.29&quot;,
  &quot;babel-core&quot;: &quot;7.0.0-bridge.0&quot;,
  &quot;babel-eslint&quot;: &quot;^10.0.1&quot;,
  &quot;babel-jest&quot;: &quot;^23.6.0&quot;,
  &quot;babel-preset-env&quot;: &quot;^1.7.0&quot;,
},
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005724-71142" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>添加如上依赖，</p><p>配置scripts:</p><div class="language-js line-numbers-mode"><pre><code><span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service test:unit&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005724-83751">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="&quot;scripts&quot;: {
  &quot;test&quot;: &quot;vue-cli-service test:unit&quot;
},
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005724-83751" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>配置<code>jest.config.js</code></p><div class="language-js line-numbers-mode"><pre><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 处理vue结尾的文件</span>
  moduleFileExtensions<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;js&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;jsx&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;json&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;vue&#39;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// es6转义</span>
  transform<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&#39;^.+\\.vue$&#39;</span><span class="token operator">:</span> <span class="token string">&#39;vue-jest&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;.+\\.(css|styl|less|sass|scss|svg|png|jpg|ttf|woff|woff2)$&#39;</span><span class="token operator">:</span> <span class="token string">&#39;jest-transform-stub&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;^.+\\.jsx?$&#39;</span><span class="token operator">:</span> <span class="token string">&#39;babel-jest&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  transformIgnorePatterns<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;/node_modules/&#39;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// cli配置了webpack别名</span>
  moduleNameMapper<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&#39;^@/(.*)$&#39;</span><span class="token operator">:</span> <span class="token string">&#39;&lt;rootDir&gt;/src/$1&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  snapshotSerializers<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;jest-serializer-vue&#39;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  testMatch<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;**/tests/unit/**/*.spec.(js|jsx|ts|tsx)|**/__tests__/*.(js|jsx|ts|tsx)&#39;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  testURL<span class="token operator">:</span> <span class="token string">&#39;http://localhost/&#39;</span><span class="token punctuation">,</span>
  watchPlugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;jest-watch-typeahead/filename&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;jest-watch-typeahead/testname&#39;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005724-63744">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="module.exports = {
  // 处理vue结尾的文件
  moduleFileExtensions: [
    &#39;js&#39;,
    &#39;jsx&#39;,
    &#39;json&#39;,
    &#39;vue&#39;
  ],
  // es6转义
  transform: {
    &#39;^.+\\.vue
&lt;/div&gt;: &#39;vue-jest&#39;,
    &#39;.+\\.(css|styl|less|sass|scss|svg|png|jpg|ttf|woff|woff2)
&lt;/div&gt;: &#39;jest-transform-stub&#39;,
    &#39;^.+\\.jsx?
&lt;/div&gt;: &#39;babel-jest&#39;
  },
  transformIgnorePatterns: [
    &#39;/node_modules/&#39;
  ],
  // cli配置了webpack别名
  moduleNameMapper: {
    &#39;^@/(.*)
&lt;/div&gt;: &#39;&lt;rootDir&gt;/src/$1&#39;
  },
  snapshotSerializers: [
    &#39;jest-serializer-vue&#39;
  ],
  testMatch: [
    &#39;**/tests/unit/**/*.spec.(js|jsx|ts|tsx)|**/__tests__/*.(js|jsx|ts|tsx)&#39;
  ],
  testURL: &#39;http://localhost/&#39;,
  watchPlugins: [
    &#39;jest-watch-typeahead/filename&#39;,
    &#39;jest-watch-typeahead/testname&#39;
  ]
}

" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005724-63744" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>写一个测试用例：</p><div class="language-"><pre><code>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005724-21009">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005724-21009" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="简约之美ava"><a class="header-anchor" href="#简约之美ava" aria-hidden="true">#</a> 简约之美AVA</h2><p>简单的说ava是mocha的替代品：</p><ul><li>es6语法支持更好，对aysnc/await有支持</li><li>执行效率更高，使用io并发，就必须保证测试的原子性</li><li>语义上更简单，集众家之长</li></ul><p>虽然 JavaScript 是单线程，但在 Node.js 里由于其异步的特性使得 IO 可以并行。AVA 利用这个优点让你的测试可以并发执行，这对于 IO 繁重的测试特别有用。另外，测试文件可以在不同的进程里并行运行，让每一个测试文件可以获得更好的性能和独立的环境。</p><h3 id="ava特点"><a class="header-anchor" href="#ava特点" aria-hidden="true">#</a> AVA特点</h3><ul><li><p>轻量和高效</p></li><li><p>简单的测试语法</p></li><li><p>并发运行测试</p></li><li><p>强制编写<strong>原子测试</strong></p><p>一旦开始，就一直运行到结束，中间不会切换到另一个测试</p></li><li><p>没有隐藏的全局变量</p></li><li><p>为每个测试文件隔离环境</p></li><li><p><strong>用 ES2015 编写测试</strong></p></li><li><p>支持 Promise</p></li><li><p>支持 Generator</p></li><li><p>支持 Async</p></li><li><p>支持 Observable</p></li><li><p>强化断言信息</p></li><li><p>可选的 TAP 输出显示</p><p><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200310105725.png" alt="img"></p></li><li><p>简明的堆栈跟踪</p></li></ul><h3 id="安装开始"><a class="header-anchor" href="#安装开始" aria-hidden="true">#</a> 安装&amp;开始</h3><p>情景一：</p><div class="language-bash line-numbers-mode"><pre><code>// 创建一个ava项目
<span class="token function">npm</span> init ava
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005724-54214">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="// 创建一个ava项目
npm init ava
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005724-54214" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>形成package.json</p><div class="language-json line-numbers-mode"><pre><code><span class="token punctuation">{</span>
	<span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;awesome-package&quot;</span><span class="token punctuation">,</span> 
	<span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ava&quot;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;ava&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.0.0&quot;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005724-50314">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="{
	&quot;name&quot;: &quot;awesome-package&quot;, 
	&quot;scripts&quot;: {
		&quot;test&quot;: &quot;ava&quot;
	},
	&quot;devDependencies&quot;: {
		&quot;ava&quot;: &quot;^1.0.0&quot;
	}
}
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005724-50314" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>情景二：（推荐）</p><div class="language-bash line-numbers-mode"><pre><code><span class="token function">npm</span> init -y

<span class="token comment"># npm &amp; cnpm</span>
<span class="token function">npm</span> <span class="token function">install</span> -D ava

<span class="token comment"># yarn </span>
<span class="token function">yarn</span> <span class="token function">add</span> ava -D
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005725-71007">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="npm init -y

# npm &amp; cnpm
npm install -D ava

# yarn 
yarn add ava -D
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005725-71007" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>测试ava正常安装：</p><div class="language-bash line-numbers-mode"><pre><code>➜ npx ava --version
<span class="token number">2.2</span>.0
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005725-99373">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="➜ npx ava --version
2.2.0
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005725-99373" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="第一个ava测试例子"><a class="header-anchor" href="#第一个ava测试例子" aria-hidden="true">#</a> 第一个ava测试例子</h3><p>流程：</p><ol><li>引用ava的测试API</li><li>执行测试</li><li>使用断言</li></ol><p>创建<code>test.js</code>文件</p><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">import</span> test <span class="token keyword">from</span> <span class="token string">&#39;ava&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">testfn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;hello ava&#39;</span><span class="token punctuation">,</span> <span class="token parameter">t</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  t<span class="token punctuation">.</span><span class="token function">pass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;my first test&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">t</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token string">&#39;hello ava!!!!&#39;</span>
  t<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token string">&#39;hello ava!!!!&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;add method&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">t</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">testfn</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
  t<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005725-32758">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="import test from &#39;ava&#39;;

const testfn = (a, b) =&gt; a + b

test(&#39;hello ava&#39;, t =&gt; {
  t.pass();
});

test(&#39;my first test&#39;, async t =&gt; {
  const str = &#39;hello ava!!!!&#39;
  t.is(str, &#39;hello ava!!!!&#39;)
});

test(&#39;add method&#39;, async t =&gt; {
  const result = testfn(3, 4)
  t.is(result, 7)
});
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005725-32758" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>ava自动搜索如下文件结尾的文件：</p><ul><li><code>**/test.js</code></li><li><code>**/test-*.js</code></li><li><code>**/*.spec.js</code></li><li><code>**/*.test.js</code></li><li><code>**/test/**/*.js</code></li><li><code>**/tests/**/*.js</code></li><li><code>**/__tests__/**/*.js</code></li></ul><p>ava中的断言：</p><div class="language-js line-numbers-mode"><pre><code><span class="token punctuation">.</span><span class="token function">pass</span><span class="token punctuation">(</span><span class="token punctuation">[</span>message<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">[</span>message<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">assert</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token punctuation">[</span>message<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">truthy</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token punctuation">[</span>message<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">falsy</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token punctuation">[</span>message<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token boolean">true</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token punctuation">[</span>message<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token boolean">false</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token punctuation">[</span>message<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> expected<span class="token punctuation">,</span> <span class="token punctuation">[</span>message<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">not</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> expected<span class="token punctuation">,</span> <span class="token punctuation">[</span>message<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">deepEqual</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> expected<span class="token punctuation">,</span> <span class="token punctuation">[</span>message<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">notDeepEqual</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> expected<span class="token punctuation">,</span> <span class="token punctuation">[</span>message<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">deepEqual</span><span class="token punctuation">(</span><span class="token punctuation">)</span>。
<span class="token punctuation">.</span><span class="token function">throws</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token punctuation">[</span>expected<span class="token punctuation">,</span> <span class="token punctuation">[</span>message<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">throwsAsync</span><span class="token punctuation">(</span>thrower<span class="token punctuation">,</span> <span class="token punctuation">[</span>expected<span class="token punctuation">,</span> <span class="token punctuation">[</span>message<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">notThrows</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token punctuation">[</span>message<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">notThrowsAsync</span><span class="token punctuation">(</span>nonThrower<span class="token punctuation">,</span> <span class="token punctuation">[</span>message<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">regex</span><span class="token punctuation">(</span>contents<span class="token punctuation">,</span> regex<span class="token punctuation">,</span> <span class="token punctuation">[</span>message<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">notRegex</span><span class="token punctuation">(</span>contents<span class="token punctuation">,</span> regex<span class="token punctuation">,</span> <span class="token punctuation">[</span>message<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">snapshot</span><span class="token punctuation">(</span>expected<span class="token punctuation">,</span> <span class="token punctuation">[</span>message<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">snapshot</span><span class="token punctuation">(</span>expected<span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>message<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005725-58289">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content=".pass([message])
.fail([message])
.assert(value, [message])
.truthy(value, [message])
.falsy(value, [message])
.true(value, [message])
.false(value, [message])
.is(value, expected, [message])
.not(value, expected, [message])
.deepEqual(value, expected, [message])
.notDeepEqual(value, expected, [message])
.deepEqual()。
.throws(fn, [expected, [message]])
.throwsAsync(thrower, [expected, [message]])
.notThrows(fn, [message])
.notThrowsAsync(nonThrower, [message])
.regex(contents, regex, [message])
.notRegex(contents, regex, [message])
.snapshot(expected, [message])
.snapshot(expected, [options], [message])
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005725-58289" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="cli命令-1"><a class="header-anchor" href="#cli命令-1" aria-hidden="true">#</a> CLI命令</h3><p>使用<code>--help</code>命令去查看ava支持的cli参数</p><div class="language-bash line-numbers-mode"><pre><code>➜ npx ava --help

  Testing can be a drag. AVA helps you get it done.

  Usage
    ava <span class="token punctuation">[</span><span class="token operator">&lt;</span>file<span class="token operator">&gt;</span> <span class="token punctuation">..</span>.<span class="token punctuation">]</span>

  Options
    --watch, -w             Re-run tests when tests and <span class="token builtin class-name">source</span> files change
    --match, -m             Only run tests with matching title <span class="token punctuation">(</span>Can be repeated<span class="token punctuation">)</span>
    --update-snapshots, -u  Update snapshots
    --fail-fast             Stop after first <span class="token builtin class-name">test</span> failure
    --timeout, -T           Set global <span class="token function">timeout</span> <span class="token punctuation">(</span>milliseconds or human-readable, e.g. 10s, 2m<span class="token punctuation">)</span>
    --serial, -s            Run tests serially
    --concurrency, -c       Max number of <span class="token builtin class-name">test</span> files running at the same <span class="token function">time</span> <span class="token punctuation">(</span>Default: CPU cores<span class="token punctuation">)</span>
    --verbose, -v           Enable verbose output
    --tap, -t               Generate TAP output
    --color                 Force color output
    --no-color              Disable color output
    --reset-cache           Reset AVA&#39;s compilation cache and <span class="token builtin class-name">exit</span>
    --config                JavaScript <span class="token function">file</span> <span class="token keyword">for</span> AVA to <span class="token builtin class-name">read</span> its config from, instead of using package.json
                            or ava.config.js files

  Examples
    ava
    ava test.js test2.js
    ava test-*.js
    ava <span class="token builtin class-name">test</span>

  The above relies on your shell expanding the glob patterns.
  Without arguments, AVA uses the following patterns:
    **/test.js **/test-*.js **/*.spec.js **/*.test.js **/test/**/*.js **/tests/**/*.js **/__tests__/**/*.js
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005725-42412">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="➜ npx ava --help

  Testing can be a drag. AVA helps you get it done.

  Usage
    ava [&lt;file&gt; ...]

  Options
    --watch, -w             Re-run tests when tests and source files change
    --match, -m             Only run tests with matching title (Can be repeated)
    --update-snapshots, -u  Update snapshots
    --fail-fast             Stop after first test failure
    --timeout, -T           Set global timeout (milliseconds or human-readable, e.g. 10s, 2m)
    --serial, -s            Run tests serially
    --concurrency, -c       Max number of test files running at the same time (Default: CPU cores)
    --verbose, -v           Enable verbose output
    --tap, -t               Generate TAP output
    --color                 Force color output
    --no-color              Disable color output
    --reset-cache           Reset AVA&#39;s compilation cache and exit
    --config                JavaScript file for AVA to read its config from, instead of using package.json
                            or ava.config.js files

  Examples
    ava
    ava test.js test2.js
    ava test-*.js
    ava test

  The above relies on your shell expanding the glob patterns.
  Without arguments, AVA uses the following patterns:
    **/test.js **/test-*.js **/*.spec.js **/*.test.js **/test/**/*.js **/tests/**/*.js **/__tests__/**/*.js
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005725-42412" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h4 id="文件匹配"><a class="header-anchor" href="#文件匹配" aria-hidden="true">#</a> 文件匹配</h4><p>使用<code>match</code>指令，匹配对应需要测试的文件：</p><p>匹配标题以<code>foo</code>：结尾</p><div class="language-sh line-numbers-mode"><pre><code>npx ava --match =&#39;* foo&#39;
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005725-9075">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="npx ava --match =&#39;* foo&#39;
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005725-9075" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>匹配标题以<code>foo</code>：</p><div class="language-sh line-numbers-mode"><pre><code>npx ava --match =&#39;foo *&#39;
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005725-32334">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="npx ava --match =&#39;foo *&#39;
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005725-32334" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>匹配标题包含<code>foo</code>：</p><div class="language-sh line-numbers-mode"><pre><code>npx ava --match =&#39;* foo *&#39;
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005726-68034">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="npx ava --match =&#39;* foo *&#39;
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005726-68034" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>匹配是完全相同 <code>foo</code>：</p><div class="language-sh line-numbers-mode"><pre><code>npx ava --match =&#39;foo&#39;
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005726-17114">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="npx ava --match =&#39;foo&#39;
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005726-17114" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>匹配标题不包含<code>foo</code>：</p><div class="language-sh line-numbers-mode"><pre><code>npx ava --match =&#39;！* foo *&#39;
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005726-9186">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="npx ava --match =&#39;！* foo *&#39;
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005726-9186" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>匹配以下<code>foo</code>结尾的标题<code>bar</code>：</p><div class="language-sh line-numbers-mode"><pre><code>npx ava --match =&#39;foo * bar&#39;
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005726-52749">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="npx ava --match =&#39;foo * bar&#39;
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005726-52749" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>匹配<code>foo</code>以<code>bar</code>：开头或结尾的标题：</p><div class="language-sh line-numbers-mode"><pre><code>npx ava --match =&#39;foo *&#39; -  match =&#39;* bar&#39;
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005726-53574">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="npx ava --match =&#39;foo *&#39; -  match =&#39;* bar&#39;
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005726-53574" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="关于reporter"><a class="header-anchor" href="#关于reporter" aria-hidden="true">#</a> 关于reporter</h4><p>默认情况下，AVA使用最小的报告：</p><p><a href="https://github.com/avajs/ava/blob/master/media/mini-reporter.gif" target="_blank" rel="noopener noreferrer"><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200310105726.png" alt="img"></a></p><p>使用该<code>--verbose</code>标志启用详细的报告者。除非启用TAP报告，否则始终在CI环境中使用此选项。</p><p><a href="https://github.com/avajs/ava/blob/master/media/verbose-reporter.png" target="_blank" rel="noopener noreferrer"><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200310105727.png" alt="img"></a></p><p><strong>TAP报告（推荐）</strong></p><p>AVA支持TAP格式，因此与任何TAP报告器兼容。使用该<code>--tap</code>标志启用TAP输出。</p><div class="language-bash line-numbers-mode"><pre><code>$ npx ava --tap <span class="token operator">|</span> npx tap-nyan
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005727-59318">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="$ npx ava --tap | npx tap-nyan
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005727-59318" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><a href="https://github.com/avajs/ava/blob/master/media/tap-reporter.png" target="_blank" rel="noopener noreferrer"><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200310105728.gif" alt="img"></a></p><p>这里有一些格式：</p><ul><li><a href="https://github.com/scottcorgan/tap-dot" target="_blank" rel="noopener noreferrer">tap-dot</a> - Dotted output.</li><li><a href="https://github.com/scottcorgan/tap-spec" target="_blank" rel="noopener noreferrer">tap-spec</a> - Mocha-like spec reporter.</li><li><a href="https://github.com/calvinmetcalf/tap-nyan" target="_blank" rel="noopener noreferrer">tap-nyan</a> - Nyan cat.</li><li><a href="https://github.com/gummesson/tap-min" target="_blank" rel="noopener noreferrer">tap-min</a> - Minimal output.</li><li><a href="https://github.com/namuol/tap-difflet" target="_blank" rel="noopener noreferrer">tap-difflet</a> - Minimal output with diffing.</li><li><a href="https://github.com/axross/tap-diff" target="_blank" rel="noopener noreferrer">tap-diff</a> - Human-friendly output with diffing.</li><li><a href="https://github.com/joeybaker/tap-simple" target="_blank" rel="noopener noreferrer">tap-simple</a> - Simple output.</li><li><a href="https://github.com/substack/faucet" target="_blank" rel="noopener noreferrer">faucet</a> - Human-readable summarizer.</li><li><a href="https://github.com/isaacs/tap-mocha-reporter" target="_blank" rel="noopener noreferrer">tap-mocha-reporter</a> - Use any of the <a href="https://github.com/isaacs/tap-mocha-reporter/tree/master/lib/reporters" target="_blank" rel="noopener noreferrer">Mocha reporters</a>.</li><li><a href="https://github.com/zoubin/tap-summary" target="_blank" rel="noopener noreferrer">tap-summary</a> - Summarized output.</li><li><a href="https://github.com/clux/tap-pessimist" target="_blank" rel="noopener noreferrer">tap-pessimist</a> - Only shows failed tests.</li><li><a href="https://github.com/toolness/tap-prettify" target="_blank" rel="noopener noreferrer">tap-prettify</a> - Nice readable output with diffing.</li><li><a href="https://github.com/substack/tap-colorize" target="_blank" rel="noopener noreferrer">tap-colorize</a> - Colorize the output while preserving machine-readability.</li><li><a href="https://github.com/juliangruber/tap-bail" target="_blank" rel="noopener noreferrer">tap-bail</a> - Bail out when the first test fails.</li><li><a href="https://github.com/axross/tap-notify" target="_blank" rel="noopener noreferrer">tap-notify</a> - Notifier for macOS, Linux and Windows.</li><li><a href="https://github.com/gummesson/tap-json" target="_blank" rel="noopener noreferrer">tap-json</a> - JSON output.</li><li><a href="https://github.com/yovasx2/ava-tap-json" target="_blank" rel="noopener noreferrer">ava-tap-json</a> - JSON output with AVA compatibility.</li><li><a href="https://github.com/aghassemi/tap-xunit" target="_blank" rel="noopener noreferrer">tap-xunit</a> - xUnit output.</li><li><a href="https://github.com/smockle/tap-teamcity" target="_blank" rel="noopener noreferrer">tap-teamcity</a> - Output for TeamCity.</li></ul><h4 id="快照功能"><a class="header-anchor" href="#快照功能" aria-hidden="true">#</a> 快照功能</h4><p>ava自动进行项目测试快照，如果文件放置在<code>test</code>或者<code>tests</code>目录，则快照会放置在<code>snapshots</code>目录。如果测试放置在<code>__test__</code>目录，则快照放置在<code>__snapshots__</code>目录</p><div class="language-bash line-numbers-mode"><pre><code>ava --update-snapshots
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005727-86096">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="ava --update-snapshots
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005727-86096" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>可以指定一个固定位置，以便在AVA的<code>package.json</code>配置中存储快照文件：</p><p><strong>package.json：</strong></p><div class="language-json line-numbers-mode"><pre><code><span class="token punctuation">{</span>
	 <span class="token string">&quot;ava&quot;</span>：<span class="token punctuation">{</span>
		 <span class="token string">&quot;snapshotDir&quot;</span>：<span class="token string">&quot;自定义目录&quot;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005727-85681">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="{
	 &quot;ava&quot;：{
		 &quot;snapshotDir&quot;：&quot;自定义目录&quot;
	}
}
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005727-85681" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="设置超时"><a class="header-anchor" href="#设置超时" aria-hidden="true">#</a> 设置超时</h4><p>AVA中的超时行为与其他测试框架中的行为不同。AVA在每次测试后重置计时器，如果在指定的超时内没有收到新的测试结果，则强制测试退出。这可用于处理停滞的测试。</p><p><em>没有默认超时。</em></p><p>您可以配置使用超时<code>--timeout</code> 命令行选项，或配置文件中设置。它们可以以人类可读的方式设置：</p><div class="language-bash line-numbers-mode"><pre><code><span class="token comment"># 10秒</span>
npx ava --timeout <span class="token operator">=</span> 10s 

<span class="token comment"># 2分钟</span>
npx ava --timeout <span class="token operator">=</span> 2m 

<span class="token comment"># 100毫秒</span>
npx ava --timeout <span class="token operator">=</span> <span class="token number">100</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005727-42960">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="# 10秒
npx ava --timeout = 10s 

# 2分钟
npx ava --timeout = 2m 

# 100毫秒
npx ava --timeout = 100
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005727-42960" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>还可以为每个测试单独设置超时。每次进行断言时都会重置这些超时。</p><div class="language-js line-numbers-mode"><pre><code><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;foo&#39;</span><span class="token punctuation">,</span> <span class="token parameter">t</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	t<span class="token punctuation">.</span><span class="token function">timeout</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 100 milliseconds</span>
	<span class="token comment">// Write your assertions here</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005727-47734">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="test(&#39;foo&#39;, t =&gt; {
	t.timeout(100); // 100 milliseconds
	// Write your assertions here
});
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005727-47734" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="其他ava设置相关"><a class="header-anchor" href="#其他ava设置相关" aria-hidden="true">#</a> 其他ava设置相关</h3><h4 id="eslint"><a class="header-anchor" href="#eslint" aria-hidden="true">#</a> ESLint</h4><p>如果使用了ESLint，请添加<a href="https://github.com/avajs/eslint-plugin-ava" target="_blank" rel="noopener noreferrer">eslint-plugin-ava</a></p><div class="language-json line-numbers-mode"><pre><code><span class="token punctuation">{</span>
	plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token string">&quot;ava&quot;</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005728-47130">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="{
	plugins: [
		&quot;ava&quot;
	]
}
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005728-47130" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="异步相关"><a class="header-anchor" href="#异步相关" aria-hidden="true">#</a> 异步相关</h4><p>如果异步操作使用promises，则应返回promise：</p><div class="language-js line-numbers-mode"><pre><code><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;fetches foo&#39;</span><span class="token punctuation">,</span> <span class="token parameter">t</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		t<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">&#39;foo&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005728-95098">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="test(&#39;fetches foo&#39;, t =&gt; {
	return fetch().then(data =&gt; {
		t.is(data, &#39;foo&#39;);
	});
});
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005728-95098" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>更好的是，使用<code>async</code>/ <code>await</code>：</p><div class="language-js line-numbers-mode"><pre><code><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;fetches foo&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">t</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	t<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">&#39;foo&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005728-87140">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="test(&#39;fetches foo&#39;, async t =&gt; {
	const data = await fetch();
	t.is(data, &#39;foo&#39;);
});
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005728-87140" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="测试环境帮手karma"><a class="header-anchor" href="#测试环境帮手karma" aria-hidden="true">#</a> 测试环境&amp;帮手Karma</h2><p>Karma 是一个基于 Node.js 的 JavaScript 测试执行过程管理工具（Test Runner）。该工具可用于测试所有主流 Web 浏览器，也可以集成到 CI（Continuous integration）工具，还可以和其他代码编辑器一起使用。</p><p>Karma 会监控配置文件中所指定的每一个文件，每当文件发生改变，它都会向测试服务器发送信号，来通知所有的浏览器再次运行测试代码。此时，浏览器会重新加载源文件，并执行测试代码。其结果会传递回服务器，并以某种形式显示给开发者。</p><p>访问浏览器执行结果，可通过以下的方式</p><ul><li>手工方式 - 通过浏览器</li><li>自动方式 - 让 karma 来启动对应的浏览器</li></ul><h3 id="工作原理简介"><a class="header-anchor" href="#工作原理简介" aria-hidden="true">#</a> 工作原理简介</h3><p><code>karma</code> 是一个典型的 <code>C/S</code> 程序，包含 client 和 server ，通讯方式基于 <code>Http</code> ，通常情况下，客户端和服务端基本都运行在开发者本地机器上。</p><p>一个服务端实例对应一个项目，假如想同时运行多个项目，得同时开启多个服务端实例。</p><p><strong>Server</strong></p><p><code>Server</code> 是框架的主要组成部分之一，它内部保存了所有的程序运行状态，比如 client 连接，当前运行的单测文件，根据这些数据状态，它提供了下面几个功能， 下图是 server 的结构</p><p><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200310105729.png" alt="karma_server"></p><ul><li>监听文件</li><li>与 client 进行通讯</li><li>向开发者输出测试结果</li><li>提供 client 端所需的资源文件</li></ul><p><strong>Client</strong></p><p>client 是单测最终运行的地方，类似一个 web app ， 跟 server 端通讯利用 <code>socket.io</code>， 执行单测在一个独立的 <code>iframe</code> 中。下面是它的结构图</p><p><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200310105730.png" alt="karma_impl_client"></p><p>client 和 server 端通讯采用 <code>socket.io</code></p><ul><li>client 端会发送这些消息</li></ul><p><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200310105731.png" alt="karma_impl_client_message_c"></p><ul><li>server 端会发送这些消息</li></ul><p><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200310105732.jpg" alt="karma_impl_client_message_s"></p><h3 id="安装karma"><a class="header-anchor" href="#安装karma" aria-hidden="true">#</a> 安装Karma</h3><p>对于Nodejs版本的要求：</p><blockquote><p>Karma currently works on Node.js <strong>6.x</strong>, <strong>8.x</strong>, and <strong>10.x</strong>. See <a href="https://karma-runner.github.io/4.0/intro/faq.html" target="_blank" rel="noopener noreferrer">FAQ</a> for more info.</p></blockquote><ol><li>全局安装</li></ol><div class="language-sh line-numbers-mode"><pre><code>$npm install -g karma
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005728-57918">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="$npm install -g karma
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005728-57918" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>安装 Karma 命令会到全局的 <code>node_modules</code> 目录下，我们可以在任何位置直接运行 karma 命令。</p><div class="language-sh line-numbers-mode"><pre><code>npm install -g karma-cli
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005728-67566">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="npm install -g karma-cli
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005728-67566" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>此命令用来安装 <code>karma-cli</code>，它会在当前目录下寻找 karma 的可执行文件。这样我们就可以在一个系统内运行多个版本的 Karma。</p><ol start="2"><li>本地安装</li></ol><div class="language-sh line-numbers-mode"><pre><code>$ npm install karma --save-dev
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005729-16782">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="$ npm install karma --save-dev
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005729-16782" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>安装 Karma 命令到当前 <code>node_modules</code> 目录下，此时，如果需要执行 karma 命令，就需要这样</p><div class="language-sh line-numbers-mode"><pre><code>   ./node_modules/.bin/karma
   
   npx karma --version
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005729-90788">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="   ./node_modules/.bin/karma
   
   npx karma --version
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005729-90788" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="配置karma"><a class="header-anchor" href="#配置karma" aria-hidden="true">#</a> 配置Karma</h3><p>karma配置文件可以用JavaScript，CoffeeScript或TypeScript编写，并作为常规Node.js模块加载。</p><p>除非作为参数提供，否则Karma CLI将在以下位置以该顺序(从上至下)查找配置文件</p><ul><li><code>./karma.conf.js</code></li><li><code>./karma.conf.coffee</code></li><li><code>./karma.conf.ts</code></li><li><code>./.config/karma.conf.js</code></li><li><code>./.config/karma.conf.coffee</code></li><li><code>./.config/karma.conf.ts</code></li></ul><p>在配置文件中，配置代码通过设置<code>module.exports</code>指向一个接受一个参数的函数：配置对象。</p><div class="language-javascript line-numbers-mode"><pre><code><span class="token comment">// karma.conf.js</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  config<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    basePath<span class="token operator">:</span> <span class="token string">&#39;../..&#39;</span><span class="token punctuation">,</span>
    frameworks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;jasmine&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">//...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
# karma<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>coffee
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">(</span>config<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
  config<span class="token punctuation">.</span>set
    basePath<span class="token operator">:</span> <span class="token string">&#39;../..&#39;</span>
    frameworks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;jasmine&#39;</span><span class="token punctuation">]</span>
    # <span class="token operator">...</span>
<span class="token comment">// karma.conf.ts</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  config<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    basePath<span class="token operator">:</span> <span class="token string">&#39;../..&#39;</span><span class="token punctuation">,</span>
    frameworks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;jasmine&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">//...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005730-73654">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="// karma.conf.js
module.exports = function(config) {
  config.set({
    basePath: &#39;../..&#39;,
    frameworks: [&#39;jasmine&#39;],
    //...
  });
};
# karma.conf.coffee
module.exports = (config) -&gt;
  config.set
    basePath: &#39;../..&#39;
    frameworks: [&#39;jasmine&#39;]
    # ...
// karma.conf.ts
module.exports = (config) =&gt; {
  config.set({
    basePath: &#39;../..&#39;,
    frameworks: [&#39;jasmine&#39;],
    //...
  });
}
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005730-73654" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><blockquote><p>关于typescript的支持，需要使用到<code>ts-node</code>，配置ts-node以使用<code>commonjs</code>模块格</p></blockquote><p>配置文件中的基本的属性介绍：<a href="https://karma-runner.github.io/4.0/config/configuration-file.html" target="_blank" rel="noopener noreferrer">Overview</a></p><p>使用CLI工具，快速创建配置</p><p>开始配置</p><div class="language-bash line-numbers-mode"><pre><code>~/Downloads/Demo is 📦 v1.0.0 via ⬢ v10.16.0 
➜ npx karma init

<span class="token comment"># 如果在应用中用到了其它的测试框架，那就需要我们安装它们所对应的插件，并在配置文件中标注它们（详见 karma.conf.js 中的 plugins 项）</span>
Which testing framework <span class="token keyword">do</span> you want to use ?
Press tab to list possible options. Enter to move to the next question.
<span class="token operator">&gt;</span> jasmine
<span class="token comment"># mocha</span>
<span class="token comment"># qunit</span>
<span class="token comment"># nodeunit</span>
<span class="token comment"># nunit</span>

<span class="token comment"># Require.js 是异步加载规范（AMD）的实现。常被作为基础代码库，应用在了很多的项目与框架之中，例如 Dojo, AngularJs 等</span>
Do you want to use Require.js ?
This will <span class="token function">add</span> Require.js plugin.
Press tab to list possible options. Enter to move to the next question.
<span class="token operator">&gt;</span> no
<span class="token comment"># yes</span>

<span class="token comment"># 选择需要运行测试用例的浏览器。需要注意的就是，必须保证所对应的浏览器插件已经安装成功。</span>
Do you want to capture any browsers automatically ?
Press tab to list possible options. Enter empty string to move to the next question.
<span class="token operator">&gt;</span> Chrome
<span class="token comment"># ChromeHeadless</span>
<span class="token comment"># ChromeCanary</span>
<span class="token comment"># Firefox</span>
<span class="token comment"># Safari</span>
<span class="token comment"># PhantomJS</span>
<span class="token comment"># Opera</span>
<span class="token comment"># IE</span>

<span class="token comment"># 选择测试用例所在的目录位置。Karma 支持通配符的方式配置文件或目录，例如 *.js, test/**/*.js 等。如果目录或文件使用相对位置，要清楚地是，此时的路径是相对于当前运行 karma 命令时所在的目录。</span>
What is the location of your <span class="token builtin class-name">source</span> and <span class="token builtin class-name">test</span> files ?
You can use glob patterns, eg. <span class="token string">&quot;js/*.js&quot;</span> or <span class="token string">&quot;test/**/*Spec.js&quot;</span><span class="token builtin class-name">.</span>
Enter empty string to move to the next question.
<span class="token operator">&gt;</span> src/*js

<span class="token comment"># 目录中不包括的那些文件。</span>
Should any of the files included by the previous patterns be excluded ?
You can use glob patterns, eg. <span class="token string">&quot;**/*.swp&quot;</span><span class="token builtin class-name">.</span>
Enter empty string to move to the next question.

<span class="token comment"># 是否需要 Karma 自动监听文件？并且文件一旦被修改，就重新运行测试用例？</span>
Do you want Karma to <span class="token function">watch</span> all the files and run the tests on change ?
Press tab to list possible options.
<span class="token operator">&gt;</span> <span class="token function">yes</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005730-4234">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="~/Downloads/Demo is 📦 v1.0.0 via ⬢ v10.16.0 
➜ npx karma init

# 如果在应用中用到了其它的测试框架，那就需要我们安装它们所对应的插件，并在配置文件中标注它们（详见 karma.conf.js 中的 plugins 项）
Which testing framework do you want to use ?
Press tab to list possible options. Enter to move to the next question.
&gt; jasmine
# mocha
# qunit
# nodeunit
# nunit

# Require.js 是异步加载规范（AMD）的实现。常被作为基础代码库，应用在了很多的项目与框架之中，例如 Dojo, AngularJs 等
Do you want to use Require.js ?
This will add Require.js plugin.
Press tab to list possible options. Enter to move to the next question.
&gt; no
# yes

# 选择需要运行测试用例的浏览器。需要注意的就是，必须保证所对应的浏览器插件已经安装成功。
Do you want to capture any browsers automatically ?
Press tab to list possible options. Enter empty string to move to the next question.
&gt; Chrome
# ChromeHeadless
# ChromeCanary
# Firefox
# Safari
# PhantomJS
# Opera
# IE

# 选择测试用例所在的目录位置。Karma 支持通配符的方式配置文件或目录，例如 *.js, test/**/*.js 等。如果目录或文件使用相对位置，要清楚地是，此时的路径是相对于当前运行 karma 命令时所在的目录。
What is the location of your source and test files ?
You can use glob patterns, eg. &quot;js/*.js&quot; or &quot;test/**/*Spec.js&quot;.
Enter empty string to move to the next question.
&gt; src/*js

# 目录中不包括的那些文件。
Should any of the files included by the previous patterns be excluded ?
You can use glob patterns, eg. &quot;**/*.swp&quot;.
Enter empty string to move to the next question.

# 是否需要 Karma 自动监听文件？并且文件一旦被修改，就重新运行测试用例？
Do you want Karma to watch all the files and run the tests on change ?
Press tab to list possible options.
&gt; yes
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005730-4234" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><p>生成了一个<code>karma.conf.js</code>文件：</p><div class="language-js line-numbers-mode"><pre><code><span class="token comment">// Karma configuration</span>
<span class="token comment">// Generated on Wed Jul 10 2019 22:46:32 GMT+0800 (GMT+08:00)</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  config<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>

    <span class="token comment">// base path that will be used to resolve all patterns (eg. files, exclude)</span>
    basePath<span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>


    <span class="token comment">// frameworks to use</span>
    <span class="token comment">// available frameworks: https://npmjs.org/browse/keyword/karma-adapter</span>
    frameworks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;mocha&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>


    <span class="token comment">// list of files / patterns to load in the browser</span>
    files<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&#39;src/*js&#39;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>


    <span class="token comment">// list of files / patterns to exclude</span>
    exclude<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>


    <span class="token comment">// preprocess matching files before serving them to the browser</span>
    <span class="token comment">// available preprocessors: https://npmjs.org/browse/keyword/karma-preprocessor</span>
    preprocessors<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>


    <span class="token comment">// test results reporter to use</span>
    <span class="token comment">// possible values: &#39;dots&#39;, &#39;progress&#39;</span>
    <span class="token comment">// available reporters: https://npmjs.org/browse/keyword/karma-reporter</span>
    reporters<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;progress&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>


    <span class="token comment">// web server port</span>
    port<span class="token operator">:</span> <span class="token number">9876</span><span class="token punctuation">,</span>


    <span class="token comment">// enable / disable colors in the output (reporters and logs)</span>
    colors<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>


    <span class="token comment">// level of logging</span>
    <span class="token comment">// possible values: config.LOG_DISABLE || config.LOG_ERROR || config.LOG_WARN || config.LOG_INFO || config.LOG_DEBUG</span>
    logLevel<span class="token operator">:</span> config<span class="token punctuation">.</span><span class="token constant">LOG_INFO</span><span class="token punctuation">,</span>


    <span class="token comment">// enable / disable watching file and executing tests whenever any file changes</span>
    autoWatch<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>


    <span class="token comment">// start these browsers</span>
    <span class="token comment">// available browser launchers: https://npmjs.org/browse/keyword/karma-launcher</span>
    browsers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;Chrome&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>


    <span class="token comment">// Continuous Integration mode</span>
    <span class="token comment">// if true, Karma captures browsers, runs the tests and exits</span>
    singleRun<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

    <span class="token comment">// Concurrency level</span>
    <span class="token comment">// how many browser should be started simultaneous</span>
    concurrency<span class="token operator">:</span> <span class="token number">Infinity</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005730-26256">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="// Karma configuration
// Generated on Wed Jul 10 2019 22:46:32 GMT+0800 (GMT+08:00)

module.exports = function(config) {
  config.set({

    // base path that will be used to resolve all patterns (eg. files, exclude)
    basePath: &#39;&#39;,


    // frameworks to use
    // available frameworks: https://npmjs.org/browse/keyword/karma-adapter
    frameworks: [&#39;mocha&#39;],


    // list of files / patterns to load in the browser
    files: [
      &#39;src/*js&#39;
    ],


    // list of files / patterns to exclude
    exclude: [
    ],


    // preprocess matching files before serving them to the browser
    // available preprocessors: https://npmjs.org/browse/keyword/karma-preprocessor
    preprocessors: {
    },


    // test results reporter to use
    // possible values: &#39;dots&#39;, &#39;progress&#39;
    // available reporters: https://npmjs.org/browse/keyword/karma-reporter
    reporters: [&#39;progress&#39;],


    // web server port
    port: 9876,


    // enable / disable colors in the output (reporters and logs)
    colors: true,


    // level of logging
    // possible values: config.LOG_DISABLE || config.LOG_ERROR || config.LOG_WARN || config.LOG_INFO || config.LOG_DEBUG
    logLevel: config.LOG_INFO,


    // enable / disable watching file and executing tests whenever any file changes
    autoWatch: true,


    // start these browsers
    // available browser launchers: https://npmjs.org/browse/keyword/karma-launcher
    browsers: [&#39;Chrome&#39;],


    // Continuous Integration mode
    // if true, Karma captures browsers, runs the tests and exits
    singleRun: false,

    // Concurrency level
    // how many browser should be started simultaneous
    concurrency: Infinity
  })
}

" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005730-26256" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br></div></div><h3 id="karma示例"><a class="header-anchor" href="#karma示例" aria-hidden="true">#</a> karma示例</h3><p>目标 ：</p><ul><li>babel支持，ES6语法支持</li><li>mocha与chai支持</li><li>karma与chrome、webpack对接</li></ul><p>说明：</p><p>Karma对babel支持的，一个可选项：<a href="https://github.com/babel/karma-babel-preprocessor" target="_blank" rel="noopener noreferrer">karma-babel-preprocessor</a>，但是：</p><blockquote><p>babel and karma-babel-preprocessor only convert ES6 modules to CommonJS/AMD/SystemJS/UMD**. If you choose CommonJS, you still need to resolve and concatenate CommonJS modules on your own**. We recommend <strong>karma-browserify + babelify</strong> or <strong>webpack + babel-loader</strong> in such cases.</p></blockquote><p>所以，我们选择了webpack</p><ol><li>安装依赖</li></ol><div class="language-"><pre><code>   npm install @babel/core @babel/preset-env chai mocha webpack webpack-cli babel-loader -D
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005731-9959">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="   npm install @babel/core @babel/preset-env chai mocha webpack webpack-cli babel-loader -D
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005731-9959" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>安装karma的适配器</li></ol><div class="language-"><pre><code>   npm install karma-webpack karma-chrome-launcher karma-mocha karma-chai -D
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005731-73148">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="   npm install karma-webpack karma-chrome-launcher karma-mocha karma-chai -D
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005731-73148" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="3"><li>配置<code>karma.config.js</code></li></ol><div class="language-js line-numbers-mode"><pre><code>   <span class="token comment">// Karma configuration</span>
   <span class="token comment">// Generated on Thu Jul 11 2019 23:23:44 GMT+0800 (GMT+08:00)</span>
   
   module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     config<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   
       <span class="token comment">// base path that will be used to resolve all patterns (eg. files, exclude)</span>
       basePath<span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
   
   
       <span class="token comment">// frameworks to use</span>
       <span class="token comment">// available frameworks: https://npmjs.org/browse/keyword/karma-adapter</span>
       frameworks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;mocha&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   
   
       <span class="token comment">// list of files / patterns to load in the browser</span>
       files<span class="token operator">:</span> <span class="token punctuation">[</span>
         <span class="token string">&#39;src/**/*.js&#39;</span><span class="token punctuation">,</span>
         <span class="token string">&#39;test/**/*.js&#39;</span>
       <span class="token punctuation">]</span><span class="token punctuation">,</span>
   
    
       <span class="token comment">// ....</span>
       
   
       <span class="token comment">// preprocess matching files before serving them to the browser</span>
       <span class="token comment">// available preprocessors: https://npmjs.org/browse/keyword/karma-preprocessor</span>
       preprocessors<span class="token operator">:</span> <span class="token punctuation">{</span>
         <span class="token string">&#39;src/**/*.js&#39;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;webpack&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token string">&#39;test/**/*.js&#39;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;webpack&#39;</span><span class="token punctuation">]</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
   
       webpack<span class="token operator">:</span> <span class="token punctuation">{</span>
         mode<span class="token operator">:</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">,</span>
         node<span class="token operator">:</span> <span class="token punctuation">{</span>
           fs<span class="token operator">:</span> <span class="token string">&#39;empty&#39;</span>
         <span class="token punctuation">}</span><span class="token punctuation">,</span>
         module<span class="token operator">:</span> <span class="token punctuation">{</span>
           rules<span class="token operator">:</span> <span class="token punctuation">[</span>
             <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span> options<span class="token operator">:</span> <span class="token punctuation">{</span> presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/env&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">}</span>
           <span class="token punctuation">]</span>
         <span class="token punctuation">}</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
    
       <span class="token comment">// ....</span>
       
       plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
         <span class="token string">&#39;karma-mocha&#39;</span><span class="token punctuation">,</span>
         <span class="token string">&#39;karma-chai&#39;</span><span class="token punctuation">,</span>
         <span class="token string">&#39;karma-chrome-launcher&#39;</span><span class="token punctuation">,</span>
         <span class="token string">&#39;karma-webpack&#39;</span>
       <span class="token punctuation">]</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005731-88651">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="   // Karma configuration
   // Generated on Thu Jul 11 2019 23:23:44 GMT+0800 (GMT+08:00)
   
   module.exports = function (config) {
     config.set({
   
       // base path that will be used to resolve all patterns (eg. files, exclude)
       basePath: &#39;&#39;,
   
   
       // frameworks to use
       // available frameworks: https://npmjs.org/browse/keyword/karma-adapter
       frameworks: [&#39;mocha&#39;],
   
   
       // list of files / patterns to load in the browser
       files: [
         &#39;src/**/*.js&#39;,
         &#39;test/**/*.js&#39;
       ],
   
    
       // ....
       
   
       // preprocess matching files before serving them to the browser
       // available preprocessors: https://npmjs.org/browse/keyword/karma-preprocessor
       preprocessors: {
         &#39;src/**/*.js&#39;: [&#39;webpack&#39;],
         &#39;test/**/*.js&#39;: [&#39;webpack&#39;]
       },
   
       webpack: {
         mode: &quot;none&quot;,
         node: {
           fs: &#39;empty&#39;
         },
         module: {
           rules: [
             { test: /\.js?$/, loader: &quot;babel-loader&quot;, options: { presets: [&quot;@babel/env&quot;] }, }
           ]
         }
       },
    
       // ....
       
       plugins: [
         &#39;karma-mocha&#39;,
         &#39;karma-chai&#39;,
         &#39;karma-chrome-launcher&#39;,
         &#39;karma-webpack&#39;
       ]
     })
   }
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005731-88651" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><ol start="4"><li>书写测试用例<code>test.js</code>：</li></ol><div class="language-js line-numbers-mode"><pre><code>   <span class="token keyword">import</span> <span class="token punctuation">{</span> describe <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;mocha&quot;</span><span class="token punctuation">;</span>
   <span class="token keyword">import</span> <span class="token punctuation">{</span> expect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;chai&#39;</span>
   
   <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;first test&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
     <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;hello mocha and karma&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;hello mocha&#39;</span><span class="token punctuation">)</span>
       <span class="token function">expect</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005731-9204">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="   import { describe } from &quot;mocha&quot;;
   import { expect } from &#39;chai&#39;
   
   describe(&#39;first test&#39;, () =&gt; {
     it(&#39;hello mocha and karma&#39;, () =&gt; {
       console.log(&#39;hello mocha&#39;)
       expect(true).to.be.equal(true)
     })
   })
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005731-9204" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="5"><li>开始测试：</li></ol><div class="language-bash line-numbers-mode"><pre><code>   npx karma start
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005732-83947">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="   npx karma start
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005732-83947" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>添加到<code>package.json</code></p><div class="language-json line-numbers-mode"><pre><code>   <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token property">&quot;karma&quot;</span><span class="token operator">:</span> <span class="token string">&quot;karma start&quot;</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005732-2924">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="   &quot;scripts&quot;: {
     &quot;karma&quot;: &quot;karma start&quot;
   },
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005732-2924" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>然后使用，<code>npm run karma</code></p><div class="language-bash line-numbers-mode"><pre><code>➜ npx karma start
ℹ ｢wdm｣: Hash: 9d2c943b68425fd58dd0
Version: webpack <span class="token number">4.35</span>.3
Time: 53ms
Built at: <span class="token number">2019</span>-07-12 <span class="token number">5</span>:07:49 PM
ℹ ｢wdm｣: Compiled successfully.
ℹ ｢wdm｣: Compiling<span class="token punctuation">..</span>.
⚠ ｢wdm｣: Hash: cca8316f4bd5855fc4de
Version: webpack <span class="token number">4.35</span>.3
Time: 2414ms
Built at: <span class="token number">2019</span>-07-12 <span class="token number">5</span>:07:52 PM
       Asset      Size  Chunks             Chunk Names
src/index.js  <span class="token number">3.62</span> KiB       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  src/index
test/test.js  <span class="token number">1010</span> KiB       <span class="token number">1</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  test/test
Entrypoint src/index <span class="token operator">=</span> src/index.js
Entrypoint test/test <span class="token operator">=</span> test/test.js
  <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> ./src/index.js <span class="token number">27</span> bytes <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> ./test/test.js <span class="token number">223</span> bytes <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> ./node_modules/mocha/browser-entry.js <span class="token number">4.19</span> KiB <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> ./node_modules/process/browser.js <span class="token number">4.96</span> KiB <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>webpack<span class="token punctuation">)</span>/buildin/global.js <span class="token number">878</span> bytes <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> ./node_modules/browser-stdout/index.js <span class="token number">662</span> bytes <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> ./node_modules/stream-browserify/index.js <span class="token number">3.53</span> KiB <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
 <span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">]</span> ./node_modules/util/util.js <span class="token number">19</span> KiB <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
 <span class="token punctuation">[</span><span class="token number">38</span><span class="token punctuation">]</span> ./node_modules/mocha/lib/mocha.js <span class="token number">21.8</span> KiB <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
 <span class="token punctuation">[</span><span class="token number">39</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>webpack<span class="token punctuation">)</span>/buildin/module.js <span class="token number">552</span> bytes <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
 <span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span> ./node_modules/escape-string-regexp/index.js <span class="token number">230</span> bytes <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
 <span class="token punctuation">[</span><span class="token number">41</span><span class="token punctuation">]</span> path <span class="token punctuation">(</span>ignored<span class="token punctuation">)</span> <span class="token number">15</span> bytes <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
 <span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">]</span> ./node_modules/mocha/lib/reporters/index.js <span class="token number">945</span> bytes <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">105</span><span class="token punctuation">]</span> ./node_modules/chai/index.js <span class="token number">39</span> bytes <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">106</span><span class="token punctuation">]</span> ./node_modules/chai/lib/chai.js <span class="token number">1.22</span> KiB <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
    + <span class="token number">128</span> hidden modules

WARNING <span class="token keyword">in</span> ./node_modules/mocha/lib/mocha.js <span class="token number">217</span>:20-37
Critical dependency: the request of a dependency is an expression
 @ ./node_modules/mocha/browser-entry.js
 @ ./test/test.js

WARNING <span class="token keyword">in</span> ./node_modules/mocha/lib/mocha.js <span class="token number">222</span>:24-70
Critical dependency: the request of a dependency is an expression
 @ ./node_modules/mocha/browser-entry.js
 @ ./test/test.js

WARNING <span class="token keyword">in</span> ./node_modules/mocha/lib/mocha.js <span class="token number">266</span>:24-35
Critical dependency: the request of a dependency is an expression
 @ ./node_modules/mocha/browser-entry.js
 @ ./test/test.js

WARNING <span class="token keyword">in</span> ./node_modules/mocha/lib/mocha.js <span class="token number">313</span>:35-48
Critical dependency: the request of a dependency is an expression
 @ ./node_modules/mocha/browser-entry.js
 @ ./test/test.js

WARNING <span class="token keyword">in</span> ./node_modules/mocha/lib/mocha.js <span class="token number">329</span>:23-44
Critical dependency: the request of a dependency is an expression
 @ ./node_modules/mocha/browser-entry.js
 @ ./test/test.js
ℹ ｢wdm｣: Compiled with warnings.
<span class="token number">12</span> 07 <span class="token number">2019</span> <span class="token number">17</span>:07:52.761:WARN <span class="token punctuation">[</span>karma<span class="token punctuation">]</span>: No captured browser, <span class="token function">open</span> http://localhost:9876/
<span class="token number">12</span> 07 <span class="token number">2019</span> <span class="token number">17</span>:07:52.770:INFO <span class="token punctuation">[</span>karma-server<span class="token punctuation">]</span>: Karma v4.1.0 server started at http://0.0.0.0:9876/
<span class="token number">12</span> 07 <span class="token number">2019</span> <span class="token number">17</span>:07:52.770:INFO <span class="token punctuation">[</span>launcher<span class="token punctuation">]</span>: Launching browsers Chrome with concurrency unlimited
<span class="token number">12</span> 07 <span class="token number">2019</span> <span class="token number">17</span>:07:52.773:INFO <span class="token punctuation">[</span>launcher<span class="token punctuation">]</span>: Starting browser Chrome
<span class="token number">12</span> 07 <span class="token number">2019</span> <span class="token number">17</span>:07:54.135:INFO <span class="token punctuation">[</span>Chrome <span class="token number">75.0</span>.3770 <span class="token punctuation">(</span>Mac OS X <span class="token number">10.14</span>.5<span class="token punctuation">)</span><span class="token punctuation">]</span>: Connected on socket R9R31QB1GtR_kayNAAAA with <span class="token function">id</span> <span class="token number">55412577</span>
Chrome <span class="token number">75.0</span>.3770 <span class="token punctuation">(</span>Mac OS X <span class="token number">10.14</span>.5<span class="token punctuation">)</span> LOG: <span class="token string">&#39;hello karma&#39;</span>

LOG: <span class="token string">&#39;hello mocha&#39;</span>
Chrome <span class="token number">75.0</span>.3770 <span class="token punctuation">(</span>Mac OS X <span class="token number">10.14</span>.5<span class="token punctuation">)</span>: Executed <span class="token number">1</span> of <span class="token number">1</span> SUCCESS <span class="token punctuation">(</span><span class="token number">0</span> secs / <span class="token number">0.001</span> secs
~/Downloads/karma-demo is 📦 v1.0.0 via ⬢ v10.16.0 
➜ <span class="token function">npm</span> run karma

<span class="token operator">&gt;</span> karma-demo@1.0.0 karma /Users/demo/Downloads/karma-demo
<span class="token operator">&gt;</span> karma start

ℹ ｢wdm｣: Hash: 9d2c943b68425fd58dd0
Version: webpack <span class="token number">4.35</span>.3
Time: 48ms
Built at: <span class="token number">2019</span>-07-12 <span class="token number">5</span>:24:02 PM
ℹ ｢wdm｣: Compiled successfully.
ℹ ｢wdm｣: Compiling<span class="token punctuation">..</span>.
⚠ ｢wdm｣: Hash: cca8316f4bd5855fc4de
Version: webpack <span class="token number">4.35</span>.3
Time: 2307ms
Built at: <span class="token number">2019</span>-07-12 <span class="token number">5</span>:24:04 PM
       Asset      Size  Chunks             Chunk Names
src/index.js  <span class="token number">3.62</span> KiB       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  src/index
test/test.js  <span class="token number">1010</span> KiB       <span class="token number">1</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  test/test
Entrypoint src/index <span class="token operator">=</span> src/index.js
Entrypoint test/test <span class="token operator">=</span> test/test.js
  <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> ./src/index.js <span class="token number">27</span> bytes <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> ./test/test.js <span class="token number">223</span> bytes <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> ./node_modules/mocha/browser-entry.js <span class="token number">4.19</span> KiB <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> ./node_modules/process/browser.js <span class="token number">4.96</span> KiB <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>webpack<span class="token punctuation">)</span>/buildin/global.js <span class="token number">878</span> bytes <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> ./node_modules/browser-stdout/index.js <span class="token number">662</span> bytes <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> ./node_modules/stream-browserify/index.js <span class="token number">3.53</span> KiB <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
 <span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">]</span> ./node_modules/util/util.js <span class="token number">19</span> KiB <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
 <span class="token punctuation">[</span><span class="token number">38</span><span class="token punctuation">]</span> ./node_modules/mocha/lib/mocha.js <span class="token number">21.8</span> KiB <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
 <span class="token punctuation">[</span><span class="token number">39</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>webpack<span class="token punctuation">)</span>/buildin/module.js <span class="token number">552</span> bytes <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
 <span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span> ./node_modules/escape-string-regexp/index.js <span class="token number">230</span> bytes <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
 <span class="token punctuation">[</span><span class="token number">41</span><span class="token punctuation">]</span> path <span class="token punctuation">(</span>ignored<span class="token punctuation">)</span> <span class="token number">15</span> bytes <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
 <span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">]</span> ./node_modules/mocha/lib/reporters/index.js <span class="token number">945</span> bytes <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">105</span><span class="token punctuation">]</span> ./node_modules/chai/index.js <span class="token number">39</span> bytes <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">106</span><span class="token punctuation">]</span> ./node_modules/chai/lib/chai.js <span class="token number">1.22</span> KiB <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>
    + <span class="token number">128</span> hidden modules

WARNING <span class="token keyword">in</span> ./node_modules/mocha/lib/mocha.js <span class="token number">217</span>:20-37
Critical dependency: the request of a dependency is an expression
 @ ./node_modules/mocha/browser-entry.js
 @ ./test/test.js

WARNING <span class="token keyword">in</span> ./node_modules/mocha/lib/mocha.js <span class="token number">222</span>:24-70
Critical dependency: the request of a dependency is an expression
 @ ./node_modules/mocha/browser-entry.js
 @ ./test/test.js

WARNING <span class="token keyword">in</span> ./node_modules/mocha/lib/mocha.js <span class="token number">266</span>:24-35
Critical dependency: the request of a dependency is an expression
 @ ./node_modules/mocha/browser-entry.js
 @ ./test/test.js

WARNING <span class="token keyword">in</span> ./node_modules/mocha/lib/mocha.js <span class="token number">313</span>:35-48
Critical dependency: the request of a dependency is an expression
 @ ./node_modules/mocha/browser-entry.js
 @ ./test/test.js

WARNING <span class="token keyword">in</span> ./node_modules/mocha/lib/mocha.js <span class="token number">329</span>:23-44
Critical dependency: the request of a dependency is an expression
 @ ./node_modules/mocha/browser-entry.js
 @ ./test/test.js
ℹ ｢wdm｣: Compiled with warnings.
<span class="token number">12</span> 07 <span class="token number">2019</span> <span class="token number">17</span>:24:04.905:WARN <span class="token punctuation">[</span>karma<span class="token punctuation">]</span>: No captured browser, <span class="token function">open</span> http://localhost:9876/
<span class="token number">12</span> 07 <span class="token number">2019</span> <span class="token number">17</span>:24:04.914:INFO <span class="token punctuation">[</span>karma-server<span class="token punctuation">]</span>: Karma v4.1.0 server started at http://0.0.0.0:9876/
<span class="token number">12</span> 07 <span class="token number">2019</span> <span class="token number">17</span>:24:04.914:INFO <span class="token punctuation">[</span>launcher<span class="token punctuation">]</span>: Launching browsers Chrome with concurrency unlimited
<span class="token number">12</span> 07 <span class="token number">2019</span> <span class="token number">17</span>:24:04.922:INFO <span class="token punctuation">[</span>launcher<span class="token punctuation">]</span>: Starting browser Chrome
<span class="token number">12</span> 07 <span class="token number">2019</span> <span class="token number">17</span>:24:06.289:INFO <span class="token punctuation">[</span>Chrome <span class="token number">75.0</span>.3770 <span class="token punctuation">(</span>Mac OS X <span class="token number">10.14</span>.5<span class="token punctuation">)</span><span class="token punctuation">]</span>: Connected on socket EbCCSbQRPbxHbq3OAAAA with <span class="token function">id</span> <span class="token number">92342032</span>
Chrome <span class="token number">75.0</span>.3770 <span class="token punctuation">(</span>Mac OS X <span class="token number">10.14</span>.5<span class="token punctuation">)</span> LOG: <span class="token string">&#39;hello karma&#39;</span>

LOG: <span class="token string">&#39;hello mocha&#39;</span>
Chrome <span class="token number">75.0</span>.3770 <span class="token punctuation">(</span>Mac OS X <span class="token number">10.14</span>.5<span class="token punctuation">)</span>: Executed <span class="token number">1</span> of <span class="token number">1</span> SUCCESS <span class="token punctuation">(</span><span class="token number">0</span> secs / <span class="token number">0.001</span> secs
Chrome <span class="token number">75.0</span>.3770 <span class="token punctuation">(</span>Mac OS X <span class="token number">10.14</span>.5<span class="token punctuation">)</span>: Executed <span class="token number">1</span> of <span class="token number">1</span> SUCCESS <span class="token punctuation">(</span><span class="token number">0.006</span> secs / <span class="token number">0.001</span> 
secs<span class="token punctuation">)</span>
TOTAL: <span class="token number">1</span> SUCCESS
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005732-94470">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="➜ npx karma start
ℹ ｢wdm｣: Hash: 9d2c943b68425fd58dd0
Version: webpack 4.35.3
Time: 53ms
Built at: 2019-07-12 5:07:49 PM
ℹ ｢wdm｣: Compiled successfully.
ℹ ｢wdm｣: Compiling...
⚠ ｢wdm｣: Hash: cca8316f4bd5855fc4de
Version: webpack 4.35.3
Time: 2414ms
Built at: 2019-07-12 5:07:52 PM
       Asset      Size  Chunks             Chunk Names
src/index.js  3.62 KiB       0  [emitted]  src/index
test/test.js  1010 KiB       1  [emitted]  test/test
Entrypoint src/index = src/index.js
Entrypoint test/test = test/test.js
  [0] ./src/index.js 27 bytes {0} [built]
  [1] ./test/test.js 223 bytes {1} [built]
  [2] ./node_modules/mocha/browser-entry.js 4.19 KiB {1} [built]
  [3] ./node_modules/process/browser.js 4.96 KiB {1} [built]
  [4] (webpack)/buildin/global.js 878 bytes {1} [built]
  [5] ./node_modules/browser-stdout/index.js 662 bytes {1} [built]
  [6] ./node_modules/stream-browserify/index.js 3.53 KiB {1} [built]
 [36] ./node_modules/util/util.js 19 KiB {1} [built]
 [38] ./node_modules/mocha/lib/mocha.js 21.8 KiB {1} [built]
 [39] (webpack)/buildin/module.js 552 bytes {1} [built]
 [40] ./node_modules/escape-string-regexp/index.js 230 bytes {1} [built]
 [41] path (ignored) 15 bytes {1} [built]
 [42] ./node_modules/mocha/lib/reporters/index.js 945 bytes {1} [built]
[105] ./node_modules/chai/index.js 39 bytes {1} [built]
[106] ./node_modules/chai/lib/chai.js 1.22 KiB {1} [built]
    + 128 hidden modules

WARNING in ./node_modules/mocha/lib/mocha.js 217:20-37
Critical dependency: the request of a dependency is an expression
 @ ./node_modules/mocha/browser-entry.js
 @ ./test/test.js

WARNING in ./node_modules/mocha/lib/mocha.js 222:24-70
Critical dependency: the request of a dependency is an expression
 @ ./node_modules/mocha/browser-entry.js
 @ ./test/test.js

WARNING in ./node_modules/mocha/lib/mocha.js 266:24-35
Critical dependency: the request of a dependency is an expression
 @ ./node_modules/mocha/browser-entry.js
 @ ./test/test.js

WARNING in ./node_modules/mocha/lib/mocha.js 313:35-48
Critical dependency: the request of a dependency is an expression
 @ ./node_modules/mocha/browser-entry.js
 @ ./test/test.js

WARNING in ./node_modules/mocha/lib/mocha.js 329:23-44
Critical dependency: the request of a dependency is an expression
 @ ./node_modules/mocha/browser-entry.js
 @ ./test/test.js
ℹ ｢wdm｣: Compiled with warnings.
12 07 2019 17:07:52.761:WARN [karma]: No captured browser, open http://localhost:9876/
12 07 2019 17:07:52.770:INFO [karma-server]: Karma v4.1.0 server started at http://0.0.0.0:9876/
12 07 2019 17:07:52.770:INFO [launcher]: Launching browsers Chrome with concurrency unlimited
12 07 2019 17:07:52.773:INFO [launcher]: Starting browser Chrome
12 07 2019 17:07:54.135:INFO [Chrome 75.0.3770 (Mac OS X 10.14.5)]: Connected on socket R9R31QB1GtR_kayNAAAA with id 55412577
Chrome 75.0.3770 (Mac OS X 10.14.5) LOG: &#39;hello karma&#39;

LOG: &#39;hello mocha&#39;
Chrome 75.0.3770 (Mac OS X 10.14.5): Executed 1 of 1 SUCCESS (0 secs / 0.001 secs
~/Downloads/karma-demo is 📦 v1.0.0 via ⬢ v10.16.0 
➜ npm run karma

&gt; karma-demo@1.0.0 karma /Users/demo/Downloads/karma-demo
&gt; karma start

ℹ ｢wdm｣: Hash: 9d2c943b68425fd58dd0
Version: webpack 4.35.3
Time: 48ms
Built at: 2019-07-12 5:24:02 PM
ℹ ｢wdm｣: Compiled successfully.
ℹ ｢wdm｣: Compiling...
⚠ ｢wdm｣: Hash: cca8316f4bd5855fc4de
Version: webpack 4.35.3
Time: 2307ms
Built at: 2019-07-12 5:24:04 PM
       Asset      Size  Chunks             Chunk Names
src/index.js  3.62 KiB       0  [emitted]  src/index
test/test.js  1010 KiB       1  [emitted]  test/test
Entrypoint src/index = src/index.js
Entrypoint test/test = test/test.js
  [0] ./src/index.js 27 bytes {0} [built]
  [1] ./test/test.js 223 bytes {1} [built]
  [2] ./node_modules/mocha/browser-entry.js 4.19 KiB {1} [built]
  [3] ./node_modules/process/browser.js 4.96 KiB {1} [built]
  [4] (webpack)/buildin/global.js 878 bytes {1} [built]
  [5] ./node_modules/browser-stdout/index.js 662 bytes {1} [built]
  [6] ./node_modules/stream-browserify/index.js 3.53 KiB {1} [built]
 [36] ./node_modules/util/util.js 19 KiB {1} [built]
 [38] ./node_modules/mocha/lib/mocha.js 21.8 KiB {1} [built]
 [39] (webpack)/buildin/module.js 552 bytes {1} [built]
 [40] ./node_modules/escape-string-regexp/index.js 230 bytes {1} [built]
 [41] path (ignored) 15 bytes {1} [built]
 [42] ./node_modules/mocha/lib/reporters/index.js 945 bytes {1} [built]
[105] ./node_modules/chai/index.js 39 bytes {1} [built]
[106] ./node_modules/chai/lib/chai.js 1.22 KiB {1} [built]
    + 128 hidden modules

WARNING in ./node_modules/mocha/lib/mocha.js 217:20-37
Critical dependency: the request of a dependency is an expression
 @ ./node_modules/mocha/browser-entry.js
 @ ./test/test.js

WARNING in ./node_modules/mocha/lib/mocha.js 222:24-70
Critical dependency: the request of a dependency is an expression
 @ ./node_modules/mocha/browser-entry.js
 @ ./test/test.js

WARNING in ./node_modules/mocha/lib/mocha.js 266:24-35
Critical dependency: the request of a dependency is an expression
 @ ./node_modules/mocha/browser-entry.js
 @ ./test/test.js

WARNING in ./node_modules/mocha/lib/mocha.js 313:35-48
Critical dependency: the request of a dependency is an expression
 @ ./node_modules/mocha/browser-entry.js
 @ ./test/test.js

WARNING in ./node_modules/mocha/lib/mocha.js 329:23-44
Critical dependency: the request of a dependency is an expression
 @ ./node_modules/mocha/browser-entry.js
 @ ./test/test.js
ℹ ｢wdm｣: Compiled with warnings.
12 07 2019 17:24:04.905:WARN [karma]: No captured browser, open http://localhost:9876/
12 07 2019 17:24:04.914:INFO [karma-server]: Karma v4.1.0 server started at http://0.0.0.0:9876/
12 07 2019 17:24:04.914:INFO [launcher]: Launching browsers Chrome with concurrency unlimited
12 07 2019 17:24:04.922:INFO [launcher]: Starting browser Chrome
12 07 2019 17:24:06.289:INFO [Chrome 75.0.3770 (Mac OS X 10.14.5)]: Connected on socket EbCCSbQRPbxHbq3OAAAA with id 92342032
Chrome 75.0.3770 (Mac OS X 10.14.5) LOG: &#39;hello karma&#39;

LOG: &#39;hello mocha&#39;
Chrome 75.0.3770 (Mac OS X 10.14.5): Executed 1 of 1 SUCCESS (0 secs / 0.001 secs
Chrome 75.0.3770 (Mac OS X 10.14.5): Executed 1 of 1 SUCCESS (0.006 secs / 0.001 
secs)
TOTAL: 1 SUCCESS
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005732-94470" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br></div></div><h2 id="ui测试利器nightmare"><a class="header-anchor" href="#ui测试利器nightmare" aria-hidden="true">#</a> UI测试利器Nightmare</h2><p>Nightmare是<a href="https://segment.com/" target="_blank" rel="noopener noreferrer">Segment</a>的高级浏览器自动化库。</p><p>目标是公开一些模仿用户操作（例如<code>goto</code>，<code>type</code>和<code>click</code>）的简单方法，使用对每个脚本块感觉同步的API，而不是深层嵌套的回调。它最初设计用于在没有API的站点之间自动执行任务，但最常用于UI测试和爬网。</p><p>它使用<a href="http://electron.atom.io/" target="_blank" rel="noopener noreferrer">Electron</a>，它与<a href="http://phantomjs.org/" target="_blank" rel="noopener noreferrer">PhantomJS</a>类似，但大约<a href="https://github.com/segmentio/nightmare/issues/484#issuecomment-184519591" target="_blank" rel="noopener noreferrer">快两倍</a>，更现代。</p><h3 id="安装与起步"><a class="header-anchor" href="#安装与起步" aria-hidden="true">#</a> 安装与起步</h3><ol><li><p>安装<code>nightmare</code></p></li><li></li></ol><div class="language-sh line-numbers-mode"><pre><code># 初始化项目
npm init -y
npm install --save-dev nightmare
npm install --save-dev mocha
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005733-69620">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="# 初始化项目
npm init -y
npm install --save-dev nightmare
npm install --save-dev mocha
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005733-69620" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>淘宝源加速</li></ol><div class="language-sh line-numbers-mode"><pre><code># 使用淘宝源加速electron的安装
export ELECTRON_MIRROR=&quot;https://npm.taobao.org/mirrors/electron/&quot;
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005733-46531">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="# 使用淘宝源加速electron的安装
export ELECTRON_MIRROR=&quot;https://npm.taobao.org/mirrors/electron/&quot;
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005733-46531" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="3"><li>起步测试：</li></ol><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">const</span> Nightmare <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;nightmare&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> assert <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;assert&#39;</span><span class="token punctuation">)</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;Load a Page&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Recommended: 5s locally, 10s to remote server, 30s from airplane ¯\_(ツ)_/¯</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">timeout</span><span class="token punctuation">(</span><span class="token string">&#39;30s&#39;</span><span class="token punctuation">)</span>

  <span class="token keyword">let</span> nightmare <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    nightmare <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Nightmare</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;/ (Home Page)&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;should load without error&#39;</span><span class="token punctuation">,</span> <span class="token parameter">done</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// your actual testing urls will likely be `http://localhost:port/path`</span>
      nightmare<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">&#39;https://www.baidu.com&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005734-84455">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="const Nightmare = require(&#39;nightmare&#39;)
const assert = require(&#39;assert&#39;)

describe(&#39;Load a Page&#39;, function () {
  // Recommended: 5s locally, 10s to remote server, 30s from airplane ¯\_(ツ)_/¯
  this.timeout(&#39;30s&#39;)

  let nightmare = null
  beforeEach(() =&gt; {
    nightmare = new Nightmare()
  })

  describe(&#39;/ (Home Page)&#39;, () =&gt; {
    it(&#39;should load without error&#39;, done =&gt; {
      // your actual testing urls will likely be `http://localhost:port/path`
      nightmare.goto(&#39;https://www.baidu.com&#39;)
        .end()
        .then(function (result) {
          done()
        })
        .catch(done)
    })
  })
})
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005734-84455" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="nightmare配合mocha测试"><a class="header-anchor" href="#nightmare配合mocha测试" aria-hidden="true">#</a> nightmare配合mocha测试</h3><p>nightmare可以进行网页的抓取，配合mocha进行页面的测试：</p><p>安装<code>mocha</code></p><div class="language-bash line-numbers-mode"><pre><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev mocha
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005734-86811">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="npm install --save-dev mocha
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005734-86811" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>还可以安装一些断言库，如：<code>chai</code></p></blockquote><p>新建测试：</p><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">const</span> Nightmare <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;nightmare&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> assert <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;assert&#39;</span><span class="token punctuation">)</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;Search nightmare&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">timeout</span><span class="token punctuation">(</span><span class="token string">&#39;30s&#39;</span><span class="token punctuation">)</span>

  <span class="token keyword">let</span> nightmare <span class="token operator">=</span> <span class="token keyword">null</span>
  
  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    nightmare <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Nightmare</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;should load with result nightmare&#39;</span><span class="token punctuation">,</span> <span class="token parameter">done</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> selector <span class="token operator">=</span> <span class="token string">&#39;em&#39;</span>
    nightmare<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">&#39;https://www.baidu.com&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&#39;#kw&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;nightmare&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token string">&#39;#su&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token string">&#39;em&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token parameter">selector</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// now we&#39;re executing inside the browser scope.</span>
      <span class="token keyword">return</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">.</span>innerText
    <span class="token punctuation">}</span><span class="token punctuation">,</span> selector<span class="token punctuation">)</span> <span class="token comment">// &lt;-- that&#39;s how you pass parameters from Node scope to browser scope</span>
      <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
      assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token string">&#39;nightmare&#39;</span><span class="token punctuation">)</span>
      <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005734-29993">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="const Nightmare = require(&#39;nightmare&#39;)
const assert = require(&#39;assert&#39;)

describe(&#39;Search nightmare&#39;, () =&gt; {
  this.timeout(&#39;30s&#39;)

  let nightmare = null
  
  beforeEach(() =&gt; {
    nightmare = new Nightmare()
  })

  it(&#39;should load with result nightmare&#39;, done =&gt; {
    const selector = &#39;em&#39;
    nightmare.goto(&#39;https://www.baidu.com&#39;)
      .type(&#39;#kw&#39;, &#39;nightmare&#39;)
      .click(&#39;#su&#39;)
      .wait(&#39;em&#39;)
      .evaluate(selector =&gt; {
      // now we&#39;re executing inside the browser scope.
      return document.querySelector(selector).innerText
    }, selector) // &lt;-- that&#39;s how you pass parameters from Node scope to browser scope
      .end()
      .then(function (result) {
      console.log(result)
      assert.equal(result, &#39;nightmare&#39;)
      done()
    })
      .catch(done)
  })
})
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005734-29993" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>将mocha作为测试脚本添加到您的 <code>package.json</code>：</p><div class="language-json line-numbers-mode"><pre><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mocha&quot;</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005734-90245">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="&quot;scripts&quot;: {
  &quot;test&quot;: &quot;mocha&quot;
}
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005734-90245" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="api介绍"><a class="header-anchor" href="#api介绍" aria-hidden="true">#</a> API介绍</h3><h4 id="nightmare的配置项"><a class="header-anchor" href="#nightmare的配置项" aria-hidden="true">#</a> nightmare的配置项</h4><div class="language-js line-numbers-mode"><pre><code><span class="token function">waitTimeout</span> <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">30</span>s<span class="token punctuation">)</span>
<span class="token function">gotoTimeout</span> <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">30</span>s<span class="token punctuation">)</span>
<span class="token function">loadTimeout</span> <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token operator">:</span> infinite<span class="token punctuation">)</span>
<span class="token function">executionTimeout</span> <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">30</span>s<span class="token punctuation">)</span>
paths
switches
electronPath
dock
openDevTools
<span class="token function">typeInterval</span> <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">100</span>ms<span class="token punctuation">)</span>
<span class="token function">pollInterval</span> <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">250</span>ms<span class="token punctuation">)</span>
<span class="token function">maxAuthRetries</span> <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">)</span>
certificateSubjectName
<span class="token punctuation">.</span><span class="token function">engineVersions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">useragent</span><span class="token punctuation">(</span>useragent<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">authentication</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> password<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">authentication</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> password<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">halt</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> done<span class="token punctuation">)</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005735-69426">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="waitTimeout (default: 30s)
gotoTimeout (default: 30s)
loadTimeout (default: infinite)
executionTimeout (default: 30s)
paths
switches
electronPath
dock
openDevTools
typeInterval (default: 100ms)
pollInterval (default: 250ms)
maxAuthRetries (default: 3)
certificateSubjectName
.engineVersions()
.useragent(useragent)
.authentication(user, password)
.authentication(user, password)
.halt(error, done)
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005735-69426" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>配置链接：<a href="https://github.com/segmentio/nightmare#nightmareoptions" target="_blank" rel="noopener noreferrer">https://github.com/segmentio/nightmare#nightmareoptions</a></p><h4 id="页面交互相关"><a class="header-anchor" href="#页面交互相关" aria-hidden="true">#</a> 页面交互相关</h4><div class="language-js line-numbers-mode"><pre><code><span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">mousedown</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">mouseup</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">mouseover</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">mouseout</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span>selector<span class="token punctuation">[</span><span class="token punctuation">,</span> text<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>selector<span class="token punctuation">[</span><span class="token punctuation">,</span> text<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">check</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">uncheck</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> option<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span>top<span class="token punctuation">,</span> left<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">inject</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> file<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>fn<span class="token punctuation">[</span><span class="token punctuation">,</span> arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">,</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span>fn<span class="token punctuation">[</span><span class="token punctuation">,</span> arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">,</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span>header<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005735-20095">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content=".back()
.forward()
.refresh()
.click(selector)
.mousedown(selector)
.mouseup(selector)
.mouseover(selector)
.mouseout(selector)
.type(selector[, text])
.insert(selector[, text])
.check(selector)
.uncheck(selector)
.select(selector, option)
.scrollTo(top, left)
.viewport(width, height)
.inject(type, file)
.evaluate(fn[, arg1, arg2,...])
.wait(ms)
.wait(selector)
.wait(fn[, arg1, arg2,...])
.header(header, value)
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005735-20095" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><a href="https://github.com/segmentio/nightmare#interact-with-the-page" target="_blank" rel="noopener noreferrer">配置参考链接</a></p><h4 id="页面提取"><a class="header-anchor" href="#页面提取" aria-hidden="true">#</a> 页面提取</h4><div class="language-js line-numbers-mode"><pre><code><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">visible</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">removeListener</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">screenshot</span><span class="token punctuation">(</span><span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">,</span> clip<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> saveType<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">pdf</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005735-48201">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content=".exists(selector)
.visible(selector)
.on(event, callback)
.once(event, callback)
.removeListener(event, callback)
.screenshot([path][, clip])
.html(path, saveType)
.pdf(path, options)
.title()
.url()
.path()
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005735-48201" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><a href="https://github.com/segmentio/nightmare#extract-from-the-page" target="_blank" rel="noopener noreferrer">配置参考链接</a></p><h2 id="补充学习"><a class="header-anchor" href="#补充学习" aria-hidden="true">#</a> 补充学习</h2><h3 id="补充资料"><a class="header-anchor" href="#补充资料" aria-hidden="true">#</a> 补充资料</h3><h4 id="软件测试的分类"><a class="header-anchor" href="#软件测试的分类" aria-hidden="true">#</a> 软件测试的分类</h4><p><strong>第一部分：软件测试的分类</strong></p><ul><li><p>按测试执行阶段划分</p><p>单元测试、集成测试、系统测试、验收测试（正式验收测试、Alpha测试、Beta测试）</p></li><li><p>按测试技术划分</p><p>白盒测试、黑盒测试、灰盒测试</p></li><li><p>被测试对象是否运行划分</p><p>动态测试、静态测试（文档检查、代码走查、界面检查）</p></li><li><p>按不同的测试手段划分</p><p>手工测试、自动化测试</p></li><li><p>按测试包含的内容划分</p><p>功能测试、界面测试、安全测试、兼容性测试、易用性测试、性能测试、压力测试、负载测试、恢复测试</p></li><li><p>其他测试</p><p>冒烟测试、回归测试、探索性测试/自由测试（测试思维）</p></li></ul><p><strong>第二部分：接下来对软件测试分类进行一个说明</strong></p><p><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200310105733.jpg" alt="img"><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200310105733.jpg" alt="img"></p><p><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200310105734.png" alt="img"><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200310105735.jpg" alt="img"></p><p><strong>第三部分：测试工具</strong></p><p>SVN，Git——&gt;版本控制管理工具</p><p>禅道——&gt;Bug管理工具</p><p>Fiddler——&gt;抓包，定位问题你</p><p>postman，jmeter，soapui——&gt;接口测试</p><p>Loadrunner，Jmeter——&gt;性能，压力测试</p><h4 id="2019年javascript测试概览"><a class="header-anchor" href="#2019年javascript测试概览" aria-hidden="true">#</a> 2019年Javascript测试概览</h4><p><a href="https://medium.com/welldone-software/an-overview-of-javascript-testing-in-2019-264e19514d0a" target="_blank" rel="noopener noreferrer">https://medium.com/welldone-software/an-overview-of-javascript-testing-in-2019-264e19514d0a</a></p><p>这是一篇非常好的国外的博文，同时也是2018年Javascript测试概览的作者。这里有2018年的译文：</p><p><a href="https://zhuanlan.zhihu.com/p/32702421" target="_blank" rel="noopener noreferrer">展望 2018 年 JavaScript Testing</a></p><p>在文中很好介绍到了测试类型，并举了大量的例子，非常全面。</p><h4 id="什么是tdd"><a class="header-anchor" href="#什么是tdd" aria-hidden="true">#</a> 什么是TDD？</h4><p><a href="https://juejin.im/post/5c3e73876fb9a049d37f5db1" target="_blank" rel="noopener noreferrer">测试驱动开发（TDD）总结——原理篇</a></p><p>TDD （Test Driven Development） 在不同的圈子、不同的角色的认知中可能会有不同的理解，有人可能会理解成 ATDD（Acceptance Test Driven Development），也有人可能会理解成 UTDD（Unit Test Driven Development），为了避免产生歧义，<strong>文章涉及到 TDD 专指 UTDD（Unit Test Driven Development），即 「单元测试驱动开发」</strong>。</p><p>TDD 的目标</p><blockquote><p>Kent Beck 在他的著作《Test-Driven Development》一书中提到：“<strong>代码简洁可用</strong>这句言简意赅的话，正是 TDD 所追求的目标”。</p></blockquote><p><strong>对于如何保证“代码简洁可用”可以使用分而治之的方法，先达到“可用”目标，再追求“简洁”目标。</strong></p><p><strong>可用：</strong> 保证代码通过自动化测试。</p><p><strong>代码简洁：</strong> 在不同阶段人们对简洁的理解程度也不一样，不过遵循的原则差不多，例如 OOD 的 SOLID 原则，Kent Beck 的 Simple Design 原则等。</p><p>虽然有很多因素妨碍我们得到整洁的代码，甚至可用的代码，无需征求太多意见，只需要采用 TDD 的开发方式来驱动出简洁可用的代码。</p><h4 id="karma的前世今生"><a class="header-anchor" href="#karma的前世今生" aria-hidden="true">#</a> Karma的前世今生</h4><p>2016年的文章，由淘宝前端团队书写：<a href="http://taobaofed.org/blog/2016/01/08/karma-origin/" target="_blank" rel="noopener noreferrer">http://taobaofed.org/blog/2016/01/08/karma-origin/</a></p><p>通篇介绍了karma的工作原理及实现原理，非常有价值的文章。</p><h3 id="ava框架的配置文件"><a class="header-anchor" href="#ava框架的配置文件" aria-hidden="true">#</a> ava框架的配置文件</h3><div class="language-json line-numbers-mode"><pre><code><span class="token punctuation">{</span>
	<span class="token property">&quot;ava&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;files&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
			<span class="token string">&quot;test/**/*&quot;</span><span class="token punctuation">,</span>
			<span class="token string">&quot;!test/exclude-files-in-this-directory&quot;</span><span class="token punctuation">,</span>
			<span class="token string">&quot;!**/exclude-files-with-this-name.*&quot;</span>
		<span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token property">&quot;helpers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
			<span class="token string">&quot;**/helpers/**/*&quot;</span>
		<span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token property">&quot;sources&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
			<span class="token string">&quot;src/**/*&quot;</span>
		<span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
			<span class="token string">&quot;*oo&quot;</span><span class="token punctuation">,</span>
			<span class="token string">&quot;!foo&quot;</span>
		<span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token property">&quot;cache&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">&quot;concurrency&quot;</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
		<span class="token property">&quot;failFast&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">&quot;failWithoutAssertions&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		<span class="token property">&quot;environmentVariables&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;MY_ENVIRONMENT_VARIABLE&quot;</span><span class="token operator">:</span> <span class="token string">&quot;some value&quot;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token property">&quot;tap&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">&quot;verbose&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">&quot;compileEnhancements&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		<span class="token property">&quot;require&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
			<span class="token string">&quot;@babel/register&quot;</span>
		<span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token property">&quot;babel&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;extensions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jsx&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
			<span class="token property">&quot;testOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				<span class="token property">&quot;babelrc&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1629558005735-20793">复制成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="{
	&quot;ava&quot;: {
		&quot;files&quot;: [
			&quot;test/**/*&quot;,
			&quot;!test/exclude-files-in-this-directory&quot;,
			&quot;!**/exclude-files-with-this-name.*&quot;
		],
		&quot;helpers&quot;: [
			&quot;**/helpers/**/*&quot;
		],
		&quot;sources&quot;: [
			&quot;src/**/*&quot;
		],
		&quot;match&quot;: [
			&quot;*oo&quot;,
			&quot;!foo&quot;
		],
		&quot;cache&quot;: true,
		&quot;concurrency&quot;: 5,
		&quot;failFast&quot;: true,
		&quot;failWithoutAssertions&quot;: false,
		&quot;environmentVariables&quot;: {
			&quot;MY_ENVIRONMENT_VARIABLE&quot;: &quot;some value&quot;
		},
		&quot;tap&quot;: true,
		&quot;verbose&quot;: true,
		&quot;compileEnhancements&quot;: false,
		&quot;require&quot;: [
			&quot;@babel/register&quot;
		],
		&quot;babel&quot;: {
			&quot;extensions&quot;: [&quot;js&quot;, &quot;jsx&quot;],
			&quot;testOptions&quot;: {
				&quot;babelrc&quot;: false
			}
		}
	}
}
" data-mdic-attach-content="copyright | [artiely]" data-mdic-notify-id="j-notify-1629558005735-20793" data-mdic-notify-delay="1000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t=&#39;&#39;,e=&#39;&#39;)=&gt;new Promise((c,o)=&gt;{const n=document.createElement(&#39;textarea&#39;),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand(&#39;copy&#39;);document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display=&#39;block&#39;,setTimeout(()=&gt;{n.style.display=&#39;none&#39;},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制</button></div></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><ul><li><code>files</code>：用于选择测试文件的glob模式数组。带有下划线前缀的文件将被忽略。默认情况下，仅选择具有<code>js</code>扩展名的文件，即使该模式与其他文件匹配。指定<code>extensions</code>并<code>babel.extensions</code>允许其他文件扩展名</li><li><code>helpers</code>：用于选择帮助文件的glob模式数组。这里匹配的文件永远不会被视为测试。默认情况下，仅选择具有<code>js</code>扩展名的文件，即使该模式与其他文件匹配。指定<code>extensions</code>并<code>babel.extensions</code>允许其他文件扩展名</li><li><code>sources</code>：一组glob模式，用于匹配文件，这些文件在更改时会导致重新运行测试（在监视模式下）。有关详细信息，<a href="https://github.com/avajs/ava/blob/master/docs/recipes/watch-mode.md#source-files-and-test-files" target="_blank" rel="noopener noreferrer">请参阅</a></li><li><code>match</code>：通常在<code>package.json</code>配置中没用，但等同于在CLI上指定<code>--match</code></li><li><code>cache</code>：缓存编译的测试和帮助文件<code>node_modules/.cache/ava</code>。如果<code>false</code>，文件缓存在临时目录中</li><li><code>failFast</code>：一旦测试失败，停止运行进一步的测试</li><li><code>failWithoutAssertions</code>：如果设置成<code>false</code>，那么如果没有运行断言，则测试失败</li><li><code>environmentVariables</code>：指定要供测试使用的环境变量。此处定义的环境变量会覆盖其中的环境变量<code>process.<wbr>env</code></li><li><code>tap</code>：设置成 <code>true</code>，启用TAP报告</li><li><code>verbose</code>：设置成 <code>true</code>，启用详细输出</li><li><code>snapshotDir</code>：指定用于存储快照文件的固定位置。如果快照最终位于错误的位置，请使用此选项</li><li><code>compileEnhancements</code>：设置成 <code>false</code>，禁用了 <a href="https://github.com/avajs/ava/blob/master/docs/03-assertions.md#enhanced-assertion-messages" target="_blank" rel="noopener noreferrer"><code>power-assert</code></a>，否则有助于提供更具描述性的错误消息， 并检测<code>t.throws()</code>断言的不当使用</li><li><code>extensions</code>：未使用AVA的Babel预设进行预编译的测试文件的扩展名。请注意，文件仍然会被编译为启用<code>power-assert</code>和其他功能，因此您可能还需要设置<code>compileEnhancements</code>为<code>false</code>文件是否为有效的JavaScript。设置此<code>&quot;js&quot;</code>值会覆盖默认值，因此请确保在列表中包含该扩展名，只要它不包含在内<code>babel.extensions</code></li><li><code>require</code>：在运行测试之前需要额外的模块。工作进程中需要模块</li><li><code>babel</code>：测试文件特定的Babel选项。有关详细信息，请参阅<a href="https://github.com/avajs/ava/blob/master/docs/recipes/babel.md#configuring-babel" target="_blank" rel="noopener noreferrer">Babel配置</a></li><li><code>babel.extensions</code>：将使用AVA的Babel预设进行预编译的测试文件的扩展。设置此选项会覆盖默认<code>&quot;js&quot;</code>值，因此请确保在列表中包含该扩展名。</li><li><code>timeout</code>：AVA中的超时行为与其他测试框架中的行为不同。AVA在每次测试后重置计时器，如果在指定的超时内没有收到新的测试结果，则强制测试退出。这可用于处理停滞的测试。请参阅我们的<a href="https://github.com/avajs/ava/blob/master/docs/07-test-timeouts.md" target="_blank" rel="noopener noreferrer">超时文档</a>以获取更多选</li></ul><p>请注意，在CLI上提供文件会覆盖该<code>files</code>选项。</p><h2 id="参考资料"><a class="header-anchor" href="#参考资料" aria-hidden="true">#</a> 参考资料</h2><ul><li><a href="https://zhuanlan.zhihu.com/p/47009664" target="_blank" rel="noopener noreferrer">使用Jest测试JavaScript(Mock篇)</a></li></ul></div></div></div><div class="footer"><div class="follow"><a href="https://github.com/artiely" target="_target" title="github"><i class="icon iconfont"></i></a><a href="https://gitee.com/artiely" target="_target" title="gitee"><i class="icon iconfont"></i></a><a href="https://www.npmjs.com/~artiely" target="_target" title="npm"><i class="icon iconfont"></i></a><a href="mailto:artiely1024@gmail.com" title="gmail"><i class="icon iconfont"></i></a><a href="https://www.youtube.com/channel/UC3U9zfLMepBqyQjlvEVhQDQ?view_as=subscriber" target="_target" title="youtube"><i class="icon iconfont"></i></a><a href="https://www.zhihu.com/people/artiely-19" target="_target" title="zhihu"><i class="icon iconfont"></i></a><a href="https://space.bilibili.com/31432769?spm_id_from=333.33.b_73656375726974794f75744c696e6b.1" target="_target" title="bilibili"><i class="icon iconfont"></i></a></div><p class="footer-copyright"> ©Artiely <span class="time">-2019-2021</span></p></div><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"9c4cbb8a\",\"code_index.md\":\"e2cac647\",\"comment_index.md\":\"f62f9a07\",\"about_index.md\":\"8b060494\",\"timeline_index.md\":\"65792fa5\",\"post_2017_2017-6-10-tcp.md\":\"f3097174\",\"post_2017_2017-6-6-css-1px.md\":\"99c961a5\",\"post_2017_2017-6-6-css-ios-android.md\":\"8722cf5c\",\"post_2017_2017-6-6-css-sticky-footer.md\":\"c83661fd\",\"post_2017_2017-6-6-git.md\":\"b3b4882d\",\"post_2017_2017-6-7-css-mobile-scroll-through.md\":\"5ecd7091\",\"post_2017_2017-6-8-yahoo-rules14.md\":\"2bc9ba3b\",\"post_2017_2017-6-9-form-default-submit.md\":\"317a039a\",\"post_2017_2017-7-4-moment.md\":\"12766297\",\"post_2017_2017-7-7-css-rules.md\":\"16fcd222\",\"post_2017_2017-7-7-js-rules.md\":\"a9e37a92\",\"post_2017_2017-7-7-rules-file.md\":\"1eef21cc\",\"post_2017_2017-7-7-rules-html.md\":\"9a34e92f\",\"post_2018_2018-1-30-centos-setup-nodejs.md\":\"462cdb9d\",\"post_2018_2018-10-10-axios.md\":\"9430b2fb\",\"post_2018_2018-10-10-chrome-dev-tips.md\":\"fc1c7a34\",\"post_2018_2018-10-10-get-post.md\":\"78c3ad41\",\"post_2018_2018-10-10-git-green-pointer.md\":\"96450586\",\"post_2018_2018-10-10-js-bit-operation.md\":\"7fbbcab4\",\"post_2018_2018-10-10-npm-nrm.md\":\"25964696\",\"post_2018_2018-10-10-pm2.md\":\"af426e22\",\"post_2018_2018-10-10-vue-pracel.md\":\"b993216d\",\"post_2018_2018-10-7-node-spider.md\":\"857d597a\",\"post_2018_2018-3-12-nodejs-npm.md\":\"5f2fced5\",\"post_2018_2018-6-26-web-koa-egg.md\":\"fd511fa7\",\"post_2018_2018-6-9-nuxt.md\":\"5133278a\",\"post_2018_2018-7-10-electron-message.md\":\"df1a434b\",\"post_2018_2018-7-10-websocket.md\":\"36433317\",\"post_2018_2018-7-11-electron-nedb.md\":\"69eef357\",\"post_2018_2018-7-11-electron-shortcut-cliboard-nativeimage.md\":\"160bf927\",\"post_2018_2018-7-3-electron-init.md\":\"55dafbf2\",\"post_2018_2018-7-4-electron-base.md\":\"4ffa05a8\",\"post_2018_2018-7-5-electron-model.md\":\"99d0ee88\",\"post_2018_2018-7-6-electron-menu-shortcut.md\":\"3877dff6\",\"post_2018_2018-7-7-electron-main-render.md\":\"49883d99\",\"post_2018_2018-7-8-electron-dialog.md\":\"cea64172\",\"post_2018_2018-7-8-electron-shell-url-webview.md\":\"632ff6c6\",\"post_2018_2018-7-9-electron-ico.md\":\"3f16079e\",\"post_2018_2018-8-7-egg-start.md\":\"917938ad\",\"post_2018_2018-8-8-question.md\":\"48b884ac\",\"post_2018_2018-8-8-vue-rules.md\":\"4d190a9b\",\"post_2018_2018-9-7-js.md\":\"1c72ef9b\",\"tags_index.md\":\"327e5493\",\"post_2019_2019-10-27-node-pm2.md\":\"9bf51a37\",\"post_2019_2019-10-3-alinode.md\":\"288fe20f\",\"post_2019_2019-11-16-nodejs-api.md\":\"f0f4855f\",\"post_2019_2019-4-15-nodejs-tcp-udp-h2.md\":\"84ad74a8\",\"post_2019_2019-4-16-vue-cli3+to-plugin.md\":\"d5a631c4\",\"post_2019_2019-4-3-sentry-sourcemap.md\":\"f64f3133\",\"post_2019_2019-4-3-vuepress-theme.md\":\"aadb5a32\",\"post_2019_2019-5-5-restful-graphql.md\":\"2f92dc34\",\"post_2019_2019-6-1-linux.md\":\"d4d0e779\",\"post_2019_2019-6-12-deploy.md\":\"a48e1e27\",\"post_2019_2019-6-19-fontend-performance-optimization.md\":\"2ed632f9\",\"post_2019_2019-6-27-eslint-test.md\":\"db9e0ea5\",\"post_2019_2019-6-4-docker.md\":\"e662a2af\",\"post_2019_2019-6-4-nodejs-events.md\":\"80c06156\",\"post_2019_2019-6-6-css-fixedleft-autoright.md\":\"e084b81c\",\"post_2019_2019-6-6-vue-observable.md\":\"86b73e8e\",\"post_2019_2019-7-13-automated-testing.md\":\"09bf2db1\",\"post_2019_2019-7-6-android-studio-flutter-shortcut.md\":\"1f5cf5ff\",\"post_2019_2019-7-6-dart-flutter-conf.md\":\"c5adc038\",\"post_2019_2019-8-14-nosql.md\":\"6ac4bdf9\",\"post_2021_2021-1-3-puppeteer.md\":\"83ca78b1\",\"post_2021_2021-2-23-proxy.md\":\"4689cc77\",\"post_2021_2021-3-18-appleid.md\":\"11bca294\",\"post_2021_2021-6-15-mini.md\":\"0a73df2a\",\"post_2021_2021-7-23-pixijs.md\":\"087f3a60\",\"post_2021_2021-8-15-resize-observer.md\":\"c07759f7\",\"post_2021_2021-8-16-min-share.md\":\"1788e49f\",\"post_2020_2020-12-31-css.md\":\"15c1ea52\",\"post_2020_2020-3-16-chrome-plugin.md\":\"310dce5f\",\"post_2020_2020-3-16-vscode-plugin.md\":\"4a45a823\",\"post_2020_2020-3-16-windows-plugin.md\":\"3e56b4e0\",\"post_2020_2020-3-18-electron-mirror-down.md\":\"d923a2a1\",\"post_2020_2020-3-18-electron-updater.md\":\"8e3021de\",\"post_2020_2020-3-19-timer.js.md\":\"c16a77da\",\"post_2020_2020-3-20-antd-vue-pro.md\":\"5fbce157\",\"post_2020_2020-3-20-js-how-to-work.md\":\"6bbe1f7b\",\"post_2020_2020-3-29-vuepress-plugin.md\":\"db191ff1\",\"post_2020_2020-3-31-shituzhengmei.md\":\"2008b4d6\",\"post_2020_2020-4-1-plupload.md\":\"23cf540b\",\"post_2020_2020-4-2-cmder.md\":\"462d53db\",\"post_2020_2020-4-29-vue-hook-lifecycle.md\":\"3b8da007\",\"post_2020_2020-4-4-yiqin.md\":\"c5c02598\",\"post_2020_2020-4-6-plop.md\":\"2e7dbcd2\",\"post_2020_2020-5-22-ali-oss.md\":\"706bb3dd\",\"post_2020_2020-5-29-axios.md\":\"259f6b15\",\"post_2020_2020-6-12-icon.md\":\"501ceb18\",\"post_2020_2020-6-20-limit-chars.md\":\"e2e71619\",\"post_2020_2020-6-23-charslimit.md\":\"4a0ba0fc\",\"post_2020_2020-6-25-custom-event.md\":\"bfd1bcf3\",\"post_2020_2020-6-25-photo.md\":\"f76c87ce\",\"post_2020_2020-6-29-component.md\":\"29aafcf6\",\"post_2020_2020-6-5-01-vue-cli.md\":\"5147397a\",\"post_2020_2020-6-5-02-vue-dir.md\":\"baae8bf6\",\"post_2020_2020-6-5-03-vue-config.md\":\"15a391f0\",\"post_2020_2020-6-5-04-vue.webpack.md\":\"47568c64\",\"post_2020_2020-6-5-05-env-mode.md\":\"7adba4cf\",\"post_2020_2020-6-5-06-local-preview.md\":\"0ee33aaa\",\"post_2020_2020-6-9-01-plugin.md\":\"55f9eb8d\",\"post_2020_2020-7-1-vue-api.md\":\"7f076787\",\"post_2020_2020-7-1-vuex-api.md\":\"07f9dee0\",\"post_2020_2020-7-13-madel.md\":\"4c1a07cf\",\"post_2020_2020-7-14-share.md\":\"922d2f73\",\"post_2020_2020-7-21-taro.md\":\"db1b6393\",\"post_2020_2020-7-23-temp.md\":\"e381ddcb\",\"post_2020_2020-7-9-thks-js.md\":\"05b6b915\",\"post_2020_2020-8-17.md\":\"0cb9026c\",\"post_2020_2020-8-27-frontend-css1.md\":\"97a8a6ba\",\"post_2020_2020-8-28-frontend-css2.md\":\"ddbec19e\",\"post_2020_2020-8-29-frontend-js1.md\":\"9611eccf\",\"post_2020_2020-8-29-frontend-js2.md\":\"8554d168\",\"post_2020_2020-8-29-frontend-js3.md\":\"f9031f99\",\"post_2020_2020-8-30-frontend-brower1.md\":\"e278fc38\",\"post_2020_2020-8-30-frontend-brower2.md\":\"6c9192b1\",\"post_2020_2020-8-31-frontend-brower3.md\":\"73ecc99d\",\"post_2020_2020-8-31-frontend-brower4.md\":\"36abf36f\",\"post_2020_2020-9-1-fw.md\":\"1097ed0e\",\"post_2020_2020-9-1-fw2.md\":\"0a2181be\",\"post_2020_2020-9-15-js-arr.md\":\"6f474a04\",\"post_2020_2020-9-2-proxy.md\":\"b61ef5ab\",\"post_2020_2020-9-24-interview.md\":\"cf0b1b13\",\"post_2020_2020-9-3-brower.md\":\"5e5a254b\",\"post_2020_2020-9-5-what-happens.md\":\"2052d068\",\"post_2020_2020-9-7-recursive.md\":\"df30bb82\"}")</script>
    <script type="module" async src="/vitepress-blog/assets/app.746f22cf.js"></script>
  </body>
</html>